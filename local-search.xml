<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CICD - Build, test, and deploy containers to ACR/AKS using GitHub Actions</title>
    <link href="/2024/01/21/cicd-build-test-and-deploy-containers-to-acr-aks-using-github-actions/"/>
    <url>/2024/01/21/cicd-build-test-and-deploy-containers-to-acr-aks-using-github-actions/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p><img src="https://learn.microsoft.com/en-us/azure/architecture/guide/aks/media/ci-cd-gitops-github-actions-aks-push.png" alt="CI/CD for AKS apps with GitHub Actions and GitFlow - Azure Example  Scenarios | Microsoft Learn"></p><h1 id="CICD-Build-test-and-deploy-containers-to-ACR-AKS-using-GitHub-Actions"><a href="#CICD-Build-test-and-deploy-containers-to-ACR-AKS-using-GitHub-Actions" class="headerlink" title="CICD - Build, test, and deploy containers to ACR, AKS using GitHub Actions"></a>CICD - Build, test, and deploy containers to ACR, AKS using GitHub Actions</h1><p>Refer to:</p><p><a href="https://learn.microsoft.com/en-us/azure/aks/kubernetes-action">Build, test, and deploy containers to Azure Kubernetes Service (AKS) using GitHub Actions</a></p><p><a href="https://learn.microsoft.com/en-us/azure/aks/cluster-container-registry-integration?tabs=azure-cli">Authenticate with Azure Container Registry (ACR) from Azure Kubernetes Service (AKS)</a></p><h2 id="Prepare-ACR-and-AKS"><a href="#Prepare-ACR-and-AKS" class="headerlink" title="Prepare ACR and AKS"></a>Prepare ACR and AKS</h2><ol><li><p>Create ACR, AKS and attach ACR to AKS with AZ CLI</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">MYRG=felixRG<br>MYACR=felixacr<br>MYAKS=felixaks<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">create ACR</span><br>az acr create -n $MYACR -g $MYRG --sku basic<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Enable admin access of ACR, to docker login to acr</span><br>az acr update --name $MYACR --admin-enabled true<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">create AKS</span><br>az aks create -n $MYAKS -g $MYRG --generate-ssh-keys --attach-acr $MYACR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Attach using acr-name</span><br>az aks update -n $MYAKS -g $MYRG --attach-acr $MYACR<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Option: you can also Attach using acr-resource-id</span><br>az aks update -n $MYAKS -g $MYRG --attach-acr &lt;acr-resource-id&gt;<br><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>To detach a ACR from AKS</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Detach using acr-name</span><br>az aks update -n myAKSCluster -g myResourceGroup --detach-acr &lt;acr-name&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Detach using acr-resource-id</span><br>az aks update -n myAKSCluster -g myResourceGroup --detach-acr &lt;acr-resource-id&gt;<br></code></pre></td></tr></table></figure></blockquote></li><li><p>Test: working with ACR &amp; AKS</p><ul><li><p>Import an nginx image into ACR</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">az acr import  -n $MYACR --source docker.io/library/nginx:latest --image nginx:v1<br></code></pre></td></tr></table></figure></li><li><p>Get AKS credentials to connect to AKS through kubectl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">az aks get-credentials -g $MYRG -n $MYAKS<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>Example of default AKS setup:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % az aks get-credentials -g $MYRG -n $MYAKS<br>Merged &quot;felixaks&quot; as current context in /Users/felixy/.kube/config<br><br>felixy@USLC-FELIXY-M ~ % kubectl get nodes<br>NAME                                STATUS   ROLES   AGE    VERSION<br>aks-nodepool1-32082944-vmss000000   Ready    agent   4h3m   v1.27.7<br>aks-nodepool1-32082944-vmss000001   Ready    agent   4h3m   v1.27.7<br>aks-nodepool1-32082944-vmss000002   Ready    agent   4h3m   v1.27.7<br><br>felixy@USLC-FELIXY-M ~ % kubectl get pods -A<br>NAMESPACE     NAME                                  READY   STATUS    RESTARTS   AGE<br>kube-system   azure-ip-masq-agent-42rds             1/1     Running   0          4h4m<br>kube-system   azure-ip-masq-agent-m8fcj             1/1     Running   0          4h4m<br>kube-system   azure-ip-masq-agent-pzgxd             1/1     Running   0          4h4m<br>kube-system   cloud-node-manager-hwhql              1/1     Running   0          4h4m<br>kube-system   cloud-node-manager-pj289              1/1     Running   0          4h4m<br>kube-system   cloud-node-manager-s6h57              1/1     Running   0          4h4m<br>kube-system   coredns-789789675-6pkjs               1/1     Running   0          4h4m<br>kube-system   coredns-789789675-sh56f               1/1     Running   0          4h3m<br>kube-system   coredns-autoscaler-649b947bbd-kdthp   1/1     Running   0          4h4m<br>kube-system   csi-azuredisk-node-79vq5              3/3     Running   0          4h4m<br>kube-system   csi-azuredisk-node-dpvvp              3/3     Running   0          4h4m<br>kube-system   csi-azuredisk-node-q547p              3/3     Running   0          4h4m<br>kube-system   csi-azurefile-node-kwf2b              3/3     Running   0          4h4m<br>kube-system   csi-azurefile-node-nqb98              3/3     Running   0          4h4m<br>kube-system   csi-azurefile-node-wqwjn              3/3     Running   0          4h4m<br>kube-system   konnectivity-agent-7797848fc-4bzp4    1/1     Running   0          3h9m<br>kube-system   konnectivity-agent-7797848fc-d9wlc    1/1     Running   0          3h9m<br>kube-system   kube-proxy-flssc                      1/1     Running   0          4h4m<br>kube-system   kube-proxy-l4g5j                      1/1     Running   0          4h4m<br>kube-system   kube-proxy-qlgvl                      1/1     Running   0          4h4m<br>kube-system   metrics-server-5467676b76-ghmfd       2/2     Running   0          4h3m<br>kube-system   metrics-server-5467676b76-rx7p4       2/2     Running   0          4h3m<br></code></pre></td></tr></table></figure></blockquote></li><li><p>Create a deployment yaml file <code>nginx-deployment.yaml</code> for a nginx deployment and a service for load balancer for expose the nginx service to public internet</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx0-deployment</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx0</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx0</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx0</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">felixacr.azurecr.io/nginx:v1</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx0-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx0</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><blockquote><p>[!CAUTION]</p><p><img src="https://felixyanghui.synology.me:8441/images/2024/01/22/image-20240121190648384.png" alt="image-20240121190648384"></p><p>When you use a Kubernetes Service of type <code>LoadBalancer</code> in Azure Kubernetes Service (AKS), it will automatically create an Azure Load Balancer and expose your service to the internet. This Load Balancer acts as the point of contact for external traffic to your service.</p><p>Here’s what happens when you apply the provided YAML in an AKS environment:</p><ol><li><p><strong>Resource Group:</strong></p><p>AKS often creates a separate <em>managed</em> resource group for resources like network resources and VMs. This is different from the resource group you specify when creating the AKS cluster. The Load Balancer might be located in this managed resource group. The name of this managed resource group usually follows the pattern <code>MC_&lt;yourResourceGroup&gt;_&lt;yourAKSClusterName&gt;_&lt;region&gt;</code>.</p><p>Azure create a VNet and subnet and NSG together with the load balancer in the resource group for a standard AKS setup</p></li><li><p><strong>Azure Load Balancer Creation</strong>:</p><ul><li><p>The <code>type: LoadBalancer</code> specification in the Service manifest instructs Kubernetes to provision an external Load Balancer in your Azure cloud environment.</p></li><li><p><em>AKS communicates with Azure to <strong>create a Load Balancer instance</strong>.</em></p></li><li><p>You can identify the created LB by default:</p><p><code>az network lb list --query &quot;[].&#123;name:name, resourceGroup:resourceGroup&#125;&quot; -o table</code></p></li></ul></li><li><p><strong>Networking Setup</strong>:</p><ul><li>The Load Balancer is configured with a public IP address.</li><li>It forwards incoming traffic on the specified port (in this case, port 80) to the selected pods, matching the <code>selector</code> criteria in the Service definition.</li></ul></li><li><p><strong>Service Exposure</strong>:</p><ul><li>The service <code>nginx0-service</code> will be exposed on the public IP address of the Azure Load Balancer.</li><li>This means the Nginx deployment becomes accessible over the internet at this public IP on port 80.</li></ul></li><li><p><strong>Integration with AKS</strong>:</p><ul><li>AKS manages the integration between the Kubernetes Service and the Azure Load Balancer, including health checks and updating the Load Balancer configuration if the underlying pods change.</li></ul></li></ol></blockquote><blockquote><p>[!NOTE]</p><p>When you add more services in Azure Kubernetes Service (AKS), AKS will not provision a new load balancer for each service if these services are of type <code>LoadBalancer</code>. Instead, it continues to use the default Load Balancer that was initially created and adds new rules to it. This is how it typically works:</p><ol><li><strong>Single Load Balancer for Multiple Services</strong>:<ul><li>When you create the first service of type <code>LoadBalancer</code> in AKS, a Load Balancer is provisioned in Azure.</li><li>Subsequent services of type <code>LoadBalancer</code> that you create in the same AKS cluster will use the same Load Balancer.</li><li>AKS efficiently manages this by adding new frontend configurations, backend pools, and routing rules to the existing Load Balancer for each new service.</li></ul></li><li><strong>Public IP Addresses</strong>:<ul><li>Each service of type <code>LoadBalancer</code> will typically get its own public IP address.</li><li>These IP addresses are associated with the Load Balancer but are unique for each service, allowing external traffic to be directed to the correct service.</li></ul></li></ol></blockquote></li><li><p>Run the yaml file to deploy the niginx and load balancer service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">apply the yaml file</span><br>kubectl apply -f nginx-deployment.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Monitor the deployment using the kubectl get pods <span class="hljs-built_in">command</span></span><br>kubectl get pods -A<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">It might take a few mins <span class="hljs-keyword">for</span> loadbalancer to be provisioned and receive an extermal IP.</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">Check the service status:</span><br>kubectl get svc nginx0-service<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>output of commands:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % kubectl get pods   <br>NAME                                 READY   STATUS    RESTARTS   AGE<br>nginx0-deployment-55ccd79fcd-j6pzj   1/1     Running   0          26s<br>nginx0-deployment-55ccd79fcd-kblvb   1/1     Running   0          26s<br>felixy@USLC-FELIXY-M ~ % kubectl get svc nginx0-service<br>NAME             TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE<br>nginx0-service   LoadBalancer   10.0.23.234   4.246.240.1   80:30170/TCP   37s<br></code></pre></td></tr></table></figure></blockquote></li><li><p>Identify the created resource group and load balancer by default, and list down all the resources in the resource group</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Identify the resource group and load balancer</span><br>az network lb list --query &quot;[].&#123;name:name, resourceGroup:resourceGroup&#125;&quot; -o table<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">List all the resources <span class="hljs-keyword">in</span> the resource group</span><br>az resource list -g mc_felixrg_felixaks_eastus -o table<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>output of commands:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % az network lb list --query &quot;[].&#123;name:name, resourceGroup:resourceGroup&#125;&quot; -o table<br><br>Name        ResourceGroup<br>----------  --------------------------<br>kubernetes  mc_felixrg_felixaks_eastus<br><br><br>felixy@USLC-FELIXY-M ~ % az resource list -g mc_felixrg_felixaks_eastus -o table<br>Name                                         ResourceGroup               Location    Type                                              Status<br>-------------------------------------------  --------------------------  ----------  ------------------------------------------------  --------<br>aks-nodepool1-32082944-vmss                  MC_felixRG_felixaks_eastus  eastus      Microsoft.Compute/virtualMachineScaleSets<br>felixaks-agentpool                           MC_felixRG_felixaks_eastus  eastus      Microsoft.ManagedIdentity/userAssignedIdentities<br>kubernetes                                   mc_felixrg_felixaks_eastus  eastus      Microsoft.Network/loadBalancers<br>aks-agentpool-28367344-nsg                   mc_felixrg_felixaks_eastus  eastus      Microsoft.Network/networkSecurityGroups<br>b0367e75-6f66-41a8-9551-69e090ccb40f         MC_felixRG_felixaks_eastus  eastus      Microsoft.Network/publicIPAddresses<br>kubernetes-a8ad97b6f249341f987b1881f407c5f0  mc_felixrg_felixaks_eastus  eastus      Microsoft.Network/publicIPAddresses<br>aks-agentpool-28367344-routetable            mc_felixrg_felixaks_eastus  eastus      Microsoft.Network/routeTables<br>aks-vnet-28367344                            MC_felixRG_felixaks_eastus  eastus      Microsoft.Network/virtualNetworks<br></code></pre></td></tr></table></figure></blockquote></li><li><p>Restrict the access from specific IP to Nginx service</p><p>Once you identify the newly created resource group <code>MC_&lt;yourResourceGroup&gt;_&lt;yourAKSClusterName&gt;_&lt;region&gt;</code> and load balancer, you can go to the resource group and edit the NSG, specify the source IP address allowed to access the load balancer</p><blockquote><p>[!NOTE]</p><p>You may not need to manually create a VNet and subnet for a standard AKS setup, as Azure can handle this automatically. However, for custom networking needs, pre-creating these resources gives you more flexibility and control.</p><p><strong>Custom Networking in AKS (Advanced):</strong></p><ul><li><strong>Manual Configuration</strong>: For more complex scenarios, such as integrating with existing VNets or configuring advanced networking features, you can manually create and configure your VNet and subnets.</li><li><strong>Custom VNet and Subnet</strong>: You can create a VNet and subnets according to your specific network requirements and then deploy the AKS cluster into this custom network.</li><li>AKS with Custom Networking<ul><li>When creating the AKS cluster, specify your custom VNet and subnet.</li><li>This approach is often used in enterprise environments for better control over networking, security, and compliance.</li></ul></li></ul><p><strong>Checking Existing Network Resources:</strong></p><p>If you’re unsure whether a VNet and subnet were automatically created for your AKS cluster, you can check:</p><ol><li><p><strong>Azure Portal</strong>:</p><ul><li>Go to the Azure Portal.</li><li>Navigate to your AKS cluster resource.</li><li>Under the “Settings” section, look for “Networking” to see the details of the network configuration.</li></ul></li><li><p><strong>Azure CLI</strong>:</p><ul><li>Use Azure CLI to list the network details of your AKS cluster.</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">az aks show --resource-group myResourceGroup --name myAKSCluster --query &quot;networkProfile&quot;<br></code></pre></td></tr></table></figure></li></ol></blockquote></li><li><p>Finally, now you can access the nginx from internet by accessing the external IP as below</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % kubectl get svc nginx0-service<br>NAME             TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE<br>nginx0-service   LoadBalancer   10.0.23.234   4.246.240.1   80:30170/TCP   150m<br></code></pre></td></tr></table></figure><img src="https://felixyanghui.synology.me:8441/images/2024/01/22/image-20240121181354342.png" alt="image-20240121181354342" style="zoom:50%;" /></li><li><p>Remove all the infra resources of AKS and ACR</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % az aks delete -n $MYAKS -g $MYRG --yes --no-wait<br><br>felixy@USLC-FELIXY-M ~ % az acr delete -n $MYACR --yes<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>This command will remove the AKS provisioned in your designated resource group, as well as the resource group AKS provisioned and all associated resources such as load balancer, vnet, subnet, nsg, public ip address, etc…</p></blockquote></li></ul></li></ol><h2 id="Create-the-CICD-pipeline"><a href="#Create-the-CICD-pipeline" class="headerlink" title="Create the CICD pipeline"></a>Create the CICD pipeline</h2><h3 id="Prepare-the-github-actions-workflow"><a href="#Prepare-the-github-actions-workflow" class="headerlink" title="Prepare the github actions workflow"></a>Prepare the github actions workflow</h3><ol><li><p>In the GitHub repo, create a new file in the <code>.github/workflows</code> directory, e.g., <code>ussrelab-ci-cd.yml</code>.</p></li><li><p><strong>Define the Workflow</strong>:</p><ul><li>The workflow file should define jobs to:<ul><li>Build and push the Flask application image to ACR.</li><li>Optionally, build and push custom MySQL and Elasticsearch images if you have specific customizations. Otherwise, you can use the official images directly in your Kubernetes deployment.</li><li>Deploy these images to AKS.</li></ul></li></ul></li><li><p>Example workflow yml file: <code>ussrelab-ci-cd.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">USSRELab</span> <span class="hljs-string">CI/CD</span> <span class="hljs-string">Pipeline</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">flask2024</span> ]<br>    <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;app&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;.github/workflows/ussrelab-ci-cd.yml&#x27;</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build-and-deploy:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Log</span> <span class="hljs-string">in</span> <span class="hljs-string">to</span> <span class="hljs-string">Azure</span> <span class="hljs-string">Container</span> <span class="hljs-string">Registry</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">azure/docker-login@v1</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">login-server:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.acr_name</span> <span class="hljs-string">&#125;&#125;.azurecr.io</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.ACR_USERNAME</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.ACR_PASSWORD</span> <span class="hljs-string">&#125;&#125;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">Docker</span> <span class="hljs-string">image</span> <span class="hljs-string">for</span> <span class="hljs-string">Flask</span> <span class="hljs-string">App</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        docker build -t $&#123;&#123; secrets.acr_name &#125;&#125;.azurecr.io/microblog:latest .</span><br><span class="hljs-string">        docker push $&#123;&#123; secrets.acr_name &#125;&#125;.azurecr.io/microblog:latest</span><br><span class="hljs-string"></span>    <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Azure</span> <span class="hljs-string">login</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">login</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">azure/login@v1.4.3</span><br>      <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">creds:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.AZURE_CREDENTIALS</span> <span class="hljs-string">&#125;&#125;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Connect</span> <span class="hljs-string">to</span> <span class="hljs-string">Azure</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">Service</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        az aks get-credentials --resource-group $&#123;&#123; secrets.resource_group &#125;&#125; --name $&#123;&#123; secrets.cluster_name &#125;&#125;</span><br><span class="hljs-string"></span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">Flask</span> <span class="hljs-string">App</span> <span class="hljs-string">to</span> <span class="hljs-string">AKS</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        kubectl apply -f k8s-deployment/flask-deployment.yaml</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>Replace <code>&lt;acr-name&gt;</code>, <code>&lt;myResourceGroup&gt;</code>, and <code>&lt;myAKSCluster&gt;</code> with your actual Azure Container Registry name, AKS resource group name, and AKS cluster name. Make sure to store <code>ACR_USERNAME</code> and <code>ACR_PASSWORD</code> as secrets in your GitHub repository settings.</p></blockquote></li><li><p>Set up required secrests in Github</p><p>Store your Azure service principal credentials, ACR credentials, and any other required secrets in GitHub Secrets for use in your workflow.</p><p>Example practice is to define it in Github responsitory and call the variables from github actions workflow</p><ol><li><p>Create a service principal to access your resource group with the <code>Contributor</code> role using the <a href="https://learn.microsoft.com/en-us/cli/azure/ad/sp#az-ad-sp-create-for-rbac"><code>az ad sp create-for-rbac</code></a> command. Replace <code>&lt;SUBSCRIPTION_ID&gt;</code> with the subscription ID of your Azure account and <code>&lt;RESOURCE_GROUP&gt;</code> with the name of the resource group containing your ACR.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs azurecli">az ad sp create-for-rbac \<br>    --name &quot;ghActionAzureSREapp&quot; \<br>    --scope /subscriptions/&lt;SUBSCRIPTION_ID&gt;/resourceGroups/felixRG \<br>    --role Contributor \<br>    --json-auth<br></code></pre></td></tr></table></figure><p>Your output should look similar to the following example output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs output">&#123;<br>  &quot;clientId&quot;: &lt;clientId&gt;,<br>  &quot;clientSecret&quot;: &lt;clientSecret&gt;,<br>  &quot;subscriptionId&quot;: &lt;subscriptionId&gt;,<br>  &quot;tenantId&quot;: &lt;tenantId&gt;,<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>If you want to check the created SP and delete it, can use below commands</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">az ad sp list --all --query &quot;[?displayName==&#x27;ghActionAzureSREapp&#x27;].&#123;name:displayName, appId:appId&#125;&quot; <br><br>az ad sp delete --id 6e7fb2db-f767-401e-9ef4-ac3d80c9b66e<br></code></pre></td></tr></table></figure></blockquote><blockquote><p>[!NOTE]</p><p>If you want to get the clientId (appId) and secret, can use below commands</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">az ad sp list --filter &quot;displayName eq &#x27;ghActionAzureSREapp&#x27;&quot; --query &quot;[].appId&quot; -o tsv<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">This <span class="hljs-built_in">command</span> will output a new password, <span class="hljs-built_in">which</span> will be your new clientSecret</span><br>az ad sp credential reset --id &lt;YourServicePrincipalId&gt;<br></code></pre></td></tr></table></figure><p>Get the “subscriptionId”,  “tenantId”</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">az account show --query &quot;&#123;subscriptionId: id, tenantId: tenantId&#125;&quot;<br></code></pre></td></tr></table></figure></blockquote><blockquote><p>[!WARNING]</p><p>As my orgnization policy only allow credential lifetime within 90 days, however az cli can only specifiy the parameter<code>--year</code> , the default lifetime is 1 year. </p><p>So the alternative is to create the principal credentials through powershell commands as below</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pow"># install powershell az module<br>PS /Users/felixy&gt; Install-Module -Name Az -AllowClobber -Scope CurrentUser<br><br># confirm the installation<br>PS /Users/felixy&gt; Get-Command -Module Az.*<br><br># connect to azure<br>PS /Users/felixy&gt; Connect-AzAccount<br><br># create the service principle credential for 1 month<br>PS /Users/felixy&gt; $endDate = (Get-Date).AddMonths(1)<br><br>PS /Users/felixy&gt; $endDate = (Get-Date).AddMonths(1)                                                                  PS /Users/felixy&gt; New-AzADServicePrincipal -DisplayName &quot;ghActionAzureSREapp&quot; -Role &quot;Contributor&quot; -Scope &quot;/subscriptions/6b892183-b95d-42e5-b659-fa2bef8f11f7/resourceGroups/felixRG&quot; -EndDate $endDate<br><br>DisplayName         Id                                   AppId<br>-----------         --                                   -----<br>ghActionAzureSREapp 15af80d8-fd8e-4038-a91d-2a5061d09519 545c5bc0-d4f8-49c6-8578-6a5770f40a1f<br></code></pre></td></tr></table></figure></blockquote></li><li><p>Navigate to your GitHub repository settings and select <strong>Security</strong> &gt; <strong>Secrets and variables</strong> &gt; <strong>Actions</strong>.</p></li><li><p>For each secret, select <strong>New Repository Secret</strong> and enter the name and value of the secret.</p><table><thead><tr><th align="left">Secret name</th><th align="left">Secret value</th></tr></thead><tbody><tr><td align="left">AZURE_CREDENTIALS</td><td align="left">The entire JSON output from the <code>az ad sp create-for-rbac</code> command.</td></tr><tr><td align="left">service_principal</td><td align="left">The value of <code>&lt;clientId&gt;</code>.</td></tr><tr><td align="left">service_principal_password</td><td align="left">The value of <code>&lt;clientSecret&gt;</code>.</td></tr><tr><td align="left">subscription</td><td align="left">The value of <code>&lt;subscriptionId&gt;</code>.</td></tr><tr><td align="left">tenant</td><td align="left">The value of <code>&lt;tenantId&gt;</code>.</td></tr><tr><td align="left">registry</td><td align="left">The name of your registry.</td></tr><tr><td align="left">repository</td><td align="left">azuredocs</td></tr><tr><td align="left">resource_group</td><td align="left">The name of your resource group.</td></tr><tr><td align="left">cluster_name</td><td align="left">The name of your cluster.</td></tr><tr><td align="left">act_name</td><td align="left">The name of your acr,  the same of registry</td></tr><tr><td align="left">ACR_USERNAME</td><td align="left">The value of name of your registry</td></tr><tr><td align="left">ACR_PASSWORD</td><td align="left">The value of registry access key:<br /> <code>az acr credential show --name &lt;acrName&gt;</code></td></tr></tbody></table><blockquote><p>you can compose your own  <code>AZURE_CREDENTIALS</code> JSON</p><p>Create a JSON string with the required fields. It should look like this:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;clientId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;YourClientId&gt;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;clientSecret&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;YourClientSecret&gt;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;subscriptionId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;YourSubscriptionId&gt;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;tenantId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;YourTenantId&gt;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Replace <code>&lt;YourClientId&gt;</code>, <code>&lt;YourClientSecret&gt;</code>, <code>&lt;YourSubscriptionId&gt;</code>, and <code>&lt;YourTenantId&gt;</code> with the actual values.</p></blockquote></li></ol></li></ol><h3 id="Prepare-the-deployment-and-service-manifest-yaml-files-for-flask-application-MYSQL-and-Elasticsearch"><a href="#Prepare-the-deployment-and-service-manifest-yaml-files-for-flask-application-MYSQL-and-Elasticsearch" class="headerlink" title="Prepare the deployment and service manifest yaml files for flask application, MYSQL and Elasticsearch"></a>Prepare the deployment and service manifest yaml files for flask application, MYSQL and Elasticsearch</h3><ol><li><p>Create Kubernetes Deployment and service Manifests for Flask app: <code>flask-deployment.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flask-app</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">flask-app</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flask-app</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flask-app</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&lt;acr-name&gt;.azurecr.io/microblog:latest</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">5000</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SECRET_KEY</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;my-secret-key&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DATABASE_URL</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;mysql+pymysql://microblog:novirus@mysql/microblog&quot;</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flask-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">5000</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flask-app</span><br><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>Noted that the type of service is loadbalancer, which AKS will ask Azure to create the loadbalancer for internet users to access</p></blockquote></li><li><p>Create MYSQL Deployment and service Manifests for mysql: <code>mysql-deployment.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># MySQL Deployment</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:latest</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;yes&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_DATABASE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;microblog&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_USER</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;microblog&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_PASSWORD</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;novirus&quot;</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># MySQL Service</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span><br><br></code></pre></td></tr></table></figure></li><li><p>Create Elasticsearch Deployment and service Manifests for elasticsearch: <code>elasticsearch-deployment.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># Elasticsearch Deployment</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.elastic.co/elasticsearch/elasticsearch:8.11.1</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">discovery.type</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;single-node&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">xpack.security.enabled</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;false&quot;</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9200</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Elasticsearch Service</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9200</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br><br></code></pre></td></tr></table></figure></li></ol><h3 id="Initiate-and-setup-the-MYSQL-and-Elasticsearch-on-AKS-firstly"><a href="#Initiate-and-setup-the-MYSQL-and-Elasticsearch-on-AKS-firstly" class="headerlink" title="Initiate and setup the MYSQL and Elasticsearch on AKS firstly"></a>Initiate and setup the MYSQL and Elasticsearch on AKS firstly</h3><p>Apply the mysql and elasticsearch manifests, as these services are not necessary to be included in GitHub actions workflow</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f mysql-deployment.yaml<br>kubectl apply -f elasticsearch-deployment.yaml<br></code></pre></td></tr></table></figure><h2 id="Test-and-Verify-the-CICD-pipline"><a href="#Test-and-Verify-the-CICD-pipline" class="headerlink" title="Test and Verify the CICD pipline"></a>Test and Verify the CICD pipline</h2><h3 id="Update-the-application-and-commit-x2F-push-the-code-to-GitHub-to-trigger-CICD"><a href="#Update-the-application-and-commit-x2F-push-the-code-to-GitHub-to-trigger-CICD" class="headerlink" title="Update the application and commit&#x2F;push the code to GitHub to trigger CICD"></a>Update the application and commit&#x2F;push the code to GitHub to trigger CICD</h3><p><img src="https://felixyanghui.synology.me:8441/images/2024/01/24/image-20240123173338222.png" alt="image-20240123173338222"></p><p>Check the extern-ip as below and access the web application</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">(venv) felixy@USLC-FELIXY-M flask-ussre % kubectl get svc -A<br>NAMESPACE     NAME             TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)         AGE<br>default       elasticsearch    ClusterIP      10.0.66.158    &lt;none&gt;          9200/TCP        46m<br>default       flask-service    LoadBalancer   10.0.173.109   4.156.227.233   80:30663/TCP    99s<br>default       kubernetes       ClusterIP      10.0.0.1       &lt;none&gt;          443/TCP         5h22m<br>default       mysql            ClusterIP      10.0.120.136   &lt;none&gt;          3306/TCP        46m<br>kube-system   kube-dns         ClusterIP      10.0.0.10      &lt;none&gt;          53/UDP,53/TCP   5h21m<br>kube-system   metrics-server   ClusterIP      10.0.54.51     &lt;none&gt;          443/TCP         5h21m<br></code></pre></td></tr></table></figure><p><img src="https://felixyanghui.synology.me:8441/images/2024/01/24/image-20240123173525810.png" alt="image-20240123173525810"></p>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AKS</tag>
      
      <tag>CICD</tag>
      
      <tag>flask</tag>
      
      <tag>ACR</tag>
      
      <tag>GitHub actions</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/20/revised-steps-with-iam-role-creation-and-assignment/"/>
    <url>/2024/01/20/revised-steps-with-iam-role-creation-and-assignment/</url>
    
    <content type="html"><![CDATA[<h3 id="Revised-Steps-with-IAM-Role-Creation-and-Assignment"><a href="#Revised-Steps-with-IAM-Role-Creation-and-Assignment" class="headerlink" title="Revised Steps with IAM Role Creation and Assignment"></a>Revised Steps with IAM Role Creation and Assignment</h3><h4 id="1-Create-VPC-and-Subnets"><a href="#1-Create-VPC-and-Subnets" class="headerlink" title="1. Create VPC and Subnets"></a>1. Create VPC and Subnets</h4><ul><li><p><strong>VPC Creation</strong>:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpc</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">16</span><br></code></pre></td></tr></table></figure><p>Note the VPC ID (e.g., <code>vpc-xxxxx</code>) for future steps.</p></li><li><p><strong>Subnet Creation</strong>: Create subnets in different Availability Zones.</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-subnet</span> <span class="hljs-built_in">--vpc-id</span> <span class="hljs-string">vpc-xxxxx</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">1</span>.<span class="hljs-string">0</span>/<span class="hljs-string">24</span> <span class="hljs-built_in">--availability-zone</span> <span class="hljs-string">us-west-2a</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-subnet</span> <span class="hljs-built_in">--vpc-id</span> <span class="hljs-string">vpc-xxxxx</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">2</span>.<span class="hljs-string">0</span>/<span class="hljs-string">24</span> <span class="hljs-built_in">--availability-zone</span> <span class="hljs-string">us-west-2b</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="2-Create-IAM-Roles"><a href="#2-Create-IAM-Roles" class="headerlink" title="2. Create IAM Roles"></a>2. Create IAM Roles</h4><ul><li><p><strong>EKS Service Role</strong>: Create an IAM role with the required policies for EKS.</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">iam</span> <span class="hljs-built_in">create-role</span> <span class="hljs-built_in">--role-name</span> <span class="hljs-string">eksServiceRole</span> <span class="hljs-built_in">--assume-role-policy-document</span> <span class="hljs-string">file</span>://<span class="hljs-string">eks-trust-policy</span>.<span class="hljs-string">json</span><br></code></pre></td></tr></table></figure><p>Attach the necessary policies:</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bashCopy code<br>aws iam attach-role-<span class="hljs-keyword">policy</span> --role-name eksServiceRole --<span class="hljs-keyword">policy</span>-arn arn:aws:iam::aws:<span class="hljs-keyword">policy</span>/AmazonEKSClusterPolicy<br>aws iam attach-role-<span class="hljs-keyword">policy</span> --role-name eksServiceRole --<span class="hljs-keyword">policy</span>-arn arn:aws:iam::aws:<span class="hljs-keyword">policy</span>/AmazonEKSServicePolicy<br></code></pre></td></tr></table></figure></li><li><p><strong>Node Group Role</strong>: Create an IAM role for the EKS worker nodes.</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">iam</span> <span class="hljs-built_in">create-role</span> <span class="hljs-built_in">--role-name</span> <span class="hljs-string">eksNodeRole</span> <span class="hljs-built_in">--assume-role-policy-document</span> <span class="hljs-string">file</span>://<span class="hljs-string">eks-node-trust-policy</span>.<span class="hljs-string">json</span><br></code></pre></td></tr></table></figure><p>Attach policies required by worker nodes:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">bashCopy code<br>aws iam attach-<span class="hljs-keyword">role</span>-<span class="hljs-keyword">policy</span> <span class="hljs-comment">--role-name eksNodeRole --policy-arn arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy</span><br>aws iam attach-<span class="hljs-keyword">role</span>-<span class="hljs-keyword">policy</span> <span class="hljs-comment">--role-name eksNodeRole --policy-arn arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy</span><br>aws iam attach-<span class="hljs-keyword">role</span>-<span class="hljs-keyword">policy</span> <span class="hljs-comment">--role-name eksNodeRole --policy-arn arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-Create-Elastic-Container-Registry-ECR"><a href="#3-Create-Elastic-Container-Registry-ECR" class="headerlink" title="3. Create Elastic Container Registry (ECR)"></a>3. Create Elastic Container Registry (ECR)</h4><ul><li><p>ECR Repository</p><p>:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ecr</span> <span class="hljs-built_in">create-repository</span> <span class="hljs-built_in">--repository-name</span> <span class="hljs-string">my-app-repo</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="4-Create-Elastic-Kubernetes-Service-EKS-Cluster"><a href="#4-Create-Elastic-Kubernetes-Service-EKS-Cluster" class="headerlink" title="4. Create Elastic Kubernetes Service (EKS) Cluster"></a>4. Create Elastic Kubernetes Service (EKS) Cluster</h4><ul><li><p>EKS Cluster</p><p>:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">eks</span> <span class="hljs-built_in">create-cluster</span> <span class="hljs-built_in">--name</span> <span class="hljs-string">my-eks-cluster</span> <span class="hljs-built_in">--role-arn</span> <span class="hljs-string">arn:aws:</span><span class="hljs-string">iam</span>::<span class="hljs-string">123456789012:role/</span><span class="hljs-string">eksServiceRole</span> <span class="hljs-built_in">--resources-vpc-config</span> <span class="hljs-string">subnetIds</span>=<span class="hljs-string">subnet-abcde01</span>,<span class="hljs-string">subnet-abcde02</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="5-Create-Security-Groups"><a href="#5-Create-Security-Groups" class="headerlink" title="5. Create Security Groups"></a>5. Create Security Groups</h4><ul><li><p>Security Group</p><p>:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-security-group</span> <span class="hljs-built_in">--group-name</span> <span class="hljs-string">my-sg</span> <span class="hljs-built_in">--description</span> <span class="hljs-string">&quot;My security group&quot;</span> <span class="hljs-built_in">--vpc-id</span> <span class="hljs-string">vpc-xxxxx</span><br></code></pre></td></tr></table></figure><p>Then, add rules to allow traffic from restricted IPs:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">bashCopy <span class="hljs-selector-tag">code</span><br>aws ec2 authorize-security-group-ingress <span class="hljs-attr">--group-id</span> sg-xxxxx <span class="hljs-attr">--protocol</span> tcp <span class="hljs-attr">--port</span> <span class="hljs-number">80</span> <span class="hljs-attr">--cidr</span> restricted-ip-<span class="hljs-selector-tag">address</span>/<span class="hljs-number">32</span><br>aws ec2 authorize-security-group-ingress <span class="hljs-attr">--group-id</span> sg-xxxxx <span class="hljs-attr">--protocol</span> tcp <span class="hljs-attr">--port</span> <span class="hljs-number">443</span> <span class="hljs-attr">--cidr</span> restricted-ip-<span class="hljs-selector-tag">address</span>/<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="6-Create-Worker-Nodes-for-EKS"><a href="#6-Create-Worker-Nodes-for-EKS" class="headerlink" title="6. Create Worker Nodes for EKS"></a>6. Create Worker Nodes for EKS</h4><blockquote><h4 id="1-Download-the-AWS-EKS-Worker-Node-CloudFormation-Template"><a href="#1-Download-the-AWS-EKS-Worker-Node-CloudFormation-Template" class="headerlink" title="1. Download the AWS EKS Worker Node CloudFormation Template"></a>1. Download the AWS EKS Worker Node CloudFormation Template</h4><p>First, you need to download the appropriate CloudFormation template provided by AWS. These templates are available in the AWS EKS documentation. You can use <code>wget</code> or <code>curl</code> to download it:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bashCopy</span> code<br><span class="hljs-attribute">wget</span> https://amazon-eks.s3.us-west-<span class="hljs-number">2</span>.amazonaws.com/cloudformation/<span class="hljs-number">2020</span>-<span class="hljs-number">08</span>-<span class="hljs-number">17</span>/amazon-eks-nodegroup.yaml<br></code></pre></td></tr></table></figure><h4 id="2-Create-a-Key-Pair-for-EC2-Instances"><a href="#2-Create-a-Key-Pair-for-EC2-Instances" class="headerlink" title="2. Create a Key Pair for EC2 Instances"></a>2. Create a Key Pair for EC2 Instances</h4><p>Create a key pair for SSH access to the EC2 instances:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-key-pair</span> <span class="hljs-built_in">--key-name</span> <span class="hljs-string">MyKeyPair</span><br></code></pre></td></tr></table></figure><p>Note: Remember to save the key material (.pem file) that you receive in response.</p><h4 id="3-Deploy-the-CloudFormation-Stack-using-AWS-CLI"><a href="#3-Deploy-the-CloudFormation-Stack-using-AWS-CLI" class="headerlink" title="3. Deploy the CloudFormation Stack using AWS CLI"></a>3. Deploy the CloudFormation Stack using AWS CLI</h4><p>Now, deploy the CloudFormation stack with the template you downloaded. You’ll need to provide various parameters such as the EKS cluster name, node group role ARN, subnet IDs, and the key pair name.</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">cloudformation</span> <span class="hljs-built_in">create-stack</span> <span class="hljs-built_in">--stack-name</span> <span class="hljs-string">my-eks-nodes</span> <span class="hljs-built_in">--template-body</span> <span class="hljs-string">file</span>://<span class="hljs-string">amazon-eks-nodegroup</span>.<span class="hljs-string">yaml</span> <span class="hljs-built_in">--parameters</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">ClusterName</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">my-eks-cluster</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">ClusterControlPlaneSecurityGroup</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">sg-xxxxx</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeGroupName</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">my-node-group</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeAutoScalingGroupMinSize</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">1</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeAutoScalingGroupMaxSize</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">3</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeInstanceType</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">t3</span>.<span class="hljs-string">medium</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeImageId</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">ami-0a887e401f7654935</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">KeyName</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">MyKeyPair</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">VpcId</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">vpc-xxxxx</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">Subnets</span>,<span class="hljs-string">ParameterValue</span>=\<span class="hljs-string">&quot;subnet-abcde01,subnet-abcde02\&quot;</span> <span class="hljs-string">ParameterKey</span>=<span class="hljs-string">NodeGroupRoleArn</span>,<span class="hljs-string">ParameterValue</span>=<span class="hljs-string">arn:aws:</span><span class="hljs-string">iam</span>::<span class="hljs-string">123456789012:role/</span><span class="hljs-string">eksNodeRole</span> <span class="hljs-built_in">--capabilities</span> <span class="hljs-string">CAPABILITY_IAM</span><br></code></pre></td></tr></table></figure><p>Replace the placeholders like <code>my-eks-cluster</code>, <code>sg-xxxxx</code>, <code>vpc-xxxxx</code>, <code>subnet-abcde01</code>, <code>subnet-abcde02</code>, etc., with your actual values.</p><h4 id="4-Monitor-the-Stack-Creation"><a href="#4-Monitor-the-Stack-Creation" class="headerlink" title="4. Monitor the Stack Creation"></a>4. Monitor the Stack Creation</h4><p>You can monitor the status of the stack creation using the AWS Management Console or AWS CLI:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">bashCopy <span class="hljs-selector-tag">code</span><br>aws cloudformation describe-stacks <span class="hljs-attr">--stack-name</span> my-eks-nodes<br></code></pre></td></tr></table></figure><p>Once the stack status is <code>CREATE_COMPLETE</code>, your worker nodes are ready and should join your EKS cluster automatically.</p></blockquote><h4 id="7-Networking-and-Access"><a href="#7-Networking-and-Access" class="headerlink" title="7. Networking and Access"></a>7. Networking and Access</h4><ul><li><p><strong>Internet Gateway &amp; Route Tables</strong>: Set up as needed for external access.</p><blockquote><ol><li><p><strong>Create an Internet Gateway</strong>:</p><ul><li>This is needed if your worker nodes need access to the internet.</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss">bashCopy <span class="hljs-built_in">code</span><br>aws ec2 <span class="hljs-keyword">create</span>-internet-gateway<br></code></pre></td></tr></table></figure><p>Note the Internet Gateway ID (<code>igw-xxxx</code>) for future steps.</p></li><li><p><strong>Attach the Internet Gateway to Your VPC</strong>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">bashCopy <span class="hljs-selector-tag">code</span><br>aws ec2 attach-internet-gateway <span class="hljs-attr">--internet-gateway-id</span> igw-xxxx <span class="hljs-attr">--vpc-id</span> vpc-xxxxx<br></code></pre></td></tr></table></figure></li><li><p><strong>Create a Route Table</strong>:</p><ul><li>Create a route table in your VPC for routing traffic.</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-route-table</span> <span class="hljs-built_in">--vpc-id</span> <span class="hljs-string">vpc-xxxxx</span><br></code></pre></td></tr></table></figure><p>Note the Route Table ID (<code>rtb-xxxx</code>) for future steps.</p></li><li><p><strong>Create a Route to the Internet Gateway</strong>:</p><ul><li>This enables traffic from the VPC to the internet via the Internet Gateway.</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-route</span> <span class="hljs-built_in">--route-table-id</span> <span class="hljs-string">rtb-xxxx</span> <span class="hljs-built_in">--destination-cidr-block</span> <span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">0</span> <span class="hljs-built_in">--gateway-id</span> <span class="hljs-string">igw-xxxx</span><br></code></pre></td></tr></table></figure></li><li><p><strong>Associate the Route Table with Subnets</strong>:</p><ul><li>Associate the route table with each of your subnets.</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">bashCopy <span class="hljs-selector-tag">code</span><br>aws ec2 associate-route-<span class="hljs-selector-tag">table</span> <span class="hljs-attr">--route-table-id</span> rtb-xxxx <span class="hljs-attr">--subnet-id</span> subnet-abcde01<br>aws ec2 associate-route-<span class="hljs-selector-tag">table</span> <span class="hljs-attr">--route-table-id</span> rtb-xxxx <span class="hljs-attr">--subnet-id</span> subnet-abcde02<br></code></pre></td></tr></table></figure></li><li><p><strong>Adjust Security Groups as Needed</strong>:</p><ul><li>Update your security groups to allow the necessary inbound and outbound traffic for your application.</li></ul></li></ol></blockquote></li></ul><h4 id="8-Configure-kubectl-for-EKS"><a href="#8-Configure-kubectl-for-EKS" class="headerlink" title="8. Configure kubectl for EKS"></a>8. Configure kubectl for EKS</h4><ul><li><p>Update kubeconfig</p><p>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">bashCopy <span class="hljs-selector-tag">code</span><br>aws eks update-kubeconfig <span class="hljs-attr">--name</span> my-eks-cluster<br></code></pre></td></tr></table></figure></li></ul><h4 id="Notes-on-IAM-Policy-Documents"><a href="#Notes-on-IAM-Policy-Documents" class="headerlink" title="Notes on IAM Policy Documents"></a>Notes on IAM Policy Documents</h4><ul><li><p>The <code>eks-trust-policy.json</code> and <code>eks-node-trust-policy.json</code> files are JSON policy documents that allow EKS and EC2 to assume the role, respectively. You need to create these JSON files as per AWS IAM policies guidelines.</p><blockquote><h3 id="eks-trust-policy-json"><a href="#eks-trust-policy-json" class="headerlink" title="eks-trust-policy.json"></a>eks-trust-policy.json</h3><p>This trust policy is used when creating the IAM role for the EKS cluster. It allows the EKS service to assume this role.</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">jsonCopy</span> <span class="hljs-meta">code</span><br>&#123;<br>  <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>  <span class="hljs-string">&quot;Statement&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>      <span class="hljs-string">&quot;Principal&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;Service&quot;</span>: <span class="hljs-string">&quot;eks.amazonaws.com&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;sts:AssumeRole&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="eks-node-trust-policy-json"><a href="#eks-node-trust-policy-json" class="headerlink" title="eks-node-trust-policy.json"></a>eks-node-trust-policy.json</h3><p>This trust policy is for the IAM role assigned to EKS worker nodes. It allows the EC2 instances (worker nodes) to assume this role.</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">jsonCopy</span> <span class="hljs-meta">code</span><br>&#123;<br>  <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>  <span class="hljs-string">&quot;Statement&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>      <span class="hljs-string">&quot;Principal&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;Service&quot;</span>: <span class="hljs-string">&quot;ec2.amazonaws.com&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;sts:AssumeRole&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>When you create the IAM roles using the AWS CLI, you’ll reference these files. For example:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">bashCopy</span> <span class="hljs-string">code</span><br><span class="hljs-string">aws</span> <span class="hljs-string">iam</span> <span class="hljs-built_in">create-role</span> <span class="hljs-built_in">--role-name</span> <span class="hljs-string">eksServiceRole</span> <span class="hljs-built_in">--assume-role-policy-document</span> <span class="hljs-string">file</span>://<span class="hljs-string">eks-trust-policy</span>.<span class="hljs-string">json</span><br><span class="hljs-string">aws</span> <span class="hljs-string">iam</span> <span class="hljs-built_in">create-role</span> <span class="hljs-built_in">--role-name</span> <span class="hljs-string">eksNodeRole</span> <span class="hljs-built_in">--assume-role-policy-document</span> <span class="hljs-string">file</span>://<span class="hljs-string">eks-node-trust-policy</span>.<span class="hljs-string">json</span><br></code></pre></td></tr></table></figure><p>Ensure that these JSON files are correctly formatted and stored locally where the AWS CLI can access them. These trust policies are crucial for setting up IAM roles that align with AWS security best practices, by explicitly defining which AWS services can assume these roles.</p></blockquote></li></ul><p>This revised procedure includes the creation and assignment of IAM roles, which are vital for managing access and permissions for EKS and its worker nodes. Remember to replace placeholder values (like <code>subnet-abcde01</code>, <code>vpc-xxxxx</code>, <code>sg-xxxxx</code>, etc.) with actual values from your AWS setup.</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Flask Application Structure</title>
    <link href="/2024/01/14/flask-web-application-devops/"/>
    <url>/2024/01/14/flask-web-application-devops/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Flask-Web-Application-DevOps"><a href="#Flask-Web-Application-DevOps" class="headerlink" title="Flask Web Application DevOps"></a>Flask Web Application DevOps</h1><h2 id="Flask-Application-Structure"><a href="#Flask-Application-Structure" class="headerlink" title="Flask Application Structure"></a>Flask Application Structure</h2><p><strong>1. Flask Application Structure:</strong></p><p>Let’s say you have a Flask project with the following structure:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">myapp/<br>│<br>├── app/<br>│   ├── __init__.<span class="hljs-keyword">py</span><br>│   ├── routes.<span class="hljs-keyword">py</span><br>│   └── ...<br>│<br>└── run.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure><p>In this structure, <code>app</code> is the package containing your Flask application, <code>routes.py</code> contains route definitions, and <code>run.py</code> is the entry point for running the app.</p><p><strong>2. Initializing Flask App (<code>__init__.py</code>):</strong></p><p>In <code>app/__init__.py</code>, you initialize your Flask application:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> routes<br></code></pre></td></tr></table></figure><p>In this file, you create an instance of <code>Flask</code> called <code>app</code>. After the instance is created, you import the <code>routes</code>. It is important that the import statement for <code>routes</code> comes after the creation of the <code>Flask</code> instance to avoid circular imports.</p><p><strong>3. Defining Routes (<code>routes.py</code>):</strong></p><p>In <code>routes.py</code>, you define your route handlers:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, World!&quot;</span><br></code></pre></td></tr></table></figure><p>Here, you’re importing the <code>app</code> instance from your <code>app</code> package and using the <code>route</code> decorator to tell Flask what URL should trigger the <code>index</code> function.</p><p><strong>4. Running the Flask App (<code>run.py</code>):</strong></p><p>Finally, in <code>run.py</code>, you run the application:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> app import app<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.<span class="hljs-built_in">run</span>(<span class="hljs-attribute">debug</span>=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>When you execute <code>run.py</code>, it imports the <code>app</code> instance from the <code>app</code> package. This import statement triggers the execution of <code>__init__.py</code>, which in turn initializes the Flask app and imports <code>routes.py</code>. As a result, the routes you defined in <code>routes.py</code> are registered with the Flask app.</p><p><strong>5. Running the Application:</strong></p><p>To start the Flask application, you would run the <code>run.py</code> script:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> run.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure><p>This starts the Flask web server, and your application should be accessible according to the routes you’ve defined in <code>routes.py</code>.</p><p>This modular setup helps in keeping the code organized and makes it easier to maintain and scale your Flask application.</p><h2 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter-1"></a>Chapter-1</h2><h2 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter-2"></a>Chapter-2</h2><h2 id="Chapter-3"><a href="#Chapter-3" class="headerlink" title="Chapter-3"></a>Chapter-3</h2><h2 id="Chapter-4"><a href="#Chapter-4" class="headerlink" title="Chapter-4"></a>Chapter-4</h2><h2 id="Chapter-5-Database"><a href="#Chapter-5-Database" class="headerlink" title="Chapter-5 Database"></a>Chapter-5 Database</h2><ol><li><p><strong>Database Configuration</strong>: Introduction to database configuration in Flask, explaining how to set up and configure a database for use with a Flask application. This likely includes choosing a database system (like SQLite for development purposes) and setting up the database URI in the Flask app’s configuration.</p></li><li><p><strong>ORM (Object-Relational Mapping)</strong>: Discussion of using an ORM like SQLAlchemy in Flask. ORM allows developers to interact with the database using Python classes and objects instead of writing raw SQL queries.</p></li><li><p><strong>Database Models</strong>: Explanation of how to define database models in Flask. This involves creating Python classes that define the tables and relationships in the database. For example, defining a <code>User</code> model for a user table.</p></li><li><p><strong>Database Migrations</strong>: Introduction to database migration tools, such as Flask-Migrate, which is an extension that handles SQLAlchemy database migrations for Flask applications. The tutorial likely covers how to create and apply database migrations, which is essential for evolving the database schema over time without losing data.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Creating The Migration Repository</span><br>(venv) $ flask db init<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Generating the migration script</span><br>(venv) $ flask db migrate -m &quot;users table&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The flask db migrate <span class="hljs-built_in">command</span> does not make any changes to the database, it just generates the migration script. To apply the changes to the database, the flask db upgrade <span class="hljs-built_in">command</span> must be used.</span><br>(venv) $ flask db upgrade<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Flask db downgrade <span class="hljs-built_in">command</span>, <span class="hljs-built_in">which</span> undoes the last migration</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The first <span class="hljs-built_in">command</span> tells Flask-Migrate to apply the database migrations <span class="hljs-keyword">in</span> reverse order. When the downgrade <span class="hljs-built_in">command</span> is not given a target, it downgrades one revision. The base target causes all migrations to be downgraded, <span class="hljs-keyword">until</span> the database is left at its initial state, with no tables.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The upgrade <span class="hljs-built_in">command</span> re-applies all the migrations <span class="hljs-keyword">in</span> forward order. The default target <span class="hljs-keyword">for</span> upgrades is <span class="hljs-built_in">head</span>, <span class="hljs-built_in">which</span> is a shortcut <span class="hljs-keyword">for</span> the most recent migration.</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">Since database migrations <span class="hljs-keyword">do</span> not preserve the data stored <span class="hljs-keyword">in</span> the database, downgrading and <span class="hljs-keyword">then</span> upgrading has the effect of quickly emptying all the tables.</span><br>(venv) $ flask db downgrade base<br>(venv) $ flask db upgrade<br></code></pre></td></tr></table></figure></li><li><p><strong>Database Operations</strong>: Overview of basic database operations like creating, reading, updating, and deleting records (CRUD operations). This section might include examples of how to perform these operations using SQLAlchemy in a Flask app.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import modules</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app, db<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User, Post<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> sqlalchemy <span class="hljs-keyword">as</span> sa<br><span class="hljs-meta">&gt;&gt;&gt; </span>app.app_context().push()<br><br><span class="hljs-comment"># For Flask and its extensions to have access to the Flask application without having to pass app as an argument into every function, an application context must be created and pushed.</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>app.app_context().push()<br><br><span class="hljs-comment"># Create a user, changes are only written to the database when a commit is issued with db.session.commit()</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = User(username=<span class="hljs-string">&#x27;john&#x27;</span>, email=<span class="hljs-string">&#x27;john@example.com&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(u)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br><br><span class="hljs-comment"># Add another user</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = User(username=<span class="hljs-string">&#x27;susan&#x27;</span>, email=<span class="hljs-string">&#x27;susan@example.com&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(u)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br><br><span class="hljs-comment"># query the suer</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>query = sa.select(User)<br><span class="hljs-meta">&gt;&gt;&gt; </span>users = db.session.scalars(query).<span class="hljs-built_in">all</span>()<br><span class="hljs-meta">&gt;&gt;&gt; </span>users<br>[&lt;User john&gt;, &lt;User susan&gt;]<br><br><span class="hljs-comment"># use the results iterator in a for-loop instead of converting it to a list</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>users = db.session.scalars(query)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> users:<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(u.<span class="hljs-built_in">id</span>, u.username)<br>...<br><span class="hljs-number">1</span> john<br><span class="hljs-number">2</span> susan<br><br><span class="hljs-comment"># Another way to query, if you know the id of a user, you can retrieve that user as follows</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = db.session.get(User, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>u<br>&lt;User john&gt;<br><br><br><span class="hljs-comment"># Add a blog post</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = db.session.get(User, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>p = Post(body=<span class="hljs-string">&#x27;my first post!&#x27;</span>, author=u)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(p)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br><br><br><span class="hljs-comment">## --------- more useful db queries</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># get all posts written by a user</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = db.session.get(User, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>u<br>&lt;User john&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>query = u.posts.select()<br><span class="hljs-meta">&gt;&gt;&gt; </span>posts = db.session.scalars(query).<span class="hljs-built_in">all</span>()<br><span class="hljs-meta">&gt;&gt;&gt; </span>posts<br>[&lt;Post my first post!&gt;]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># same, but with a user that has no posts</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = db.session.get(User, <span class="hljs-number">2</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>u<br>&lt;User susan&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>query = u.posts.select()<br><span class="hljs-meta">&gt;&gt;&gt; </span>posts = db.session.scalars(query).<span class="hljs-built_in">all</span>()<br><span class="hljs-meta">&gt;&gt;&gt; </span>posts<br>[]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># print post author and body for all posts</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>query = sa.select(Post)<br><span class="hljs-meta">&gt;&gt;&gt; </span>posts = db.session.scalars(query)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> posts:<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(p.<span class="hljs-built_in">id</span>, p.author.username, p.body)<br>...<br><span class="hljs-number">1</span> john my first post!<br><br><span class="hljs-comment"># get all users in reverse alphabetical order</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>query = sa.select(User).order_by(User.username.desc())<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.scalars(query).<span class="hljs-built_in">all</span>()<br>[&lt;User susan&gt;, &lt;User john&gt;]<br><br><span class="hljs-comment"># get all users that have usernames starting with &quot;s&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>query = sa.select(User).where(User.username.like(<span class="hljs-string">&#x27;s%&#x27;</span>))<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.scalars(query).<span class="hljs-built_in">all</span>()<br>[&lt;User susan&gt;]<br></code></pre></td></tr></table></figure></li><li><p><strong>Integrating with Flask Application</strong>: Steps to integrate the database with the main Flask application, including initializing the database with the app and possibly creating a shell context for working with the database in the Flask shell.</p><blockquote><p>without flask shell, it is boring to test database as you need to import the modules&#x2F;db models everytime. </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from app import app, db</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from app.models import User, Post</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import sqlalchemy as sa</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; app.app_context().push()</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># The following function in microblog.py creates a shell context that adds the database instance and models to the shell session:</span><br><span class="hljs-keyword">import</span> sqlalchemy <span class="hljs-keyword">as</span> sa<br><span class="hljs-keyword">import</span> sqlalchemy.orm <span class="hljs-keyword">as</span> so<br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app, db<br><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User, Post<br><br><span class="hljs-meta">@app.shell_context_processor</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_shell_context</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;sa&#x27;</span>: sa, <span class="hljs-string">&#x27;so&#x27;</span>: so, <span class="hljs-string">&#x27;db&#x27;</span>: db, <span class="hljs-string">&#x27;User&#x27;</span>: User, <span class="hljs-string">&#x27;Post&#x27;</span>: Post&#125;<br></code></pre></td></tr></table></figure><p>After you add the shell context processor function you can work with database entities without having to import them:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">(venv) $ flask shell<br><span class="hljs-meta">&gt;&gt;&gt; </span>db<br>&lt;SQLAlchemy sqlite:////home/miguel/microblog/app.db&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>User<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;app.models.User&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>Post<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;app.models.Post&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li></ol><h2 id="Chapter-19-Deployment-on-Docker-Containers"><a href="#Chapter-19-Deployment-on-Docker-Containers" class="headerlink" title="Chapter-19 Deployment on Docker Containers"></a>Chapter-19 Deployment on Docker Containers</h2>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flask</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Build localstack on local k8s cluster - updated</title>
    <link href="/2023/12/10/build-localstack-on-local-k8s-cluster-updated/"/>
    <url>/2023/12/10/build-localstack-on-local-k8s-cluster-updated/</url>
    
    <content type="html"><![CDATA[<h1 id="Localstack-on-local-k8s-cluster-updated"><a href="#Localstack-on-local-k8s-cluster-updated" class="headerlink" title="Localstack on local k8s cluster - updated"></a>Localstack on local k8s cluster - updated</h1><h2 id="Installation-with-yaml-file"><a href="#Installation-with-yaml-file" class="headerlink" title="Installation with yaml file"></a>Installation with yaml file</h2><ol><li><p>Set up your Kubernetes cluster:</p><ul><li>Install a Kubernetes cluster locally. Follow the respective documentation for installation instructions.</li></ul></li><li><p>Deploy localStack and localstack web dashboard to your Kubernetes cluster:</p><ul><li><p>Create a Kubernetes deployment YAML file, for example, <code>localstack-deployment.yaml</code> with the following contents:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">localstack</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">localstack/localstack</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">4566</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SERVICES</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;*&quot;</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-number">1</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">1Gi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">500m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">500Mi</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">localstack</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-port</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">4566</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">4566</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-web</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">localstack</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">localstack-web</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">localstack-web</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-web</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">localstack/localstack-web</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SERVICES</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;*&quot;</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">500m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">500Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">250m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">250Mi</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-web</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">localstack</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">localstack-web</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-web-port</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br><br></code></pre></td></tr></table></figure></li><li><p>Apply the deployment to your Kubernetes cluster: <code>kubectl apply -f localstack-deployment.yaml</code>.</p></li></ul></li><li><p>Access LocalStack services:</p><p>With the LocalStack deployment described in the <code>localstack-deployment.yaml</code> file, you can determine the AWS endpoints for each service by using the following steps:</p><ol><li><p>Find the NodePort assigned to the <code>localstack</code> service:</p><ul><li><p>Run the following command to get the NodePort value:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get service -n localstack localstack -o jsonpath=<span class="hljs-string">&#x27;&#123;.spec.ports[0].nodePort&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>Note down the NodePort value returned by the command.</p></li></ul></li><li><p>Determine the IP address of your Kubernetes cluster:</p><ul><li><p>Run the following command to get the IP address of your cluster:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl cluster-info | grep <span class="hljs-string">&#x27;Kubernetes master&#x27;</span> | awk <span class="hljs-string">&#x27;/http/ &#123;print $NF&#125;&#x27;</span> | sed -e <span class="hljs-string">&#x27;s/.*\/\///&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>Note down the IP address returned by the command.</p></li></ul></li><li><p>Build the AWS service endpoint URLs:</p><ul><li><p>Combine the IP address and NodePort value obtained in the previous steps to construct the AWS service endpoints:</p><ul><li><p>For LocalStack services, the endpoint URL format is:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://&lt;Cluster-IP&gt;:&lt;NodePort&gt;<br></code></pre></td></tr></table></figure><p>Replace <code>&lt;Cluster-IP&gt;</code> with the IP address of your Kubernetes cluster, and <code>&lt;NodePort&gt;</code> with the NodePort value from step 1.</p></li><li><p>For each AWS service, the endpoint URL format is:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-symbol">http:</span>//&lt;<span class="hljs-title class_">Cluster</span>-<span class="hljs-title class_">IP</span>&gt;<span class="hljs-symbol">:&lt;NodePort&gt;/&lt;Service-Name&gt;</span><br></code></pre></td></tr></table></figure><p>Replace <code>&lt;Cluster-IP&gt;</code> with the IP address of your Kubernetes cluster, <code>&lt;NodePort&gt;</code> with the NodePort value from step 1, and <code>&lt;Service-Name&gt;</code> with the name of the AWS service (e.g., s3, sqs, lambda).</p></li></ul></li></ul></li></ol><p>For example, if your cluster’s IP address is <code>192.168.1.100</code> and the NodePort assigned to the <code>localstack</code> service is <code>30000</code>, here are a few examples of AWS service endpoint URLs:</p><ul><li>S3: <code>http://192.168.1.100:30000/s3</code></li><li>SQS: <code>http://192.168.1.100:30000/sqs</code></li><li>Lambda: <code>http://192.168.1.100:30000/lambda</code></li></ul></li></ol><h2 id="Installation-with-helm3"><a href="#Installation-with-helm3" class="headerlink" title="Installation with helm3"></a>Installation with helm3</h2><p>Follow the guide here: <a href="https://docs.localstack.cloud/getting-started/installation/">https://docs.localstack.cloud/getting-started/installation/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm repo add localstack-repo https://helm.localstack.cloud<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@CentOS001 ~]<span class="hljs-comment"># helm upgrade --install localstack localstack-repo/localstack</span><br>Release <span class="hljs-string">&quot;localstack&quot;</span> does not exist. Installing it now.<br>NAME: localstack<br>LAST DEPLOYED: Mon Dec 11 03:57:02 2023<br>NAMESPACE: default<br>STATUS: deployed<br>REVISION: 1<br>NOTES:<br>1. Get the application URL by running these commands:<br>  <span class="hljs-built_in">export</span> NODE_PORT=$(kubectl get --namespace <span class="hljs-string">&quot;default&quot;</span> -o jsonpath=<span class="hljs-string">&quot;&#123;.spec.ports[0].nodePort&#125;&quot;</span> services localstack)<br>  <span class="hljs-built_in">export</span> NODE_IP=$(kubectl get nodes --namespace <span class="hljs-string">&quot;default&quot;</span> -o jsonpath=<span class="hljs-string">&quot;&#123;.items[0].status.addresses[0].address&#125;&quot;</span>)<br>  <span class="hljs-built_in">echo</span> http://<span class="hljs-variable">$NODE_IP</span>:<span class="hljs-variable">$NODE_PORT</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>localstack</tag>
      
      <tag>k8s</tag>
      
      <tag>aws</tag>
      
      <tag>api</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Build localstack on local k8s cluster</title>
    <link href="/2023/12/10/build-localstack-on-local-k8s-cluster/"/>
    <url>/2023/12/10/build-localstack-on-local-k8s-cluster/</url>
    
    <content type="html"><![CDATA[<h1 id="Localstack-on-local-k8s-cluster"><a href="#Localstack-on-local-k8s-cluster" class="headerlink" title="Localstack on local k8s cluster"></a>Localstack on local k8s cluster</h1><ol><li><p>Set up your Kubernetes cluster:</p><ul><li>Install a Kubernetes cluster locally. Follow the respective documentation for installation instructions.</li></ul></li><li><p>Deploy LocalStack to your Kubernetes cluster:</p><ul><li><p>Create a Kubernetes deployment YAML file, for example, <code>localstack-deployment.yaml</code> with the following contents:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localstack</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">localstack/localstack</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">4566</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">4571</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SERVICES</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;ec2,apigateway,lambda,s3,sns,dynamodb,route53,cloudwatch&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>Apply the deployment to your Kubernetes cluster: <code>kubectl apply -f localstack-deployment.yaml</code>.</p></li></ul></li><li><p>Expose LocalStack for access:</p><ul><li><p>Create a Kubernetes service YAML file, for example, <code>localstack-service.yaml</code> with the following contents:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">localstack-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">localstack</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">port-4566</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">4566</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">4566</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">port-4571</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">4571</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">4571</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br></code></pre></td></tr></table></figure></li><li><p>Apply the service to your Kubernetes cluster: <code>kubectl apply -f localstack-service.yaml</code>.</p></li></ul></li><li><p>Access LocalStack services:</p><ul><li><p>Find the NodePort assigned to the LocalStack service: <code>kubectl get services</code>.</p></li><li><p>Use the NodePort to access LocalStack services. For example, for S3, the endpoint would be <code>http://&lt;cluster-ip&gt;:&lt;node-port&gt;/</code>.</p></li><li><p>Test the S3 service with AWS CLI</p><ul><li><p>Install AWS CLI on centos7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install awscli -y<br></code></pre></td></tr></table></figure></li><li><p>Configure AK and SK (Using example AK and SK is good enough )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># aws configure</span><br>AWS Access Key ID [None]: EXAMPLEACCESSKEY<br>AWS Secret Access Key [None]: EXAMPLEACCESSKEY<br>Default region name [None]: <br>Default output format [None]: <br></code></pre></td></tr></table></figure></li><li><p>Create the s3 bucket</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># aws --endpoint-url=http://10.52.184.221:32661 s3api create-bucket --bucket test</span><br>&#123;<br>    <span class="hljs-string">&quot;Location&quot;</span>: <span class="hljs-string">&quot;/test&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>List the s3 bucket</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># aws --endpoint-url=http://10.52.184.221:32661 s3api list-buckets</span><br>&#123;<br>    <span class="hljs-string">&quot;Owner&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;DisplayName&quot;</span>: <span class="hljs-string">&quot;webfile&quot;</span>, <br>        <span class="hljs-string">&quot;ID&quot;</span>: <span class="hljs-string">&quot;75aa57f09aa0c8caeab4f8c24e99d10f8e7faeebf76c078efc7c6caea54ba06a&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;Buckets&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;CreationDate&quot;</span>: <span class="hljs-string">&quot;2023-12-10T15:22:27.000Z&quot;</span>, <br>            <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;test&quot;</span><br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>Configure your applications to use LocalStack:</p><ul><li>Update your application’s AWS SDK or AWS CLI configuration to point to the LocalStack endpoints. For example, set the endpoint for S3 to <code>http://&lt;cluster-ip&gt;:&lt;node-port&gt;/</code> in your code or AWS CLI configuration.</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>localstack</tag>
      
      <tag>k8s</tag>
      
      <tag>aws</tag>
      
      <tag>api</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Building testing lab with Terraform and Ansible</title>
    <link href="/2023/12/10/build-testing-lab-in-local-dc-with-terraform-and-ansible/"/>
    <url>/2023/12/10/build-testing-lab-in-local-dc-with-terraform-and-ansible/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h1><h2 id="Linux-VM-provision-in-Batch-with-Terraform"><a href="#Linux-VM-provision-in-Batch-with-Terraform" class="headerlink" title="Linux VM provision in Batch with Terraform"></a>Linux VM provision in Batch with Terraform</h2><p><strong>Step 1: Create the linux vm template</strong></p><p><strong>Step 2: Use Terraform to provision the VM in batch, sample <code>main.tf</code> file as below:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># cat ../terraform/sre-vsphere-lab/main.tf </span><br><span class="hljs-comment"># Configure the VMware vSphere Provider</span><br>provider <span class="hljs-string">&quot;vsphere&quot;</span> &#123;<br>  user           = <span class="hljs-string">&quot;administrator@vsphere.local&quot;</span><br>  password       = <span class="hljs-string">&quot;xxxx&quot;</span><br>  vsphere_server = <span class="hljs-string">&quot;xx.xx.xx.xx&quot;</span><br><br>  <span class="hljs-comment"># if you have a self-signed cert</span><br>  allow_unverified_ssl = <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-comment"># Deploy 3 linux VMs</span><br>module <span class="hljs-string">&quot;centos-server-linuxvm&quot;</span> &#123;<br>  <span class="hljs-built_in">source</span>    = <span class="hljs-string">&quot;Terraform-VMWare-Modules/vm/vsphere&quot;</span><br>  <span class="hljs-comment">#source    = &quot;.terraform/modules/centos-server-linuxvm&quot;</span><br>  version   = <span class="hljs-string">&quot;3.5.0&quot;</span><br>  vmtemp    = <span class="hljs-string">&quot;centos7&quot;</span><br>  instances = 3<br>  vmname    = <span class="hljs-string">&quot;CentOS&quot;</span><br>  vmnameformat  = <span class="hljs-string">&quot;%03d&quot;</span> <span class="hljs-comment">#To use three decimal with leading zero vmnames will be AdvancedVM001,AdvancedVM002</span><br>  vmrp      = <span class="hljs-string">&quot;USSRE/Resources/felix&quot;</span><br>  network = &#123;<br>    <span class="hljs-string">&quot;VM Network&quot;</span> = [<span class="hljs-string">&quot;10.52.184.221&quot;</span>, <span class="hljs-string">&quot;10.52.184.222&quot;</span>, <span class="hljs-string">&quot;10.52.184.223&quot;</span>] <span class="hljs-comment"># To use DHCP create Empty list [&quot;&quot;,&quot;&quot;]; You can also use a CIDR annotation;</span><br>  &#125;<br>  vmgateway = <span class="hljs-string">&quot;xx.xx.xx.xx&quot;</span><br>  dc        = <span class="hljs-string">&quot;USRELAB&quot;</span><br>  datastore = <span class="hljs-string">&quot;data&quot;</span><br>  ipv4submask  = [<span class="hljs-string">&quot;16&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>]<br>  network_type = [<span class="hljs-string">&quot;vmxnet3&quot;</span>, <span class="hljs-string">&quot;vmxnet3&quot;</span>, <span class="hljs-string">&quot;vmxnet3&quot;</span>]<br>  dns_server_list  = [<span class="hljs-string">&quot;10.52.191.10&quot;</span>, <span class="hljs-string">&quot;10.52.191.10&quot;</span>, <span class="hljs-string">&quot;10.52.191.10&quot;</span>]<br>  is_windows_image = <span class="hljs-literal">false</span><br>&#125;<br><br>output <span class="hljs-string">&quot;vmnames&quot;</span> &#123;<br>  value = module.centos-server-linuxvm.VM<br>&#125;<br><br>output <span class="hljs-string">&quot;vmnameswip&quot;</span> &#123;<br>  value = module.centos-server-linuxvm.ip<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Step 3: Run the terraform yaml file as below</strong></p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">terraform init<br>terraform plan<br>terraform <span class="hljs-built_in">apply</span><br></code></pre></td></tr></table></figure><h2 id="Use-Ansible-to-manage-the-Linux-VM-and-set-up-the-k8s-cluster"><a href="#Use-Ansible-to-manage-the-Linux-VM-and-set-up-the-k8s-cluster" class="headerlink" title="Use Ansible to manage the Linux VM and set up the k8s cluster"></a>Use Ansible to manage the Linux VM and set up the k8s cluster</h2><p><strong>Topology:</strong></p><ul><li>1 CentOS 7 VM for the Kubernetes Master (e.g., 192.168.0.10)</li><li>2 CentOS 7 VMs for the Kubernetes Nodes (e.g., 192.168.0.11, 192.168.0.12)</li></ul><p><strong>Step 1: Prepare the Control Node:</strong></p><ul><li><p>Set up a separate CentOS 7 VM as your Ansible control node.</p></li><li><p>Install Ansible on the control node using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install ansible<br></code></pre></td></tr></table></figure></li><li><p>Create ansible.cfg file under the working folder (same folder with yml files), set <code>host_key_checking=false</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># cat ansible.cfg </span><br>[defaults]<br>host_key_checking=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>This is to ignore SSH authenticity checking, to avoid any human intervention in the middle of the script execution for below prompts:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># GATHERING FACTS <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">***</span></span><br><span class="hljs-strong"><span class="hljs-section"># The authenticity of host &#x27;xxx.xxx.xxx.xxx (xxx.xxx.xxx.xxx)&#x27; can&#x27;t be established.</span></span><br><span class="hljs-strong"><span class="hljs-section"># RSA key fingerprint is xx:yy:zz:....</span></span><br><span class="hljs-strong"><span class="hljs-section"># Are you sure you want to continue connecting (yes/no)?</span></span><br></code></pre></td></tr></table></figure></li></ul><p><strong>Step 2: Set up Inventory and Hosts File:</strong></p><ul><li><p>Create an inventory file on the control node, e.g., <code>inventory.ini</code> with the following content:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[masters]<br>192.168.0.10<br><br>[workers]<br>192.168.0.11<br>192.168.0.12<br><br>[all:vars]<br>ansible_user=root<br>ansible_ssh_pass=your_ssh_password<br></code></pre></td></tr></table></figure></li><li><p>Test the SSH connection to the linux VM</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># ansible -i inventory.ini all -m ping</span><br>10.52.184.222 | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br>10.52.184.223 | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br>10.52.184.221 | SUCCESS =&gt; &#123;<br>    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>Step 3: Create Ansible Playbook:</strong></p><ul><li><p>Create a playbook file, e.g., <code>kubernetes-setup.yml</code> with the following content:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">k8s_version:</span> <span class="hljs-string">&quot;1.28.2&quot;</span><br>    <span class="hljs-attr">kubelet_version:</span> <span class="hljs-string">&quot;1.28.2&quot;</span><br>    <span class="hljs-attr">container_runtime:</span> <span class="hljs-string">&quot;containerd&quot;</span><br>    <span class="hljs-attr">master_ip:</span> <span class="hljs-string">&quot;10.52.184.221&quot;</span><br>    <span class="hljs-attr">pod_subnet:</span> <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br>    <span class="hljs-attr">service_subnet:</span> <span class="hljs-string">&quot;your_service_subnet&quot;</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">Yum</span> <span class="hljs-string">repository</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">&quot;/etc/yum.repos.d/kubernetes.repo&quot;</span><br>        <span class="hljs-attr">content:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          [kubernetes]</span><br><span class="hljs-string">          name=Kubernetes</span><br><span class="hljs-string">          baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">          enabled=1</span><br><span class="hljs-string">          gpgcheck=0</span><br><span class="hljs-string">          repo_gpgcheck=0</span><br><span class="hljs-string">          gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string"></span>      <span class="hljs-attr">notify:</span> <span class="hljs-string">Reload</span> <span class="hljs-string">Repository</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">SELinux</span> <span class="hljs-string">to</span> <span class="hljs-string">permissive</span> <span class="hljs-string">mode</span><br>      <span class="hljs-attr">selinux:</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">permissive</span><br>        <span class="hljs-attr">policy:</span> <span class="hljs-string">targeted</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Disable</span> <span class="hljs-string">firewalld</span><br>      <span class="hljs-attr">systemd:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">firewalld</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">stopped</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">no</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Allow</span> <span class="hljs-string">ports</span> <span class="hljs-number">6443 </span><span class="hljs-string">and</span> <span class="hljs-number">10250</span> <span class="hljs-string">in</span> <span class="hljs-string">firewall</span> <span class="hljs-string">using</span> <span class="hljs-string">iptables</span><br>      <span class="hljs-attr">iptables:</span><br>        <span class="hljs-attr">chain:</span> <span class="hljs-string">INPUT</span><br>        <span class="hljs-attr">protocol:</span> <span class="hljs-string">tcp</span><br>        <span class="hljs-attr">destination_port:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">jump:</span> <span class="hljs-string">ACCEPT</span><br>      <span class="hljs-attr">with_items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">6443</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">10250</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Disable</span> <span class="hljs-string">swap</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">swapoff</span> <span class="hljs-string">-a</span><br>      <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Comment</span> <span class="hljs-string">out</span> <span class="hljs-string">swap</span> <span class="hljs-string">entry</span> <span class="hljs-string">in</span> <span class="hljs-string">/etc/fstab</span><br>      <span class="hljs-attr">lineinfile:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/fstab</span><br>        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^/dev/mapper/.*swap.*$&#x27;</span><br>        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;# <span class="hljs-template-variable">&#123;&#123; item &#125;&#125;</span>&#x27;</span><br>      <span class="hljs-attr">with_items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;UUID=xxxxxxxxxx   none            swap    sw              0       0&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">bridge</span> <span class="hljs-string">and</span> <span class="hljs-string">IP</span> <span class="hljs-string">forwarding</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">with_items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;modprobe br_netfilter&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;sysctl net.bridge.bridge-nf-call-iptables=1&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;sysctl net.ipv4.ip_forward=1&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Update</span> <span class="hljs-string">system</span> <span class="hljs-string">packages</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;*&quot;</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span><br>        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Add</span> <span class="hljs-string">Containerd</span> <span class="hljs-string">repository</span><br>      <span class="hljs-attr">yum_repository:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">containerd</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">Containerd</span> <span class="hljs-string">Repository</span><br>        <span class="hljs-attr">baseurl:</span> <span class="hljs-string">https://download.docker.com/linux/centos/7/$basearch/stable</span><br>        <span class="hljs-attr">gpgkey:</span> <span class="hljs-string">https://download.docker.com/linux/centos/gpg</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Containerd</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">containerd.io</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">Containerd</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">content:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span><br><span class="hljs-string">            runtime_type = &quot;io.containerd.runc.v2&quot;</span><br><span class="hljs-string"></span><br>          [<span class="hljs-string">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.containerd</span>]<br>            <span class="hljs-string">runtime_type</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;io.containerd.runtime.v1.linux&quot;</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/containerd/config.toml</span><br>        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-number">0644</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Start</span> <span class="hljs-string">and</span> <span class="hljs-string">enable</span> <span class="hljs-string">Containerd</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">containerd</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">started</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">components</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">kubelet-&#123;&#123;</span> <span class="hljs-string">k8s_version</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">kubeadm-&#123;&#123;</span> <span class="hljs-string">k8s_version</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">kubectl-&#123;&#123;</span> <span class="hljs-string">k8s_version</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">and</span> <span class="hljs-string">start</span> <span class="hljs-string">kubelet</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">kubelet</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">started</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-attr">handlers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Reload</span> <span class="hljs-string">Repository</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;*&quot;</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br>        <span class="hljs-attr">enablerepo:</span> <span class="hljs-string">kubernetes</span><br>        <span class="hljs-attr">disablerepo:</span> <span class="hljs-string">&quot;*&quot;</span><br>        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">yes</span><br><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">masters</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">k8s_version:</span> <span class="hljs-string">&quot;1.28.2&quot;</span><br>    <span class="hljs-attr">kubelet_version:</span> <span class="hljs-string">&quot;1.28.2&quot;</span><br>    <span class="hljs-attr">container_runtime:</span> <span class="hljs-string">&quot;containerd&quot;</span><br>    <span class="hljs-attr">master_ip:</span> <span class="hljs-string">&quot;10.52.184.221&quot;</span><br>    <span class="hljs-attr">pod_subnet:</span> <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br>    <span class="hljs-attr">service_subnet:</span> <span class="hljs-string">&quot;your_service_subnet&quot;</span><br>    <br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">bridge-nf-call-iptables</span> <span class="hljs-string">to</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">sysctl</span> <span class="hljs-string">net.bridge.bridge-nf-call-iptables=1</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Initialize</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">master</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">kubeadm</span> <span class="hljs-string">init</span> <span class="hljs-string">--kubernetes-version=&#123;&#123;</span> <span class="hljs-string">k8s_version</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">--pod-network-cidr=&#123;&#123;</span> <span class="hljs-string">pod_subnet</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">--apiserver-advertise-address=&#123;&#123;</span> <span class="hljs-string">master_ip</span> <span class="hljs-string">&#125;&#125;</span><br>      <span class="hljs-attr">register:</span> <span class="hljs-string">kubeadm_output</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">kubeadm</span> <span class="hljs-string">output</span> <span class="hljs-string">on</span> <span class="hljs-string">master</span> <span class="hljs-string">node</span><br>      <span class="hljs-attr">set_fact:</span><br>        <span class="hljs-attr">kubeadm_output:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; kubeadm_output.stdout_lines[-2:] | join(&#x27; &#x27;) | regex_replace(&#x27;\t&#x27;, &#x27;&#x27;) | regex_replace(&#x27;\\\\&#x27;, &#x27;&#x27;) &#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">kubeadm_output.stdout_lines</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Remove</span> <span class="hljs-string">existing</span> <span class="hljs-string">kubeconfig</span> <span class="hljs-string">file</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">rm</span> <span class="hljs-string">-f</span> <span class="hljs-string">$HOME/.kube/config</span><br>      <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">kubeconfig</span> <span class="hljs-string">directory</span><br>      <span class="hljs-attr">file:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">$HOME/.kube</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">directory</span><br>        <span class="hljs-attr">owner:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_user &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_user &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0755&#x27;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">kubeconfig</span> <span class="hljs-string">to</span> <span class="hljs-string">user&#x27;s</span> <span class="hljs-string">home</span> <span class="hljs-string">directory</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/etc/kubernetes/admin.conf</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">$HOME/.kube/config</span><br>        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">owner:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_user &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_user &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0644&#x27;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Flannel</span> <span class="hljs-string">pod</span> <span class="hljs-string">network</span> <span class="hljs-string">addon</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">workers</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">master_ip:</span> <span class="hljs-string">&quot;10.52.184.221&quot;</span><br><br><br>  <span class="hljs-attr">tasks:</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">net.ipv4.ip_forward</span> <span class="hljs-string">to</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">sysctl</span> <span class="hljs-string">net.ipv4.ip_forward=1</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Join</span> <span class="hljs-string">worker</span> <span class="hljs-string">nodes</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; hostvars[groups[&#x27;masters&#x27;][0]].kubeadm_output &#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">register:</span> <span class="hljs-string">join_output</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Debug</span> <span class="hljs-string">join</span> <span class="hljs-string">output</span><br>      <span class="hljs-attr">debug:</span><br>        <span class="hljs-attr">var:</span> <span class="hljs-string">join_output.stdout</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">join_output.stdout</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Debug</span> <span class="hljs-string">join</span> <span class="hljs-string">error</span><br>      <span class="hljs-attr">debug:</span><br>        <span class="hljs-attr">var:</span> <span class="hljs-string">join_output.stderr</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">join_output.stderr</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>Step 4: Run the Ansible Playbook:</strong></p><ul><li><p>Run the Ansible playbook using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-playbook -i inventory.ini kubernetes-setup.yml<br><br><span class="hljs-comment">## running the playbook with debug model as needed</span><br><span class="hljs-comment"># ansible-playbook -i inventory.ini kubernetes-setup.yml -vvv</span><br></code></pre></td></tr></table></figure></li><li><p>The output is as below:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos-0 ansible]<span class="hljs-comment"># ansible-playbook -i inventory.ini  k8s-cluster.yml</span><br><br>PLAY [all] *******************************************************************************************************************************************************************************************************<br>TASK [Gathering Facts] *******************************************************************************************************************************************************************************************ok: [10.52.184.221]<br>ok: [10.52.184.222]<br>ok: [10.52.184.223]<br><br>TASK [Configure Kubernetes Yum repository] ***********************************************************************************************************************************************************************changed: [10.52.184.222]<br>changed: [10.52.184.223]<br>changed: [10.52.184.221]<br><br>TASK [Set SELinux to permissive mode] ****************************************************************************************************************************************************************************changed: [10.52.184.223]<br>changed: [10.52.184.222]<br>changed: [10.52.184.221]<br><br>TASK [Disable firewalld] *****************************************************************************************************************************************************************************************changed: [10.52.184.222]<br>changed: [10.52.184.221]<br>changed: [10.52.184.223]<br><br>TASK [Allow ports 6443 and 10250 <span class="hljs-keyword">in</span> firewall using iptables] *****************************************************************************************************************************************************changed: [10.52.184.221] =&gt; (item=6443)<br>changed: [10.52.184.223] =&gt; (item=6443)<br>changed: [10.52.184.222] =&gt; (item=6443)<br>changed: [10.52.184.221] =&gt; (item=10250)<br>[WARNING]: The value 6443 (<span class="hljs-built_in">type</span> int) <span class="hljs-keyword">in</span> a string field was converted to u<span class="hljs-string">&#x27;6443&#x27;</span> (<span class="hljs-built_in">type</span> string). If this does not look like what you expect, quote the entire value to ensure it does not change.<br>[WARNING]: The value 10250 (<span class="hljs-built_in">type</span> int) <span class="hljs-keyword">in</span> a string field was converted to u<span class="hljs-string">&#x27;10250&#x27;</span> (<span class="hljs-built_in">type</span> string). If this does not look like what you expect, quote the entire value to ensure it does not change.<br>changed: [10.52.184.223] =&gt; (item=10250)<br>changed: [10.52.184.222] =&gt; (item=10250)<br><br>TASK [Disable swap] **********************************************************************************************************************************************************************************************changed: [10.52.184.221]<br>changed: [10.52.184.222]<br>changed: [10.52.184.223]<br><br>TASK [Comment out swap entry <span class="hljs-keyword">in</span> /etc/fstab] **********************************************************************************************************************************************************************changed: [10.52.184.222] =&gt; (item=UUID=xxxxxxxxxx   none            swap    sw              0       0)<br>changed: [10.52.184.223] =&gt; (item=UUID=xxxxxxxxxx   none            swap    sw              0       0)<br>changed: [10.52.184.221] =&gt; (item=UUID=xxxxxxxxxx   none            swap    sw              0       0)<br><br>TASK [Enable bridge and IP forwarding] ***************************************************************************************************************************************************************************changed: [10.52.184.222] =&gt; (item=modprobe br_netfilter)<br>changed: [10.52.184.223] =&gt; (item=modprobe br_netfilter)<br>changed: [10.52.184.221] =&gt; (item=modprobe br_netfilter)<br>changed: [10.52.184.222] =&gt; (item=sysctl net.bridge.bridge-nf-call-iptables=1)<br>changed: [10.52.184.223] =&gt; (item=sysctl net.bridge.bridge-nf-call-iptables=1)<br>changed: [10.52.184.221] =&gt; (item=sysctl net.bridge.bridge-nf-call-iptables=1)<br>changed: [10.52.184.222] =&gt; (item=sysctl net.ipv4.ip_forward=1)<br>changed: [10.52.184.223] =&gt; (item=sysctl net.ipv4.ip_forward=1)<br>changed: [10.52.184.221] =&gt; (item=sysctl net.ipv4.ip_forward=1)<br><br>TASK [Update system packages] ************************************************************************************************************************************************************************************ok: [10.52.184.223]<br>ok: [10.52.184.222]<br>ok: [10.52.184.221]<br><br>TASK [Add Containerd repository] *********************************************************************************************************************************************************************************changed: [10.52.184.221]<br>changed: [10.52.184.223]<br>changed: [10.52.184.222]<br><br>TASK [Install Containerd] ****************************************************************************************************************************************************************************************changed: [10.52.184.222]<br>changed: [10.52.184.223]<br>changed: [10.52.184.221]<br><br>TASK [Configure Containerd] **************************************************************************************************************************************************************************************changed: [10.52.184.223]<br>changed: [10.52.184.222]<br>changed: [10.52.184.221]<br><br>TASK [Start and <span class="hljs-built_in">enable</span> Containerd service] ***********************************************************************************************************************************************************************changed: [10.52.184.223]<br>changed: [10.52.184.222]<br>changed: [10.52.184.221]<br><br>TASK [Install Kubernetes components] *****************************************************************************************************************************************************************************changed: [10.52.184.221]<br>changed: [10.52.184.223]<br>changed: [10.52.184.222]<br><br>TASK [Enable and start kubelet service] **************************************************************************************************************************************************************************changed: [10.52.184.222]<br>changed: [10.52.184.221]<br>changed: [10.52.184.223]<br><br>RUNNING HANDLER [Reload Repository] ******************************************************************************************************************************************************************************ok: [10.52.184.222]<br>ok: [10.52.184.221]<br>ok: [10.52.184.223]<br><br>PLAY [masters] ***************************************************************************************************************************************************************************************************<br>TASK [Gathering Facts] *******************************************************************************************************************************************************************************************ok: [10.52.184.221]<br><br>TASK [Set bridge-nf-call-iptables to 1] **************************************************************************************************************************************************************************changed: [10.52.184.221]<br><br>TASK [Initialize Kubernetes master] ******************************************************************************************************************************************************************************changed: [10.52.184.221]<br><br>TASK [Set kubeadm output on master node] *************************************************************************************************************************************************************************ok: [10.52.184.221]<br><br>TASK [Print <span class="hljs-built_in">join</span> <span class="hljs-built_in">command</span> on master node] *************************************************************************************************************************************************************************skipping: [10.52.184.221]<br><br>TASK [Remove existing kubeconfig file] ***************************************************************************************************************************************************************************[WARNING]: Consider using the file module with state=absent rather than running <span class="hljs-string">&#x27;rm&#x27;</span>.  If you need to use <span class="hljs-built_in">command</span> because file is insufficient you can add <span class="hljs-string">&#x27;warn: false&#x27;</span> to this <span class="hljs-built_in">command</span> task or <span class="hljs-built_in">set</span><br><span class="hljs-string">&#x27;command_warnings=False&#x27;</span> <span class="hljs-keyword">in</span> ansible.cfg to get rid of this message.<br>changed: [10.52.184.221]<br><br>TASK [Create kubeconfig directory] *******************************************************************************************************************************************************************************changed: [10.52.184.221]<br><br>TASK [Copy kubeconfig to user<span class="hljs-string">&#x27;s home directory] ******************************************************************************************************************************************************************changed: [10.52.184.221]</span><br><span class="hljs-string"></span><br><span class="hljs-string">TASK [Install Flannel pod network addon] *************************************************************************************************************************************************************************changed: [10.52.184.221]</span><br><span class="hljs-string"></span><br><span class="hljs-string">PLAY [workers] ***************************************************************************************************************************************************************************************************</span><br><span class="hljs-string">TASK [Gathering Facts] *******************************************************************************************************************************************************************************************ok: [10.52.184.222]</span><br><span class="hljs-string">ok: [10.52.184.223]</span><br><span class="hljs-string"></span><br><span class="hljs-string">TASK [Set net.ipv4.ip_forward to 1] ******************************************************************************************************************************************************************************changed: [10.52.184.222]</span><br><span class="hljs-string">changed: [10.52.184.223]</span><br><span class="hljs-string"></span><br><span class="hljs-string">TASK [Join worker nodes to the cluster] **************************************************************************************************************************************************************************changed: [10.52.184.223]</span><br><span class="hljs-string">changed: [10.52.184.222]</span><br><span class="hljs-string"></span><br><span class="hljs-string">TASK [Debug join output] *****************************************************************************************************************************************************************************************ok: [10.52.184.222] =&gt; &#123;</span><br><span class="hljs-string">    &quot;join_output.stdout&quot;: &quot;[preflight] Running pre-flight checks\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with &#x27;</span>kubectl -n kube-system get cm kubeadm-config -o yaml<span class="hljs-string">&#x27;\n[kubelet-start] Writing kubelet configuration to file \&quot;/var/lib/kubelet/config.yaml\&quot;\n[kubelet-start] Writing kubelet environment file with flags to file \&quot;/var/lib/kubelet/kubeadm-flags.env\&quot;\n[kubelet-start] Starting the kubelet\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun &#x27;</span>kubectl get nodes<span class="hljs-string">&#x27; on the control-plane to see this node join the cluster.&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">ok: [10.52.184.223] =&gt; &#123;</span><br><span class="hljs-string">    &quot;join_output.stdout&quot;: &quot;[preflight] Running pre-flight checks\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with &#x27;</span>kubectl -n kube-system get cm kubeadm-config -o yaml<span class="hljs-string">&#x27;\n[kubelet-start] Writing kubelet configuration to file \&quot;/var/lib/kubelet/config.yaml\&quot;\n[kubelet-start] Writing kubelet environment file with flags to file \&quot;/var/lib/kubelet/kubeadm-flags.env\&quot;\n[kubelet-start] Starting the kubelet\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun &#x27;</span>kubectl get nodes<span class="hljs-string">&#x27; on the control-plane to see this node join the cluster.&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">TASK [Debug join error] ******************************************************************************************************************************************************************************************ok: [10.52.184.222] =&gt; &#123;</span><br><span class="hljs-string">    &quot;join_output.stderr&quot;: &quot;&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">ok: [10.52.184.223] =&gt; &#123;</span><br><span class="hljs-string">    &quot;join_output.stderr&quot;: &quot;&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">PLAY RECAP *******************************************************************************************************************************************************************************************************10.52.184.221              : ok=24   changed=19   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   </span><br><span class="hljs-string">10.52.184.222              : ok=21   changed=15   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br><span class="hljs-string">10.52.184.223              : ok=21   changed=15   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure></li><li><p>Verify the k8s cluster status from master node</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@CentOS001 ~]<span class="hljs-comment"># kubectl get nodes</span><br>NAME        STATUS   ROLES           AGE     VERSION<br>centos001   Ready    control-plane   4h18m   v1.28.2<br>centos002   Ready    &lt;none&gt;          4h17m   v1.28.2<br>centos003   Ready    &lt;none&gt;          4h17m   v1.28.2<br><br>[root@CentOS001 ~]<span class="hljs-comment"># kubectl get pods -A</span><br>NAMESPACE      NAME                                READY   STATUS    RESTARTS   AGE<br>kube-flannel   kube-flannel-ds-58ztz               1/1     Running   0          4h18m<br>kube-flannel   kube-flannel-ds-d7ktx               1/1     Running   0          4h18m<br>kube-flannel   kube-flannel-ds-jtdtf               1/1     Running   0          4h18m<br>kube-system    coredns-5dd5756b68-fqspp            1/1     Running   0          4h18m<br>kube-system    coredns-5dd5756b68-pvqkw            1/1     Running   0          4h18m<br>kube-system    etcd-centos001                      1/1     Running   0          4h18m<br>kube-system    kube-apiserver-centos001            1/1     Running   0          4h18m<br>kube-system    kube-controller-manager-centos001   1/1     Running   0          4h18m<br>kube-system    kube-proxy-btpvq                    1/1     Running   0          4h18m<br>kube-system    kube-proxy-j6fj4                    1/1     Running   0          4h18m<br>kube-system    kube-proxy-qjkcn                    1/1     Running   0          4h18m<br>kube-system    kube-scheduler-centos001            1/1     Running   0          4h18m<br></code></pre></td></tr></table></figure></li></ul><h3 id="Use-Ansible-to-install-helm3"><a href="#Use-Ansible-to-install-helm3" class="headerlink" title="Use Ansible to install helm3"></a>Use Ansible to install helm3</h3><p><strong>Step 1: create the playbook for helm3 installation</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">masters</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">Helm</span> <span class="hljs-string">installation</span> <span class="hljs-string">script</span><br>      <span class="hljs-attr">get_url:</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp/helm.tar.gz</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Extract</span> <span class="hljs-string">Helm</span> <span class="hljs-string">package</span><br>      <span class="hljs-attr">unarchive:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/tmp/helm.tar.gz</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/tmp</span><br>        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Move</span> <span class="hljs-string">Helm</span> <span class="hljs-string">binary</span> <span class="hljs-string">to</span> <span class="hljs-string">/usr/local/bin</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">chdir=/tmp/linux-amd64/</span> <span class="hljs-string">mv</span> <span class="hljs-string">helm</span> <span class="hljs-string">/usr/local/bin/</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Helm</span> <span class="hljs-string">repository</span> <span class="hljs-string">cache</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">helm</span> <span class="hljs-string">repo</span> <span class="hljs-string">cache</span> <span class="hljs-string">rebuild</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Initialize</span> <span class="hljs-string">Helm</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">helm</span> <span class="hljs-string">repo</span> <span class="hljs-string">add</span> <span class="hljs-string">stable</span> <span class="hljs-string">https://charts.helm.sh/stable</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Helm</span> <span class="hljs-string">completion</span> <span class="hljs-string">for</span> <span class="hljs-string">Bash</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;source &lt;(helm completion bash)&quot;</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">~/.bashrc</span><br></code></pre></td></tr></table></figure><p><strong>Step 2: run the playbook</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-playbook -i inventory.ini helm3.yml<br></code></pre></td></tr></table></figure><p><strong>Tips: something more about helm</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># add helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="hljs-string">&quot;stable&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="hljs-string">&quot;aliyun&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add jetstack https://charts.jetstack.io</span><br><span class="hljs-string">&quot;jetstack&quot;</span> has been added to your repositories<br><br><span class="hljs-comment"># update helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo update</span><br>Hang tight <span class="hljs-keyword">while</span> we grab the latest from your chart repositories...<br>...Successfully got an update from the <span class="hljs-string">&quot;jetstack&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;aliyun&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;stable&quot;</span> chart repository<br>Update Complete. ⎈ Happy Helming!⎈ <br><br><span class="hljs-comment"># list helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo list</span><br>NAME    URL                                                   <br>stable  http://mirror.azure.cn/kubernetes/charts              <br>aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br>jetstackhttps://charts.jetstack.io                            <br><br><span class="hljs-comment"># search chart</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm search repo nginx</span><br>NAME                       CHART VERSIONAPP VERSIONDESCRIPTION                                       <br>aliyun/nginx-ingress       0.9.5        0.10.2     An nginx Ingress controller that uses ConfigMap...<br>aliyun/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>stable/nginx-ingress       1.41.3       v0.34.1    DEPRECATED! An nginx Ingress controller that us...<br>stable/nginx-ldapauth-proxy0.1.6        1.13.5     DEPRECATED - nginx proxy with ldapauth            <br>stable/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>aliyun/gcloud-endpoints    0.1.0                   Develop, deploy, protect and monitor your APIs ...<br>stable/gcloud-endpoints    0.1.2        1          DEPRECATED Develop, deploy, protect and monitor..<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lab</tag>
      
      <tag>k8s</tag>
      
      <tag>ansible</tag>
      
      <tag>terraform</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NFS server on CentOS8</title>
    <link href="/2023/12/07/nfs-server-on-centos8/"/>
    <url>/2023/12/07/nfs-server-on-centos8/</url>
    
    <content type="html"><![CDATA[<h1 id="NFS-server-on-CentOS8"><a href="#NFS-server-on-CentOS8" class="headerlink" title="NFS server on CentOS8"></a>NFS server on CentOS8</h1><h2 id="Install-and-configure-NFS-server"><a href="#Install-and-configure-NFS-server" class="headerlink" title="Install and configure NFS server"></a>Install and configure NFS server</h2><p><strong>Step 1: Install NFS Packages:</strong></p><ol><li><p>Open a terminal on your CentOS 8 VM.</p></li><li><p>Run the following command to install the necessary NFS packages using</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install nfs-utils<br></code></pre></td></tr></table></figure></li></ol><p><strong>Step 2: Configure NFS Exports:</strong></p><ol><li><p>Create a directory that will be shared with NFS clients. For example, let’s create a directory called &#x2F;shared</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> /shared<br></code></pre></td></tr></table></figure></li><li><p>Assign appropriate permissions to the shared directory:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">chmod</span> -R 777 /shared<br></code></pre></td></tr></table></figure></li><li><p>Open the <code>/etc/exports</code> file in a text editor:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vi /etc/exports<br></code></pre></td></tr></table></figure></li><li><p>Add an entry in the file to define the shared directory and specify the allowed NFS clients. For example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/shared 192.168.1.0/24(rw,<span class="hljs-built_in">sync</span>,no_root_squash)<br></code></pre></td></tr></table></figure><ul><li><code>/shared</code>: Path to the directory you created.</li><li><code>192.168.1.0/24</code>: IP address range or specific IP of the NFS clients allowed to access the shared directory.</li><li><code>rw</code>: Allows read and write access.</li><li><code>sync</code>: Synchronizes changes to the disk before acknowledging the request.</li><li><code>no_root_squash</code>: Allows the root user on the NFS client to have root privileges on the NFS server.</li></ul></li></ol><p><strong>Step 3: Start and Enable NFS Services:</strong></p><ol><li><p>Start the NFS server service:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl start nfs-server<br></code></pre></td></tr></table></figure></li><li><p>Enable the NFS server service to start automatically at boot:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> nfs-server<br></code></pre></td></tr></table></figure></li></ol><p><strong>Step 4: Configure Firewall for NFS:</strong></p><ol><li><p>If you have a firewall enabled, open the necessary ports for NFS:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo firewall-cmd --permanent --zone=public --add-service=nfs<br>sudo firewall-cmd --permanent --zone=public --add-service=mountd<br>sudo firewall-cmd --permanent --zone=public --add-service=rpc-bind<br>sudo firewall-cmd --reload<br></code></pre></td></tr></table></figure></li></ol><p><strong>Step 5: Export the Shared Directory:</strong></p><ol><li><p>Export the shared directory by running the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo exportfs -r<br></code></pre></td></tr></table></figure></li></ol><p><strong>Step 6: Test NFS Access:</strong></p><ol><li><p>On a client machine, ensure that the NFS utilities package is installed. If not, install it using <code>sudo dnf install nfs-utils</code>.</p></li><li><p>Create a directory on the client machine where you want to mount the NFS share. For example, let’s create a directory called</p><p> <code>/mnt/nfs</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> /mnt/nfs<br></code></pre></td></tr></table></figure></li><li><p>Mount the NFS share from the server to the client:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mount server_ip:/shared /mnt/nfs<br></code></pre></td></tr></table></figure><ul><li>Replace <code>server_ip</code> with the IP address of your NFS server.</li></ul></li><li><p>Verify that the NFS share is mounted successfully by accessing the <code>/mnt/nfs</code> directory on the client.</p></li></ol><h2 id="Access-NFS-server-shared-folder-from-windows"><a href="#Access-NFS-server-shared-folder-from-windows" class="headerlink" title="Access NFS server shared folder from windows"></a>Access NFS server shared folder from windows</h2><p><strong>Step 1: Enable NFS Client Feature:</strong></p><ol><li>Open the “Control Panel” on your Windows machine.</li><li>Go to “Programs” or “Programs and Features”.</li><li>Click on “Turn Windows features on or off”.</li><li>Scroll down and locate “Services for NFS”.</li><li>Check the box next to “Client for NFS”.</li><li>Click “OK” and wait for the feature to be installed.</li></ol><p><strong>Step 2: Mount the NFS Share:</strong></p><ol><li><p>Open the “File Explorer” on your Windows machine.</p></li><li><p>In the address bar, enter the following command, replacing <code>nfs_server_ip</code> with the IP address of your NFS server and <code>shared_directory</code> with the path to the shared directory on the NFS server:</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">\\nfs<span class="hljs-number">_</span>server<span class="hljs-number">_</span>ip\<span class="hljs-keyword">shared</span><span class="hljs-number">_</span>directory<br></code></pre></td></tr></table></figure><p>For example:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">\\<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>\<span class="hljs-keyword">shared</span><br></code></pre></td></tr></table></figure></li><li><p>Press Enter or click on the arrow button to access the NFS share.</p></li><li><p>If prompted, enter the appropriate credentials to access the NFS share (if the NFS server requires authentication).</p></li><li><p>Optional: Use web browser to access the shared folder:</p><p><img src="https://felixyanghui.synology.me:8441/images/2023/12/08/image-20231208113943859.png" alt="image-20231208113943859"></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>centos</tag>
      
      <tag>linux</tag>
      
      <tag>NFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Alist on Synology NA</title>
    <link href="/2023/11/20/alist-on-synology-nas/"/>
    <url>/2023/11/20/alist-on-synology-nas/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="Set-up-Alist-on-Synology-NAS"><a href="#Set-up-Alist-on-Synology-NAS" class="headerlink" title="Set up Alist on Synology NAS"></a>Set up Alist on Synology NAS</h1><blockquote><p>If you want to set up downloader with Aria as well , use the other docker image here <a href="https://hub.docker.com/r/xhofe/alist-aria2">https://hub.docker.com/r/xhofe/alist-aria2</a></p></blockquote><h2 id="Install-Alist-through-docker"><a href="#Install-Alist-through-docker" class="headerlink" title="Install Alist through docker"></a>Install Alist through docker</h2><h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><ul><li><p>Create a folder under <code>docker/alist</code>, grant full permission to Everyone</p></li><li><p>Connect to synology through remote SSH</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes256-cbc XXX -p XXX<br><br>felix_yanghui@DS218plus:~$ <br></code></pre></td></tr></table></figure></li></ul><h3 id="Run-Docker"><a href="#Run-Docker" class="headerlink" title="Run Docker"></a>Run Docker</h3><ul><li><p>Run the docker with docker-cli</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">felix_yanghui@DS218plus:~$ sudo docker pull xhofe/alist<br>Password: <br>Using default tag: latest<br>latest: Pulling from xhofe/alist<br>7264a8db6415: Pull complete <br>79745e4f888f: Pull complete <br>3c33e08caf6b: Pull complete <br>45f351bad286: Pull complete <br>a98fc4aad311: Pull complete <br>Digest: sha256:1e931c57d9de771f75c5c853231f215ffd8a684563323fa42138beda8ff42e5a<br>Status: Downloaded newer image for xhofe/alist:latest<br>docker.io/xhofe/alist:latest<br><br>felix_yanghui@DS218plus:~$ sudo docker run -d --restart=always -v /volume1/docker/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=&quot;alist&quot; xhofe/alist:latest<br>4a1fa7bef232bb549e394dd7338932bad8e2cf467da21e50e927e89c07046f0b<br></code></pre></td></tr></table></figure></li><li><p>set up the new password for Alist container</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">felix_yanghui@DS218plus:~$ sudo docker exec -it alist ./alist admin set &quot;xxx&quot;<br>INFO[2023-11-20 18:51:52] reading config file: data/config.json        <br>INFO[2023-11-20 18:51:52] load config from env with prefix: ALIST_     <br>INFO[2023-11-20 18:51:52] init logrus...                               <br>INFO[2023-11-20 18:51:52] admin user has been updated:                 <br>INFO[2023-11-20 18:51:52] username: admin                              <br>INFO[2023-11-20 18:51:52] password: xxx<br></code></pre></td></tr></table></figure></li></ul><h2 id="Set-up-the-network-connection"><a href="#Set-up-the-network-connection" class="headerlink" title="Set up the network connection"></a>Set up the network connection</h2><ul><li><p>Set up the port maping on router</p><p><img src="https://felixyanghui.synology.me:8441/images/2023/11/21/image-20231120131921976.png" alt="image-20231120131921976"></p></li><li><p>Set up the reverse proxy of the FQDN and port </p><ul><li>Control panel - &gt; System - &gt; logon portal - &gt; Advanced - &gt; Reversed proxy</li></ul></li></ul><h2 id="Access-to-the-Alist-portal-from-external-internet"><a href="#Access-to-the-Alist-portal-from-external-internet" class="headerlink" title="Access to the Alist portal from external internet"></a>Access to the Alist portal from external internet</h2><p><img src="https://felixyanghui.synology.me:8441/images/2023/11/21/image-20231120132259397.png" alt="image-20231120132259397"></p>]]></content>
    
    
    
    <tags>
      
      <tag>synology</tag>
      
      <tag>Alist</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>How to make a bootable windows 10 USB on a Mac</title>
    <link href="/2023/11/19/how-to-make-a-bootable-windows-10-usb-on-a-mac/"/>
    <url>/2023/11/19/how-to-make-a-bootable-windows-10-usb-on-a-mac/</url>
    
    <content type="html"><![CDATA[<h1 id="How-to-make-a-bootable-windows-10-USB-on-a-Mac"><a href="#How-to-make-a-bootable-windows-10-USB-on-a-Mac" class="headerlink" title="How to make a bootable windows 10 USB on a Mac"></a>How to make a bootable windows 10 USB on a Mac</h1><h2 id="Inset-the-USB-driver"><a href="#Inset-the-USB-driver" class="headerlink" title="Inset the USB driver"></a>Inset the USB driver</h2><h3 id="Open-the-disk-utility-and-format-the-USB-driver"><a href="#Open-the-disk-utility-and-format-the-USB-driver" class="headerlink" title="Open the disk utility and format the USB driver"></a>Open the disk utility and format the USB driver</h3><p><img src="https://felixyanghui.synology.me:8441/images/2023/11/20/image-20231119230448398.png" alt="image-20231119230448398"></p><h2 id="Download-the-windows-10-ISO-file"><a href="#Download-the-windows-10-ISO-file" class="headerlink" title="Download the windows 10 ISO file"></a>Download the windows 10 ISO file</h2><p><a href="https://www.microsoft.com/en-us/software-download/windows10ISO">https://www.microsoft.com/en-us/software-download/windows10ISO</a></p><p>Step-0: Double click the ISO file to mount the disk</p><p>Step-1: Copy all the files expect the folder <code>sources</code>  from ISO mounted driver to USB driver</p><p>Step-2: Create a new folder <code>sources</code> in USB driver</p><p>Step-3: Copy all the files except the <code>install.wim</code> under <code>sources</code> folder of ISO mounted driver, into new folder <code>sources</code> in USB driver</p><h2 id="Split-the-big-file-install-wim"><a href="#Split-the-big-file-install-wim" class="headerlink" title="Split the big file: install.wim"></a>Split the big file: <code>install.wim</code></h2><h3 id="Brew-install-wimlib"><a href="#Brew-install-wimlib" class="headerlink" title="Brew install wimlib"></a>Brew install wimlib</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % brew install wimlib<br>==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">######################################################################################################################################################################################################################################################## 100.0%</span></span><br>==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">######################################################################################################################################################################################################################################################## 100.0%</span></span><br>Warning: wimlib 1.14.3 is already installed and up-to-date.<br>To reinstall 1.14.3, run:<br>  brew reinstall wimlib<br></code></pre></td></tr></table></figure><h3 id="Split-the-big-file-install-wim-and-output-the-splited-files-to-sources-folder-of-USB-driver"><a href="#Split-the-big-file-install-wim-and-output-the-splited-files-to-sources-folder-of-USB-driver" class="headerlink" title="Split the big file: install.wim and output the splited files to sources folder of USB driver"></a>Split the big file: install.wim and output the splited files to <code>sources</code> folder of USB driver</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">felixy@USLC-FELIXY-M ~ % wimlib-imagex split /Volumes/CCCOMA_X64FRE_ZH-CN_DV9/sources/install.wim /Volumes/WINDOWS10/sources/install.swm 4000 <br>Splitting WIM: 4815 MiB of 4815 MiB (100%) written, part 2 of 2<br>Finished splitting &quot;/Volumes/CCCOMA_X64FRE_ZH-CN_DV9/sources/install.wim&quot;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bootable</tag>
      
      <tag>windows</tag>
      
      <tag>Mac</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Lab - Networking on AWS and Azure</title>
    <link href="/2023/11/07/lab-networking-on-aws-and-azure/"/>
    <url>/2023/11/07/lab-networking-on-aws-and-azure/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Lab-1-Basic-Networking-on-AWS-and-Azure"><a href="#Lab-1-Basic-Networking-on-AWS-and-Azure" class="headerlink" title="Lab 1: Basic Networking on AWS and Azure"></a>Lab 1: Basic Networking on AWS and Azure</h1><ul><li><p>AWS CLI Steps:</p><ol><li><p>Create a VPC:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpc</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">16</span><br></code></pre></td></tr></table></figure></li><li><p>Create subnets:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-subnet</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">1</span>.<span class="hljs-string">0</span>/<span class="hljs-string">24</span><br></code></pre></td></tr></table></figure></li><li><p>Create an internet gateway:</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">&lt;TEXT&gt;<br>aws ec2 <span class="hljs-built_in">create</span>-<span class="hljs-keyword">internet</span>-gateway<br></code></pre></td></tr></table></figure></li><li><p>Attach the internet gateway to the VPC:</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-operator">&lt;</span>TEXT<span class="hljs-operator">&gt;</span><br>aws ec2 attach<span class="hljs-operator">-</span>internet<span class="hljs-operator">-</span>gateway <span class="hljs-operator">--</span>vpc<span class="hljs-operator">-</span><span class="hljs-built_in">id</span> <span class="hljs-operator">&lt;</span>vpc<span class="hljs-operator">-</span><span class="hljs-built_in">id</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">--</span>internet<span class="hljs-operator">-</span>gateway<span class="hljs-operator">-</span><span class="hljs-built_in">id</span> <span class="hljs-operator">&lt;</span>internet<span class="hljs-operator">-</span>gateway<span class="hljs-operator">-</span><span class="hljs-built_in">id</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>Create a route table and add a route:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-route-table</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-route</span> <span class="hljs-built_in">--route-table-id</span> &lt;<span class="hljs-string">route-table-id</span>&gt; <span class="hljs-built_in">--destination-cidr-block</span> <span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">0</span> <span class="hljs-built_in">--gateway-id</span> &lt;<span class="hljs-string">internet-gateway-id</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create a VNet:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet create --<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure></li><li><p>Create subnets:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet subnet create --<span class="hljs-built_in">name</span> &lt;subnet-<span class="hljs-built_in">name</span>&gt; --vnet-<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure></li><li><p>Create a network security group (NSG):</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network nsg create --<span class="hljs-built_in">name</span> &lt;nsg-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Associate the NSG with the subnet:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet subnet update --<span class="hljs-built_in">name</span> &lt;subnet-<span class="hljs-built_in">name</span>&gt; --vnet-<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --network-security-<span class="hljs-built_in">group</span> &lt;nsg-<span class="hljs-built_in">name</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a virtual network gateway (for VPN or ExpressRoute connectivity) if needed:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet-gateway create --<span class="hljs-built_in">name</span> &lt;gateway-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet &lt;vnet-<span class="hljs-built_in">name</span>&gt; --public-ip-address &lt;public-ip-<span class="hljs-built_in">name</span>&gt; --gateway-<span class="hljs-built_in">type</span> &lt;gateway-<span class="hljs-built_in">type</span>&gt; --sku &lt;sku-<span class="hljs-built_in">type</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-2-High-Availability-and-Load-Balancing"><a href="#Lab-2-High-Availability-and-Load-Balancing" class="headerlink" title="Lab 2: High Availability and Load Balancing"></a>Lab 2: High Availability and Load Balancing</h1><ul><li><p>Topology Example:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">&lt;TEXT&gt;</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|      Internet     |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   Load Balancer   |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   Web Servers     |</span><br><span class="hljs-section">+-------------------+</span><br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create an application load balancer:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">elbv2</span> <span class="hljs-built_in">create-load-balancer</span> <span class="hljs-built_in">--name</span> &lt;<span class="hljs-string">load-balancer-name</span>&gt; <span class="hljs-built_in">--subnets</span> &lt;<span class="hljs-string">subnet-ids</span>&gt; <span class="hljs-built_in">--security-groups</span> &lt;<span class="hljs-string">security-group-ids</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create target groups and register the web servers:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">elbv2</span> <span class="hljs-built_in">create-target-group</span> <span class="hljs-built_in">--name</span> &lt;<span class="hljs-string">target-group-name</span>&gt; <span class="hljs-built_in">--protocol</span> <span class="hljs-string">HTTP</span> <span class="hljs-built_in">--port</span> <span class="hljs-string">80</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">elbv2</span> <span class="hljs-string">register-targets</span> <span class="hljs-built_in">--target-group-arn</span> &lt;<span class="hljs-string">target-group-arn</span>&gt; <span class="hljs-built_in">--targets</span> &lt;<span class="hljs-string">instance-ids</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create a load balancer:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network lb create --<span class="hljs-built_in">name</span> &lt;lb-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --frontend-ip-<span class="hljs-built_in">name</span> &lt;frontend-ip-<span class="hljs-built_in">name</span>&gt; --backend-pool-<span class="hljs-built_in">name</span> &lt;backend-pool-<span class="hljs-built_in">name</span>&gt; --sku &lt;lb-sku&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create load balancing rules and probe:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-symbol">&lt;TEXT&gt;</span><br>az network <span class="hljs-keyword">lb</span> rule create --name <span class="hljs-symbol">&lt;rule-name&gt;</span> --resource-group <span class="hljs-symbol">&lt;resource-group-name&gt;</span> --<span class="hljs-keyword">lb</span>-name <span class="hljs-symbol">&lt;lb-name&gt;</span> --protocol TCP --frontend-port <span class="hljs-symbol">&lt;frontend-port&gt;</span> --backend-port <span class="hljs-symbol">&lt;backend-port&gt;</span> --frontend-ip-name <span class="hljs-symbol">&lt;frontend-ip-name&gt;</span> --backend-pool-name <span class="hljs-symbol">&lt;backend-pool-name&gt;</span><br>az network <span class="hljs-keyword">lb</span> probe create --name <span class="hljs-symbol">&lt;probe-name&gt;</span> --resource-group <span class="hljs-symbol">&lt;resource-group-name&gt;</span> --<span class="hljs-keyword">lb</span>-name <span class="hljs-symbol">&lt;lb-name&gt;</span> --protocol TCP --port <span class="hljs-symbol">&lt;port&gt;</span> --interval <span class="hljs-symbol">&lt;interval&gt;</span> --threshold <span class="hljs-symbol">&lt;threshold&gt;</span><br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-3-Hybrid-Cloud-Networking"><a href="#Lab-3-Hybrid-Cloud-Networking" class="headerlink" title="Lab 3: Hybrid Cloud Networking"></a>Lab 3: Hybrid Cloud Networking</h1><ul><li><p>Topology Example:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">&lt;TEXT&gt;</span><br><span class="hljs-section">+------------------------+</span><br><span class="hljs-section">|   On-Premises Network   |</span><br><span class="hljs-section">+------------------------+</span><br><span class="hljs-code">              |</span><br><span class="hljs-code">      +-------------------+</span><br><span class="hljs-code">      |     VPN/ExpressRoute Gateway     |</span><br><span class="hljs-code">      +-------------------+</span><br><span class="hljs-section">              |</span><br><span class="hljs-section">+-------------------------+</span><br>|    VPN/ExpressRoute    |<br><span class="hljs-section">|    Connection         |</span><br><span class="hljs-section">+-------------------------+</span><br><span class="hljs-section">              |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   VPC/VNet         |</span><br><span class="hljs-section">+-------------------+</span><br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create a customer gateway for VPN or an AWS Direct Connect gateway for Direct Connect:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-customer-gateway</span> <span class="hljs-built_in">--bgp-asn</span> &lt;<span class="hljs-string">bgp-asn</span>&gt; <span class="hljs-built_in">--public-ip</span> &lt;<span class="hljs-string">ip-address</span>&gt; <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">gateway-type</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a VPN gateway and attach it to the VPC:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpn-gateway</span> <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">gateway-type</span>&gt; <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-string">attach-vpn-gateway</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--vpn-gateway-id</span> &lt;<span class="hljs-string">vpn-gateway-id</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a VPN connection and specify the customer gateway and VPN gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpn-connection</span> <span class="hljs-built_in">--customer-gateway-id</span> &lt;<span class="hljs-string">customer-gateway-id</span>&gt; <span class="hljs-built_in">--vpn-gateway-id</span> &lt;<span class="hljs-string">vpn-gateway-id</span>&gt; <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">connection-type</span>&gt; <span class="hljs-built_in">--static-routes-only</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create a virtual network gateway and specify the VPN gateway type:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet-gateway create --<span class="hljs-built_in">name</span> &lt;gateway-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet &lt;vnet-<span class="hljs-built_in">name</span>&gt; --public-ip-address &lt;public-ip-<span class="hljs-built_in">name</span>&gt; --gateway-<span class="hljs-built_in">type</span> &lt;gateway-<span class="hljs-built_in">type</span>&gt; --sku &lt;sku-<span class="hljs-built_in">type</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a connection object and specify the shared key and gateway IDs:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vpn-connection create --<span class="hljs-built_in">name</span> &lt;connection-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet-gateway1 &lt;gateway-<span class="hljs-built_in">name</span>&gt; --shared-key &lt;shared-key&gt; --remote-vnet &lt;remote-vnet-id&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-4-Multi-Region-Networking"><a href="#Lab-4-Multi-Region-Networking" class="headerlink" title="Lab 4: Multi-Region Networking"></a>Lab 4: Multi-Region Networking</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-----------------------+                 +-----------------------+<br>|<span class="hljs-string">     Region 1           </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      Region 2          </span>|<br>+-----------------------+                 +-----------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Instances       </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Instances       </span>|<br>+-------------------+                       +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create a VPC in each region:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpc</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">16</span> <span class="hljs-built_in">--region</span> &lt;<span class="hljs-string">region-name</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create subnets in each region:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-subnet</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">1</span>.<span class="hljs-string">0</span>/<span class="hljs-string">24</span> <span class="hljs-built_in">--availability-zone</span> &lt;<span class="hljs-string">availability-zone</span>&gt; <span class="hljs-built_in">--region</span> &lt;<span class="hljs-string">region-name</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Configure VPC peering between the two VPCs:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpc-peering-connection</span> <span class="hljs-built_in">--peer-vpc-id</span> &lt;<span class="hljs-string">peer-vpc-id</span>&gt; <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--region</span> &lt;<span class="hljs-string">region-name</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create a VNet in each region:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet create --<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span> --location &lt;region-<span class="hljs-built_in">name</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create subnets in each VNet:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet subnet create --<span class="hljs-built_in">name</span> &lt;subnet-<span class="hljs-built_in">name</span>&gt; --vnet-<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure></li><li><p>Establish peering between the two VNets:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet peering create --<span class="hljs-built_in">name</span> &lt;peering-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet-<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --remote-vnet &lt;remote-vnet-id&gt; --allow-vnet-access<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-5-Inter-Cloud-Networking"><a href="#Lab-5-Inter-Cloud-Networking" class="headerlink" title="Lab 5: Inter-Cloud Networking"></a>Lab 5: Inter-Cloud Networking</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-------------------+                 +-----------------------+<br>|<span class="hljs-string">      AWS VPC      </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      Azure VNet        </span>|<br>+-------------------+                 +-----------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Instances       </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Instances       </span>|<br>+-------------------+                       +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create a VPC in AWS:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpc</span> <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>/<span class="hljs-string">16</span><br></code></pre></td></tr></table></figure></li><li><p>Create subnets in the VPC:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-subnet</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--cidr-block</span> <span class="hljs-string">10</span>.<span class="hljs-string">0</span>.<span class="hljs-string">1</span>.<span class="hljs-string">0</span>/<span class="hljs-string">24</span><br></code></pre></td></tr></table></figure></li><li><p>Create a virtual private gateway and attach it to the VPC:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpn-gateway</span> <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">gateway-type</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-string">attach-vpn-gateway</span> <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--vpn-gateway-id</span> &lt;<span class="hljs-string">gateway-id</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a customer gateway and specify the public IP address and BGP ASN of the Azure gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-customer-gateway</span> <span class="hljs-built_in">--bgp-asn</span> &lt;<span class="hljs-string">bgp-asn</span>&gt; <span class="hljs-built_in">--public-ip</span> &lt;<span class="hljs-string">ip-address</span>&gt; <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">gateway-type</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a VPN connection and specify the customer gateway and virtual private gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-vpn-connection</span> <span class="hljs-built_in">--customer-gateway-id</span> &lt;<span class="hljs-string">customer-gateway-id</span>&gt; <span class="hljs-built_in">--vpn-gateway-id</span> &lt;<span class="hljs-string">vpn-gateway-id</span>&gt; <span class="hljs-built_in">--type</span> &lt;<span class="hljs-string">connection-type</span>&gt; <span class="hljs-built_in">--static-routes-only</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create a VNet in Azure:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet create --<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure></li><li><p>Create subnets in the VNet:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet subnet create --<span class="hljs-built_in">name</span> &lt;subnet-<span class="hljs-built_in">name</span>&gt; --vnet-<span class="hljs-built_in">name</span> &lt;vnet-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --address-prefixes <span class="hljs-number">10.0</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure></li><li><p>Create a virtual network gateway and specify the VPN gateway type:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vnet-gateway create --<span class="hljs-built_in">name</span> &lt;gateway-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet &lt;vnet-<span class="hljs-built_in">name</span>&gt; --public-ip-address &lt;public-ip-<span class="hljs-built_in">name</span>&gt; --gateway-<span class="hljs-built_in">type</span> &lt;gateway-<span class="hljs-built_in">type</span>&gt; --sku &lt;sku-<span class="hljs-built_in">type</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create a connection object and specify the shared key and gateway IDs:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vpn-connection create --<span class="hljs-built_in">name</span> &lt;connection-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vnet-gateway1 &lt;gateway-<span class="hljs-built_in">name</span>&gt; --shared-key &lt;shared-key&gt; --remote-vnet &lt;remote-vnet-id&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-6-Security-and-Compliance"><a href="#Lab-6-Security-and-Compliance" class="headerlink" title="Lab 6: Security and Compliance"></a>Lab 6: Security and Compliance</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-------------------+                 +-----------------------+<br>|<span class="hljs-string">      AWS VPC      </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      Azure VNet        </span>|<br>+-------------------+                 +-----------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Instances       </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Instances       </span>|<br>+-------------------+                       +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create security groups and specify inbound&#x2F;outbound rules:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-security-group</span> <span class="hljs-built_in">--group-name</span> &lt;<span class="hljs-string">group-name</span>&gt; <span class="hljs-built_in">--description</span> &lt;<span class="hljs-string">description</span>&gt; <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-string">authorize-security-group-ingress</span> <span class="hljs-built_in">--group-id</span> &lt;<span class="hljs-string">group-id</span>&gt; <span class="hljs-built_in">--protocol</span> &lt;<span class="hljs-string">protocol</span>&gt; <span class="hljs-built_in">--port</span> &lt;<span class="hljs-string">port</span>&gt; <span class="hljs-built_in">--source</span> &lt;<span class="hljs-string">source-ip</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Azure CLI Steps:</p><ol><li><p>Create network security groups (NSGs) and specify inbound&#x2F;outbound rules:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network nsg create --<span class="hljs-built_in">name</span> &lt;nsg-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt;<br>az network nsg rule create --<span class="hljs-built_in">name</span> &lt;rule-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --nsg-<span class="hljs-built_in">name</span> &lt;nsg-<span class="hljs-built_in">name</span>&gt; --protocol &lt;protocol&gt; --<span class="hljs-built_in">direction</span> &lt;<span class="hljs-built_in">direction</span>&gt; --source-address-prefixes &lt;source-ip&gt; --destination-port-ranges &lt;port-range&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><blockquote><p>Please note that you should replace the placeholders (e.g., <code>&lt;vpc-id&gt;</code>, <code>&lt;subnet-name&gt;</code>, <code>&lt;region-name&gt;</code>, etc.) with the actual values specific to your setup. These steps and commands provide a general guideline, and you should consult the official documentation of AWS and Azure for detailed instructions and variations based on your specific requirements and configurations.</p></blockquote><h1 id="Lab-7-Transit-Gateway-on-AWS"><a href="#Lab-7-Transit-Gateway-on-AWS" class="headerlink" title="Lab 7: Transit Gateway on AWS"></a>Lab 7: Transit Gateway on AWS</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-------------------+                 +-----------------------+<br>|<span class="hljs-string">   VPC 1           </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      VPC 2             </span>|<br>+-------------------+                 +-----------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Instances       </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Instances       </span>|<br>+-------------------+                       +-------------------+<br>                  \                             /<br>                   \                           /<br>                    \                         /<br>                 +-------------------+<br>                 |<span class="hljs-string">  Transit Gateway  </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   VPC 3           </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Subnet 3        </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Instances       </span>|<br>                 +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>AWS CLI Steps:</p><ol><li><p>Create three VPCs (VPC 1, VPC 2, VPC 3) with subnets in each VPC.</p></li><li><p>Create a transit gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-transit-gateway</span> <span class="hljs-built_in">--description</span> &lt;<span class="hljs-string">description</span>&gt; <span class="hljs-built_in">--options</span> &lt;<span class="hljs-string">options</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Attach the VPCs to the transit gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-transit-gateway-vpc-attachment</span> <span class="hljs-built_in">--transit-gateway-id</span> &lt;<span class="hljs-string">transit-gateway-id</span>&gt; <span class="hljs-built_in">--vpc-id</span> &lt;<span class="hljs-string">vpc-id</span>&gt; <span class="hljs-built_in">--subnet-ids</span> &lt;<span class="hljs-string">subnet-ids</span>&gt; <span class="hljs-built_in">--options</span> &lt;<span class="hljs-string">options</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create route tables in the transit gateway and associate them with the attachments:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-transit-gateway-route-table</span> <span class="hljs-built_in">--transit-gateway-id</span> &lt;<span class="hljs-string">transit-gateway-id</span>&gt; <span class="hljs-built_in">--tag-specifications</span> &lt;<span class="hljs-string">tag-specifications</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-transit-gateway-route</span> <span class="hljs-built_in">--transit-gateway-route-table-id</span> &lt;<span class="hljs-string">transit-gateway-route-table-id</span>&gt; <span class="hljs-built_in">--destination-cidr-block</span> &lt;<span class="hljs-string">destination-cidr-block</span>&gt; <span class="hljs-built_in">--transit-gateway-attachment-id</span> &lt;<span class="hljs-string">transit-gateway-attachment-id</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Update the VPC route tables to point to the transit gateway:</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">&lt;<span class="hljs-string">TEXT</span>&gt;<br><span class="hljs-string">aws</span> <span class="hljs-string">ec2</span> <span class="hljs-built_in">create-route</span> <span class="hljs-built_in">--route-table-id</span> &lt;<span class="hljs-string">route-table-id</span>&gt; <span class="hljs-built_in">--destination-cidr-block</span> &lt;<span class="hljs-string">destination-cidr-block</span>&gt; <span class="hljs-built_in">--transit-gateway-id</span> &lt;<span class="hljs-string">transit-gateway-id</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-8-Virtual-WAN-on-Azure"><a href="#Lab-8-Virtual-WAN-on-Azure" class="headerlink" title="Lab 8: Virtual WAN on Azure"></a>Lab 8: Virtual WAN on Azure</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-------------------+                 +-----------------------+<br>|<span class="hljs-string">   VNet 1          </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      VNet 2             </span>|<br>+-------------------+                 +-----------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Instances       </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Instances       </span>|<br>+-------------------+                       +-------------------+<br>                  \                             /<br>                   \                           /<br>                    \                         /<br>                 +-------------------+<br>                 |<span class="hljs-string">  Virtual WAN      </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   VNet 3          </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Subnet 3        </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Instances       </span>|<br>                 +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>Azure CLI Steps:</p><ol><li><p>Create three VNets (VNet 1, VNet 2, VNet 3) with subnets in each VNet.</p></li><li><p>Create a virtual WAN hub:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-tag">&lt;TEXT&gt;</span><br>az network vhub create --name <span class="hljs-tag">&lt;vhub-name&gt;</span> --resource-<span class="hljs-keyword">group</span> <span class="hljs-title">&lt;resource-group-name</span>&gt; --<span class="hljs-keyword">location</span> <span class="hljs-title">&lt;location</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>Create VPN sites and associate them with the VNets:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-tag">&lt;TEXT&gt;</span><br>az network vpn-site create --name <span class="hljs-tag">&lt;site1-name&gt;</span> --resource-<span class="hljs-keyword">group</span> <span class="hljs-title">&lt;resource-group-name</span>&gt; --<span class="hljs-keyword">location</span> <span class="hljs-title">&lt;location</span>&gt; --ip-address <span class="hljs-tag">&lt;ip-address&gt;</span> --vnet <span class="hljs-tag">&lt;vnet1-name&gt;</span><br>az network vpn-site create --name <span class="hljs-tag">&lt;site2-name&gt;</span> --resource-<span class="hljs-keyword">group</span> <span class="hljs-title">&lt;resource-group-name</span>&gt; --<span class="hljs-keyword">location</span> <span class="hljs-title">&lt;location</span>&gt; --ip-address <span class="hljs-tag">&lt;ip-address&gt;</span> --vnet <span class="hljs-tag">&lt;vnet2-name&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>Create connections between the virtual WAN hub and VNets:</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&lt;<span class="hljs-built_in">TEXT</span>&gt;<br>az network vhub connection create --<span class="hljs-built_in">name</span> &lt;connection1-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vhub-<span class="hljs-built_in">name</span> &lt;vhub-<span class="hljs-built_in">name</span>&gt; --remote-vnet &lt;vnet1-<span class="hljs-built_in">name</span>&gt; --allow-hub-<span class="hljs-keyword">to</span>-vnet-transit <span class="hljs-literal">true</span><br>az network vhub connection create --<span class="hljs-built_in">name</span> &lt;connection2-<span class="hljs-built_in">name</span>&gt; --resource-<span class="hljs-built_in">group</span> &lt;resource-<span class="hljs-built_in">group</span>-<span class="hljs-built_in">name</span>&gt; --vhub-<span class="hljs-built_in">name</span> &lt;vhub-<span class="hljs-built_in">name</span>&gt; --remote-vnet &lt;vnet2-<span class="hljs-built_in">name</span>&gt; --allow-hub-<span class="hljs-keyword">to</span>-vnet-transit <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li><li><p>Update the VNet route tables to point to the virtual WAN hub:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;TEXT&gt;<br>az network route-<span class="hljs-selector-tag">table</span> route create <span class="hljs-attr">--resource-group</span> &lt;resource-group-name&gt; <span class="hljs-attr">--route-table-name</span> &lt;route-<span class="hljs-selector-tag">table</span>-name&gt; <span class="hljs-attr">--name</span> &lt;route-name&gt; <span class="hljs-attr">--address-prefix</span> &lt;destination-cidr-block&gt; <span class="hljs-attr">--next-hop-type</span> VirtualHub <span class="hljs-attr">--next-hop-ip-address</span> &lt;vhub-ip-<span class="hljs-selector-tag">address</span>&gt;<br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Lab-9-Network-Monitoring-on-AWS"><a href="#Lab-9-Network-Monitoring-on-AWS" class="headerlink" title="Lab 9: Network Monitoring on AWS"></a>Lab 9: Network Monitoring on AWS</h1><ul><li><p>Topology Example:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">&lt;TEXT&gt;</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   VPC             |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   Subnet          |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   EC2 Instances   |</span><br><span class="hljs-section">+-------------------+</span><br></code></pre></td></tr></table></figure></li><li><p>AWS Services:</p><ol><li>Enable VPC Flow Logs to capture network traffic:<ul><li>Enable VPC Flow Logs for the desired VPC and subnet.</li><li>Configure the flow log destination to an Amazon S3 bucket or Amazon CloudWatch Logs.</li></ul></li><li>Set up CloudWatch Metrics and Alarms for network monitoring:<ul><li>Create custom CloudWatch metrics to track specific network performance metrics (e.g., network throughput, packet loss).</li><li>Configure CloudWatch Alarms to trigger notifications or automated actions based on predefined thresholds.</li></ul></li></ol></li></ul><h1 id="Lab-10-Network-Monitoring-on-Azure"><a href="#Lab-10-Network-Monitoring-on-Azure" class="headerlink" title="Lab 10: Network Monitoring on Azure"></a>Lab 10: Network Monitoring on Azure</h1><ul><li><p>Topology Example:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">&lt;TEXT&gt;</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   VNet            |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   Subnet          |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">        |</span><br><span class="hljs-section">+-------------------+</span><br><span class="hljs-section">|   VM Instances    |</span><br><span class="hljs-section">+-------------------+</span><br></code></pre></td></tr></table></figure></li><li><p>Azure Services:</p><ol><li>Enable Network Watcher to monitor network traffic and connectivity:<ul><li>Enable Network Watcher for the desired VNet and subnet.</li><li>Use the “IP Flow Verify” feature to test connectivity between resources within the VNet and to external endpoints.</li><li>Utilize the “Connection Monitor” feature to monitor and troubleshoot network connections between VMs.</li></ul></li><li>Configure Traffic Analytics to gain insights into network traffic patterns:<ul><li>Enable Traffic Analytics for the desired subnet.</li><li>Analyze traffic flow, identify top talkers, and detect anomalies using Traffic Analytics logs and dashboards.</li></ul></li><li>Utilize Azure Monitor for network monitoring:<ul><li>Configure Azure Monitor to collect and analyze diagnostic logs and metrics from VMs, load balancers, and other network resources.</li><li>Set up alerts and notifications based on predefined conditions to proactively monitor network performance and availability.</li></ul></li></ol></li></ul><h1 id="Lab-11-Network-Monitoring-for-Transit-Gateway-on-AWS"><a href="#Lab-11-Network-Monitoring-for-Transit-Gateway-on-AWS" class="headerlink" title="Lab 11: Network Monitoring for Transit Gateway on AWS"></a>Lab 11: Network Monitoring for Transit Gateway on AWS</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-------------------+                 +-----------------------+<br>|<span class="hljs-string">   VPC 1           </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      VPC 2             </span>|<br>+-------------------+                 +-----------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>        |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   EC2 Instances   </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   EC2 Instances   </span>|<br>+-------------------+                       +-------------------+<br>                  \                             /<br>                   \                           /<br>                    \                         /<br>                 +-------------------+<br>                 |<span class="hljs-string">  Transit Gateway  </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   VPC 3           </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Subnet 3        </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   EC2 Instances   </span>|<br>                 +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>AWS Services:</p><ol><li>Enable VPC Flow Logs for transit gateway:<ul><li>Enable VPC Flow Logs for the transit gateway attachment VPCs and subnets.</li><li>Configure the flow log destination to an Amazon S3 bucket or Amazon CloudWatch Logs.</li></ul></li><li>Set up CloudWatch Metrics and Alarms for transit gateway monitoring:<ul><li>Create custom CloudWatch metrics to track transit gateway performance metrics (e.g., bytes in&#x2F;out, packets in&#x2F;out).</li><li>Configure CloudWatch Alarms to trigger notifications or automated actions based on predefined thresholds.</li></ul></li><li>Use Amazon CloudWatch Logs Insights to analyze VPC Flow Logs:<ul><li>Query and analyze VPC Flow Logs data using CloudWatch Logs Insights.</li><li>Identify patterns, anomalies, and potential network issues within the transit gateway traffic.</li></ul></li></ol></li></ul><h1 id="Lab-12-Network-Monitoring-for-Transit-Network-on-Azure"><a href="#Lab-12-Network-Monitoring-for-Transit-Network-on-Azure" class="headerlink" title="Lab 12: Network Monitoring for Transit Network on Azure"></a>Lab 12: Network Monitoring for Transit Network on Azure</h1><ul><li><p>Topology Example:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;TEXT&gt;</span><br>+-----------------------+                 +-----------------------+<br>|<span class="hljs-string">     VNet 1             </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">      VNet 2             </span>|<br>+-----------------------+                 +-----------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   Subnet 1        </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   Subnet 2        </span>|<br>+-------------------+                       +-------------------+<br>           |<span class="hljs-string">                                          </span>|<br>+-------------------+                       +-------------------+<br>|<span class="hljs-string">   VM Instances    </span>|<span class="hljs-string">                       </span>|<span class="hljs-string">   VM Instances    </span>|<br>+-------------------+                       +-------------------+<br>                  \                             /<br>                   \                           /<br>                    \                         /<br>                 +-------------------+<br>                 |<span class="hljs-string">   Transit Gateway  </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   VNet 3          </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   Subnet 3        </span>|<br>                 +-------------------+<br>                          |<span class="hljs-string"></span><br><span class="hljs-string">                 +-------------------+</span><br><span class="hljs-string">                 </span>|<span class="hljs-string">   VM Instances    </span>|<br>                 +-------------------+<br></code></pre></td></tr></table></figure></li><li><p>Azure Services:</p><ol><li>Enable Traffic Analytics for transit gateway:<ul><li>Enable Traffic Analytics for the transit gateway subnet.</li><li>Analyze traffic flow, identify top talkers, and detect anomalies using Traffic Analytics logs and dashboards.</li></ul></li><li>Utilize Azure Monitor for transit gateway monitoring:<ul><li>Configure Azure Monitor to collect and analyze diagnostic logs and metrics from the transit gateway and associated resources.</li><li>Set up alerts and notifications based on predefined conditions to proactively monitor transit gateway performance and availability.</li></ul></li><li>Use Azure Network Watcher for troubleshooting and diagnostics:<ul><li>Utilize Network Watcher’s “IP Flow Verify” feature to test connectivity between resources within and across VNets via the transit gateway.</li><li>Use the “Connection Monitor” feature to monitor and troubleshoot network connections between VMs across VNets.</li></ul></li></ol></li></ul>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>aws</tag>
      
      <tag>azure</tag>
      
      <tag>network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setup SAML server in lab</title>
    <link href="/2023/09/27/install-a-virtual-machine-softwaredownload-and-install-a-virtual-machine-software-like-virtualbox-or-vmware-on-your-com/"/>
    <url>/2023/09/27/install-a-virtual-machine-softwaredownload-and-install-a-virtual-machine-software-like-virtualbox-or-vmware-on-your-com/</url>
    
    <content type="html"><![CDATA[<h1 id="Setup-SAML-server-in-lab"><a href="#Setup-SAML-server-in-lab" class="headerlink" title="Setup SAML server in lab"></a>Setup SAML server in lab</h1><ol><li><p>Install a virtual machine software:</p><ul><li>Download and install a virtual machine software like VirtualBox or VMware on your computer.</li></ul></li><li><p>Download a Linux distribution image:</p><ul><li>Download a Linux distribution image from the official website of the chosen distribution (e.g., Ubuntu, CentOS).</li><li>Save the downloaded image to your computer.</li></ul></li><li><p>Create a virtual machine:</p><ul><li>Open the virtual machine software and click on the “New” button to create a new virtual machine.</li><li>Follow the wizard to create a new virtual machine, selecting the downloaded Linux distribution image as the operating system.</li></ul></li><li><p>Install Apache web server:</p><ul><li><p>Open the terminal on the virtual machine and run the following command to install Apache web server:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">TXT<br>Copysudo apt-<span class="hljs-built_in">get</span> update<br>sudo apt-<span class="hljs-built_in">get</span> install apache2<br></code></pre></td></tr></table></figure></li></ul></li><li><p>Install SimpleSAMLphp:</p><ul><li>Download the latest version of SimpleSAMLphp from the official website (<a href="https://simplesamlphp.org/download">https://simplesamlphp.org/download</a>).</li><li>Extract the downloaded archive to the Apache web server document root directory (&#x2F;var&#x2F;www&#x2F;html).</li><li>Rename the extracted directory to “simplesamlphp”.</li></ul></li><li><p>Configure SimpleSAMLphp as a SAML identity provider:</p><ul><li><p>Open the terminal on the virtual machine and navigate to the SimpleSAMLphp configuration directory:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">TXT<br>Copycd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>simplesamlphp/config<br></code></pre></td></tr></table></figure></li><li><p>Copy the “config-templates&#x2F;config.php” file to “config.php”:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">TXT<br>Copycp config-templates/config.php config.php<br></code></pre></td></tr></table></figure></li><li><p>Edit the “config.php” file and set the following parameters:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">TXT<br>Copy<span class="hljs-string">&#x27;baseurlpath&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/simplesamlphp/&#x27;</span>,<br><span class="hljs-string">&#x27;auth.adminpassword&#x27;</span> =&gt; <span class="hljs-string">&#x27;CHOOSE-A-STRONG-PASSWORD&#x27;</span>,<br><span class="hljs-string">&#x27;secretsalt&#x27;</span> =&gt; <span class="hljs-string">&#x27;CHOOSE-A-RANDOM-STRING&#x27;</span>,<br></code></pre></td></tr></table></figure></li><li><p>Save and close the “config.php” file.</p></li></ul></li><li><p>Configure SimpleSAMLphp as a SAML service provider:</p><ul><li><p>Open the terminal on the virtual machine and navigate to the SimpleSAMLphp configuration directory:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">TXT<br>Copycd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>simplesamlphp/config<br></code></pre></td></tr></table></figure></li><li><p>Copy the “config-templates&#x2F;authsources.php” file to “authsources.php”:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">TXT<br>Copycp config-templates/authsources.php authsources.php<br></code></pre></td></tr></table></figure></li><li><p>Edit the “authsources.php” file and set the following parameters:</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs zephir">TXT<br>Copy<span class="hljs-string">&#x27;default-sp&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;saml:SP&#x27;</span>,<br>    <span class="hljs-string">&#x27;entityID&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp&#x27;</span>,<br>    <span class="hljs-string">&#x27;discoURL&#x27;</span> =&gt; <span class="hljs-keyword">null</span>,<br>    <span class="hljs-string">&#x27;NameIDFormat&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.nameidattribute&#x27;</span> =&gt; <span class="hljs-string">&#x27;uid&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.attributes&#x27;</span> =&gt; <span class="hljs-keyword">false</span>,<br>    <span class="hljs-string">&#x27;AssertionConsumerService&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-acs.php&#x27;</span>,<br>    <span class="hljs-string">&#x27;SingleLogoutService&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-logout.php&#x27;</span>,<br>    <span class="hljs-string">&#x27;sign.logout&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>    <span class="hljs-string">&#x27;redirect.sign&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>),<br></code></pre></td></tr></table></figure></li><li><p>Save and close the “authsources.php” file.</p></li></ul></li><li><p>Create a test user account:</p><ul><li><p>Open the terminal on the virtual machine and navigate to the SimpleSAMLphp metadata directory:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">TXT<br>Copycd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>simplesamlphp/metadata<br></code></pre></td></tr></table></figure></li><li><p>Copy the “saml20-idp-remote.php” file to “testuser.php”:</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-keyword">TXT</span><br>Copycp saml20-idp-remote.php testuser.php<br></code></pre></td></tr></table></figure></li><li><p>Edit the “testuser.php” file and set the following parameters:</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs zephir">TXT<br>Copy$metadata[<span class="hljs-string">&#x27;testuser&#x27;</span>] = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;entityid&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testuser&#x27;</span>,<br>    <span class="hljs-string">&#x27;contacts&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;contactType&#x27;</span> =&gt; <span class="hljs-string">&#x27;technical&#x27;</span>,<br>            <span class="hljs-string">&#x27;givenName&#x27;</span> =&gt; <span class="hljs-string">&#x27;Test&#x27;</span>,<br>            <span class="hljs-string">&#x27;surName&#x27;</span> =&gt; <span class="hljs-string">&#x27;User&#x27;</span>,<br>            <span class="hljs-string">&#x27;emailAddress&#x27;</span> =&gt; <span class="hljs-string">&#x27;testuser@example.com&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;metadata-set&#x27;</span> =&gt; <span class="hljs-string">&#x27;saml20-idp-remote&#x27;</span>,<br>    <span class="hljs-string">&#x27;SingleSignOnService&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;Binding&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&#x27;</span>,<br>            <span class="hljs-string">&#x27;Location&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/simplesamlphp/saml2/idp/SSOService.php&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;SingleLogoutService&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;Binding&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&#x27;</span>,<br>            <span class="hljs-string">&#x27;Location&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/simplesamlphp/saml2/idp/SingleLogoutService.php&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;NameIDFormat&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.nameidattribute&#x27;</span> =&gt; <span class="hljs-string">&#x27;uid&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.attributes&#x27;</span> =&gt; <span class="hljs-keyword">false</span>,<br>    <span class="hljs-string">&#x27;authproc&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-number">10</span> =&gt; <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;class&#x27;</span> =&gt; <span class="hljs-string">&#x27;core:AttributeAdd&#x27;</span>,<br>            <span class="hljs-string">&#x27;testuser&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;uid&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;testuser&#x27;</span>)),<br>        ),<br>    ),<br>);<br></code></pre></td></tr></table></figure></li><li><p>Save and close the “testuser.php” file.</p></li></ul></li><li><p>Configure the SAML service provider to trust the SAML identity provider:</p><ul><li><p>Open the terminal on the virtual machine and navigate to the SimpleSAMLphp metadata directory:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">TXT<br>Copycd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>simplesamlphp/metadata<br></code></pre></td></tr></table></figure></li><li><p>Create a new file named “idp-metadata.xml” and add the following metadata for the SAML identity provider:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">TXT<br>Copy<span class="hljs-tag">&lt;<span class="hljs-name">md:EntityDescriptor</span> <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;https://localhost/simplesamlphp/saml2/idp/metadata.php&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">md:IDPSSODescriptor</span> <span class="hljs-attr">protocolSupportEnumeration</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">md:NameIDFormat</span>&gt;</span><br>            urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">md:NameIDFormat</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">md:SingleSignOnService</span> <span class="hljs-attr">Binding</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;</span> <span class="hljs-attr">Location</span>=<span class="hljs-string">&quot;https://localhost/simplesamlphp/saml2/idp/SSOService.php&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">md:SingleLogoutService</span> <span class="hljs-attr">Binding</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;</span> <span class="hljs-attr">Location</span>=<span class="hljs-string">&quot;https://localhost/simplesamlphp/saml2/idp/SingleLogoutService.php&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">md:IDPSSODescriptor</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">md:EntityDescriptor</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>Edit the “metadata&#x2F;saml20-sp-remote.php” file and set the following parameters:</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs zephir">TXT<br>Copy$metadata[<span class="hljs-string">&#x27;https://localhost/testsp&#x27;</span>] = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;AssertionConsumerService&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-acs.php&#x27;</span>,<br>    <span class="hljs-string">&#x27;SingleLogoutService&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-logout.php&#x27;</span>,<br>    <span class="hljs-string">&#x27;NameIDFormat&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.nameidattribute&#x27;</span> =&gt; <span class="hljs-string">&#x27;uid&#x27;</span>,<br>    <span class="hljs-string">&#x27;simplesaml.attributes&#x27;</span> =&gt; <span class="hljs-keyword">false</span>,<br>    <span class="hljs-string">&#x27;metadata-set&#x27;</span> =&gt; <span class="hljs-string">&#x27;saml20-sp-remote&#x27;</span>,<br>    <span class="hljs-string">&#x27;entityid&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp&#x27;</span>,<br>    <span class="hljs-string">&#x27;contacts&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;contactType&#x27;</span> =&gt; <span class="hljs-string">&#x27;technical&#x27;</span>,<br>            <span class="hljs-string">&#x27;givenName&#x27;</span> =&gt; <span class="hljs-string">&#x27;Test&#x27;</span>,<br>            <span class="hljs-string">&#x27;surName&#x27;</span> =&gt; <span class="hljs-string">&#x27;SP&#x27;</span>,<br>            <span class="hljs-string">&#x27;emailAddress&#x27;</span> =&gt; <span class="hljs-string">&#x27;testsp@example.com&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;AssertionConsumerService&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;Binding&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&#x27;</span>,<br>            <span class="hljs-string">&#x27;Location&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-acs.php&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;SingleLogoutService&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;Binding&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&#x27;</span>,<br>            <span class="hljs-string">&#x27;Location&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-logout.php&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;NameIDMappingService&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;Binding&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:bindings:SOAP&#x27;</span>,<br>            <span class="hljs-string">&#x27;Location&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://localhost/testsp/saml2-nameidmapping.php&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;attributes.NameFormat&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#x27;</span>,<br>    <span class="hljs-string">&#x27;attributes&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(),<br>    <span class="hljs-string">&#x27;authproc&#x27;</span> =&gt; <span class="hljs-keyword">array</span>(<br>        <span class="hljs-number">3</span> =&gt; <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;class&#x27;</span> =&gt; <span class="hljs-string">&#x27;saml:NameIDAttribute&#x27;</span>,<br>            <span class="hljs-string">&#x27;attribute&#x27;</span> =&gt; <span class="hljs-string">&#x27;uid&#x27;</span>,<br>            <span class="hljs-string">&#x27;Format&#x27;</span> =&gt; <span class="hljs-string">&#x27;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&#x27;</span>,<br>        ),<br>    ),<br>    <span class="hljs-string">&#x27;saml20.sign.assertion&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>    <span class="hljs-string">&#x27;saml20.sign.response&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>    <span class="hljs-string">&#x27;saml20.encrypt&#x27;</span> =&gt; <span class="hljs-keyword">false</span>,<br>    <span class="hljs-string">&#x27;saml20.sign.metadata&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>    <span class="hljs-string">&#x27;redirect.sign&#x27;</span> =&gt; <span class="hljs-keyword">true</span>,<br>);<br></code></pre></td></tr></table></figure></li><li><p>Save and close the “saml20-sp-remote.php” file.</p></li></ul></li><li><p>Test the SAML authentication:</p><ul><li>Open a web browser on your host machine and navigate to “<a href="https://localhost/testsp">https://localhost/testsp</a>“.</li><li>You will be redirected to the SAML identity provider for authentication.</li><li>Enter the test user credentials created earlier and complete the authentication process.</li><li>You will be redirected back to the SAML service provider and should be able to access the protected resource.</li><li>Verify that the SAML response is valid and that the user is authenticated.</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lab</tag>
      
      <tag>SAML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>扩展磁盘-GCP VM</title>
    <link href="/2023/06/11/kuo-zhan-ci-pan-gcp-vm/"/>
    <url>/2023/06/11/kuo-zhan-ci-pan-gcp-vm/</url>
    
    <content type="html"><![CDATA[<hr><p>[TOC]</p><blockquote><p>Weeks ago, I created a GCP VM for the VPN and Jupyter notebook server, however I used the minimum spec in order to save the cost. The disk was only 10G, which could not meet the requirements of Pytorch installation, so I got to extend the capacity of my vm disk to which is 20G in my case.</p><p>The Pytorch is required in transformers.GPT2LMHeadModel</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-comment"># Import the necessary libraries</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> GPT2Tokenizer, GPT2LMHeadModel<br><span class="hljs-number">3</span><br><span class="hljs-number">4</span> <span class="hljs-comment"># Load the pre-trained GPT-2 tokenizer and model</span><br><span class="hljs-number">5</span> tokenizer = GPT2Tokenizer.from_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><span class="hljs-number">6</span> model = GPT2LMHeadModel.from_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><span class="hljs-number">7</span><br><span class="hljs-number">8</span> <span class="hljs-comment"># Set the model to evaluation mode</span><br><span class="hljs-number">9</span> model.<span class="hljs-built_in">eval</span>()<br><span class="hljs-number">10</span><br><span class="hljs-number">11</span> <span class="hljs-comment"># Define a prompt for the model to complete</span><br><span class="hljs-number">12</span> prompt = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;You: &quot;</span>)<br><span class="hljs-number">13</span><br><span class="hljs-number">14</span> <span class="hljs-comment"># Tokenize the prompt and generate text</span><br><span class="hljs-number">15</span> input_ids = tokenizer.encode(prompt, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>)<br><span class="hljs-number">16</span> output = model.generate(input_ids, max_length=<span class="hljs-number">50</span>, do_sample=<span class="hljs-literal">True</span>)<br><span class="hljs-number">17</span><br><span class="hljs-number">18</span> <span class="hljs-comment"># Decode the generated text and print it to the console</span><br><span class="hljs-number">19</span> generated_text = tokenizer.decode(output[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>)<br><span class="hljs-number">20</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;AI: &quot;</span> + generated_text)<br></code></pre></td></tr></table></figure></blockquote><h1 id="Install-Pytorch"><a href="#Install-Pytorch" class="headerlink" title="Install Pytorch"></a>Install Pytorch</h1><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Refer to <a href="https://pytorch.org/get-started/locally/">PyTorch</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip3 install torch torchvision --no-cache-dir<br></code></pre></td></tr></table></figure><blockquote><p>By default, pip will download all the packages into memory instead of the disk for installation, use <code>--no-cache-dir</code> to avoid downloading them into memory.</p></blockquote><h2 id="VERIFICATION"><a href="#VERIFICATION" class="headerlink" title="VERIFICATION"></a>VERIFICATION</h2><p>To ensure that PyTorch was installed correctly, we can verify the installation by running sample PyTorch code. Here we will construct a randomly initialized tensor.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import torch<br>x = torch<span class="hljs-selector-class">.rand</span>(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(x)</span></span><br></code></pre></td></tr></table></figure><p>The output should be something similar to:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs inform7">tensor(<span class="hljs-comment">[<span class="hljs-comment">[0.3380, 0.3845, 0.3217]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[0.8337, 0.9050, 0.2650]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[0.2979, 0.7141, 0.9069]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[0.1449, 0.1132, 0.1375]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[0.4675, 0.3947, 0.1426]</span>]</span>)<br></code></pre></td></tr></table></figure><h1 id="Extend-disk-of-GCP-VM"><a href="#Extend-disk-of-GCP-VM" class="headerlink" title="Extend disk of GCP VM"></a>Extend disk of GCP VM</h1><p>Refer to <a href="https://cloud.google.com/compute/docs/disks/resize-persistent-disk?hl=zh-cn">Increase the size of a persistent disk</a></p>]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GCP</tag>
      
      <tag>Pytorch</tag>
      
      <tag>Disk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jupyter notebook server</title>
    <link href="/2023/06/09/jupyter-notebook-on-cloud/"/>
    <url>/2023/06/09/jupyter-notebook-on-cloud/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="如何安装一台jupyter-notebook-server，可以远程访问使用"><a href="#如何安装一台jupyter-notebook-server，可以远程访问使用" class="headerlink" title="如何安装一台jupyter notebook server，可以远程访问使用"></a>如何安装一台jupyter notebook server，可以远程访问使用</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ul><li>远程访问</li><li>必须使用https</li><li>notebook 用来学习测试chatgpt，所以需要在外网</li></ul><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul><li>一台Google Cloud VM (ubuntu server 18.4)<ul><li>VPC network 需要增加防火墙rule，允许访问8443 端口（此端口为jupyter server绑定的端口）</li></ul></li><li>域名和DNS 设置：xxx.excelsre.com</li><li>HTTPS 证书<ul><li>使用certbot生成证书</li></ul></li></ul><h2 id="搭建jupyter-server"><a href="#搭建jupyter-server" class="headerlink" title="搭建jupyter server"></a>搭建jupyter server</h2><h3 id="远程SSH-连接GCP-VM"><a href="#远程SSH-连接GCP-VM" class="headerlink" title="远程SSH 连接GCP VM"></a>远程SSH 连接GCP VM</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -i /Users/&lt;username&gt;/.ssh/id_rsa &lt;your-user-name-for-ssh&gt;@&lt;public-ip or hostname&gt;<br></code></pre></td></tr></table></figure><h3 id="安装jupyter-notebook"><a href="#安装jupyter-notebook" class="headerlink" title="安装jupyter notebook"></a>安装jupyter notebook</h3><ol><li><p>Ubuntu 安装jupyter，有2种方法</p><ul><li><p>直接用apt 安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install jupyter notebook<br></code></pre></td></tr></table></figure></li><li><p>先安装pip3管理器，再给予python3进行jupyter的安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get install -y python3-pip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">升级到最新版本</span><br>pip3 install --upgrade pip<br><br>pip3 install jupyter<br></code></pre></td></tr></table></figure></li></ul></li><li><p>生成HTTPS 证书</p><ul><li><p>使用certbot 生成证书</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo certbot certonly --standalone<br></code></pre></td></tr></table></figure><blockquote><p>证书默认生成在 <code>/etc/letsencrypt/live/&lt;YOUR.DOMAIN.COM/&gt;</code> 目录下，这个证书90天后就过期了，所以，需要使用一个 cron job 来定期更新, 使用命令 <code>crontab -e</code> 来编辑定时任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">0 0 1 * * /usr/bin/certbot renew --force-renewal<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">还需要添加一个任务来重启jupyter notebook service，这里有一个脚本可供参考https://github.com/libuliduobuqiuqiu/Jupyter_Control/blob/master/jupyter.sh</span><br></code></pre></td></tr></table></figure></blockquote></li><li><p>生成的证书，默认owner是root。如果后续用当前user 启动jupyter server，需要修改owner 权限，不然会报错</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo chown &lt;user&gt;:&lt;user&gt; cert.pem<br>sudo chown &lt;user&gt;:&lt;user&gt; privkey.pem<br></code></pre></td></tr></table></figure></li></ul></li><li><p>配置文件</p><ul><li><p>创建配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jupyter notebook --generate-config<br></code></pre></td></tr></table></figure></li><li><p>创建密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jupyter notebook password<br></code></pre></td></tr></table></figure></li><li><p>修改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi ~/.jupyter/jupyter_notebook_config.py<br><br><span class="hljs-comment"># 修改的参数如下：</span><br><br><span class="hljs-comment"># 绑定地址和端口</span><br>c.NotebookApp.ip = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>c.NotebookApp.port = 8443<br><br><span class="hljs-comment"># 允许远程访问</span><br>c.NotebookApp.allow_remote_access = True<br><br><span class="hljs-comment"># HTTPS 证书</span><br>c.NotebookApp.certfile = <span class="hljs-string">&#x27;/etc/letsencrypt/live/&lt;your-domain-name&gt;/cert.pem&#x27;</span><br>c.NotebookApp.keyfile = <span class="hljs-string">&#x27;/etc/letsencrypt/live/&lt;your-domain-name&gt;/privkey.pem&#x27;</span><br><br><span class="hljs-comment"># 启动notbook，不打开浏览器</span><br>c.NotebookApp.open_browser = False<br></code></pre></td></tr></table></figure></li><li><p>查看配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -v <span class="hljs-string">&#x27;^#&#x27;</span> ~/.jupyter/jupyter_notebook_config.py | sed <span class="hljs-string">&#x27;/^\s*$/d&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="启动jupyter-notebook-server"><a href="#启动jupyter-notebook-server" class="headerlink" title="启动jupyter notebook server"></a>启动jupyter notebook server</h3><ol><li><p>新建工作目录（这个目录就是后续notebook 打开之后的默认目录）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> jupyter_workspace<br><span class="hljs-built_in">cd</span> jupyter_workspace/<br></code></pre></td></tr></table></figure></li><li><p>后台启动jupyter，一定要用root 启动，因为生成的证书owner 也是root 权限。如果不用root 启动，需要先修改证书owner 为当前user</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> nohup jupyter notebook --<span class="hljs-literal">allow</span>-root &gt; ../log <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br></code></pre></td></tr></table></figure><blockquote><p>除了后台启动，还有其他启动方式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">普通运行</span><br>jupyter notebook<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">无后台窗口运行， &gt;后面的路径是我的日志路径，可自行做匹配修改</span><br>nohup jupyter notebook &gt;/usr/local/JupyterNotebook/jupyterLog/jupyter.log 2&gt;&amp;1 &amp;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用root权限运行</span><br>jupyter notebook ---allow-root<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定参数运行</span><br>nohup jupyter notebook --ip=0.0.0.0 --port=8080 --no-browser --allow-root &gt;~/usr/local/JupyterNotebook/jupyterLog/jupyter.log 2&gt;&amp;1 &amp;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用无后台运行时，关闭服务可以使用</span><br>ps -ef |grep jupyter      查看进程<br><br>kill -9 &quot;进程号&quot;          杀死进程<br></code></pre></td></tr></table></figure></blockquote></li></ol><h2 id="访问jupyter-notebook-server"><a href="#访问jupyter-notebook-server" class="headerlink" title="访问jupyter notebook server"></a>访问jupyter notebook server</h2><p><a href="https://domain-name:8443/">https://domain-name:8443</a></p><img src="https://felixyanghui.synology.me:8441/images/2023/06/09/image-20230609163901711.png" alt="image-20230609163901711" style="zoom: 50%;" />]]></content>
    
    
    <categories>
      
      <category>技术文章</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>科学上网 - 最佳实践</title>
    <link href="/2023/06/05/ke-xue-shang-wang-zui-jia-shi-jian/"/>
    <url>/2023/06/05/ke-xue-shang-wang-zui-jia-shi-jian/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="科学上网最佳实践"><a href="#科学上网最佳实践" class="headerlink" title="科学上网最佳实践"></a>科学上网最佳实践</h1><p>参考左耳朵的文章： <a href="https://github.com/haoel/haoel.github.io">https://github.com/haoel/haoel.github.io</a> </p><h2 id="创建代理服务器"><a href="#创建代理服务器" class="headerlink" title="创建代理服务器"></a>创建代理服务器</h2><h3 id="Google-Cloud-VM"><a href="#Google-Cloud-VM" class="headerlink" title="Google Cloud VM"></a>Google Cloud VM</h3><ol><li><p>首先创建VPC 网络</p><ul><li><em>名称：</em> <em>“name of the vac”</em></li><li><em>子网创建模式：自定义</em></li><li><em>新子网：</em><ul><li><em>名称：“name of the subnet”</em></li><li><em>区域： “select the region”</em></li><li><em>IPv4 范围： “IP address range for the subnet”</em></li></ul></li><li><em>防火墙规则</em><ul><li><em>可以选择与定义的规则， 比如allow-icmp, allow-rep, allow-ssh</em></li><li><em>需要新建allow-https，允许访问443 端口（此端口是代理端口，后文会提到）</em></li></ul></li></ul></li><li><p>创建虚拟VM： Computer Engine - &gt; 虚拟机实例 -&gt; 新建虚拟机实例</p><ul><li><p><em>名称： “name of the VM”</em></p></li><li><p><em>区域&#x2F;可用区：”select the region and AZ”</em> </p><blockquote><p><em>区域建议选择TW： asia-east1</em></p></blockquote></li><li><p><em>机器配置</em></p><ul><li><em>系列： 第一代 N1</em></li><li><em>机器类型： e2-micro</em></li></ul></li><li><p><em>启动磁盘</em></p><ul><li><em>更改映像image： Ubuntu 18.04 LTS</em></li></ul></li><li><p><em>防火墙</em></p><ul><li><em>允许HTTPS 流量</em></li></ul></li><li><p><em>高级选项 - &gt; 网络</em></p><ul><li><em>网络接口： 选择之前设置的VPC 网络和子网</em></li></ul></li></ul></li><li><p>SSH 到创建的虚拟VM</p><ul><li><p>本地生成相应的SSH public key (macOS)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -f ~/.ssh/&lt;username&gt;_gcp_key -C &lt;your-user-name-for-SSH&gt;<br></code></pre></td></tr></table></figure></li><li><p>拷贝public key的内容到虚拟VM</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat ~/.ssh/&lt;username&gt;_gcp_key.pub<br></code></pre></td></tr></table></figure><p>虚拟机 -&gt; 元数据 -&gt; SSH 密钥 -&gt; 修改， 添加一项，添加拷贝的public key的内容</p></li><li><p>SSH 连接到VM</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -i /Users/&lt;username&gt;/.ssh/id_rsa &lt;your-user-name-for-ssh&gt;@&lt;public-ip or hostname&gt;<br></code></pre></td></tr></table></figure></li></ul></li></ol><h2 id="配置代理服务器"><a href="#配置代理服务器" class="headerlink" title="配置代理服务器"></a>配置代理服务器</h2><h3 id="安装设置Docker"><a href="#安装设置Docker" class="headerlink" title="安装设置Docker"></a>安装设置Docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br>sudo install -m 0755 -d /etc/apt/keyrings<br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg<br>sudo chmod a+r /etc/apt/keyrings/docker.gpg<br><br>echo   &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \<br>    &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; |   sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null<br><br>sudo apt-get update<br>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<br><br>sudo docker run hello-world<br></code></pre></td></tr></table></figure><h3 id="开启TCP-BBR-拥塞控制算法"><a href="#开启TCP-BBR-拥塞控制算法" class="headerlink" title="开启TCP BBR 拥塞控制算法"></a>开启TCP BBR 拥塞控制算法</h3><blockquote><p>TCP BBR（Bottleneck Bandwidth and Round-trip propagation time）是由Google设计，于2016年发布的拥塞算法。以往大部分拥塞算法是基于丢包来作为降低传输速率的信号，而BBR则基于模型主动探测。该算法使用网络最近出站数据分组当时的最大带宽和往返时间来创建网络的显式模型。数据包传输的每个累积或选择性确认用于生成记录在数据包传输过程和确认返回期间的时间内所传送数据量的采样率。该算法认为随着网络接口控制器逐渐进入千兆速度时，分组丢失不应该被认为是识别拥塞的主要决定因素，所以基于模型的拥塞控制算法能有更高的吞吐量和更低的延迟，可以用BBR来替代其他流行的拥塞算法，例如CUBIC。Google在YouTube上应用该算法，将全球平均的YouTube网络吞吐量提高了4%，在一些国家超过了14%。</p><p>BBR之后移植入Linux内核4.9版本，并且对于QUIC可用。</p><p>如果开启，请参看 《<a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95">开启TCP BBR拥塞控制算法</a> 》</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">uname -r<br>lsmod | grep bbr<br>sudo modprobe tcp_bbr<br>echo &quot;tcp_bbr&quot; | sudo tee --append /etc/modules-load.d/modules.conf<br>echo &quot;net.core.default_qdisc=fq&quot; | sudo tee --append /etc/sysctl.conf<br>echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; | sudo tee --append /etc/sysctl.conf<br>sudo sysctl -p<br>sysctl net.ipv4.tcp_available_congestion_control<br>sysctl net.ipv4.tcp_congestion_control<br>lsmod | grep bbr<br></code></pre></td></tr></table></figure><h3 id="准备域名，-DNS解析，HTTPS证书"><a href="#准备域名，-DNS解析，HTTPS证书" class="headerlink" title="准备域名， DNS解析，HTTPS证书"></a>准备域名， DNS解析，HTTPS证书</h3><ol><li><p>域名</p><ul><li>直接从腾讯云DNSPod 购买的域名和DNS 服务</li></ul></li><li><p>DNS 解析</p><ul><li>创建一个A 记录指向后续创建的虚拟机 （公网地址）</li></ul></li><li><p>安装certbot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install snapd<br>sudo snap install core<br>sudo snap refresh core<br>sudo snap install --classic certbot<br>sudo ln -s /snap/bin/certbot /usr/bin/certbot<br>sudo certbot renew --dry-run<br><br></code></pre></td></tr></table></figure></li><li><p>申请一个证书（使用standalone的方式，然后，需要输入电子邮件和解析到 VM的域名）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo certbot certonly --standalone</span><br></code></pre></td></tr></table></figure><p>证书默认生成在 <code>/etc/letsencrypt/live/&lt;YOUR.DOMAIN.COM/&gt;</code> 目录下，这个证书90天后就过期了，所以，需要使用一个 cron job 来定期更新, 使用命令 <code>crontab -e</code> 来编辑定时任务：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span><span class="hljs-number">0</span> <span class="hljs-number">1</span> * * /<span class="hljs-keyword">usr</span>/bin/certbot renew --force-renewal<br><span class="hljs-symbol">5 </span><span class="hljs-number">0</span> <span class="hljs-number">1</span> * * /<span class="hljs-keyword">usr</span>/bin/docker restart gost<br></code></pre></td></tr></table></figure></li></ol><h3 id="用Gost设置HTTPS-服务"><a href="#用Gost设置HTTPS-服务" class="headerlink" title="用Gost设置HTTPS 服务"></a>用Gost设置HTTPS 服务</h3><p><a href="https://github.com/ginuerzh/gost">gost</a> 是一个非常强的代理服务，它可以设置成 HTTPS 代理，然后把你的服务伪装成一个Web服务器，<strong>这比其它的流量伪装更好，也更隐蔽。这也是这里强烈推荐的一个方式</strong>。</p><p>接下来就是启动 gost 服务了，我们这里使用 Docker 的方式建立 gost 服务器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">felix_yang@c1ws-test:~$ cat gost_install.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">下面的四个参数需要改成你的</span><br>DOMAIN=&quot;YOU.DOMAIN.NAME&quot;<br>USER=&quot;username&quot;<br>PASS=&quot;password&quot;<br>PORT=443<br><br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/fullchain.pem<br>KEY=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/privkey.pem<br>sudo docker run -d --name gost \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;USER&#125;:$&#123;PASS&#125;@$&#123;BIND_IP&#125;:$&#123;PORT&#125;?cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=web:www.bing.com&amp;knock=www.google.com&quot;<br></code></pre></td></tr></table></figure><blockquote><p><strong>Note:</strong> </p><ol><li><p>在 Gost 的启动上加上这个参数：<code>probe_resist=web:www.bing.com</code>，这样，当有人探测你的端口的时候，会返回bing.com，这样，就会让探测者以为你的端口是一个 Web 服务器，而不是一个代理服务器。</p></li><li><p>开启了探测防御功能后，当认证失败时服务器默认不会响应 <code>407 Proxy Authentication Required</code>，但某些情况下客户端需要服务器告知代理是否需要认证(例如Chrome中的 SwitchyOmega 插件)。通过knock参数设置服务器才会发送407响应。对于上面的例子，我们的<code>knock</code>参数配置的是<code>www.google.com</code>，所以，你需要先访问一下 <code>https://www.google.com</code> 让服务端返回一个 <code>407</code> 后，SwitchyOmega 才能正常工作。</p></li><li><p>如果认证信息（也就是用户名和密码）中包含特殊字符，则可以（应该是必须！否则客户端一侧会有很多不兼容）通过auth参数来设置，下面是使用 <code>auth</code> 参数的例子（注意，需要 gost 在 2.9.2+ 以上版本）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">DOMAIN=&quot;YOU.DOMAIN.NAME&quot;<br>USER=&quot;username&quot;<br>PASS=&quot;password&quot;<br>PORT=443<br>AUTH=$(echo -n $&#123;USER&#125;:$&#123;PASS&#125; | base64)<br>   <br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/fullchain.pem<br>KEY=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/privkey.pem<br>sudo docker run -d --name gost \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;USER&#125;:$&#123;PASS&#125;@$&#123;BIND_IP&#125;:$&#123;PORT&#125;?cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=web:www.bing.com&amp;knock=www.google.com&quot;<br></code></pre></td></tr></table></figure></li></ol></blockquote><p>如无意外，你的服务就启起来了。 你可以使用如下命令在检查有没有启动成功：</p><ul><li><code>sudo docker ps</code> 来查看 gost 是否在运行。</li><li><code>netstat -nolp | grep 443</code> 来查看 gost 是否在监听 443 端口。</li><li><code>sudo docker logs gost</code> 来查看 gost 的日志。</li></ul><p>你可以使用下面的命令验证你的 gost 服务是否正常。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">curl -v <span class="hljs-string">&quot;https://www.google.com&quot;</span> --proxy <span class="hljs-string">&quot;https://DOMAIN&quot;</span> --proxy-<span class="hljs-keyword">user</span> <span class="hljs-title">&#x27;USER</span>:PASS&#x27;<br></code></pre></td></tr></table></figure><h2 id="使用代理"><a href="#使用代理" class="headerlink" title="使用代理"></a>使用代理</h2><ol><li><p>电脑 - Chrome 代理</p><ul><li><p>使用<a href="chrome-extension://padekgcemlokbadohgkifijomclgjgif/options.html#!/about">SwitchyOmega</a></p><img src="https://felixyanghui.synology.me:8441/images/2023/06/06/image-20230606112051680.png" alt="image-20230606112051680" style="zoom:50%;" /></li><li><p>代理上网，需要先访问<code>knock</code>参数配置的网址进行认证</p></li></ul></li><li><p>iPhone&#x2F;iPad - Shadowrocket</p><blockquote><p> How to get Shadowrocket:   taobao 购买, 和美国appstore 官网价格差不多，2美金，但是省了不少事情，比如美国付款方式，美国appstore 账号等等</p></blockquote><img src="https://felixyanghui.synology.me:8441/images/2023/06/06/image-20230606111533591.png" alt="image-20230606111533591" style="zoom:50%;" /></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>科学上网</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenAI GPT For Python Developers</title>
    <link href="/2023/05/30/openai-gpt-for-python-developers/"/>
    <url>/2023/05/30/openai-gpt-for-python-developers/</url>
    
    <content type="html"><![CDATA[<hr><p><img src="https://felixyanghui.synology.me:8441/images/2023/05/30/image-20230530182644993.png" alt="image-20230530182644993"></p><p>[TOC]</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="What-is-ChatGPT-GPT-GPT-3-DALL-E-Codex"><a href="#What-is-ChatGPT-GPT-GPT-3-DALL-E-Codex" class="headerlink" title="What is ChatGPT, GPT, GPT-3, DALL-E, Codex?"></a>What is ChatGPT, GPT, GPT-3, DALL-E, Codex?</h2><h3 id="Story-of-OpenAI"><a href="#Story-of-OpenAI" class="headerlink" title="Story of OpenAI"></a>Story of OpenAI</h3><p>An artificial intelligence research laboratory consisting of the for-profit corporation OpenAI LP and its parent company, the non-profit OpenAI Inc.</p><ul><li><p>成立于Y2015, 成立之初的愿景：promoting and developing a friendly AI in a way that benefits humanity as a whole。 </p></li><li><p><em><strong>Sam Altman, Elon Musk,</strong> Greg Brockman, Reid Hoffman, Jessica Livingston, Peter Thiel, Amazon</em></p><p><em>Web Services (AWS), Infosys, and YC Research announced the formation of OpenAI and pledged</em></p><p><em>over <strong>US$1 billion</strong> to the venture.</em></p></li><li><p>Y2016, relase “Universe”, a software platform for measuring and training an AI’s general intelligence accross the world’s supply of games, websites and other applications</p></li><li><p><strong>Y2018, Elon Musk resigned from his board seat</strong>, but remained a donor.</p></li><li><p>Y2019, transitioned from non-profit to capped-profit (profit cap set to 100 times on any investment), The company distributed equity to its employees and partnered with <strong>Microsoft, which announced an investment package of US$1 billion into the company</strong>.</p></li><li><p>Y2020, GPT-3, a language model trained on trillions of words from the Internet.</p></li><li><p>Y2021, DALL-E, a deep-learning model that can generate digital images from natural language descriptions.</p></li><li><p><strong>Y2022, ChatGPT  - 自此开始全球风靡</strong></p></li></ul><h3 id="ChatGPT"><a href="#ChatGPT" class="headerlink" title="ChatGPT"></a>ChatGPT</h3><p>ChatGPT simply stands for <strong>G</strong>enerative <strong>P</strong>re-trained <strong>T</strong>ransformer, is built on top of OpenAI’s GPT-3 family of large language models.</p><p>Other projects using GPT-3 are:</p><ul><li><p><em>GitHub Copilot (using the OpenAI Codex model, a descendant of GPT-3, fine-tuned for generating code)</em></p></li><li><p><em>Copy.ai and  Jasper.ai (content generation for marketing purposes)</em></p></li><li><p><em>Drexel University (detection of early signs of Alzheimer’s disease)</em></p></li><li><p><em>Algolia (enhancing their search engine capabilities)</em></p></li></ul><h3 id="What-we-can-do-with-GPT"><a href="#What-we-can-do-with-GPT" class="headerlink" title="What we can do with GPT?"></a>What we can do with GPT?</h3><ol><li><p><em>By the end of your learning journey, you will have built applications such as:</em></p><ul><li><p>A fine-tuned medical chatbot assistant</p></li><li><p>An intelligent coffee recommendation system</p></li><li><p>An intelligent conversational system with memory and context</p></li><li><p>An AI voice assistant like Alexa but smarter</p></li><li><p>A Chatbot assistant to help with Linux commands</p></li><li><p>A semantic search engine</p></li><li><p>A news category prediction system</p></li><li><p>An image recognition intelligent system (image to text)</p></li><li><p>An image generator (text to image)</p></li><li><p>and more!</p></li></ul></li><li><p>By reading this guide and following the examples, you will be able to:</p><ul><li><p>Understand the different models available, and how and when to use each one.</p></li><li><p>Generate human-like text for various purposes, such as answering questions, creating content, and other creative uses.</p></li><li><p>Control the creativity of GPT models and adopt the best practices to generate high-quality text.</p></li><li><p>Transform and edit the text to perform translation, formatting, and other useful tasks.</p></li><li><p>Optimize the performance of GPT models using the various parameters and options such as suffix, max_tokens, temperature, top_p, n, stream, logprobs, echo, stop, presence_penalty, frequency_penalty, best_of, and others.</p></li><li><p>Stem, lemmatize, and reduce your bills when using the API</p></li><li><p>Understand Context Stuffing, chaining, and practice using advanced techniques</p></li><li><p>Understand text embedding and how companies such as Tesla and Notion are using it</p></li><li><p>Understand and implement semantic search and other advanced tools and concepts.</p></li><li><p>Creating prediction algorithms and zero-shot techniques and evaluating their accuracy </p></li><li><p>Understand, practice, and improve few-shot learning.</p></li><li><p>Understand fine-tuning and leveraging its power to create your own models.</p></li><li><p>Understand and use the best practices to create your own models.</p></li><li><p>Practice training and classification techniques using GPT.</p></li><li><p>Create advanced fine-tuned models.</p></li><li><p>Use OpenAI Whisper and other tools to create intelligent voice assistants.</p></li><li><p>Implement image classification using OpenAI CLIP.</p></li><li><p>Generate and edit images using OpenAI DALL-E.</p></li><li><p>Draw inspiration from other images to create yours.</p></li><li><p>Reverse engineer images’ prompts from Stable Diffusion (image to text)</p></li></ul></li></ol><h2 id="How-Does-GPT-Work"><a href="#How-Does-GPT-Work" class="headerlink" title="How Does GPT Work?"></a>How Does GPT Work?</h2><h3 id="Deep-Learning-Machine-Learning-and-AI"><a href="#Deep-Learning-Machine-Learning-and-AI" class="headerlink" title="Deep Learning, Machine Learning and AI"></a><a href="https://learn.microsoft.com/zh-cn/azure/machine-learning/concept-deep-learning-vs-machine-learning?view=azureml-api-2">Deep Learning, Machine Learning and AI</a></h3><p><img src="https://felixyanghui.synology.me:8441/images/2023/06/10/ai-vs-machine-learning-vs-deep-learning.png" alt="关系图：AI、深度学习与机器学习"></p><blockquote><ul><li><strong>Deep learning</strong> is a subset of machine learning that’s based on <strong>artificial neural networks</strong>. The <em>learning process</em> is <em>deep</em> because the structure of artificial neural networks consists of multiple input, output, and hidden layers. Each layer contains units that transform the input data into information that the next layer can use for a certain predictive task. Thanks to this structure, a machine can learn through its own data processing.</li><li><strong>Generative AI</strong> is a subset of artificial intelligence that uses techniques (such as deep learning) to generate new content. For example, you can use generative AI to create images, text, or audio. These models leverage massive pre-trained knowledge to generate this content.</li></ul></blockquote><h3 id="Artificial-neural-networks"><a href="#Artificial-neural-networks" class="headerlink" title="Artificial neural networks"></a>Artificial neural networks</h3><p>Artificial neural networks are formed by layers of connected nodes. Deep learning models use neural networks that have a large number of layers.</p><p>The following are most popular artificial neural network typologies and models</p><ul><li><p>Feedforward neural network</p></li><li><p>Recurrent neural network (RNN)</p></li><li><p>Convolutional neural network (CNN)</p></li><li><p>Generative adversarial network (GAN)</p></li><li><p><strong>Transformers</strong></p></li></ul><h3 id="Transformers"><a href="#Transformers" class="headerlink" title="Transformers"></a>Transformers</h3><p>Transformers are a model architecture of <strong>Artificial neural networks</strong> that is suited for solving problems containing sequences such as text or time-series data. They consist of <a href="https://en.wikipedia.org/wiki/Transformer_(machine_learning_model)#Encoder">encoder and decoder layers</a>. The encoder takes an input and maps it to a numerical representation containing information such as context. The decoder uses information from the encoder to produce an output such as translated text. What makes transformers different from other architectures containing encoders and decoders are the attention sub-layers. Attention is the idea of focusing on specific parts of an input based on the importance of their context in relation to other inputs in a sequence. For example, when summarizing a news article, not all sentences are relevant to describe the main idea. By focusing on key words throughout the article, summarization can be done in a single sentence, the headline.</p><p>Transformers have been used to solve natural language processing problems such as translation, text generation, question answering, and text summarization.</p><p>Some well-known implementations of transformers are:</p><ul><li>Bidirectional Encoder Representations from Transformers (BERT)</li><li>Generative Pre-trained Transformer 2 (<strong>GPT</strong>-2)</li><li>Generative Pre-trained Transformer 3 (<strong>GPT</strong>-3)</li></ul><h3 id="GPT-Generative-Pre-trained-Transformer"><a href="#GPT-Generative-Pre-trained-Transformer" class="headerlink" title="GPT (Generative Pre-trained Transformer)"></a>GPT (<strong>G</strong>enerative <strong>P</strong>re-trained <strong>T</strong>ransformer)</h3><p>GPT is a type of neural network called a transformer, which is specifically designed for natural language processing tasks. The architecture of a transformer is based on a series of <em><strong>self-attention</strong></em> mechanisms that allow the model to process input text in parallel and weigh the importance of each word or token based on its context.</p><h3 id="Self-attention"><a href="#Self-attention" class="headerlink" title="Self-attention"></a>Self-attention</h3><p>Self-attention is a mechanism used in deep learning models for natural language processing (NLP) that allows a model to weigh the importance of different parts of a sentence or a number of sentences when making predictions. Part of the Transformer architecture, it enables a neural network to achieve a satisfactory degree of performance when it comes to NLP tasks.</p><h3 id="How-GPT-generate-text-differently-from-other"><a href="#How-GPT-generate-text-differently-from-other" class="headerlink" title="How GPT generate text differently from other"></a>How GPT generate text differently from other</h3><p>An example of using Hugging Face transformers for GPT-2 interface</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline<br><span class="hljs-number">2</span> generator = pipeline(<span class="hljs-string">&#x27;text-generation&#x27;</span>, model = <span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><span class="hljs-number">3</span> generator(<span class="hljs-string">&quot;Hello, I&#x27;m a language model&quot;</span>, max_length = <span class="hljs-number">30</span>, num_return_sequences=<span class="hljs-number">3</span>)<br><span class="hljs-number">4</span> <span class="hljs-comment">## [&#123;&#x27;generated_text&#x27;: &quot;Hello, I&#x27;m a language modeler. So while writing this, when I\</span><br><span class="hljs-number">5</span> went out to meet my wife <span class="hljs-keyword">or</span> come home she told me that my<span class="hljs-string">&quot;&#125;,</span><br><span class="hljs-string">6 ## &#123;&#x27;generated_text&#x27;: &quot;</span>Hello, I<span class="hljs-string">&#x27;m a language modeler. I write and maintain software\</span><br><span class="hljs-string">7 in Python. I love to code, and that includes coding things that require writing&quot;&#125;, \</span><br><span class="hljs-string">8 ...</span><br></code></pre></td></tr></table></figure><p>By default, a model has no memory, this means that each input is processed independently, without any information being carried over from previous inputs. When GPT generates text, it doesn’t have any preconceived notions about what should come next based on previous inputs. <strong>Instead, it generates <em>each word</em> based on the probability of it being the next likely word given the previous input</strong>. This results in text that can be surprising and creative.</p><p>默认情况下，模型没有内存，这意味着每个输入都是独立处理的，不需要从以前的输入传递任何信息。当GPT生成文本时，它不会根据之前的输入对下一步应该做什么有任何先入为主的概念。相反，它根据给定前一个输入的下一个可能<strong>单词</strong>的概率生成<strong>每个单词</strong>。这就产生了令人惊讶且富有创造性的文本。</p><p>This is another example of code that uses a GPT model to generate text based on user input.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Import the necessary libraries</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> GPT2Tokenizer, GPT2LMHeadModel<br><span class="hljs-number">3</span><br><span class="hljs-number">4</span> <span class="hljs-comment"># Load the pre-trained GPT-2 tokenizer and model</span><br><span class="hljs-number">5</span> tokenizer = GPT2Tokenizer.from_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><span class="hljs-number">6</span> model = GPT2LMHeadModel.from_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><span class="hljs-number">7</span><br><span class="hljs-number">8</span> <span class="hljs-comment"># Set the model to evaluation mode</span><br><span class="hljs-number">9</span> model.<span class="hljs-built_in">eval</span>()<br><span class="hljs-number">10</span><br><span class="hljs-number">11</span> <span class="hljs-comment"># Define a prompt for the model to complete</span><br><span class="hljs-number">12</span> prompt = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;You: &quot;</span>)<br><span class="hljs-number">13</span><br><span class="hljs-number">14</span> <span class="hljs-comment"># Tokenize the prompt and generate text</span><br><span class="hljs-number">15</span> input_ids = tokenizer.encode(prompt, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>)<br><span class="hljs-number">16</span> output = model.generate(input_ids, max_length=<span class="hljs-number">50</span>, do_sample=<span class="hljs-literal">True</span>)<br><span class="hljs-number">17</span><br><span class="hljs-number">18</span> <span class="hljs-comment"># Decode the generated text and print it to the console</span><br><span class="hljs-number">19</span> generated_text = tokenizer.decode(output[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>)<br><span class="hljs-number">20</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;AI: &quot;</span> + generated_text)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install openai<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install --upgrade openai<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br>openai.api_key = <span class="hljs-string">&#x27;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&#x27;</span><br><br>models = openai.Model.<span class="hljs-built_in">list</span>()<br>datas = models[<span class="hljs-string">&#x27;data&#x27;</span>]<br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> datas:<br>    <span class="hljs-built_in">print</span>(data[<span class="hljs-string">&#x27;id&#x27;</span>])<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br>openai.api_key = <span class="hljs-string">&#x27;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&#x27;</span><br><br><br>response = openai.ChatCompletion.create(<br>    model=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>    messages=[<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Assistant is a large language model trained by OpenAI.&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Who were the founders of Microsoft?&quot;</span>&#125;<br>    ]<br>)<br><br><span class="hljs-built_in">print</span>(response[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>])<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install transformers<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> GPT2Tokenizer, GPT2LMHeadModel<br><br>tokenizer = GPT2Tokenizer.from_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br>model = GPT2LMHeadModel.from_pretrained_pretrained(<span class="hljs-string">&#x27;gpt2&#x27;</span>)<br><br>model.<span class="hljs-built_in">eval</span>()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">openai.api_key = <span class="hljs-string">&#x27;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&#x27;</span><br><span class="hljs-built_in">print</span>(openai.api_key)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>models = openai.Model.<span class="hljs-built_in">list</span>()<br>datas = models[<span class="hljs-string">&#x27;data&#x27;</span>]<br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> datas:<br>    <span class="hljs-built_in">print</span>(data[<span class="hljs-string">&#x27;id&#x27;</span>])<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">15</span>,<br>    temperature=<span class="hljs-number">0.5</span><br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h2 id="Using-GPT-Text-Completions"><a href="#Using-GPT-Text-Completions" class="headerlink" title="Using GPT Text Completions"></a>Using GPT Text Completions</h2><h3 id="Logprobs"><a href="#Logprobs" class="headerlink" title="Logprobs"></a>Logprobs</h3><p>To increase the possibilities, we can use the “logprobs” prameters. For example, setting logprobs to 2 will return two versions of each token</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">15</span>,<br>    temperature=<span class="hljs-number">0</span>,<br>    logprobs=<span class="hljs-number">3</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h3 id="Streaming-the-Results"><a href="#Streaming-the-Results" class="headerlink" title="Streaming the Results"></a>Streaming the Results</h3><p>Another common parameter we can use in OpenAI is the stream. It is possible to instruct the API to return a stream of tokens instead of a block containing all tokens. In this case, the API will return a generator that yields tokens in the order they were generated.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">7</span>,<br>    stream=<span class="hljs-literal">True</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-built_in">next</span>))<br><br><br><span class="hljs-comment"># # * will unpack the generator</span><br><span class="hljs-comment"># print(*next, sep=&#x27;\n&#x27;)</span><br><br><span class="hljs-comment"># Read the generator text elements one by one</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span>:<br>    <span class="hljs-built_in">print</span>(i[<span class="hljs-string">&quot;choices&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;text&quot;</span>])<br></code></pre></td></tr></table></figure><h3 id="Controlling-Repetitivity-Frequency-and-Presence-Penalties"><a href="#Controlling-Repetitivity-Frequency-and-Presence-Penalties" class="headerlink" title="Controlling Repetitivity: Frequency and Presence Penalties"></a>Controlling Repetitivity: Frequency and Presence Penalties</h3><p>the completions API has two features that can be used to stop the same words from being suggested too often. These features change the chances of certain words being suggested by adding a bonus or penalty to the logits(the numbers that show how likely a word is to be suggested)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">100</span>,<br>    frequency_penalty=<span class="hljs-number">2.0</span>,<br>    presence_penalty=<span class="hljs-number">2.0</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== Frequency and presence penalty 2.0 ===&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>[<span class="hljs-string">&quot;choices&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;text&quot;</span>])<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">100</span>,<br>    frequency_penalty=-<span class="hljs-number">2.0</span>,<br>    presence_penalty=-<span class="hljs-number">2.0</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== Frequency and presence penalty -2.0 ===&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>[<span class="hljs-string">&quot;choices&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;text&quot;</span>])<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">5</span>,<br>    n=<span class="hljs-number">2</span><br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h3 id="Getting-the-“best-of”"><a href="#Getting-the-“best-of”" class="headerlink" title="Getting the “best of”"></a>Getting the “best of”</h3><p>It is possible to ask the AI models to generate possible completions for a given task on the server side and select the one with the highest probability of being correct. This can be done using the <code>best_of</code> parameter.<br>When using <code>best_of</code>, you need to specify two numbers: <strong>n</strong> and <strong>best_of</strong><br>As seen previously, n is the number of candidate completions you want to see.<br>Note: Make sure that best_of is greater than n.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">5</span>,<br>    n=<span class="hljs-number">1</span>,<br>    best_of=<span class="hljs-number">2</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h3 id="Controlling-when-the-completion-stops"><a href="#Controlling-when-the-completion-stops" class="headerlink" title="Controlling when the completion stops"></a>Controlling when the completion stops</h3><p>In most cases, it is useful to stop the API from generating more text.</p><p>Let’s say, we want to generate a single paragraph and no more. In this case, we can ask the API to stop completing the text when there’s a new line(\n). This can be done using a similar code as below:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">5</span>,<br>    stop=[<span class="hljs-string">&quot;\n&quot;</span>,],<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><p>The stop parameter can contain up to four stop words. Note that the completion will not include the stop sequence in the result. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Once upon a time&quot;</span>,<br>    max_tokens=<span class="hljs-number">5</span>,<br>    stop=[<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;Story&quot;</span>, <span class="hljs-string">&quot;End&quot;</span>, <span class="hljs-string">&quot;Once upon a time&quot;</span>],<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h3 id="Using-Suffic-after-text-completion"><a href="#Using-Suffic-after-text-completion" class="headerlink" title="Using Suffic after text completion"></a>Using Suffic after text completion</h3><p>The parameter suffix comes after the completion of inserted text.</p><p>Imagine, we want to crate a Python dict containing the list of primary numbers between 0 and 9:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml">&#123;<br>    <span class="hljs-attr">&quot;primes&quot;:</span> [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>The API, in this case, is upposed to return 2, 3, 5, 7. We can use the suffic parmeter in this case.</p><p>Example-1:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Write a JSON containing primary numbers between 0 and 9 \n\n&#123;\n\t\&quot;primes\&quot;: [&quot;</span>,<br>)<br><br><span class="hljs-comment"># print(next[&quot;choices&quot;][0][&quot;text&quot;])</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><p>Example-2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Write a JSON containing primary numbers between 0 and 9 \n\n&#123;\n\t\&quot;primes\&quot;: [&quot;</span>,<br>    suffix=<span class="hljs-string">&quot;]\n&#125;&quot;</span><br>)<br><br><span class="hljs-comment"># print(next[&quot;choices&quot;][0][&quot;text&quot;])</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h3 id="Extracting-keywords"><a href="#Extracting-keywords" class="headerlink" title="Extracting keywords"></a>Extracting keywords</h3><p>Through appending the keywords at the end of the prompt message to get the completion text, the model will recognize that we need keywords and output should look something like this:<br><code>Plankalku\u0308l, Fortran, ALGOL 58, Lisp</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;The first programming language to be invented was Plankalkül, which was designed by \</span><br><span class="hljs-string">Konrad Zuse in the 1940s, but not publicly known until 1972 (and not implemented unt\</span><br><span class="hljs-string">il 1998). The first widely known and successful high-level programming language was \</span><br><span class="hljs-string">Fortran, developed from 1954 to 1957 by a team of IBM researchers led by John Backus\</span><br><span class="hljs-string">. The success of FORTRAN led to the formation of a committee of scientists to develo\</span><br><span class="hljs-string">p a &quot;universal&quot; computer language; the result of their effort was ALGOL 58. Separate\</span><br><span class="hljs-string">ly, John McCarthy of MIT developed Lisp, the first language with origins in academia\</span><br><span class="hljs-string">to be successful. With the success of these initial efforts, programming languages \</span><br><span class="hljs-string">became an active topic of research in the 1960s and beyond.\n\nKeywords:&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">300</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet[<span class="hljs-string">&quot;choices&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;text&quot;</span>])<br></code></pre></td></tr></table></figure><p>You can play with the prompt and try different things such as: <code>Keywords:\n-</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;The first programming language to be invented was Plankalkül, which was designed by \</span><br><span class="hljs-string">Konrad Zuse in the 1940s, but not publicly known until 1972 (and not implemented unt\</span><br><span class="hljs-string">il 1998). The first widely known and successful high-level programming language was \</span><br><span class="hljs-string">Fortran, developed from 1954 to 1957 by a team of IBM researchers led by John Backus\</span><br><span class="hljs-string">. The success of FORTRAN led to the formation of a committee of scientists to develo\</span><br><span class="hljs-string">p a &quot;universal&quot; computer language; the result of their effort was ALGOL 58. Separate\</span><br><span class="hljs-string">ly, John McCarthy of MIT developed Lisp, the first language with origins in academia\</span><br><span class="hljs-string">to be successful. With the success of these initial efforts, programming languages \</span><br><span class="hljs-string">became an active topic of research in the 1960s and beyond.\n\nKeywords:\n-&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">300</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet.choices[<span class="hljs-number">0</span>].text)<br></code></pre></td></tr></table></figure><h3 id="Generating-Tweets"><a href="#Generating-Tweets" class="headerlink" title="Generating Tweets"></a>Generating Tweets</h3><p>We can apped “tweet:” instead of “Keywords:” to prompt the model to return the tweet-style message.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;The first programming language to be invented was Plankalkül, which was designed by \</span><br><span class="hljs-string">Konrad Zuse in the 1940s, but not publicly known until 1972 (and not implemented unt\</span><br><span class="hljs-string">il 1998). The first widely known and successful high-level programming language was \</span><br><span class="hljs-string">Fortran, developed from 1954 to 1957 by a team of IBM researchers led by John Backus\</span><br><span class="hljs-string">. The success of FORTRAN led to the formation of a committee of scientists to develo\</span><br><span class="hljs-string">p a &quot;universal&quot; computer language; the result of their effort was ALGOL 58. Separate\</span><br><span class="hljs-string">ly, John McCarthy of MIT developed Lisp, the first language with origins in academia\</span><br><span class="hljs-string">to be successful. With the success of these initial efforts, programming languages \</span><br><span class="hljs-string">became an active topic of research in the 1960s and beyond.\n\nTweet:&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">300</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet.choices[<span class="hljs-number">0</span>].text)<br></code></pre></td></tr></table></figure><p>We can also add hashtags with <code>Tweet with hashtags:</code>, here’s the code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;The first programming language to be invented was Plankalkül, which was designed by \</span><br><span class="hljs-string">Konrad Zuse in the 1940s, but not publicly known until 1972 (and not implemented unt\</span><br><span class="hljs-string">il 1998). The first widely known and successful high-level programming language was \</span><br><span class="hljs-string">Fortran, developed from 1954 to 1957 by a team of IBM researchers led by John Backus\</span><br><span class="hljs-string">. The success of FORTRAN led to the formation of a committee of scientists to develo\</span><br><span class="hljs-string">p a &quot;universal&quot; computer language; the result of their effort was ALGOL 58. Separate\</span><br><span class="hljs-string">ly, John McCarthy of MIT developed Lisp, the first language with origins in academia\</span><br><span class="hljs-string">to be successful. With the success of these initial efforts, programming languages \</span><br><span class="hljs-string">became an active topic of research in the 1960s and beyond.\n\nTweet with hashtags:&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">300</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet.choices[<span class="hljs-number">0</span>].text)<br></code></pre></td></tr></table></figure><h3 id="Generating-a-Rap-Song"><a href="#Generating-a-Rap-Song" class="headerlink" title="Generating a Rap Song"></a>Generating a Rap Song</h3><ul><li>Example-1 with <code>text-davinci-002</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;Write a rap song:\n\n&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">200</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><ul><li>Example-1 with <code>text-davinci-003</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;Write a rap song:\n\n&#x27;</span><br><br>tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">200</span>,<br>)<br><br><span class="hljs-built_in">print</span>(tweet.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><h3 id="Generating-a-Todo-List"><a href="#Generating-a-Todo-List" class="headerlink" title="Generating a Todo List"></a>Generating a Todo List</h3><p>In this example, we are asking the model to generate a to-do list for creating a company in the US. We need five items on the list</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-built_in">next</span> = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>    prompt=<span class="hljs-string">&quot;Todo list to create a company in US\n\n1.&quot;</span>,<br>    temperature=<span class="hljs-number">0.3</span>,<br>    max_tokens=<span class="hljs-number">64</span>,<br>    top_p=<span class="hljs-number">0.1</span>,<br>    frequency_penalty=<span class="hljs-number">0</span>,<br>    presence_penalty=<span class="hljs-number">0.5</span>,<br>    stop=[<span class="hljs-string">&quot;6.&quot;</span>],<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>)<br></code></pre></td></tr></table></figure><h4 id="model"><a href="#model" class="headerlink" title="model:"></a>model:</h4><p>specifies the model that the API should use for generating the text completion. In this case,<br>it is using “text-davinci-002”.</p><h4 id="prompt"><a href="#prompt" class="headerlink" title="prompt:"></a>prompt:</h4><p>is the text that the API uses as a starting point for generating the completion. In our case,<br>we used a prompt that is a to-do list for creating a company in the US. The first item should start<br>with “1.”, knowing that the output we asked for should be in this format;<br>1 1. &lt;1st item&gt;<br>2 2. &lt;2nd item&gt;<br>3 3. &lt;3nd item&gt;<br>4 4. &lt;4th item&gt;<br>5 5. &lt;5th item&gt;</p><h4 id="temperature"><a href="#temperature" class="headerlink" title="temperature"></a>temperature</h4><p>controls the “creativity” of the text generated by the model. The higher temperature the<br>more creative and diverse completions will be. On the other hand, a lower temperature will result<br>in a more “conservative” and predictable completions. In this case, the temperature is set to 0.3.</p><h4 id="max-tokens"><a href="#max-tokens" class="headerlink" title="max_tokens"></a>max_tokens</h4><p>limits the maximum number of tokens that the API will generate. In our case, the<br>maximum number of tokens is 64. You can increase this value but keep in mind that the more<br>tokens you will generate, the more credits you will be charged. When learning and testing, keeping<br>a lower value will help you avoid overspending.</p><h4 id="top-p"><a href="#top-p" class="headerlink" title="top_p"></a>top_p</h4><p>controls the proportion of the mass of the distribution that the API considers when generating<br>the next token. A higher value will result in more conservative completions, while a lower value will<br>result in more diverse completions. In this case, the top_p is set to 0.1. It is not recommended to use<br>both this and temperature but it’s not also a blocking issue.</p><h4 id="frequency-penalty"><a href="#frequency-penalty" class="headerlink" title="frequency_penalty"></a>frequency_penalty</h4><p>is used to adjust the model’s preference for generating frequent or rare words.<br>A positive value will decrease the chances of frequent words, while a negative value will increase<br>them. In this case, the frequency_penalty is set to 0<br>presence_penalty is used to adjust the model’s preference for generating words that are present or<br>absent in the prompt. A positive value will decrease the chances of words that are present in the<br>prompt, a negative value will increase them. The presence_penalty is set to 0.5 in our example.</p><h4 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h4><p>is used to specify a sequence of tokens that the API should stop generating completions after. In<br>our example, since we only want 5 items, we should stop generating after the token 6. is generated.</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>The OpenAI Completions API is a powerful tool for generating text in various contexts. With the<br>right parameters and settings, it can produce natural-sounding text that is pertinent to the task.<br>By configuring the right values for some parameters such as frequency and presence penalties, the<br>results can be tailored to produce desired outcomes.<br>With the ability to control when the completion stops, the user can also control the length of the<br>generated text. This could be also helpful to reduce the number of tokens generated and indirectly<br>reduce costs.</p><h2 id="Editing-Text-Using-GPT"><a href="#Editing-Text-Using-GPT" class="headerlink" title="Editing Text Using GPT"></a>Editing Text Using GPT</h2><p>After being given a prompt and a set of instructions, the GPT model you are using will take the prompt and then use its algorithms to generate a modified version of the original prompt.</p><p>The modified version can be longer and&#x2F;or more detailed than the initial prompt depending on your instructions.</p><p>A GPT model is able to understand the context of the prompt of the prompt and the instructions given, allowing it to determine which additional details would be most beneficial to include in the output. </p><h3 id="Tanslating-Text"><a href="#Tanslating-Text" class="headerlink" title="Tanslating Text"></a>Tanslating Text</h3><p>This is an example:</p><ul><li>Use API endipoint: openai.Edit.create</li><li>Use instruction and input (optional)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&#x27;Hallo Welt&#x27;</span>,<br>    instruction=<span class="hljs-string">&#x27;Translate to English&#x27;</span>,<br>)<br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure><p>The other example with instruction only, without input:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;Translate the following sentence to English: &#x27;Hallo Welt&#x27;&quot;</span>,<br>)<br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure><h3 id="Editing-using-the-completions-endpoint-and-vice-versa"><a href="#Editing-using-the-completions-endpoint-and-vice-versa" class="headerlink" title="Editing using the completions endpoint and vice versa"></a>Editing using the completions endpoint and vice versa</h3><p>Some tasks you can excute using the edits endpoint can be done using the completions endpoint. It is up to you to choose which one is best for your needs.<br>Here’s an example of a translation task using the edits endpoint:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Example using edit dendpoint</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;Translate from English to Japanese, French, Arabic, and Spanish. /n 1:Japanese: &quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;The cat sat on the mat&quot;</span><br>)<br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Example using completion endpoint</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>content=<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Translate the following sentence from English to Japanese, French, Arabic, and Spanish.</span><br><span class="hljs-string">    The cat sat on the mat.</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>response = openai.ChatCompletion.create(<br>    model=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>    messages=[<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: content&#125;,<br>    ],<br>)<br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].message.content)<br><span class="hljs-comment"># print(response)</span><br></code></pre></td></tr></table></figure><h3 id="Formatting-the-output"><a href="#Formatting-the-output" class="headerlink" title="Formatting the output"></a>Formatting the output</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Example to add comments to a Golang code</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>message=<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">package main</span><br><span class="hljs-string"></span><br><span class="hljs-string">import (</span><br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">)</span><br><span class="hljs-string"></span><br><span class="hljs-string">func main() &#123;</span><br><span class="hljs-string">resp, err := http.Get(&quot;https://website.com&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">if err != nil &#123;</span><br><span class="hljs-string">log.Fatalln(err)</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="hljs-string">if err != nil &#123;</span><br><span class="hljs-string">log.Fatalln(err)</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">sb := string(body)</span><br><span class="hljs-string">log.Printf(sb)</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>response = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;Explain the following Golang code&quot;</span>,<br>    <span class="hljs-built_in">input</span>=message,<br>    temperature=<span class="hljs-number">0.5</span><br>)<br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].text)<br></code></pre></td></tr></table></figure><h3 id="Creativity-vs-Well-defined-answers"><a href="#Creativity-vs-Well-defined-answers" class="headerlink" title="Creativity vs. Well-defined answers"></a>Creativity vs. Well-defined answers</h3><p>Same as the completions endpoint, we have control over the creativity of the result using the temperature parameter.<br>You can try this example using two different temperatures to see the difference in the output:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response_1 = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;correct the spelling mistakes:&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;The kuick brown fox jumps over the lazy dog and&quot;</span>,<br>    temperature=<span class="hljs-number">0</span>,<br>)<br><br>response_2 = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;correct the spelling mistakes:&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;The kuick brown fox jumps over the lazy dog and&quot;</span>,<br>    temperature=<span class="hljs-number">0.9</span>,<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Temperature 0:&quot;</span>)<br><span class="hljs-built_in">print</span>(response_1.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Temperature 1:&quot;</span>)<br><span class="hljs-built_in">print</span>(response_2.choices[<span class="hljs-number">0</span>].text)<br></code></pre></td></tr></table></figure><blockquote><p>Generally, after running the code multiple times, you may observe that the first output is consistent, while the second one changes from one execution to the next. For a use case such as fixing typos, we usually don;t need creativity, so setting the temperature parameter to 0 is enough.<br>We can also use <code>top_p</code> to add the creativitiy, it is similar to the temperature. It means only tokens comprising the top #% probability mass are considered in the result.</p></blockquote><h3 id="Generating-multiple-edits"><a href="#Generating-multiple-edits" class="headerlink" title="Generating multiple edits"></a>Generating multiple edits</h3><p>In all of the previous examples, we always had a single edit. However, using the parameter n, it is possible to get more. Just use the number of edits you want to have:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    instruction=<span class="hljs-string">&quot;Edit the text to make it longer.&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;Exercise is good for your health.&quot;</span>,<br>    top_p=<span class="hljs-number">0.2</span>,<br>    n=<span class="hljs-number">2</span><br>)<br><br><br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].text)<br><span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">1</span>].text)<br></code></pre></td></tr></table></figure><h2 id="Advanced-Text-Manipulation"><a href="#Advanced-Text-Manipulation" class="headerlink" title="Advanced Text Manipulation"></a>Advanced Text Manipulation</h2><p>Untill now, we have see how to use different endpoints: edits and completions. Let’s do more examples to understand the different possibilities the model offers.</p><h3 id="Chaining-completions-and-edits"><a href="#Chaining-completions-and-edits" class="headerlink" title="Chaining completions and edits"></a>Chaining completions and edits</h3><ul><li>Use completion endpoint to generate the tweet with hashtags.</li><li>Use generated tweet as the <code>input</code>, and use <code>instruction</code> to translate the tweet</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>prompt = <span class="hljs-string">&#x27;The first programming language to be invented was Plankalkül, which was designed by \</span><br><span class="hljs-string">Konrad Zuse in the 1940s, but not publicly known until 1972 (and not implemented unt\</span><br><span class="hljs-string">il 1998). The first widely known and successful high-level programming language was \</span><br><span class="hljs-string">Fortran, developed from 1954 to 1957 by a team of IBM researchers led by John Backus\</span><br><span class="hljs-string">. The success of FORTRAN led to the formation of a committee of scientists to develo\</span><br><span class="hljs-string">p a &quot;universal&quot; computer language; the result of their effort was ALGOL 58. Separate\</span><br><span class="hljs-string">ly, John McCarthy of MIT developed Lisp, the first language with origins in academia\</span><br><span class="hljs-string">to be successful. With the success of these initial efforts, programming languages \</span><br><span class="hljs-string">became an active topic of research in the 1960s and beyond.\n\nTweet with hashtags:&#x27;</span><br><br>english_tweet = openai.Completion.create(<br>    model=<span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>    prompt=prompt,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    max_tokens=<span class="hljs-number">20</span>,<br>)<br><br>english_tweet_text = english_tweet.choices[<span class="hljs-number">0</span>].text.strip()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;English tweet:&quot;</span>)<br><span class="hljs-built_in">print</span>(english_tweet_text)<br><br>spanish_tweet = openai.Edit.create(<br>    model=<span class="hljs-string">&quot;text-davinci-edit-001&quot;</span>,<br>    <span class="hljs-built_in">input</span>=english_tweet_text,<br>    instruction=<span class="hljs-string">&quot;Translate to Spanish&quot;</span>,<br>    temperature=<span class="hljs-number">0.5</span>,<br>    <br>)<br><br>spanish_tweet_text = spanish_tweet.choices[<span class="hljs-number">0</span>].text.strip()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Spanish tweet:&quot;</span>)<br><span class="hljs-built_in">print</span>(spanish_tweet_text)<br></code></pre></td></tr></table></figure><h3 id="Aple-the-Company-vs-Apple-the-Fruit-Context-Stuffing"><a href="#Aple-the-Company-vs-Apple-the-Fruit-Context-Stuffing" class="headerlink" title="Aple the Company vs. Apple the Fruit (Context Stuffing)"></a>Aple the Company vs. Apple the Fruit (Context Stuffing)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt = <span class="hljs-string">&quot;Determine the part of speech of the word &#x27;light&#x27;.\n\n&quot;</span><br><br>result = openai.Completion.create(<br>    model = <span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>    prompt = prompt,<br>    max_tokens = <span class="hljs-number">20</span>,<br>    temperature = <span class="hljs-number">1</span>,<br>)<br><br><span class="hljs-built_in">print</span>(result.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt_a = <span class="hljs-string">&quot;The light is red. Determine the part of speech of the word &#x27;light&#x27;.\n\n&quot;</span><br>prompt_b = <span class="hljs-string">&quot;This desk is very light. Determine the part of speech of the word &#x27;light&#x27;.\n\n&quot;</span><br>prompt_c = <span class="hljs-string">&quot;You light up my life. Determine the part of speech of the word &#x27;light&#x27;.\n\n&quot;</span><br><br><span class="hljs-keyword">for</span> prompt <span class="hljs-keyword">in</span> [prompt_a, prompt_b, prompt_c]:<br>    result = openai.Completion.create(<br>        model=<span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>        prompt=prompt,<br>        max_tokens=<span class="hljs-number">20</span>,<br>        temperature=<span class="hljs-number">0</span>,<br>    )<br>    <span class="hljs-built_in">print</span>(result.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt_1 = <span class="hljs-string">&quot;Huawei:\ncompany\n\nGoogle:\ncompany\n\nMicrosoft:\ncompany\n\nApple:\n&quot;</span><br>prompt_2 = <span class="hljs-string">&quot;Huawei:\ncompany\n\nGoogle:\ncompany\n\nMicrosoft:\ncompany\n\nApricot:\nFruit\n\nApple:\n&quot;</span><br><br><span class="hljs-keyword">for</span> prompt <span class="hljs-keyword">in</span> [prompt_1, prompt_2]:<br>    result = openai.Completion.create(<br>        model = <span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>        prompt = prompt,<br>        max_tokens = <span class="hljs-number">20</span>,<br>        temperature = <span class="hljs-number">0</span>,<br>        stop=[<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot; &quot;</span>],<br>    )<br><br>    <span class="hljs-built_in">print</span>(result.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><h3 id="Getting-cryptocurrency-information-based-on-a-user-defined-schema-context-stuffing"><a href="#Getting-cryptocurrency-information-based-on-a-user-defined-schema-context-stuffing" class="headerlink" title="Getting cryptocurrency information based on a user-defined schema (context stuffing)"></a>Getting cryptocurrency information based on a user-defined schema (context stuffing)</h3><ul><li>define a schema or template</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt = <span class="hljs-string">&quot;&quot;&quot;Input: Bitcoin</span><br><span class="hljs-string">Output:</span><br><span class="hljs-string">BTC was created in 2008, you can learn more about it here: https://bitcoin.org/en/ a\</span><br><span class="hljs-string">nd get the latest price here: https://www.coingecko.com/en/coins/bitcoin.</span><br><span class="hljs-string">It&#x27;s all-time high is $64,895.00 and it&#x27;s all-time low is $67.81.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: Ethereum</span><br><span class="hljs-string">Output:</span><br><span class="hljs-string">ETH was created in 2015, you can learn more about it here: https://ethereum.org/en/ \</span><br><span class="hljs-string">and get the latest price here: https://www.coingecko.com/en/coins/ethereum</span><br><span class="hljs-string">It&#x27;s all-time high is $4,379.00 and it&#x27;s all-time low is $0.43.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: Dogecoin</span><br><span class="hljs-string">Output:</span><br><span class="hljs-string">DOGE was created in 2013, you can learn more about it here: https://dogecoin.com/ an\</span><br><span class="hljs-string">d get the latest price here: https://www.coingecko.com/en/coins/dogecoin</span><br><span class="hljs-string">It&#x27;s all-time high is $0.73 and it&#x27;s all-time low is $0.000002.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: Cardano</span><br><span class="hljs-string">Output:\n&quot;&quot;&quot;</span><br><br>result = openai.Completion.create(<br>    model = <span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>    prompt = prompt,<br>    max_tokens = <span class="hljs-number">200</span>,<br>    temperature = <span class="hljs-number">0</span>,<br>)<br><br><span class="hljs-built_in">print</span>(result.choices[<span class="hljs-number">0</span>].text.strip())<br></code></pre></td></tr></table></figure><h3 id="Creating-a-Chatbot-assistant-to-help-with-Linux-commands"><a href="#Creating-a-Chatbot-assistant-to-help-with-Linux-commands" class="headerlink" title="Creating a Chatbot assistant to help with Linux commands"></a>Creating a Chatbot assistant to help with Linux commands</h3><p>Disclaimer: This part was inspired by an old demo of OpenAI from 2020.<br>Our goal is to develop a command-line tool that can assist us with Linux commands through<br>conversation.<br>Let’s start with this example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install click==<span class="hljs-number">8.1</span><span class="hljs-number">.3</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">import</span> click<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><br><br>_prompt = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Input: List all the files in the current directory</span><br><span class="hljs-string">Output: ls -l</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: List all the files in the current directory, including hidden files</span><br><span class="hljs-string">Output: ls -la</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: Delete all the files in the current directory</span><br><span class="hljs-string">Output: rm *</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: Count the number of occurrences of the word &quot;sun&quot; in the file &quot;test.txt&quot;</span><br><span class="hljs-string">Output: grep -o &quot;sun&quot; test.txt | wc -l</span><br><span class="hljs-string"></span><br><span class="hljs-string">Input: &#123;&#125;</span><br><span class="hljs-string">Output:&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    request = <span class="hljs-built_in">input</span>(click.style(<span class="hljs-string">&quot;Input(type &#x27;exit&#x27; to quit): &quot;</span>, fg=<span class="hljs-string">&quot;green&quot;</span>))<br>    <span class="hljs-keyword">if</span> request == <span class="hljs-string">&quot;exit&quot;</span>:<br>        <span class="hljs-keyword">break</span><br>        <br>    prompt = _prompt.<span class="hljs-built_in">format</span>(request)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        result = openai.Completion.create(<br>            model = <span class="hljs-string">&quot;text-davinci-002&quot;</span>,<br>            prompt = prompt,<br>            max_tokens = <span class="hljs-number">100</span>,<br>            temperature = <span class="hljs-number">0</span>,<br>            stop=[<span class="hljs-string">&quot;\n&quot;</span>],<br>        )<br>        command = result.choices[<span class="hljs-number">0</span>].text.strip()<br>        click.echo(click.style(<span class="hljs-string">&quot;Output: &quot;</span>, fg=<span class="hljs-string">&quot;yellow&quot;</span>) + command)<br>        <br>        click.echo(click.style(<span class="hljs-string">&quot;Execute? (y/n): &quot;</span>, fg=<span class="hljs-string">&quot;yellow&quot;</span>), nl=<span class="hljs-literal">False</span>)<br>        choice = <span class="hljs-built_in">input</span>()<br>        <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&quot;y&quot;</span>:<br>            os.system(command)<br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&quot;n&quot;</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">else</span>:<br>            click.echo(click.style(<span class="hljs-string">&quot;Invalid choice. Please enter &#x27;y&#x27; or &#x27;n&#x27;.&quot;</span>, fg=<span class="hljs-string">&quot;red&quot;</span>))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        click.echo(click.style(<span class="hljs-string">&quot;The command could not be executed. &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(e), fg=<span class="hljs-string">&quot;red&quot;</span>))<br>        <span class="hljs-keyword">pass</span><br>    click.echo()<br></code></pre></td></tr></table></figure><h2 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h2><ul><li>measure how similar two text strings are to each other</li><li>used for tasks like:<ul><li>finding the most relevant results to a search query</li><li>grouping text strings together based on how similar they are</li><li>recommending items with similar text strings</li><li>finding text strings that are very different from the other</li><li>analyzing how different text srings are from each other</li><li>labeling text strings based on what they are most like.</li></ul></li></ul><p>Here’re some practical approaches to use embeddings in the industry.</p><ul><li>Tesla</li><li>Kalendar AI</li><li>Notion</li><li>DALL-E 2</li></ul><p>To work with embedding, you should install datalib using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install datalib<br></code></pre></td></tr></table></figure><p>At another level of this guide, we will need Matplotlib and other libraries:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install matplotlib plotly scipy scikit-learn<br></code></pre></td></tr></table></figure><p>This package will also install tools like pandas and NumPy.<br>These libraries are some of the most used in AI and data science in general.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install datalib<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install matplotlib plotly scipy scikit-learn<br></code></pre></td></tr></table></figure><h3 id="Understanding-Text-Embedding"><a href="#Understanding-Text-Embedding" class="headerlink" title="Understanding Text Embedding"></a>Understanding Text Embedding</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br>response = openai.Embedding.create(<br>    model=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;I am a programmer&quot;</span>,<br>)<br><br><span class="hljs-built_in">print</span>(response)<br><br><span class="hljs-comment"># These floating points represent the embedding of the input text “I am a programmer” generated by the OpenAI “text-embedding-ada-002” model.</span><br></code></pre></td></tr></table></figure><h3 id="Embeddings-for-Multiple-Inputs"><a href="#Embeddings-for-Multiple-Inputs" class="headerlink" title="Embeddings for Multiple Inputs"></a>Embeddings for Multiple Inputs</h3><p>We can use multiple inputs to get the embeddings, here’s the example</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">response = openai.Embedding.create(<br>    model=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>,<br>    <span class="hljs-built_in">input</span>=[<span class="hljs-string">&quot;I am a programmer&quot;</span>, <span class="hljs-string">&quot;I am a writer&quot;</span>],<br>)<br><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> response.data:<br>    <span class="hljs-built_in">print</span>(data.embedding)<br></code></pre></td></tr></table></figure><h3 id="Semantic-Search-语义搜索"><a href="#Semantic-Search-语义搜索" class="headerlink" title="Semantic Search - 语义搜索"></a>Semantic Search - 语义搜索</h3><p>We are going to implement a semantic search using OpenAI embeddings</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> openai.embeddings_utils <span class="hljs-keyword">import</span> get_embedding, cosine_similarity<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br>init_api()<br><br><span class="hljs-comment"># words.csv is a csv file with a column named &#x27;text&#x27; containing words</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;words.csv&#x27;</span>)<br><br><span class="hljs-comment"># get the embeddings for each word in the dataframe</span><br>df[<span class="hljs-string">&#x27;embedding&#x27;</span>] = df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: get_embedding(x, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>))<br><br><span class="hljs-comment"># save the dataframe to a csv file</span><br>df.to_csv(<span class="hljs-string">&#x27;embedding.csv&#x27;</span>)<br><br><span class="hljs-comment"># read the csv file</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;embedding.csv&#x27;</span>)<br><br><span class="hljs-comment"># convert the embedding axis to a numpy array</span><br>df[<span class="hljs-string">&#x27;embedding&#x27;</span>] = df[<span class="hljs-string">&#x27;embedding&#x27;</span>].apply(<span class="hljs-built_in">eval</span>).apply(np.array)<br><br><span class="hljs-comment"># get the search term from the user</span><br>user_search = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Enter a search term: &#x27;</span>)<br><br><span class="hljs-comment"># get the embedding for the search term</span><br>search_term_embedding = get_embedding(user_search, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>)<br><br><span class="hljs-comment"># calculate the cosine similarity between the search term and each word in the dataframe</span><br>df[<span class="hljs-string">&#x27;similarity&#x27;</span>] = df[<span class="hljs-string">&#x27;embedding&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: cosine_similarity(x, search_term_embedding))<br><br><span class="hljs-comment"># sort the dataframe by the similarity axis</span><br>df = df.sort_values(by=<span class="hljs-string">&#x27;similarity&#x27;</span>, ascending=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># print the top 10 results</span><br><span class="hljs-built_in">print</span>(df.head(<span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure><h3 id="Cosine-Similarity"><a href="#Cosine-Similarity" class="headerlink" title="Cosine Similarity"></a>Cosine Similarity</h3><p>Cosine similarity is a way of measuring how similar two vectors are. It looks at the angle between<br>two vectors (lines) and compares them. Cosine similarity is the cosine of the angle between the<br>vector. A result is a number between -1 and 1. If the vectors are the same, the result is 1. If the<br>vectors are completely different, the result is -1. If the vectors are at a 90-degree angle, the result is 0. In mathematical terms, this is the equation:<br>$$<br>Similarity &#x3D; (A.B) &#x2F; (||A||.||B||)<br>$$</p><ul><li>A and B are vectors</li><li>A.B is a way of multiplying two sets of numbers together. It is done by taking each number in one set and multiplying it with the same number in the other set, then adding all of those products together.</li><li>||A|| is the length of the vector A. It is calculated by taking the square root of the sum of the squares of each element of the vector A.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import numpy and norm from numpy.linalg</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> numpy.linalg <span class="hljs-keyword">import</span> norm<br><br><span class="hljs-comment"># define two vectors</span><br>A = np.array([<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>B = np.array([<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>])<br><br><span class="hljs-comment"># print the vectors</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Vector A: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(A))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Vector B: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(B))<br><br><span class="hljs-comment"># calculate the cosine similarity</span><br>cosine = np.dot(A,B)/(norm(A)*norm(B))<br><br><span class="hljs-comment"># print the cosine similarity</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Cosine Similarity between A and B: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(cosine))<br></code></pre></td></tr></table></figure><h2 id="Advanced-Embedding-Examples"><a href="#Advanced-Embedding-Examples" class="headerlink" title="Advanced Embedding Examples"></a>Advanced Embedding Examples</h2><h3 id="Predicting-your-preferred-Coffee"><a href="#Predicting-your-preferred-Coffee" class="headerlink" title="Predicting your preferred Coffee"></a>Predicting your preferred Coffee</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install nltk<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> nltk<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">from</span> openai.embeddings_utils <span class="hljs-keyword">import</span> get_embedding, cosine_similarity<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_nltk_data</span>():<br>    <span class="hljs-keyword">try</span>:<br>        nltk.data.find(<span class="hljs-string">&#x27;tokenizers/punkt&#x27;</span>)<br>    <span class="hljs-keyword">except</span> LookupError:<br>        nltk.download(<span class="hljs-string">&#x27;punkt&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        nltk.data.find(<span class="hljs-string">&#x27;corpora/stopwords&#x27;</span>)<br>    <span class="hljs-keyword">except</span> LookupError:<br>        nltk.download(<span class="hljs-string">&#x27;stopwords&#x27;</span>)<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_review</span>(<span class="hljs-params">review</span>):<br>    <span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords<br>    <span class="hljs-keyword">from</span> nltk.stem <span class="hljs-keyword">import</span> PorterStemmer<br>    stopwords = <span class="hljs-built_in">set</span>(stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>))<br>    stemmer = PorterStemmer()<br>    tokens = nltk.word_tokenize(review.lower())<br>    tokens = [token <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> token <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopwords]<br>    tokens = [stemmer.stem(token) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens]<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>.join(tokens)<br><br>init_api()<br><br>download_nltk_data()<br><br><span class="hljs-comment"># Read user input</span><br>input_coffee_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter a coffee name: &quot;</span>)<br><br><span class="hljs-comment"># Load the CSV file into a Pandas DataFrame </span><br><span class="hljs-comment"># (only the first 50 rows for now to speed up the demo and avoid paying for too many API calls)</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;simplified_coffee.csv&#x27;</span>, nrows=<span class="hljs-number">50</span>)<br><br><span class="hljs-comment"># Preprocess the review text: lowercase, tokenize, remove stopwords, and stem</span><br>df[<span class="hljs-string">&#x27;preprocessed_review&#x27;</span>] = df[<span class="hljs-string">&#x27;review&#x27;</span>].apply(preprocess_review)<br><br><span class="hljs-comment"># Get the embeddings for each review</span><br>review_embeddings = []<br><span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> df[<span class="hljs-string">&#x27;preprocessed_review&#x27;</span>]:<br>    review_embeddings.append(get_embedding(review, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>))<br>    <br><span class="hljs-comment"># Get the index of the input coffee name</span><br><span class="hljs-keyword">try</span>:<br>    input_coffee_index = df[df[<span class="hljs-string">&#x27;name&#x27;</span>] == input_coffee_name].index[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry, we don&#x27;t have that coffee in our database. Please try again.&quot;</span>)<br>    exit()<br>    <br><span class="hljs-comment"># Calculate the cosine similarity between the input coffee&#x27;s review and all other reviews</span><br>similarities = []<br>input_review_embedding = review_embeddings[input_coffee_index]<br><span class="hljs-keyword">for</span> review_embedding <span class="hljs-keyword">in</span> review_embeddings:<br>    similarity = cosine_similarity(input_review_embedding, review_embedding)<br>    similarities.append(similarity)<br><br><span class="hljs-comment"># Get the indices of the most similar reviews (excluding the input coffee&#x27;s review itself)</span><br>most_similar_indices = np.argsort(similarities)[-<span class="hljs-number">6</span>:-<span class="hljs-number">1</span>]<br><br><span class="hljs-comment"># why -1? because the last one is the input coffee itself</span><br><br><span class="hljs-comment"># Get the names of the most similar coffees</span><br>similar_coffee_names = df.iloc[most_similar_indices][<span class="hljs-string">&#x27;name&#x27;</span>].tolist()<br><br><span class="hljs-comment"># Print the results</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The most similar coffees to &#123;&#125; are:&quot;</span>.<span class="hljs-built_in">format</span>(input_coffee_name))<br><span class="hljs-keyword">for</span> coffee_name <span class="hljs-keyword">in</span> similar_coffee_names:<br>    <span class="hljs-built_in">print</span>(coffee_name)<br></code></pre></td></tr></table></figure><h3 id="Making-a-“Fuzzier”-search"><a href="#Making-a-“Fuzzier”-search" class="headerlink" title="Making a “Fuzzier” search"></a>Making a “Fuzzier” search</h3><ul><li>The previous code has limitation which need exact match for the input and existing coffee name list. </li><li>“Fuzzier” search leverage fuzzy search technique, such as “<em>Levenshtein distance</em>“ or cosine similarity search between the user input and the coffe names.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> nltk<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">from</span> openai.embeddings_utils <span class="hljs-keyword">import</span> get_embedding, cosine_similarity<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_nltk_data</span>():<br>    <span class="hljs-keyword">try</span>:<br>        nltk.data.find(<span class="hljs-string">&#x27;tokenizers/punkt&#x27;</span>)<br>    <span class="hljs-keyword">except</span> LookupError:<br>        nltk.download(<span class="hljs-string">&#x27;punkt&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        nltk.data.find(<span class="hljs-string">&#x27;corpora/stopwords&#x27;</span>)<br>    <span class="hljs-keyword">except</span> LookupError:<br>        nltk.download(<span class="hljs-string">&#x27;stopwords&#x27;</span>)<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_review</span>(<span class="hljs-params">review</span>):<br>    <span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords<br>    <span class="hljs-keyword">from</span> nltk.stem <span class="hljs-keyword">import</span> PorterStemmer<br>    stopwords = <span class="hljs-built_in">set</span>(stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>))<br>    stemmer = PorterStemmer()<br>    tokens = nltk.word_tokenize(review.lower())<br>    tokens = [token <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> token <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopwords]<br>    tokens = [stemmer.stem(token) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens]<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>.join(tokens)<br><br>init_api()<br><br>download_nltk_data()<br><br><span class="hljs-comment"># Read user input</span><br>input_coffee_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter a coffee name: &quot;</span>)<br><br><span class="hljs-comment"># Load the CSV file into a Pandas DataFrame </span><br><span class="hljs-comment"># (only the first 50 rows for now to speed up the demo and avoid paying for too many API calls)</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;simplified_coffee.csv&#x27;</span>, nrows=<span class="hljs-number">50</span>)<br><br><span class="hljs-comment"># Preprocess the review text: lowercase, tokenize, remove stopwords, and stem</span><br>df[<span class="hljs-string">&#x27;preprocessed_review&#x27;</span>] = df[<span class="hljs-string">&#x27;review&#x27;</span>].apply(preprocess_review)<br><br><span class="hljs-comment"># Get the embeddings for each review</span><br>review_embeddings = []<br><span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> df[<span class="hljs-string">&#x27;preprocessed_review&#x27;</span>]:<br>    review_embeddings.append(get_embedding(review, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>))<br>    <br><span class="hljs-comment"># Get the index of the input coffee name, with &quot;fuzzy search&quot;</span><br><span class="hljs-keyword">try</span>:<br>    input_coffee_index = df[df[<span class="hljs-string">&#x27;name&#x27;</span>] == input_coffee_name].index[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">except</span> IndexError:<br>    <span class="hljs-comment"># get the embeddings for each name</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry, we don&#x27;t have that coffee in our database. We will try to find the closest match.&quot;</span>)<br>    name_embeddings = []<br>    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> df[<span class="hljs-string">&#x27;name&#x27;</span>]:<br>        name_embeddings.append(get_embedding(name, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>))<br>    <span class="hljs-comment"># perform a cosine similarity search on the input coffee name</span><br>    input_coffee_embedding = get_embedding(input_coffee_name, engine=<span class="hljs-string">&#x27;text-embedding-ada-002&#x27;</span>)<br>    _similarities = []<br>    <span class="hljs-keyword">for</span> name_embedding <span class="hljs-keyword">in</span> name_embeddings:<br>        _similarities.append(cosine_similarity(input_coffee_embedding, name_embedding))<br>    <br>    input_coffee_index = _similarities.index(<span class="hljs-built_in">max</span>(_similarities))<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry, we don&#x27;t have that coffee in our database. Please try again.&quot;</span>)<br>    exit()<br>    <br><span class="hljs-comment"># Calculate the cosine similarity between the input coffee&#x27;s review and all other reviews</span><br>similarities = []<br>input_review_embedding = review_embeddings[input_coffee_index]<br><span class="hljs-keyword">for</span> review_embedding <span class="hljs-keyword">in</span> review_embeddings:<br>    similarity = cosine_similarity(input_review_embedding, review_embedding)<br>    similarities.append(similarity)<br><br><span class="hljs-comment"># Get the indices of the most similar reviews (excluding the input coffee&#x27;s review itself)</span><br>most_similar_indices = np.argsort(similarities)[-<span class="hljs-number">6</span>:-<span class="hljs-number">1</span>]<br><br><span class="hljs-comment"># why -1? because the last one is the input coffee itself</span><br><br><span class="hljs-comment"># Get the names of the most similar coffees</span><br>similar_coffee_names = df.iloc[most_similar_indices][<span class="hljs-string">&#x27;name&#x27;</span>].tolist()<br><br><span class="hljs-comment"># Print the results</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The most similar coffees to &#123;&#125; are:&quot;</span>.<span class="hljs-built_in">format</span>(input_coffee_name))<br><span class="hljs-keyword">for</span> coffee_name <span class="hljs-keyword">in</span> similar_coffee_names:<br>    <span class="hljs-built_in">print</span>(coffee_name)<br></code></pre></td></tr></table></figure><h3 id="Predicting-News-category-using-embedding-零样本"><a href="#Predicting-News-category-using-embedding-零样本" class="headerlink" title="Predicting News category using embedding(零样本)"></a>Predicting News category using embedding(零样本)</h3><p> This example will introduce a zero-shot news classifier that predicts the category of a news article.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> nltk<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">from</span> openai.embeddings_utils <span class="hljs-keyword">import</span> get_embedding, cosine_similarity<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br>    <br>init_api()<br><br>categories = [<br>    <span class="hljs-string">&quot;POLITICS&quot;</span>,<br>    <span class="hljs-string">&quot;WELLNESS&quot;</span>,<br>    <span class="hljs-string">&quot;ENTERTAINMENT&quot;</span>,<br>    <span class="hljs-string">&quot;TRAVEL&quot;</span>,<br>    <span class="hljs-string">&quot;STYLE &amp; BEAUTY&quot;</span>,<br>    <span class="hljs-string">&quot;PARENTING&quot;</span>,<br>    <span class="hljs-string">&quot;HEALTHY LIVING&quot;</span>,<br>    <span class="hljs-string">&quot;QUEER VOICES&quot;</span>,<br>    <span class="hljs-string">&quot;FOOD &amp; DRINK&quot;</span>,<br>    <span class="hljs-string">&quot;BUSINESS&quot;</span>,<br>    <span class="hljs-string">&quot;COMEDY&quot;</span>,<br>    <span class="hljs-string">&quot;SPORTS&quot;</span>,<br>    <span class="hljs-string">&quot;BLACK VOICES&quot;</span>,<br>    <span class="hljs-string">&quot;HOME &amp; LIVING&quot;</span>,<br>    <span class="hljs-string">&quot;PARENTS&quot;</span>,<br>]<br><br><span class="hljs-comment"># define a function to classify a sentence</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">classify_sentence</span>(<span class="hljs-params">sentence</span>):<br>    <span class="hljs-comment">#Get the embedding of the sentence</span><br>    sentence_embedding = get_embedding(sentence, engine=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>)<br>    <br>    <span class="hljs-comment">#Calculate the similarity score between the sentence and each category</span><br>    similarity_scores = &#123;&#125;<br>    <span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:<br>        category_embeddings = get_embedding(category, engine=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>)<br>        similarity_scores[category] = cosine_similarity(sentence_embedding, category_embeddings)<br>        <br>    <span class="hljs-comment"># Return the category with the highest similarity score</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(similarity_scores, key=similarity_scores.get)<br><br>sentences = [<br>    <span class="hljs-string">&quot;1 dead and 3 injured in El Paso, Texas, mall shooting&quot;</span>,<br>    <span class="hljs-string">&quot;Director Owen Kline Calls Funny Pages His ‘Self-Critical’ Debut&quot;</span>,<br>    <span class="hljs-string">&quot;15 spring break ideas for families that want to get away&quot;</span>,<br>    <span class="hljs-string">&quot;The US is preparing to send more troops to the Middle East&quot;</span>,<br>    <span class="hljs-string">&quot;Bruce Willis&#x27; &#x27;condition has progressed&#x27; to frontotemporal dementia, his family says&quot;</span>,<br>    <span class="hljs-string">&quot;Get an inside look at Universal’s new Super Nintendo World&quot;</span>,<br>    <span class="hljs-string">&quot;Barcelona 2-2 Manchester United: Marcus Rashford shines but Raphinha salvages draw for hosts&quot;</span>,<br>    <span class="hljs-string">&quot;Chicago bulls win the NBA championship&quot;</span>,<br>    <span class="hljs-string">&quot;The new iPhone 12 is now available&quot;</span>,<br>    <span class="hljs-string">&quot;Scientists discover a new dinosaur species&quot;</span>,<br>    <span class="hljs-string">&quot;The new coronavirus vaccine is now available&quot;</span>,<br>    <span class="hljs-string">&quot;The new Star Wars movie is now available&quot;</span>,<br>    <span class="hljs-string">&quot;Amazon stock hits a new record high&quot;</span>,<br>]<br><br><span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#123;:50&#125; category is &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(sentence, classify_sentence(sentence)))<br>    <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure><h3 id="Evaluating-the-accuracy-of-a-Zero-Shot-classifier-零样本"><a href="#Evaluating-the-accuracy-of-a-Zero-Shot-classifier-零样本" class="headerlink" title="Evaluating the accuracy of a Zero-Shot classifier (零样本)"></a>Evaluating the accuracy of a Zero-Shot classifier (零样本)</h3><p>It looks like the previous classifier is almost perfect but there is a way to understand if it is really accurate and generate an accuracy score.</p><p>We are going to start by downloading this dataset from kaggle and saving it under&#x2F;data&#x2F;News_-Category_Dataset_v3.json.</p><p>This dataset contains around 210k news headlines from 2012 to 2022 from HuffPost.The dataset classifies the headlines of each article into a category.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> openai.embeddings_utils <span class="hljs-keyword">import</span> get_embedding, cosine_similarity<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> precision_score<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br>    <br>init_api()<br><br>categories = [<br>    <span class="hljs-string">&quot;POLITICS&quot;</span>,<br>    <span class="hljs-string">&quot;WELLNESS&quot;</span>,<br>    <span class="hljs-string">&quot;ENTERTAINMENT&quot;</span>,<br>    <span class="hljs-string">&quot;TRAVEL&quot;</span>,<br>    <span class="hljs-string">&quot;STYLE &amp; BEAUTY&quot;</span>,<br>    <span class="hljs-string">&quot;PARENTING&quot;</span>,<br>    <span class="hljs-string">&quot;HEALTHY LIVING&quot;</span>,<br>    <span class="hljs-string">&quot;QUEER VOICES&quot;</span>,<br>    <span class="hljs-string">&quot;FOOD &amp; DRINK&quot;</span>,<br>    <span class="hljs-string">&quot;BUSINESS&quot;</span>,<br>    <span class="hljs-string">&quot;COMEDY&quot;</span>,<br>    <span class="hljs-string">&quot;SPORTS&quot;</span>,<br>    <span class="hljs-string">&quot;BLACK VOICES&quot;</span>,<br>    <span class="hljs-string">&quot;HOME &amp; LIVING&quot;</span>,<br>    <span class="hljs-string">&quot;PARENTS&quot;</span>,<br>]<br><br><span class="hljs-comment"># Define a function to classify a sentence</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">classify_sentence</span>(<span class="hljs-params">sentence</span>):<br>    <span class="hljs-comment"># Get the embedding of the sentence</span><br>    sentence_embedding = get_embedding(sentence, engine=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>)<br>    <span class="hljs-comment"># Calculate the similarity score between the sentence and each category</span><br>    similarity_scores = &#123;&#125;<br>    <span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:<br>        category_embeddings = get_embedding(category, engine=<span class="hljs-string">&quot;text-embedding-ada-002&quot;</span>)<br>        similarity_scores[category] = cosine_similarity(sentence_embedding, category_embeddings)<br>        <span class="hljs-comment"># Return the category with the highest similarity score</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(similarity_scores, key=similarity_scores.get)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_precision</span>(<span class="hljs-params">categories</span>):<br>    <span class="hljs-comment"># Load the dataset</span><br>    df = pd.read_json(<span class="hljs-string">&quot;News_Category_Dataset_v3.json&quot;</span>, lines=<span class="hljs-literal">True</span>).head(<span class="hljs-number">20</span>)<br>    y_true = []<br>    y_pred = []<br>    <br>    <span class="hljs-comment"># Classify each sentence</span><br>    <span class="hljs-keyword">for</span> _, row <span class="hljs-keyword">in</span> df.iterrows():<br>        true_category = row[<span class="hljs-string">&#x27;category&#x27;</span>]<br>        predicted_category = classify_sentence(row[<span class="hljs-string">&#x27;headline&#x27;</span>])<br>        <br>        y_true.append(true_category)<br>        y_pred.append(predicted_category)<br>        <br>        <span class="hljs-comment"># Calculate the precision score</span><br>        <span class="hljs-keyword">return</span> precision_score(y_true, y_pred, average=<span class="hljs-string">&#x27;micro&#x27;</span>, labels=categories)<br>    <br>precision_evaluated = evaluate_precision(categories)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Precision: &#123;:.2f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(precision_evaluated))<br></code></pre></td></tr></table></figure><h2 id="Fine-Tuning-amp-Best-Practices"><a href="#Fine-Tuning-amp-Best-Practices" class="headerlink" title="Fine Tuning &amp; Best Practices"></a>Fine Tuning &amp; Best Practices</h2><h3 id="Few-short-learning-and-example-of-Fine-Tuning-practice"><a href="#Few-short-learning-and-example-of-Fine-Tuning-practice" class="headerlink" title="Few short learning and example of Fine Tuning practice"></a>Few short learning and example of Fine Tuning practice</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1. create a json file with below <span class="hljs-built_in">test</span> prompts</span><br>[<br>&#123;<br>    &quot;prompt&quot;:&quot;When do I have to start the heater?&quot;,<br>    &quot;completion&quot;:&quot;Every day in the morning at 7AM. You should stop it at 2PM&quot;<br>&#125;,<br><br>&#123;<br>    &quot;prompt&quot;:&quot;Where is the garage remote control?&quot;,<br>    &quot;completion&quot;:&quot;Next to the yellow door, on the key ring&quot;<br>&#125;,<br><br>&#123;<br>    &quot;prompt&quot;:&quot;Is it necessary to program the scent diffuser every day?&quot;,<br>    &quot;completion&quot;:&quot;The scent diffuser is already programmed, you just need to recharge it when its battery is low&quot;<br>&#125;<br>]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">2. generate the jasonl file based on the previous json file</span><br>root@c1ws-test:~/jupyter_workspace# cat data.json<br>root@c1ws-test:~/jupyter_workspace# openai tools fine_tunes.prepare_data -f data.json<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. tune the new model based on model: davinci</span><br>root@c1ws-test:~/jupyter_workspace# export OPENAI_API_KEY=&quot;YOUR_API_KEY&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Optional to add suffix of the new model name as below:</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">root@c1ws-test:~/jupyter_workspace<span class="hljs-comment"># openai api fine_tunes.create  -t &quot;data_prepared.jsonl&quot; -m davinci --suffix &quot;felix_yang&quot;</span></span><br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.create  -t &quot;data_prepared.jsonl&quot; -m davinci<br>Upload progress: 100%|████████████████████████████████████████████████████████████████████| 417/417 [00:00&lt;00:00, 540kit/s]<br>Uploaded file from data_prepared.jsonl: file-WIRS3kIX67OFCmGdBKlYhawT<br>Created fine-tune: ft-vs2MUECcW4S92WGroV4xtfuc<br>Streaming events until fine-tuning is complete...<br><br>(Ctrl-C will interrupt the stream, but not cancel the fine-tune)<br>[2023-06-21 03:28:41] Created fine-tune: ft-vs2MUECcW4S92WGroV4xtfuc<br><br>Stream interrupted (client disconnected).<br>To resume the stream, run:<br><br>  openai api fine_tunes.follow -i ft-vs2MUECcW4S92WGroV4xtfuc<br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.follow -i ft-vs2MUECcW4S92WGroV4xtfuc<br>[2023-06-21 03:28:41] Created fine-tune: ft-vs2MUECcW4S92WGroV4xtfuc<br>[2023-06-21 03:29:52] Fine-tune costs $0.01<br>[2023-06-21 03:29:53] Fine-tune enqueued. Queue number: 0<br>[2023-06-21 03:30:05] Fine-tune started<br><br>Stream interrupted (client disconnected).<br>To resume the stream, run:<br><br>  openai api fine_tunes.follow -i ft-vs2MUECcW4S92WGroV4xtfuc<br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.follow -i ft-vs2MUECcW4S92WGroV4xtfuc<br>[2023-06-21 03:28:41] Created fine-tune: ft-vs2MUECcW4S92WGroV4xtfuc<br>[2023-06-21 03:29:52] Fine-tune costs $0.01<br>[2023-06-21 03:29:53] Fine-tune enqueued. Queue number: 0<br>[2023-06-21 03:30:05] Fine-tune started<br>[2023-06-21 03:32:56] Completed epoch 1/4<br>[2023-06-21 03:32:57] Completed epoch 2/4<br>[2023-06-21 03:32:58] Completed epoch 3/4<br>[2023-06-21 03:32:59] Completed epoch 4/4<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">4. Check the new model <span class="hljs-built_in">id</span></span><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.list<br>&#123;<br>  &quot;object&quot;: &quot;list&quot;,<br>  &quot;data&quot;: [<br>    &#123;<br>      &quot;object&quot;: &quot;fine-tune&quot;,<br>      &quot;id&quot;: &quot;ft-vs2MUECcW4S92WGroV4xtfuc&quot;,   ## Fine_tune_job_id<br>      &quot;hyperparams&quot;: &#123;<br>        &quot;n_epochs&quot;: 4,<br>        &quot;batch_size&quot;: 1,<br>        &quot;prompt_loss_weight&quot;: 0.01,<br>        &quot;learning_rate_multiplier&quot;: 0.1<br>      &#125;,<br>      &quot;organization_id&quot;: &quot;org-1kpSRIJZFLe1LzYA6NIMCm20&quot;,<br>      &quot;model&quot;: &quot;davinci&quot;,<br>      &quot;training_files&quot;: [<br>        &#123;<br>          &quot;object&quot;: &quot;file&quot;,<br>          &quot;id&quot;: &quot;file-WIRS3kIX67OFCmGdBKlYhawT&quot;,<br>          &quot;purpose&quot;: &quot;fine-tune&quot;,<br>          &quot;filename&quot;: &quot;data_prepared.jsonl&quot;,<br>          &quot;bytes&quot;: 417,<br>          &quot;created_at&quot;: 1687318121,<br>          &quot;status&quot;: &quot;processed&quot;,<br>          &quot;status_details&quot;: null<br>        &#125;<br>      ],<br>      &quot;validation_files&quot;: [],<br>      &quot;result_files&quot;: [<br>        &#123;<br>          &quot;object&quot;: &quot;file&quot;,<br>          &quot;id&quot;: &quot;file-4lcuZduyevJH94dl7nkf4BPO&quot;,<br>          &quot;purpose&quot;: &quot;fine-tune-results&quot;,<br>          &quot;filename&quot;: &quot;compiled_results.csv&quot;,<br>          &quot;bytes&quot;: 754,<br>          &quot;created_at&quot;: 1687318420,<br>          &quot;status&quot;: &quot;processed&quot;,<br>          &quot;status_details&quot;: null<br>        &#125;<br>      ],<br>      &quot;created_at&quot;: 1687318121,<br>      &quot;updated_at&quot;: 1687318421,<br>      &quot;status&quot;: &quot;succeeded&quot;,<br>      &quot;fine_tuned_model&quot;: &quot;davinci:ft-personal-2023-06-21-03-33-39&quot;  # New model id<br>    &#125;<br>  ]<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">5. Test the new model</span><br><br>root@c1ws-test:~/jupyter_workspace# export FINE_TUNED_MODEL=&quot;davinci:ft-personal-2023-06-21-03-33-39&quot;<br>root@c1ws-test:~/jupyter_workspace# openai api completions.create -m $FINE_TUNED_MODEL -p &quot;When do I have to start the heater?&quot;<br>When do I have to start the heater?When do I have to turn off the A/C?How low can I<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">6. Analyze the new model</span><br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.results -i &quot;ft-vs2MUECcW4S92WGroV4xtfuc&quot;<br>step,elapsed_tokens,elapsed_examples,training_loss,training_sequence_accuracy,training_token_accuracy<br>1,33,1,1.262732845058199,0.0,0.6<br>2,66,2,1.6095716556394473,0.0,0.17647058823529413<br>3,91,3,1.6150656826297443,0.0,0.45454545454545453<br>4,124,4,1.466446138578467,0.0,0.29411764705882354<br>5,149,5,1.484918415422241,0.0,0.45454545454545453<br>6,182,6,1.0398217318346723,0.0,0.55<br>7,215,7,1.0021467336965726,0.0,0.55<br>8,240,8,1.3121158500760792,0.0,0.45454545454545453<br>9,273,9,1.2723229727894068,0.0,0.4117647058823529<br>10,298,10,1.260173139721155,0.0,0.45454545454545453<br>11,331,11,1.2538491002004593,0.0,0.47058823529411764<br>12,364,12,0.9169519251119346,0.0,0.55<br>13,397,13,1.246762776928954,0.0,0.4117647058823529<br>14,422,14,1.242958545796573,0.0,0.45454545454545453<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">7. Delete the model</span><br>- CLI:<br>root@c1ws-test:~/jupyter_workspace# openai api models.delete -i &quot;davinci:ft-personal-2023-06-21-03-33-39&quot;<br>&#123;<br>  &quot;id&quot;: &quot;davinci:ft-personal-2023-06-21-03-33-39&quot;,<br>  &quot;object&quot;: &quot;model&quot;,<br>  &quot;deleted&quot;: true<br>&#125;<br><br>- Python<br>openai.Model.delete(&quot;davinci:ft-personal-2023-06-21-03-33-39&quot;)<br><br>- cURL<br>curl -X &quot;DELETE&quot; https://api.openai.com/v1/models/&lt;FINE_TUNED_MODEL&gt; -H &quot;Authorization: Bearer $OPENAI_API_KEY&quot;<br><br></code></pre></td></tr></table></figure><h3 id="What’s-the-best-practice-Datasets-Prompts-and-Completions"><a href="#What’s-the-best-practice-Datasets-Prompts-and-Completions" class="headerlink" title="What’s the best practice - Datasets, Prompts and Completions"></a>What’s the best practice - Datasets, Prompts and Completions</h3><ul><li>Each Prompt Should End With a Fixed Separator</li><li>Each Completion Should Start With a Whitespace</li><li>Each Completion Should End With a Fixed-Stop Sequence</li><li>Fine-Tuning Performs Better With More High-Quality Examples</li><li>For the dataset, converting the input data into natural language will likely result in better performance. This is evenclearer when you are building a generative model.</li><li>Review Your Data for Offensive Content</li><li>Review the Type and Structure of Your Dataset</li><li>Analyze Your Model</li></ul><blockquote><p>root@c1ws-test:~&#x2F;jupyter_workspace# openai api fine_tunes.results -i “ft-vs2MUECcW4S92WGroV4xtfuc”<br>step,elapsed_tokens,elapsed_examples,training_loss,training_sequence_accuracy,training_token_accuracy<br>1,33,1,1.262732845058199,0.0,0.6<br>2,66,2,1.6095716556394473,0.0,0.17647058823529413<br>3,91,3,1.6150656826297443,0.0,0.45454545454545453<br>4,124,4,1.466446138578467,0.0,0.29411764705882354<br>5,149,5,1.484918415422241,0.0,0.45454545454545453<br>6,182,6,1.0398217318346723,0.0,0.55<br>7,215,7,1.0021467336965726,0.0,0.55<br>8,240,8,1.3121158500760792,0.0,0.45454545454545453<br>9,273,9,1.2723229727894068,0.0,0.4117647058823529<br>10,298,10,1.260173139721155,0.0,0.45454545454545453<br>11,331,11,1.2538491002004593,0.0,0.47058823529411764<br>12,364,12,0.9169519251119346,0.0,0.55<br>13,397,13,1.246762776928954,0.0,0.4117647058823529<br>14,422,14,1.242958545796573,0.0,0.45454545454545453</p><ol><li>“step”: This column shows the training step number or the number of iterations of the trainingprocess.</li><li>“elapsed_tokens”: Shows the number of tokens processed by the training process so far. A token is a unit of text, such as a word or a punctuation mark.</li><li>“elapsed_examples”: This is the number of examples (i.e., pieces of text) processed by the training process so far.</li><li>“training_loss”: This number shows the value of the loss function during training. (The loss function is a measure of how well the model is performing, with lower values indicating better performance.)</li><li>“training_sequence_accuracy”: The accuracy of the model in predicting the next sequence of tokens. (A sequence is a group of tokens that form a meaningful unit, such as a sentence or a paragraph.)</li><li>“training_token_accuracy”: This value tells us about the accuracy of the model in predicting individual tokens.<br>Some third-party tools, such as wandb⁴⁰, can also be used to analyze the results.</li></ol></blockquote><ul><li>Use validation data if needed</li></ul><blockquote><p>openai api fine_tunes.create -t train_data.jsonl -v validation_data.jsonl -m <engine></p></blockquote><ul><li><p>Tweak the Hyperparameters</p><ul><li>n_epochs</li><li>batch_size</li><li>learning_rate_multiplier</li></ul></li><li><p>Use Ada</p><ul><li>When tackling classification problems, the Ada model is a good option. It performs only slightly<br>worse than Davinci once fine-tuned, at the same time it is considerably faster and more affordable</li></ul></li><li><p>Use Single-Token Classes</p><ul><li>save token numbers</li><li>much fast<ul><li>“sports and entertainment”:</li><li>{prompt:”The Los Angeles Lakers won the NBA championship last year.”, completion: “sports and entertainment”}</li><li>1(for sports and entertainment):</li><li>{prompt:”The Los Angeles Lakers won the NBA championship last year.”, completion: “1”}</li></ul></li></ul></li><li><p>Other Considerations for Classification</p><ul><li>Ensure that the prompt and completion combined do not exceed 2048 tokens, including the separator.</li><li>Try to provide at least 100 examples for each class.</li><li>The separator should not be used within the prompt text. You should remove it from the prompt if it’s the case. Example: If your separator is !#! you should preprocess the text of the prompt to remove any !#!</li></ul></li></ul><h2 id="Advanced-Fine-Tuning-Drug-Classification"><a href="#Advanced-Fine-Tuning-Drug-Classification" class="headerlink" title="Advanced Fine Tuning: Drug Classification"></a>Advanced Fine Tuning: Drug Classification</h2><h3 id="Dataset-Used-in-the-Example"><a href="#Dataset-Used-in-the-Example" class="headerlink" title="Dataset Used in the Example"></a>Dataset Used in the Example</h3><p>In this example, we are going to use a public dataset containing drug names and the correspoinding malady, illness, or condition that they are used to treat.</p><p>We are going to create a model and “teach” it to predict the output based on user input.</p><p>The user input is the name of the drug and the output is the name of malady.<br>The dataset is available at Kaggle.com, you will need to download using the following URL:<br><a href="https://www.kaggle.com/datasets/saratchendra/medicine-recommendation/download?datase%5CtVersionNumber=1">https://www.kaggle.com/datasets/saratchendra/medicine-recommendation/download?datase\tVersionNumber=1</a></p><ul><li>Use sheet1</li><li>Use first and second column:  drug_name and reason<ul><li>A CN Gel(Topical) 20gmA CN Soap 75gm &#x3D;&#x3D;&gt; Acne</li><li>PPG Trio 1mg Tablet 10’SPPG Trio 2mg Tablet 10’S &#x3D;&#x3D;&gt; Diabetes</li><li>Iveomezoled 200mg Injection 500ml &#x3D;&#x3D;&gt; Fungal</li></ul></li></ul><h3 id="Preparing-the-Data-and-Launching-the-Fine-Tuning"><a href="#Preparing-the-Data-and-Launching-the-Fine-Tuning" class="headerlink" title="Preparing the Data and Launching the Fine Tuning"></a>Preparing the Data and Launching the Fine Tuning</h3><ul><li><p>We are going to use below format:</p><ul><li>{“prompt”:”Drug: <DRUG NAME>\nMalady:”,”completion”:” <MALADY NAME>“}</li></ul></li><li><p>As you can see, we will be using \nMalady: as a separator.</p></li></ul><blockquote><p>The completion will also start with a whitespace. Remember to start each completion with a<br>whitespace due to tokenization (most words are tokenized with preceding whitespace.)<br>Also, we have learned that each completion should end with a fixed stop sequence to inform the<br>model when the completion ends. for example \n, ###, END, or any other token that does not appear<br>in the completion.<br>However, in our case, this is not necessary as we are going to use a single token for classification.<br>Basically, we are going to give each malady a unique identifier. For example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">Acne: 1<br>Allergies: 2<br>Alzheimer: 3<br>..etc<br></code></pre></td></tr></table></figure><p>This way, the model will return a single token at inference time in all cases. This is the reason why<br>the stop sequence is not necessary.<br>To begin, use Pandas to transform the data into the desired format</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install openpyxl<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-comment"># read the first n rows</span><br>n = <span class="hljs-number">2000</span><br><br>df = pd.read_excel(<span class="hljs-string">&#x27;Medicine_description.xlsx&#x27;</span>, sheet_name=<span class="hljs-string">&#x27;Sheet1&#x27;</span>, header=<span class="hljs-number">0</span>, nrows=n)<br><br><span class="hljs-comment"># get the unique values in the Reason column</span><br>reasons = df[<span class="hljs-string">&quot;Reason&quot;</span>].unique()<br><br><span class="hljs-comment"># assign a number to each reason</span><br>reasons_dict = &#123;reason: i <span class="hljs-keyword">for</span> i, reason <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(reasons)&#125;<br><br><span class="hljs-comment"># add a new line and ### to the end of each description</span><br>df[<span class="hljs-string">&quot;Drug_Name&quot;</span>] = <span class="hljs-string">&quot;Drug: &quot;</span> + df[<span class="hljs-string">&quot;Drug_Name&quot;</span>] + <span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;Malady:&quot;</span><br><br><span class="hljs-comment"># concatenate the Reason and Description columns</span><br>df[<span class="hljs-string">&quot;Reason&quot;</span>] = <span class="hljs-string">&quot; &quot;</span> + df[<span class="hljs-string">&quot;Reason&quot;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-string">&quot;&quot;</span> + <span class="hljs-built_in">str</span>(reasons_dict[x]))<br><br><span class="hljs-comment"># drop the Reason column</span><br>df.drop([<span class="hljs-string">&quot;Description&quot;</span>], axis=<span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># rename the columns</span><br>df.rename(columns=&#123;<span class="hljs-string">&quot;Drug_Name&quot;</span>: <span class="hljs-string">&quot;prompt&quot;</span>, <span class="hljs-string">&quot;Reason&quot;</span>: <span class="hljs-string">&quot;completion&quot;</span>&#125;, inplace=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># convert the dataframe to jsonl format</span><br>jsonl = df.to_json(orient=<span class="hljs-string">&quot;records&quot;</span>, indent=<span class="hljs-number">0</span>, lines=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># write the jsonl to a file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;drug_malady_data.jsonl&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(jsonl)<br></code></pre></td></tr></table></figure><p>snippet of the generated file: drug_malady_data.jsonl</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs swift">&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: A CN Gel(Topical) 20gmA CN Soap 75gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: A Ret 0.05% Gel 20gmA Ret 0.1% Gel 20gmA Ret 0.025% Gel 20gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: ACGEL CL NANO Gel 15gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: ACGEL NANO Gel 15gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acleen 1% Lotion 25ml<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Aclene 0.10% Gel 15gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acnay Gel 10gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acne Aid Bar 50gmAcne Aid Bar 100gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acne UV Gel 60gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acne UV SPF 30 Gel 30gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acnecure Gel 20gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;prompt&quot;</span>:<span class="hljs-string">&quot;Drug: Acnedap Gel 15gm<span class="hljs-subst">\n</span>Malady:&quot;</span>,<span class="hljs-string">&quot;completion&quot;</span>:<span class="hljs-string">&quot; 0&quot;</span>&#125;<br><span class="hljs-operator">...</span><br><br></code></pre></td></tr></table></figure><p>Now we need to train the module for a new model based on the jsonl file. Here’re the details:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@c1ws-test:~/jupyter_workspace# openai tools fine_tunes.prepare_data -f drug_malady_data.jsonl<br>Analyzing...<br><br>- Your file contains 2000 prompt-completion pairs<br>- Based on your data it seems like you&#x27;re trying to fine-tune a model for classification<br>- For classification, we recommend you try one of the faster and cheaper models, such as `ada`<br>- For classification, you can estimate the expected model performance by keeping a held out dataset, which is not used fortraining<br>- All prompts end with suffix `\nMalady:`<br>- All prompts start with prefix `Drug: `<br><br>No remediations found.<br>- [Recommended] Would you like to split into training and validation set? [Y/n]: Y<br><br><br>Your data will be written to a new JSONL file. Proceed [Y/n]: Y<br><br>Wrote modified files to `drug_malady_data_prepared_train.jsonl` and `drug_malady_data_prepared_valid.jsonl`<br>Feel free to take a look!<br><br>Now use that file when fine-tuning:<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">openai api fine_tunes.create -t <span class="hljs-string">&quot;drug_malady_data_prepared_train.jsonl&quot;</span> -v <span class="hljs-string">&quot;drug_malady_data_prepared_valid.jsonl&quot;</span> --compute_classification_metrics --classification_n_classes 7</span><br><br>After you’ve fine-tuned a model, remember that your prompt has to end with the indicator string `\nMalady:` for the model to start generating completions, rather than continuing with the prompt.<br>Once your model starts training, it&#x27;ll approximately take 50.33 minutes to train a `curie` model, and less for `ada` and `babbage`. Queue will approximately take half an hour per job ahead of you.<br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.create \<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">-t <span class="hljs-string">&quot;drug_malady_data_prepared_train.jsonl&quot;</span> \</span><br><span class="language-bash">&gt; -v <span class="hljs-string">&quot;drug_malady_data_prepared_valid.jsonl&quot;</span> \</span><br><span class="language-bash">&gt; --compute_classification_metrics \</span><br><span class="language-bash">&gt; --classification_n_classes 7 \</span><br><span class="language-bash">&gt; -m ada \</span><br><span class="language-bash">&gt; --suffix <span class="hljs-string">&quot;drug_malady_data&quot;</span></span><br>Error: No API key provided. You can set your API key in code using &#x27;openai.api_key = &lt;API-KEY&gt;&#x27;, or you can set the environment variable OPENAI_API_KEY=&lt;API-KEY&gt;). If your API key is stored in a file, you can point the openai module at it with &#x27;openai.api_key_path = &lt;PATH&gt;&#x27;. You can generate API keys in the OpenAI web interface. See https://platform.openai.com/account/api-keys for details.<br><br><br>root@c1ws-test:~/jupyter_workspace# export OPENAI_API_KEY=&quot;&lt;your key&gt;&quot;<br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.create -t &quot;drug_malady_data_prepared_train.jsonl&quot; -v &quot;drug_malady_data_prepared_valid.jsonl&quot; --compute_classification_metrics --classification_n_classes 7 -m ada --suffix &quot;drug_malady_data&quot;<br>Upload progress: 100%|██████████████████████████████████████████████████████████████████| 128k/128k [00:00&lt;00:00, 187Mit/s]<br>Uploaded file from drug_malady_data_prepared_train.jsonl: file-0NFPDCuDyX1nfLv3dFuarPDr<br>Upload progress: 100%|███████████████████████████████████████████████████████████████| 32.0k/32.0k [00:00&lt;00:00, 59.6Mit/s]<br>Uploaded file from drug_malady_data_prepared_valid.jsonl: file-kxzT0UhZZRwam7RfjYIFcuTF<br>Created fine-tune: ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br>Streaming events until fine-tuning is complete...<br><br>(Ctrl-C will interrupt the stream, but not cancel the fine-tune)<br>[2023-06-21 08:54:19] Created fine-tune: ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br><br>Stream interrupted (client disconnected).<br>To resume the stream, run:<br><br>  openai api fine_tunes.follow -i ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.follow -i ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br>[2023-06-21 08:54:19] Created fine-tune: ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br>[2023-06-21 08:56:36] Fine-tune costs $0.05<br>[2023-06-21 08:56:36] Fine-tune enqueued. Queue number: 20<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">It took mroe than 1 hour to complete the model training</span><br><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.follow -i ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br>[2023-06-21 08:54:19] Created fine-tune: ft-zk8Ojv3J1Nj1HpzRdicC2iPL<br>[2023-06-21 08:56:36] Fine-tune costs $0.05<br>[2023-06-21 08:56:36] Fine-tune enqueued. Queue number: 20<br>[2023-06-21 09:06:35] Fine-tune is in the queue. Queue number: 19<br>[2023-06-21 09:06:39] Fine-tune is in the queue. Queue number: 18<br>[2023-06-21 09:07:09] Fine-tune is in the queue. Queue number: 17<br>[2023-06-21 09:08:12] Fine-tune is in the queue. Queue number: 16<br>[2023-06-21 09:09:27] Fine-tune is in the queue. Queue number: 15<br>[2023-06-21 09:10:00] Fine-tune is in the queue. Queue number: 14<br>[2023-06-21 09:10:55] Fine-tune is in the queue. Queue number: 13<br>[2023-06-21 09:11:40] Fine-tune is in the queue. Queue number: 12<br>[2023-06-21 09:13:14] Fine-tune is in the queue. Queue number: 11<br>[2023-06-21 09:13:48] Fine-tune is in the queue. Queue number: 10<br>[2023-06-21 09:15:02] Fine-tune is in the queue. Queue number: 9<br>[2023-06-21 09:15:08] Fine-tune is in the queue. Queue number: 8<br>[2023-06-21 09:18:55] Fine-tune is in the queue. Queue number: 7<br>[2023-06-21 09:19:27] Fine-tune is in the queue. Queue number: 6<br>[2023-06-21 09:30:57] Fine-tune is in the queue. Queue number: 5<br>[2023-06-21 09:32:08] Fine-tune is in the queue. Queue number: 4<br>[2023-06-21 09:32:29] Fine-tune is in the queue. Queue number: 3<br>[2023-06-21 09:33:03] Fine-tune is in the queue. Queue number: 2<br>[2023-06-21 09:33:54] Fine-tune is in the queue. Queue number: 1<br>[2023-06-21 09:37:01] Fine-tune is in the queue. Queue number: 0<br>[2023-06-21 09:37:21] Fine-tune started<br>[2023-06-21 09:42:31] Completed epoch 1/4<br>[2023-06-21 09:52:33] Completed epoch 3/4<br>[2023-06-21 09:57:33] Completed epoch 4/4<br>[2023-06-21 09:58:06] Uploaded model: ada:ft-personal:drug-malady-data-2023-06-21-09-58-05<br>[2023-06-21 09:58:07] Uploaded result file: file-tzqW6Vjcqg9thdkCBzgihH8M<br>[2023-06-21 09:58:07] Fine-tune succeeded<br><br>Job complete! Status: succeeded 🎉<br>Try out your fine-tuned model:<br><br>openai api completions.create -m ada:ft-personal:drug-malady-data-2023-06-21-09-58-05 -p &lt;YOUR_PROMPT&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">List the generated new models</span><br>root@c1ws-test:~/jupyter_workspace# openai api fine_tunes.list<br>&#123;<br>  &quot;object&quot;: &quot;list&quot;,<br>  &quot;data&quot;: [<br>    &#123;<br>      &quot;object&quot;: &quot;fine-tune&quot;,<br>      &quot;id&quot;: &quot;ft-zk8Ojv3J1Nj1HpzRdicC2iPL&quot;,<br>      &quot;hyperparams&quot;: &#123;<br>        &quot;n_epochs&quot;: 4,<br>        &quot;batch_size&quot;: 2,<br>        &quot;prompt_loss_weight&quot;: 0.01,<br>        &quot;classification_n_classes&quot;: 7,<br>        &quot;learning_rate_multiplier&quot;: 0.1,<br>        &quot;compute_classification_metrics&quot;: true<br>      &#125;,<br>      &quot;organization_id&quot;: &quot;org-1kpSRIJZFLe1LzYA6NIMCm20&quot;,<br>      &quot;model&quot;: &quot;ada&quot;,<br>      &quot;training_files&quot;: [<br>        &#123;<br>          &quot;object&quot;: &quot;file&quot;,<br>          &quot;id&quot;: &quot;file-0NFPDCuDyX1nfLv3dFuarPDr&quot;,<br>          &quot;purpose&quot;: &quot;fine-tune&quot;,<br>          &quot;filename&quot;: &quot;drug_malady_data_prepared_train.jsonl&quot;,<br>          &quot;bytes&quot;: 128249,<br>          &quot;created_at&quot;: 1687337657,<br>          &quot;status&quot;: &quot;processed&quot;,<br>          &quot;status_details&quot;: null<br>        &#125;<br>      ],<br>      &quot;validation_files&quot;: [<br>        &#123;<br>          &quot;object&quot;: &quot;file&quot;,<br>          &quot;id&quot;: &quot;file-kxzT0UhZZRwam7RfjYIFcuTF&quot;,<br>          &quot;purpose&quot;: &quot;fine-tune&quot;,<br>          &quot;filename&quot;: &quot;drug_malady_data_prepared_valid.jsonl&quot;,<br>          &quot;bytes&quot;: 32007,<br>          &quot;created_at&quot;: 1687337659,<br>          &quot;status&quot;: &quot;processed&quot;,<br>          &quot;status_details&quot;: null<br>        &#125;<br>      ],<br>      &quot;result_files&quot;: [<br>        &#123;<br>          &quot;object&quot;: &quot;file&quot;,<br>          &quot;id&quot;: &quot;file-tzqW6Vjcqg9thdkCBzgihH8M&quot;,<br>          &quot;purpose&quot;: &quot;fine-tune-results&quot;,<br>          &quot;filename&quot;: &quot;compiled_results.csv&quot;,<br>          &quot;bytes&quot;: 168489,<br>          &quot;created_at&quot;: 1687341486,<br>          &quot;status&quot;: &quot;processed&quot;,<br>          &quot;status_details&quot;: null<br>        &#125;<br>      ],<br>      &quot;created_at&quot;: 1687337659,<br>      &quot;updated_at&quot;: 1687341487,<br>      &quot;status&quot;: &quot;succeeded&quot;,<br>      &quot;fine_tuned_model&quot;: &quot;ada:ft-personal:drug-malady-data-2023-06-21-09-58-05&quot;  ---&gt; fine tuned model ID<br>    &#125;<br>  ]<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Simple Test the new model</span><br>root@c1ws-test:~/jupyter_workspace# openai api completions.create -m ada:ft-personal:drug-malady-data-2023-06-21-09-58-05 -p &quot;What is &#x27;A CN Gel(Topical) 20gmA CN Soap 75gm&#x27; used for?&quot;<br>What is &#x27;A CN Gel(Topical) 20gmA CN Soap 75gm&#x27; used for? 0.0% Gel(Topical) 60gm<br><br></code></pre></td></tr></table></figure><h3 id="Testing-the-Fine-Tuned-Model"><a href="#Testing-the-Fine-Tuned-Model" class="headerlink" title="Testing the Fine Tuned Model"></a>Testing the Fine Tuned Model</h3><p>When the model is ready, you can test with below code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br>    <br>init_api()<br><br><span class="hljs-comment"># Configure the model ID. Change this to your model ID.</span><br>model = <span class="hljs-string">&quot;ada:ft-personal:drug-malady-data-2023-06-21-09-58-05&quot;</span><br><br><span class="hljs-comment"># Let&#x27;s use a drug from each class</span><br>drugs = [<br>    <span class="hljs-string">&quot;A CN Gel(Topical) 20gmA CN Soap 75gm&quot;</span>, <span class="hljs-comment"># Class 0</span><br>    <span class="hljs-string">&quot;Addnok Tablet 20&#x27;S&quot;</span>, <span class="hljs-comment"># Class 1</span><br>    <span class="hljs-string">&quot;ABICET M Tablet 10&#x27;s&quot;</span>, <span class="hljs-comment"># Class 2</span><br>]<br><br>class_map = &#123;<br>    <span class="hljs-number">0</span>: <span class="hljs-string">&quot;Acne&quot;</span>,<br>    <span class="hljs-number">1</span>: <span class="hljs-string">&quot;Adhd&quot;</span>,<br>    <span class="hljs-number">2</span>: <span class="hljs-string">&quot;Allergies&quot;</span>,<br>    <span class="hljs-comment"># ...</span><br>&#125;<br><br><span class="hljs-comment"># Returns a drug class for each drug</span><br><span class="hljs-keyword">for</span> drug_name <span class="hljs-keyword">in</span> drugs:<br>    prompt = <span class="hljs-string">&quot;Drug: &#123;&#125;\nMalady:&quot;</span>.<span class="hljs-built_in">format</span>(drug_name)<br>    response = openai.Completion.create(<br>        model=model,<br>        prompt= prompt,<br>        temperature=<span class="hljs-number">1</span>,<br>        max_tokens=<span class="hljs-number">1</span>,<br>    )<br>    response = response.choices[<span class="hljs-number">0</span>].text<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(drug_name + <span class="hljs-string">&quot; is used for &quot;</span> + class_map[<span class="hljs-built_in">int</span>(response)])<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I don&#x27;t know what &quot;</span> + drug_name + <span class="hljs-string">&quot; is used for.&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure><h2 id="Advanced-Fine-Tuning-Creating-a-Chatbot-Assitant"><a href="#Advanced-Fine-Tuning-Creating-a-Chatbot-Assitant" class="headerlink" title="Advanced Fine Tuning: Creating a Chatbot Assitant"></a>Advanced Fine Tuning: Creating a Chatbot Assitant</h2><p>Based on previous truning model, the goal of this chapter is to create a chatbot with clarification more human friendly. </p><h3 id="Interactive-Classification"><a href="#Interactive-Classification" class="headerlink" title="Interactive Classification"></a>Interactive Classification</h3><p>Three functions defined:</p><ul><li>regular_discussion()</li><li>get_malady_name()</li><li>get_malady_description()</li></ul><p>The end user, when asking about a drug name will get the malady(from the fine-tuned model) and its description(from Davinci).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_api</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;.env&#x27;</span>) <span class="hljs-keyword">as</span> env:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> env:<br>            key, value = line.strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)<br>            os.environ[key] = value<br>    <br>    openai.api_key = os.environ.get(<span class="hljs-string">&quot;API_KEY&quot;</span>)<br>    <br>init_api()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">regular_discussion</span>(<span class="hljs-params">prompt</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    params: prompt - a string</span><br><span class="hljs-string">    Returns a response from the API using Davinci.</span><br><span class="hljs-string">    If the user asks about a drug, the function will call get_malady_name()</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    prompt = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    The following is a conversation with an AI assistant. The assistant is helpful, \</span><br><span class="hljs-string">    creative, clever, very friendly and careful with Human&#x27;s health topics</span><br><span class="hljs-string">    The AI assistant is not a doctor and does not diagnose or treat medical conditions to Human</span><br><span class="hljs-string">    The AI assistant is not a pharmacist and does not dispense or recommend medications to Human</span><br><span class="hljs-string">    The AI assistant does not provide medical advice to Human</span><br><span class="hljs-string">    The AI assistant does not provide medical and health diagnosis to Human</span><br><span class="hljs-string">    The AI assistant does not provide medical treatment to Human</span><br><span class="hljs-string">    The AI assistant does not provide medical prescriptions to Human</span><br><span class="hljs-string">    If Human writes the name of a drug the assistant will reply with &quot;######&quot;.</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    Human: Hi</span><br><span class="hljs-string">    AI: Hello Human. How are you? I&#x27;ll be glad to help. Give me the name of a drug a\</span><br><span class="hljs-string">    nd I&#x27;ll tell you what it&#x27;s used for.</span><br><span class="hljs-string">    Human: Vitibex</span><br><span class="hljs-string">    AI: ######</span><br><span class="hljs-string">    Human: I&#x27;m fine. How are you?</span><br><span class="hljs-string">    AI: I am fine. Thank you for asking. I&#x27;ll be glad to help. Give me the name of a\</span><br><span class="hljs-string">    drug and I&#x27;ll tell you what it&#x27;s used for.</span><br><span class="hljs-string">    Human: What is Chaos Engineering?</span><br><span class="hljs-string">    AI: I&#x27;m sorry, I am not qualified to do that. I&#x27;m only programmed to answer ques\</span><br><span class="hljs-string">    tions about drugs. Give me the name of a drug and I&#x27;ll tell you what it&#x27;s used for.</span><br><span class="hljs-string">    Human: Where is Carthage?</span><br><span class="hljs-string">    AI: I&#x27;m sorry, I am not qualified to do that. I&#x27;m only programmed to answer ques\</span><br><span class="hljs-string">    tions about drugs. Give me the name of a drug and I&#x27;ll tell you what it&#x27;s used for.</span><br><span class="hljs-string">    Human: What is Maxcet 5mg Tablet 10&#x27;S?</span><br><span class="hljs-string">    AI: ######</span><br><span class="hljs-string">    Human: What is Axepta?</span><br><span class="hljs-string">    AI: ######</span><br><span class="hljs-string">    Human: &#123;&#125;</span><br><span class="hljs-string">    AI:&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(prompt)<br>    <br>    <span class="hljs-comment"># Get the response from API</span><br>    response = openai.Completion.create(<br>        model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>        prompt=prompt,<br>        max_tokens=<span class="hljs-number">100</span>,<br>        stop=[<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;Human:&#x27;</span>, <span class="hljs-string">&#x27;AI:&#x27;</span>],<br>    )<br>    <br>    <span class="hljs-keyword">if</span> response.choices[<span class="hljs-number">0</span>].text.strip() == <span class="hljs-string">&quot;######&quot;</span>:<br>        get_malady_name(prompt)<br>    <span class="hljs-keyword">else</span>:<br>        final_response = response.choices[<span class="hljs-number">0</span>].text.strip() + <span class="hljs-string">&#x27;\n&#x27;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;AI: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(final_response))<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_malady_name</span>(<span class="hljs-params">drug_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    params: drug_name - a string</span><br><span class="hljs-string">    Returns a malady name that corresponds to a drug name from the fine-tuned model.</span><br><span class="hljs-string">    The function will call get_malady_description() to get a description of the malady.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># Configure the model ID. Change this to your model ID.</span><br>    model = <span class="hljs-string">&quot;ada:ft-personal:drug-malady-data-2023-06-21-09-58-05&quot;</span><br>    class_map = &#123;<br>        <span class="hljs-number">0</span>: <span class="hljs-string">&quot;Acne&quot;</span>,<br>        <span class="hljs-number">1</span>: <span class="hljs-string">&quot;Adhd&quot;</span>,<br>        <span class="hljs-number">2</span>: <span class="hljs-string">&quot;Allergies&quot;</span>,<br>        <span class="hljs-comment"># ...</span><br>    &#125;<br>    <br>    <span class="hljs-comment"># Returns a drug class for each drug</span><br>    prompt = <span class="hljs-string">&quot;Drug: &#123;&#125;\nMalady:&quot;</span>.<span class="hljs-built_in">format</span>(drug_name)<br>    response = openai.Completion.create(<br>        model=model,<br>        prompt=prompt,<br>        temperature=<span class="hljs-number">1</span>,<br>        max_tokens=<span class="hljs-number">1</span>, <br>    )<br>    <br>    response = response.choices[<span class="hljs-number">0</span>].text.strip()<br>    <span class="hljs-keyword">try</span>:<br>        malady = class_map[<span class="hljs-built_in">int</span>(response)]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;AI: This drug used for &#123;&#125;.&quot;</span>.<span class="hljs-built_in">format</span>(malady))<br>        <span class="hljs-built_in">print</span>(get_malady_description(malady))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;AI: I don&#x27;t know what &#x27;&quot;</span> + drug_name + <span class="hljs-string">&quot;&#x27; is used for.&quot;</span>)<br>        <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_malady_description</span>(<span class="hljs-params">malady</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    params: drug_name - a string</span><br><span class="hljs-string">    Get a description of a malady from the API using Davinci.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    prompt = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    The following is a conversation with an AI assistant. The assistant is helpful, \</span><br><span class="hljs-string">    creative, clever, and very friendly.</span><br><span class="hljs-string">    The assistant does not provide medical advice. It only defines a malady, a disea\</span><br><span class="hljs-string">    se, or a condition.</span><br><span class="hljs-string">    If the assistant does not know the answer to a question, it will ask to rephrase\</span><br><span class="hljs-string">    it.</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    Q: What is &#123;&#125;?</span><br><span class="hljs-string">    A:&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(malady)<br>    <br>    <span class="hljs-comment"># Get the response from the API</span><br>    response = openai.Completion.create(<br>        model=<span class="hljs-string">&quot;text-davinci-003&quot;</span>,<br>        prompt=prompt,<br>        max_tokens=<span class="hljs-number">100</span>,<br>        stop=[<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;Q:&#x27;</span>, <span class="hljs-string">&#x27;A:&#x27;</span>],<br>    )<br>    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].text.strip()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        regular_discussion(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Human:&quot;</span>))<br></code></pre></td></tr></table></figure><pre><code class="hljs">Human:What is FantanylAI: This drug used for Allergies.Allergies are a common condition caused by an overly sensitive immune system. Symptoms usually include sneezing, runny nose, itchy eyes, and skin rash. Allergies can be triggered by something in the environment, such as pollen, pet hair, dust, or certain foods.---------------------------------------------------------------------------KeyboardInterrupt                         Traceback (most recent call last)Cell In[3], line 129    127 if __name__ == &#39;__main__&#39;:    128     while True:--&gt; 129         regular_discussion(input(&quot;Human:&quot;))File ~/.local/lib/python3.8/site-packages/ipykernel/kernelbase.py:1191, in Kernel.raw_input(self, prompt)   1189     msg = &quot;raw_input was called, but this frontend does not support input requests.&quot;   1190     raise StdinNotImplementedError(msg)-&gt; 1191 return self._input_request(   1192     str(prompt),   1193     self._parent_ident[&quot;shell&quot;],   1194     self.get_parent(&quot;shell&quot;),   1195     password=False,   1196 )File ~/.local/lib/python3.8/site-packages/ipykernel/kernelbase.py:1234, in Kernel._input_request(self, prompt, ident, parent, password)   1231 except KeyboardInterrupt:   1232     # re-raise KeyboardInterrupt, to truncate traceback   1233     msg = &quot;Interrupted by user&quot;-&gt; 1234     raise KeyboardInterrupt(msg) from None   1235 except Exception:   1236     self.log.warning(&quot;Invalid Message:&quot;, exc_info=True)KeyboardInterrupt: Interrupted by user</code></pre><h2 id="Intelligent-Speech-Recognition-Using-OpenAI-Whisper"><a href="#Intelligent-Speech-Recognition-Using-OpenAI-Whisper" class="headerlink" title="Intelligent Speech Recognition Using OpenAI Whisper"></a>Intelligent Speech Recognition Using OpenAI Whisper</h2>]]></content>
    
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>AI</tag>
      
      <tag>GPT</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo 博客搭建</title>
    <link href="/2023/05/28/hexo-bo-ke-da-jian/"/>
    <url>/2023/05/28/hexo-bo-ke-da-jian/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><hr><h1 id="博客基本搭建"><a href="#博客基本搭建" class="headerlink" title="博客基本搭建"></a>博客基本搭建</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p><a href="https://hexo.io/docs/">Hero 文档</a></p><p>Hexo is a fast, simple and powerful blog framework. You write posts in <a href="http://daringfireball.net/projects/markdown/">Markdown</a> (or other markup languages) and Hexo generates static files with a beautiful theme in seconds.</p><h3 id="安装node-和-npm"><a href="#安装node-和-npm" class="headerlink" title="安装node 和 npm"></a>安装node 和 npm</h3><blockquote><p>推荐使用brew install 安装node，安装node会自动安装npm</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install node<br>node -v<br></code></pre></td></tr></table></figure><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-cli -g<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">hexo 在5.0 之后把swig 删除了，需要手动安装，否则会出现加载theme 出错的问题</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">https://blog.csdn.net/qq_39898645/article/details/109181736</span><br><br>npm install hexo-renderer-swig<br></code></pre></td></tr></table></figure><h2 id="利用Hexo-搭建一个博客"><a href="#利用Hexo-搭建一个博客" class="headerlink" title="利用Hexo 搭建一个博客"></a>利用Hexo 搭建一个博客</h2><h3 id="创建博客目录-felixyh-github-io"><a href="#创建博客目录-felixyh-github-io" class="headerlink" title="创建博客目录 felixyh.github.io"></a>创建博客目录 felixyh.github.io</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init felixyh.github.io<br>cd felixyh.github.io<br>npm install<br></code></pre></td></tr></table></figure><h3 id="生成静态页面"><a href="#生成静态页面" class="headerlink" title="生成静态页面"></a>生成静态页面</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br>hexo g<br></code></pre></td></tr></table></figure><h3 id="本地运行"><a href="#本地运行" class="headerlink" title="本地运行"></a>本地运行</h3><blockquote><p>打开浏览器，输入地址 <strong>localhost:4000</strong> 即可看到效果</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><h2 id="Hexo-基本使用"><a href="#Hexo-基本使用" class="headerlink" title="Hexo 基本使用"></a>Hexo 基本使用</h2><h3 id="文章发布"><a href="#文章发布" class="headerlink" title="文章发布"></a>文章发布</h3><ul><li><p>命令行模式</p><ul><li><p>生成文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new test<br></code></pre></td></tr></table></figure><p>在**source&#x2F;_posts&#x2F;**中生成<code>test.md</code>文件，输入内容，并且保存</p></li><li><p>生成静态页面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br>hexo g<br>hexo s<br></code></pre></td></tr></table></figure></li></ul></li><li><p>直接在**source&#x2F;_posts&#x2F;**创建<code>.md</code>文件</p></li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>网站的设置大部分都在**_config.yml**文件中，详细配置可以查看<a href="https://hexo.io/zh-cn/docs/configuration.html">官方文档</a></p><p>下面只列出简单常用配置</p><ul><li><strong>title</strong> -&gt; 网站标题</li><li><strong>subtitle</strong> -&gt; 网站副标题</li><li><strong>description</strong> -&gt; 网站描述</li><li><strong>author</strong> -&gt; 您的名字</li><li><strong>language</strong> -&gt; 网站使用的语言</li></ul><p>坑：<strong>进行配置时，需要在冒号:后加一个英文空格</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">Droidlover</span><br></code></pre></td></tr></table></figure><h3 id="增加评论功能"><a href="#增加评论功能" class="headerlink" title="增加评论功能"></a>增加评论功能</h3><p><a href="https://minimalism.codeover.cn/docs/start">gitment Demo</a></p><p><a href="https://minimalism.codeover.cn/docs/start">gitment 教程</a></p><h3 id="换一个好看的主题"><a href="#换一个好看的主题" class="headerlink" title="换一个好看的主题"></a>换一个好看的主题</h3><p>Hexo 中有很多主题，可以在<a href="https://hexo.io/themes/">官网</a>查看。</p><p>我的博客使用的主题是： <a href="https://minimalism.codeover.cn/">hexo-theme-minimalism</a></p><p>参考minimalism主题安装步骤：<a href="https://minimalism.codeover.cn/docs/start">快速开始</a></p><h3 id="部署到Github"><a href="#部署到Github" class="headerlink" title="部署到Github"></a>部署到Github</h3><ol><li><p>创建一个xxx.github.io的public的仓库，也可以使用private 仓库，但是需要付费，<a href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages">参考github pages</a></p></li><li><p>安装git deployment 插件<a href="https://github.com/hexojs/hexo-deployer-git">hexo-deployer-git</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure></li><li><p>网站配置git</p><blockquote><p>branch 为分支，默认为master。如果github 的分支是main，配置也要改成main</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/one-command-deployment</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/felixyh/felixyh.github.io.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">main</span><br></code></pre></td></tr></table></figure></li><li><p>部署</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo d<br></code></pre></td></tr></table></figure></li></ol><h1 id="Github-源代码管理"><a href="#Github-源代码管理" class="headerlink" title="Github 源代码管理"></a>Github 源代码管理</h1><p><a href="https://zhuanlan.zhihu.com/p/71544809">使用git分支保存hexo博客源码到github</a></p><blockquote><p>可以参考上述文章，注意最后推送博客源码到分支的时候，强制推送覆盖github分支上的博客静态页面代码为博客源代码，不然会报错。<code>git push origin source -f</code></p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>hero</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>科学上网</title>
    <link href="/2023/05/26/ke-xue-shang-wang/"/>
    <url>/2023/05/26/ke-xue-shang-wang/</url>
    
    <content type="html"><![CDATA[<hr><h1> 科学上网 </h1><p>作者：左耳朵 <a href="http://coolshell.cn/">http://coolshell.cn</a><br>更新时间：2023-05-02</p><p>这篇文章可以写的更好，欢迎到 <a href="https://github.com/haoel/haoel.github.io">https://github.com/haoel/haoel.github.io</a> 更新</p><ul><li><a href="#0-%E5%BA%8F">0. 序</a></li><li><a href="#1-%E6%9C%BA%E5%9C%BA-vs-%E8%87%AA%E5%BB%BA">1. 机场 vs 自建</a></li><li><a href="#2-%E8%B4%AD%E4%B9%B0vps">2. 购买VPS</a><ul><li><a href="#21-%E5%B8%B8%E8%A7%84vps">2.1 常规VPS</a></li><li><a href="#22-cn2-%E7%BA%BF%E8%B7%AF">2.2 CN2 线路</a></li></ul></li><li><a href="#3-%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1">3. 搭建相关代理服务</a><ul><li><a href="#31-%E8%AE%BE%E7%BD%AEdocker%E6%9C%8D%E5%8A%A1">3.1 设置Docker服务</a></li><li><a href="#32-%E5%BC%80%E5%90%AF-tcp-bbr-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95">3.2 开启 TCP BBR 拥塞控制算法</a></li><li><a href="#33-%E7%94%B3%E8%AF%B7%E5%9F%9F%E5%90%8D%E5%92%8C%E8%AF%81%E4%B9%A6">3.3 申请域名和证书</a></li><li><a href="#34-%E7%94%A8-gost-%E8%AE%BE%E7%BD%AE-https-%E6%9C%8D%E5%8A%A1">3.4 用 Gost 设置 HTTPS 服务</a></li><li><a href="#35-%E8%AE%BE%E7%BD%AE-shadowsocks-%E6%9C%8D%E5%8A%A1-%E4%B8%8D%E6%8E%A8%E8%8D%90">3.5 设置 ShadowSocks 服务 （不推荐）</a></li><li><a href="#36-%E8%AE%BE%E7%BD%AEl2tpipsec%E6%9C%8D%E5%8A%A1-%E4%B8%8D%E6%8E%A8%E8%8D%90">3.6 设置L2TP&#x2F;IPSec服务 （不推荐）</a></li></ul></li><li><a href="#4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE">4. 客户端设置</a><ul><li><a href="#41-%E7%94%B5%E8%84%91%E7%AB%AF%E8%AE%BE%E7%BD%AE">4.1 电脑端设置</a><ul><li><a href="#411-chrome-%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE">4.1.1 Chrome 代理设置</a></li><li><a href="#412-%E5%85%A8%E5%B1%80-clash-%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE">4.1.2 全局 Clash 代理设置</a></li></ul></li><li><a href="#42-%E6%89%8B%E6%9C%BA%E7%AB%AF%E8%AE%BE%E7%BD%AE">4.2 手机端设置</a><ul><li><a href="#421-android">4.2.1 Android</a></li><li><a href="#422-iphone">4.2.2 iPhone</a></li></ul></li><li><a href="#43-%E5%B9%B3%E6%9D%BF%E7%AB%AF%E8%AE%BE%E7%BD%AE-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BD%BF%E7%94%A8gost%E4%BB%A3%E7%90%86">4.3 平板端设置</a><ul><li><a href="#431-ipad">4.3.1 iPad</a></li></ul></li></ul></li><li><a href="#5-%E7%BE%8E%E5%9B%BD%E6%89%8B%E6%9C%BA%E5%92%8C%E6%94%AF%E4%BB%98">5. 美国手机和支付</a><ul><li><a href="#51-%E7%BE%8E%E5%9B%BD%E6%89%8B%E6%9C%BA">5.1 美国手机</a></li><li><a href="#52-%E7%BE%8E%E5%9B%BD%E6%94%AF%E4%BB%98">5.2 美国支付</a></li></ul></li><li><a href="#6-%E6%B5%81%E9%87%8F%E4%BC%AA%E8%A3%85%E5%92%8C%E9%98%B2%E6%8E%A2%E6%B5%8B">6. 流量伪装和防探测</a></li><li><a href="#7-%E9%92%88%E5%AF%B9-ip-%E8%A2%AB%E5%B0%81%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">7. 针对 IP 被封的解决方案</a></li><li><a href="#8-%E5%AE%B6%E7%94%A8%E9%80%8F%E6%98%8E%E7%BD%91%E5%85%B3">8. 家用透明网关</a><ul><li><a href="#81-openwrt-%E8%B7%AF%E7%94%B1%E5%99%A8">8.1 OpenWRT 路由器</a></li><li><a href="#82-%E9%80%9A%E8%BF%87%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9A%E6%97%81%E8%B7%AF%E7%BD%91%E5%85%B3">8.2 通过树莓派做旁路网关</a></li><li><a href="#83-%E5%AE%89%E8%A3%85-clash">8.3 安装 Clash</a></li><li><a href="#84-%E8%AE%BE%E7%BD%AE-iptables-%E8%BD%AC%E5%8F%91">8.4 设置 <code>iptables</code> 转发</a></li></ul></li><li><a href="#9-%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83%E9%80%8F%E6%98%8E%E7%BD%91%E5%85%B3">9. 数据中心透明网关</a><ul><li><a href="#91-aws-%E7%BD%91%E7%BB%9C%E6%9E%84%E5%BB%BA">9.1 AWS 网络构建</a></li><li><a href="#92-%E5%AE%89%E8%A3%85-clash">9.2 安装 Clash</a></li><li><a href="#93-%E9%85%8D%E7%BD%AE%E7%A7%81%E6%9C%89%E5%AD%90%E7%BD%91%E4%B8%AD%E7%9A%84-ec2">9.3 配置私有子网中的 EC2</a></li><li><a href="#94-%E7%A7%81%E6%9C%89%E5%AD%90%E7%BD%91%E4%B8%AD%E7%9A%84-kubernetes">9.4 私有子网中的 Kubernetes</a></li></ul></li><li><a href="#10-%E4%BB%A3%E7%90%86%E6%8A%80%E5%B7%A7">10. 代理技巧</a><ul><li><a href="#101-http-%E9%9A%A7%E9%81%93">10.1 HTTP 隧道</a></li><li><a href="#102-ssh-%E9%9A%A7%E9%81%93">10.2 SSH 隧道</a></li><li><a href="#103-github--git-ssh-%E4%BB%A3%E7%90%86">10.3 Github &#x2F; Git SSH 代理</a></li><li><a href="#104-cloudflare-warp-%E5%8E%9F%E7%94%9F-ip">10.4 Cloudflare Warp 原生 IP</a><ul><li><a href="#1041-warp-%E6%A8%A1%E5%BC%8F">10.4.1 WARP 模式</a></li><li><a href="#1042-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">10.4.2 代理模式</a></li><li><a href="#1043-docker-%E4%BB%A3%E7%90%86">10.4.3 Docker 代理</a></li></ul></li></ul></li><li><a href="#11-%E5%85%B6%E5%AE%83">11. 其它</a><ul><li><a href="#111-%E5%85%B6%E5%AE%83%E6%96%B9%E5%BC%8F">11.1 其它方式</a></li><li><a href="#112-%E6%90%AD%E5%BB%BA%E8%84%9A%E6%9C%AC">11.2 搭建脚本</a></li></ul></li></ul><h2 id="0-序"><a href="#0-序" class="headerlink" title="0. 序"></a>0. 序</h2><p>首先，我们先明确一下，我科学上网的目的主要是为了学习、工作、交友、查资料、和丰富自己的眼界，不是其它的事。</p><p>对我来说，科学上网很重要，下面罗列一下需要科学上网，我才能真正学习工作和生活的网站：</p><ul><li>Youtube 和 Vimeo 上的各种大会和教学视频，除了我自己要学，我的孩子也要学。</li><li>Wikipedia 维基百科是我目前唯一信得过的百科全书，我在上面可以比较系统地翻阅各种词条。</li><li>SlideShare 上有很多的技术文档和资料的PPT，是我的知识学习的地方。</li><li>Quora 问答网站，在上面有很多有趣的问答。</li><li>博客和论文，很多博客和论文站点都被墙了，比如：Blogspot 和 Medium。</li><li>Google 的各种服务，比如：Gmail, Map, Docs，Driver，照片，图片搜索，Voices，论文搜索……包括Google官方的各种技术文档……</li><li>一些云服务，比如：Dropbox，IFTTT，Imgur，archive.org……</li><li>Twitter 上 Follow 一些牛人和一些官方账号，比如：AWS、Docker……</li><li>社交 Facebook, Telegram, Whatsapp, Slack……，有一些我在国外的亲戚和朋友……</li><li>Reddit 是一个聚合网站，一个新闻和文章的集散地，你可以认为是各种频道的今日头条……</li><li>Pinterest 和 Instagram  上面有很多不错的图片和视频新闻，是我减压力的地方……</li><li>新闻，如BBC。 BBC是全球比较出众的媒体，有太多的有价值资源和内容了，比如纪录片、学英文……</li><li>编程，有很多编程的场景需要翻墙，比如，Go语言编程时的 go get 中的很多库是放在 Google的服务器上， 然而Google是全部被墙，包括 Android 和其它一些文档和资源也是一样。包括 SourceForge 的某些项目也需要科学上网，Docker Registry也有部分被墙，还有偶尔抽风的Github，以及不能访问的gist……</li><li>……等等</li></ul><p>所以，科学上网后，英文是一件很重要的事。</p><p>为什么这么说？<strong>这主要是针对计算机相关的知识，逻辑是这样的，如果你上了Google还是在用中文关键词，那么你好不容易出来了，结果又回去了，所以没什么意义。</strong> 换言之，科学上网的目的是为了进入广阔的世界范围与全世界的人交流，所以，英文是必备的，如果你英文有问题，VPN过去的用处也不大。</p><p>所以，我把这个前提条件放在第一的位置，就是说—— <strong>真正的墙不是GFW，而是人的大脑！</strong> 意思是，屏蔽你获得信息能力的不是墙，而很大一部分则是我们自己的语言能力！</p><h2 id="1-机场-vs-自建"><a href="#1-机场-vs-自建" class="headerlink" title="1. 机场 vs 自建"></a>1. 机场 vs 自建</h2><p>对于科学上网，我强烈建议通过自建的方式。因为使用一些“机场”会有如下的几个问题：</p><ol><li>机场主需要公开售卖，使用的人也比较多，所以，都会被重点关注，非常容易被封；</li><li>机场需要购买一堆服务器，所以，很容易经营不善跑路；</li><li>使用机场很容易泄漏自己的隐私，因为你的所有流量都经过了机场的服务器；</li></ol><p>自建梯子会是一条很好的路，不过，问题就是，自建梯子需要一定的技术能力，成本和门槛都比机场要高，但是，在安全性方面会比较好一些。自己动手，自力更生，让人有更多的安全感。</p><p>所以，如果你不是很有技术能力，或者不想花钱，那么，还是使用“机场”吧。</p><p>本文主要是针对自建的文档！</p><h2 id="2-购买VPS"><a href="#2-购买VPS" class="headerlink" title="2. 购买VPS"></a>2. 购买VPS</h2><p>自建梯需要购买一台服务器 VPS。<strong>现在你买一台VPS也不贵了，一个月几十元钱。当然，如果需要好的线路得需要多花一些钱，但是也不贵。</strong>。</p><p>购买的 VPS 有几个要点 - “<strong>流量</strong>” 和 “<strong>位置</strong>”：</p><ul><li><strong>配置</strong>。服务器的配置不需要很高，用最小的型号就可以了，一般来说，1个CPU，1GB内存，50GB硬盘是足够了；</li><li><strong>流量</strong>。服务器主是要要年有没有足够的流量和带宽，很多VPS提供商在流量和带宽上会收额外的费用，要小心。一般来说，1TB流量和30Mbps带宽是足够了，如果不看电影的话，500GB左右一个月的流量也够了；</li><li><strong>位置</strong>。服务器的线路和地理位置还是比较重要的，一般来说，香港，台湾，日本，韩国，新加坡，美国，欧洲都是不错的选择。<ul><li><strong>线路</strong>。 经过我长期的实践，GIA CN2 的线路是非常好的。<strong>但是你要小心，很多VPS提供商会在宣传上说自己是 CN2 的线路，但是，实际上并不是</strong>。</li><li><strong>原生 IP</strong>。很多海外的应用都有地区限制，会屏蔽IP，所以，使用美国的原生 IP 也是很重要的。</li></ul></li></ul><p>上述的这些东西在后面都会讲到。<strong>另外，VPS 建议安装成 Ubuntu，版本用 18.04，20.04，22.04 都行</strong>。</p><h3 id="2-1-常规VPS"><a href="#2-1-常规VPS" class="headerlink" title="2.1 常规VPS"></a>2.1 常规VPS</h3><p>对于常规 VPS，主要是一个云服务提供商，大的原厂商都提供免费使用和赠金，所以，可以白嫖一段时间。</p><ul><li><a href="https://lightsail.aws.amazon.com/">AWS LightSail</a> 是一个非常便宜好用的服务，最低配置一个月 $3.5 美金，流量不限，目前的Zone不多，推荐使用日本，新加坡或美国俄勒冈（支持银联卡）。现对 2021&#x2F;8&#x2F;7 之后使用 LightSail 的用户提供3个月的免费试用。</li><li><a href="https://azure.microsoft.com/zh-cn/">Microsoft Azure</a>提供免费一年的服务（B1S实例），而且每个月有 100G 的免费流量，并赠送200刀赠金。（需要国际信用卡）</li><li><a href="https://cloud.google.com/">Google Cloud Platform</a>提供免费试用，赠送300刀赠金（需要国际信用卡）</li><li><a href="https://www.oracle.com/cloud/free/">Oracle Cloud</a>两台VPS无限期使用，可选美日韩等地（需要国际信用卡）</li><li><a href="https://my.racknerd.com/aff.php?aff=1134">RackNerd</a>，价格在一年 10 刀-20 刀（如下所示）。支持支付宝、银联。购买的时候，有个 Location 选项，可以选择机房位置，后面有相应的 IP，你可以测试一下 ping 值，选择最低的那个。</li><li><a href="https://aws.amazon.com/cn/">AWS EC2</a>香港、日本或韩国申请个免费试用一年的EC2 VPS （支持银联卡）</li><li><a href="https://www.linode.com/">Linode</a>买个一月USD5刀的VPS</li><li><a href="https://www.vultr.com/?ref=7609494">Vultr</a>上买一个日本的VPS，一个月5刀 - 6刀 （可以支付宝）</li></ul><blockquote><p><strong>Note</strong></p><ul><li><p>你要知道很多云厂商的 VPS 服务器和流量是分开计费的，所以，你要确认一下你的云帐单以免出现不预期的费用。所以，最好购买包流量的 VPS。比如：AWS 的 LightSail, RackNerd 等。</p></li><li><p>在中国，因为有太多的网络提供商，所以，不同的地方，不同的网络，不同的时间，到不同的国家完全不一样，而且还经常性地调整路由，所以，经常性地有时候快有时候慢，简直就是随机的。如果你对上网要求比较高的人，最好会备 2-3个不同国家地区的VPS。</p></li><li><p>香港网速应该是比较好的，但是香港的成本也是比较高的（使用 Microsoft Azure 的 East Asia 可以把 VPS 买在香港区）。台湾的网速也是不错的（可以通过 Google Cloud 购买），日本的网速其次，新加坡再次之，然后是美国的东海岸。但是，因为线路的问题，如果没有为中国区优化的线路，丢包率是非常大的，日本区 ping 值虽然很低，但是经常性的丢包，好的线路的美国的 ping 值虽然大，但是也会飞快。</p></li><li><p>Google Cloud Platform - GCP 的香港和台湾节点也是很快的。但是你要能买GCP的主机，你还得先翻墙，所以，感觉有点死锁了。所以，你可能先用其它方式翻墙，然后再到GCP上购买。</p></li></ul></blockquote><h3 id="2-2-CN2-线路"><a href="#2-2-CN2-线路" class="headerlink" title="2.2 CN2 线路"></a>2.2 CN2 线路</h3><p>如果你需要更好更高速的网络服务（比如你要看 Youtube 的 1080P），那么，你需要下面的这些服务器资源了（价格也会高一些）</p><p><code>CN2</code> 和 <code>GIA</code> 是两个关键词。<strong>CN2 GIA</strong> 全称 China telecom Next Carrier Network- Global Internet Access 电信国际精品网络，特征是路由线路上骨干节点均为59.43开头的IP。如果想要寻找接入CN2线路的国外VPS提供商，建议使用 <code>Next Carrier Network</code> 或者 <code>CN2</code> 这个关键词搜索即可。</p><p>多说一句， CN2本身又分为两种类型：</p><ul><li><p><strong>CN2 GT</strong>: CN2 里属于Global Transit的产品(又名GIS-Global Internet Service)，在CN2里等级低，省级&#x2F;出国节点为 <code>202.97</code> 开头，国际骨干节点有2～4个 <code>59.43</code> 开头的CN2节点。在出国线路上拥堵程度一般，相对于163骨干网的稍强，相比CN2 GIA，性价比也较高。</p></li><li><p><strong>CN2 GIA</strong>: CN2 里属于Global Internet Access的产品，等级最高，省级&#x2F;出国&#x2F;国际骨干节点都以<code>59.43</code>开头，全程没有<code>202.97</code>开头的节点。在出国线路上表现最好，很少拥堵，理论上速度最快最稳定，当然，价格也相对 CN2 GT 偏高。</p></li></ul><p>关于 <code>CN2</code> 线路的主机提供商，好些都不靠谱，只推荐下面两个，首推搬瓦工。</p><ul><li><p><a href="https://bwh8.net/aff.php?aff=39384">搬瓦工</a>  这应该是美区最好的一个用来科学上网的VPS提供商了，实测飞快，无论在中国哪个地方都很快。购买时你需要注意VPS规格上的 <code>CN2</code> 和 <code>GIA</code> 的描述。（注：点击主页右上角的 <code>regisiter</code> 以后，你可以看到页面上方有两个导航条，在下面的导航条上点 <code>Services</code> -&gt; <code>Order New Services</code> 就可以看到所有的列表了。买完后，你可能需要重装一下操作系统，装成64位带BBR的 ）</p></li><li><p><a href="https://bill.hostdare.com/aff.php?aff=3397">HostDare</a> 的 CN2 GIA 产品也是三网直连。专门有两个分类针对中国的 CN2 GIA，一个是 Premium China Optimized NVMeKVM，一组是 Premium China Optimized KVM。支持支付宝和银联。购买后要等一段时间（2-4个小时）才会创建好，IP 有可能会给你是一个已经被封了的，如果是这样，你要在3天内申请换IP，都是免费的。时间长了也可以换，就是时间比较长，而且还要花一定的费用（3美金）。线路质量还不错，不过没有搬瓦工快。</p></li></ul><p>更多的可以参考这篇文章《<a href="https://wzfou.com/cn2-gia-vps/">CN2 GIA VPS主机收集整理汇总-电信,联通,移动三网CN2 GIA线路VPS主机</a>》（注：随时间推移，这篇文章的内容可能会失效）</p><p>重点说一下，<strong>CN2 GIA + 香港机房</strong>，你会得到巨快无比的上网速度（无论你在中国的哪个位置，无论使用哪家运营商，CN2 GIA都是最优的），然而，香港地区的VPS的确是有点贵了。在 Youtube上看 4K 的视频毫无压力。虽然阿里云和腾讯的也有，但是被查到的风险基本上是100%，不建议使用，被抓了别怪我没警告过你。</p><h2 id="3-搭建相关代理服务"><a href="#3-搭建相关代理服务" class="headerlink" title="3. 搭建相关代理服务"></a>3. 搭建相关代理服务</h2><blockquote><p>注：如下的搭建和安装脚本可参看本库的 scripts 目录下的脚本，如： <a href="https://github.com/haoel/haoel.github.io/blob/master/scripts/install.ubuntu.18.04.sh">Ubuntu 18.04 Installation Script</a> （感谢网友 <a href="https://github.com/gongzili456">@gongzili456</a> 开发），另外，<strong>这个脚本可能年久失修，不一定能用，但是可以参考，如果有问题，可以提交 PR</strong>。</p></blockquote><h3 id="3-1-设置Docker服务"><a href="#3-1-设置Docker服务" class="headerlink" title="3.1 设置Docker服务"></a>3.1 设置Docker服务</h3><p>首先，你要安装一个Docker CE 服务，这里你要去看一下docker官方的安装文档：</p><ul><li><a href="https://docs.docker.com/install/linux/docker-ce/centos/">CentOS 上的 Docker CE 安装</a></li><li><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Ubuntu 上的 Docker CE 安装</a></li></ul><p>然后开始设置你的VPN&#x2F;SS服务</p><h3 id="3-2-开启-TCP-BBR-拥塞控制算法"><a href="#3-2-开启-TCP-BBR-拥塞控制算法" class="headerlink" title="3.2 开启 TCP BBR 拥塞控制算法"></a>3.2 开启 TCP BBR 拥塞控制算法</h3><p>TCP BBR（Bottleneck Bandwidth and Round-trip propagation time）是由Google设计，于2016年发布的拥塞算法。以往大部分拥塞算法是基于丢包来作为降低传输速率的信号，而BBR则基于模型主动探测。该算法使用网络最近出站数据分组当时的最大带宽和往返时间来创建网络的显式模型。数据包传输的每个累积或选择性确认用于生成记录在数据包传输过程和确认返回期间的时间内所传送数据量的采样率。该算法认为随着网络接口控制器逐渐进入千兆速度时，分组丢失不应该被认为是识别拥塞的主要决定因素，所以基于模型的拥塞控制算法能有更高的吞吐量和更低的延迟，可以用BBR来替代其他流行的拥塞算法，例如CUBIC。Google在YouTube上应用该算法，将全球平均的YouTube网络吞吐量提高了4%，在一些国家超过了14%。</p><p>BBR之后移植入Linux内核4.9版本，并且对于QUIC可用。</p><p>如果开启，请参看 《<a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95">开启TCP BBR拥塞控制算法</a> 》</p><h3 id="3-3-申请域名和证书"><a href="#3-3-申请域名和证书" class="headerlink" title="3.3 申请域名和证书"></a>3.3 申请域名和证书</h3><p>为了更为的隐蔽，使用 HTTPS 服务，你需要完成如下工作：</p><p>1） 一个域名（可以上 <a href="https://www.godaddy.com/en-us">GoDaddy</a>，但一定要使用美国版）</p><p>2） 然后在 GoDaddy 上修改域名解析服务器，把其指向 <a href="https://cloudflare.com/">Cloudflare</a> —— 当你注册完 Cloudflare 帐号后，Cloudflare 会告诉你怎么做。</p><p>3）然后，你在 Cloudflare 上创建一个子域名解析到你的 VPS 上 IP 上（注：不要开启 Cloudflare 的 Proxy 模式）</p><p>4）最后，使用 <a href="https://letsencrypt.org/">Let’s Encrypt</a> 来签 一个证书。使用 Let’s Encrypt 证书你需要在服务器上安装一个 <a href="https://certbot.eff.org/instructions">certbot</a>，点击 <a href="https://certbot.eff.org/instructions">certbot</a> 这个链接，你可以选择你的服务器，操作系统，然后就跟着指令走吧。</p><p>接下来，你需要申请一个证书（我们使用standalone的方式，然后，你需要输入你的电子邮件和你解析到 VPS 的域名）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo certbot certonly --standalone</span><br></code></pre></td></tr></table></figure><p>证书默认生成在 <code>/etc/letsencrypt/live/&lt;YOUR.DOMAIN.COM/&gt;</code> 目录下，这个证书90天后就过期了，所以，需要使用一个 cron job 来定期更新（稍后给出）</p><h3 id="3-4-用-Gost-设置-HTTPS-服务"><a href="#3-4-用-Gost-设置-HTTPS-服务" class="headerlink" title="3.4 用 Gost 设置 HTTPS 服务"></a>3.4 用 Gost 设置 HTTPS 服务</h3><p><a href="https://github.com/ginuerzh/gost">gost</a> 是一个非常强的代理服务，它可以设置成 HTTPS 代理，然后把你的服务伪装成一个Web服务器，<strong>我感觉这比其它的流量伪装更好，也更隐蔽。这也是这里强烈推荐的一个方式</strong>。</p><p>接下来就是启动 gost 服务了，我们这里使用 Docker 的方式建立 gost 服务器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">下面的四个参数需要改成你的</span><br>DOMAIN=&quot;YOU.DOMAIN.NAME&quot;<br>USER=&quot;username&quot;<br>PASS=&quot;password&quot;<br>PORT=443<br><br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/fullchain.pem<br>KEY=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/privkey.pem<br>sudo docker run -d --name gost \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;USER&#125;:$&#123;PASS&#125;@$&#123;BIND_IP&#125;:$&#123;PORT&#125;?cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=code:404&amp;knock=www.google.com&quot;<br></code></pre></td></tr></table></figure><p>上面这个脚本，你需要配置：域名(<code>DOMAIN</code>), 用户名 (<code>USER</code>), 密码 (<code>PASS</code>) 和 端口号(<code>PORT</code>) 这几个变量。</p><p>关于 gost 的参数， 你可以参看其文档：<a href="https://docs.ginuerzh.xyz/gost/">Gost Wiki</a>，上面我设置一个参数 <code>probe_resist=code:404</code> 意思是，如果服务器被探测，或是用浏览器来访问，返回404错误，也可以返回一个网页（如：<code>probe_resist=file:/path/to/file.txt</code> 或其它网站 <code>probe_resist=web:example.com/page.html</code>）</p><blockquote><p><strong>Note</strong></p><ol><li><p>开启了探测防御功能后，当认证失败时服务器默认不会响应 <code>407 Proxy Authentication Required</code>，但某些情况下客户端需要服务器告知代理是否需要认证(例如Chrome中的 SwitchyOmega 插件)。通过knock参数设置服务器才会发送407响应。对于上面的例子，我们的<code>knock</code>参数配置的是<code>www.google.com</code>，所以，你需要先访问一下 <code>https://www.google.com</code> 让服务端返回一个 <code>407</code> 后，SwitchyOmega 才能正常工作。</p></li><li><p>如果认证信息（也就是用户名和密码）中包含特殊字符，则可以（应该是必须！否则客户端一侧会有很多不兼容）通过auth参数来设置，下面是使用 <code>auth</code> 参数的例子（注意，需要 gost 在 2.9.2+ 以上版本）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">DOMAIN=&quot;YOU.DOMAIN.NAME&quot;<br>USER=&quot;username&quot;<br>PASS=&quot;password&quot;<br>PORT=443<br>AUTH=$(echo -n $&#123;USER&#125;:$&#123;PASS&#125; | base64)<br>  <br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/fullchain.pem<br>KEY=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/privkey.pem<br>sudo docker run -d --name gost \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;BIND_IP&#125;:$&#123;PORT&#125;?auth=$&#123;AUTH&#125;&amp;cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=code:404&amp;knock=www.go   ogle.&gt; com&quot;<br></code></pre></td></tr></table></figure></li></ol></blockquote><p>如无意外，你的服务就启起来了。 你可以使用如下命令在检查有没有启动成功：</p><ul><li><code>sudo docker ps</code> 来查看 gost 是否在运行。</li><li><code>netstat -nolp | grep 443</code> 来查看 gost 是否在监听 443 端口。</li><li><code>sudo docker logs gost</code> 来查看 gost 的日志。</li></ul><p>你可以使用下面的命令验证你的 gost 服务是否正常。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -v &quot;https://www.google.com&quot; --proxy &quot;https://DOMAIN&quot; --proxy-user &#x27;USER:PASS&#x27;<br></code></pre></td></tr></table></figure><p>接下来就是证书的自动化更新。</p><p>可以使用命令  <code>crontab -e</code>  来编辑定时任务：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span><span class="hljs-number">0</span> <span class="hljs-number">1</span> * * /<span class="hljs-keyword">usr</span>/bin/certbot renew --force-renewal<br><span class="hljs-symbol">5 </span><span class="hljs-number">0</span> <span class="hljs-number">1</span> * * /<span class="hljs-keyword">usr</span>/bin/docker restart gost<br></code></pre></td></tr></table></figure><p>这样，服务器就配置完成了。客户端请移动后面的客户端章节。</p><blockquote><p> <strong>使用 Cloudflare 的注意事项</strong></p><p>上述的方法并不支持 Cloudflare CDN，如果你想使用了 Cloudflare CDN，你需要使用 WebSocket 协议，如下所示，你需要使用 <code>mwss</code> 协议。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gost -L=mwss://username:password@:443?cert=/path/to/your/cert/file\&amp;key=/path/to/your/key/file<br></code></pre></td></tr></table></figure><p>在 CloudFlare 上，请将TLS&#x2F;SSL设置为 <strong>完全</strong></p><p>如果你的客户端只能使用 socks 协议，你还要在客户端这边转一下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">gost -L socks://:YourLocalPort -F mwss://username:password@example.com:443</span><br></code></pre></td></tr></table></figure><p>然后在其他软件中设置socks5代理即可</p></blockquote><h3 id="3-5-设置-ShadowSocks-服务-（不推荐）"><a href="#3-5-设置-ShadowSocks-服务-（不推荐）" class="headerlink" title="3.5 设置 ShadowSocks 服务 （不推荐）"></a>3.5 设置 ShadowSocks 服务 （不推荐）</h3><p><strong>（注：ShadowSocks 被查的机率非常大，不推荐使用）</strong></p><p><strong>（如果有隧道转发，可以使用）</strong></p><p>ShadowSocks 的 Docker 启动脚本 （其中的 <code>SS_PORT</code> 和 <code>SS_PASSWD</code> 需要重新定义一下）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>SS_PORT=1984<br>SS_PASSWD=MyPasswd<br><br>sudo docker run -dt --name ss \<br>   -p $&#123;SS_PORT&#125;:$&#123;SS_PORT&#125; mritd/shadowsocks \<br>   -s &quot;-s 0.0.0.0 -p $&#123;SS_PORT&#125; -m aes-256-cfb -k $&#123;SS_PASSWD&#125; --fast-open&quot;<br></code></pre></td></tr></table></figure><h3 id="3-6-设置L2TP-x2F-IPSec服务-（不推荐）"><a href="#3-6-设置L2TP-x2F-IPSec服务-（不推荐）" class="headerlink" title="3.6 设置L2TP&#x2F;IPSec服务 （不推荐）"></a>3.6 设置L2TP&#x2F;IPSec服务 （不推荐）</h3><p><strong>（注：VPN方式被查的机率非常大，不推荐使用）</strong></p><p>L2TP&#x2F;IPSec 的启动脚本，其中的三个环境变量 <code>USER</code>， <code>PASS</code> 和 <code>PSK</code> 需要替换一下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>USER=someone<br>PASS=password<br>PSK=psk_key<br><br>sudo docker run -d  --privileged \<br>    -e PSK=$&#123;PSK&#125; \<br>    -e USERNAME=$&#123;USER&#125; -e PASSWORD=$&#123;PASS&#125; \<br>    -p 500:500/udp \<br>    -p 4500:4500/udp \<br>    -p 1701:1701/tcp \<br>    -p 1194:1194/udp  \<br>    siomiz/softethervpn<br></code></pre></td></tr></table></figure><h2 id="4-客户端设置"><a href="#4-客户端设置" class="headerlink" title="4. 客户端设置"></a>4. 客户端设置</h2><h3 id="4-1-电脑端设置"><a href="#4-1-电脑端设置" class="headerlink" title="4.1 电脑端设置"></a>4.1 电脑端设置</h3><h4 id="4-1-1-Chrome-代理设置"><a href="#4-1-1-Chrome-代理设置" class="headerlink" title="4.1.1 Chrome 代理设置"></a>4.1.1 Chrome 代理设置</h4><p>你可以使用 Chrome 插件 <a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif">SwitchyOmega</a>进行代理设置。在 SwitchyOmega 中，你需要设置一个代理服务器。</p><ol><li>打开 SwitchyOmega 的设置页面，点击左边导航栏上的“New Profile”，输入一个名字，比如“代理”。</li><li>然后在 <code>Protocol</code> 中选择 <code>HTTPS</code>, 填上你的 Gost 的 VPS 服务器和端口号。</li><li>点后面的 <code>🔒</code> 按钮，输入 Gost 服务器的用户名和密码。</li></ol><p>具体的教程可以参看官方教程 - 《<a href="https://switchyomega.org/">最新 SwitchyOmega 使用教程快速入门篇</a>》</p><p>如果无法直接配置 HTTPS 代理，具体原因可能是因为你设置了<code>probe_resist</code>以开启探测防御功能。这里，你需要在服务器端设置 <code>knock</code> 参数（参看 <a href="#34-%E7%94%A8-gost-%E8%AE%BE%E7%BD%AE-https-%E6%9C%8D%E5%8A%A1">用 Gost 设置 HTTPS 服务</a> 中的“注意”一节 ）</p><p>或是，干脆使用 gost 客户端在本机启动一个 SOCKS 5的代理服务用来代替（<code>gost -L socks5://:1080 -F &#39;https://USER:PASS@DOMAIN:443&#39;</code>），然后在 SwitchyOmega 配置代理为’127.0.0.1:1080’即可。</p><h4 id="4-1-2-全局-Clash-代理设置"><a href="#4-1-2-全局-Clash-代理设置" class="headerlink" title="4.1.2 全局 Clash 代理设置"></a>4.1.2 全局 Clash 代理设置</h4><p>在电脑上，使用 <a href="https://github.com/Dreamacro/clash">Clash</a> 一个就可以了。Clash 支持很多翻墙协议：ShadowSocks(R), Vmess, Socks5, HTTP(s)，Snell，Trojan。 而且支持多个代理服务器的分组和负载均衡。</p><p>Clash 的客户端支持多种平台，包括 Windows, MacOS, Linux 等，你可以在 <a href="https://github.com/Dreamacro/clash/releases">Clash 的 Release 页面</a> 下载到最新的版本。这个是命令行版本，但配置其实并不复杂。</p><p>另外，有一些比较高级的功能，如：开启 Tun 网卡，需要使用 <a href="https://github.com/Dreamacro/clash/releases/tag/premium">Clash Premium</a>，这个版本不收费，但是是闭源的。</p><p>当然，如果你要安装 GUI 版本，你可以通过如下的项目安装：</p><ul><li><a href="https://github.com/Fndroid/clash_for_windows_pkg/releases">Clash for Windows</a>。注意：<strong>这个软件是闭源软件</strong>。</li><li><a href="https://github.com/yichengchen/clashX">Clash for MacOS</a></li><li><a href="https://github.com/Kr328/ClashForAndroid">Clash for Android</a></li></ul><p>下面是 Clash 安装完后的配置目录结构：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">├── clash                &lt;- 建一个 clash 的目录<br>│   ├── clash            &lt;- 运行文件<br>│   ├── config.yaml      &lt;- 配置文件<br>│   ├── Country.mmdb     &lt;- IP地址库<br>│   └── ui               &lt;- Clash 的 UI<br>│       ├── index.html<br>│       ├── ...<br></code></pre></td></tr></table></figure><p>说明一下：</p><ul><li>UI界面可以到 <a href="https://github.com/haishanh/yacd">haishah&#x2F;yacd</a> 下载。放到clash的配置目录下 <code>ui</code> 目录下</li><li>一个是 <code>Country.mmdb</code> 这是IP地址的在哪个国家的数据库。你需要到这里下载 - <a href="https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb">Country.mmdb</a> （当然，clash启动时，会自动下载，我这里给你一个手动下载的链接）</li><li>另一个是 <code>config.yaml</code> 文件，这个文件详细解释可参看 - <a href="https://github.com/Dreamacro/clash/wiki/configuration">官方Wiki</a></li></ul><p>下面是个示例：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">port:</span> <span class="hljs-number">7890</span><br><span class="hljs-attr">socks-port:</span> <span class="hljs-number">7891</span><br><span class="hljs-attr">redir-port:</span> <span class="hljs-number">7892</span><br><span class="hljs-attr">mixed-port:</span> <span class="hljs-number">7893</span><br><span class="hljs-attr">ipv6:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">allow-lan:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">mode:</span> <span class="hljs-string">Rule</span><br><span class="hljs-attr">log-level:</span> <span class="hljs-string">info</span><br><span class="hljs-attr">external-controller:</span> <span class="hljs-string">&#x27;0.0.0.0:9090&#x27;</span><br><span class="hljs-attr">external-ui:</span> <span class="hljs-string">ui</span><br><span class="hljs-attr">secret:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attr">tun:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">stack:</span> <span class="hljs-string">system</span><br>  <span class="hljs-attr">dns-hijack:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tcp://8.8.8.8:53</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">udp://8.8.8.8:53</span><br><span class="hljs-attr">dns:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">ipv6:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">listen:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:53</span><br>  <span class="hljs-attr">default-nameserver:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>  <span class="hljs-comment">#enhanced-mode: redir-host</span><br>  <span class="hljs-attr">enhanced-mode:</span> <span class="hljs-string">fake-ip</span> <span class="hljs-comment">#如果要玩netflix，需要使用fake-ip</span><br>  <span class="hljs-attr">fake-ip-range:</span> <span class="hljs-number">198.18</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">/16</span><br>  <span class="hljs-attr">nameserver:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tls://8.8.8.8:853</span><br>  <span class="hljs-attr">fallback:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tls://8.8.8.8:853</span><br><br><span class="hljs-comment"># 两个代理服务器</span><br><span class="hljs-attr">proxies:</span><br>  <span class="hljs-comment"># http</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;https01&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https.server.domain</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">user</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;password&quot;</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># https</span><br>    <span class="hljs-attr">skip-cert-verify:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;https01&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https.server.domain</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">user</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;passowrd&quot;</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># https</span><br>    <span class="hljs-attr">skip-cert-verify:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 配置 Group</span><br><span class="hljs-attr">proxy-groups:</span><br>  <span class="hljs-comment"># 自动切换</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;auto&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">url-test</span><br>    <span class="hljs-attr">proxies:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us01_https</span><br>      <span class="hljs-comment">#- us02_https</span><br>      <span class="hljs-comment">#- hk_https</span><br>    <span class="hljs-comment"># tolerance: 150</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://www.google.com/&#x27;</span><br>    <span class="hljs-attr">interval:</span> <span class="hljs-number">300</span><br>  <span class="hljs-comment"># 按需选择 - 可以在UI上选择</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;netflix&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">select</span><br>    <span class="hljs-attr">proxies:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us01_https</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us02_https</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">hk_https</span><br><br><span class="hljs-attr">rules:</span><br><span class="hljs-comment"># LAN</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,local,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,127.0.0.0/8,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,172.16.0.0/12,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,192.168.0.0/16,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,10.0.0.0/8,DIRECT</span><br><br><span class="hljs-comment"># Netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,fast.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,api-global.netflix.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,netflix.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,netflix.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxext.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflximg.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflximg.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxso.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxvideo.net,netflix</span><br><br><span class="hljs-comment"># 最终规则（除了中国区的IP之外的，全部翻墙）</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">GEOIP,CN,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">MATCH,auto</span><br><br></code></pre></td></tr></table></figure><p>更多的规则网上可以找到很多，也可以参看这里：<a href="https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/clash.yaml">SS-Rule-Snippet&#x2F;LAZY_RULES&#x2F;clash.yaml</a></p><p><br/><br/></p><blockquote><p><strong>Note</strong></p><p>除了 Clash 外，你可以安装原生的客户端。如：</p><p><strong>1) VPN 客户端</strong></p><p> 对于L2TP&#x2F;IPSec，几乎所有的客户端操作系统（无论是Windows&#x2F;Mac&#x2F;Linux的电脑，还是iPhone&#x2F;Android）都支持，你可以自行Google。</p><ul><li><a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md">全平台配置 IPsec&#x2F;L2TP VPN 客户端</a></li><li><a href="https://support.apple.com/zh-cn/guide/mac-help/mchlp2963/mac">Apple 官网：在 Mac 上设置 VPN 连接</a></li><li><a href="http://nic.upc.edu.cn/2016/0928/c7809a132077/page.htm">Windows 7操作系统配置L2TP VPN方法</a></li></ul><p><strong>2) Shadowsocks 客户端</strong></p><p>对于 Shadowsocks 客户端，可以到这里查看 <a href="https://github.com/shadowsocks">Shadowsocks Clients</a></p><ul><li>MacOS 上你可以下载 <a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases">ShadowsocksX-NG</a></li><li>Windows上你可以下载 <a href="https://github.com/shadowsocks/shadowsocks-windows/releases">Shadowsocks-Windows</a>，需要先安装 <a href="https://dotnet.microsoft.com/download/dotnet-framework-runtime">.NET Framework</a></li></ul><p>注：关于 Shadowsocks 客户端的配制, 加密协议必须是跟 Shadowsocks 服务端相一致。可以自行约定在 Shadowsocks ,  如：之前章节示例中使用的是 <code>aes-128-gcm</code> 。</p><p><strong>3) Gost 客户端</strong></p><p>Gost 并不支持智能代理（也就是该翻的时候翻，不用翻的时候不翻）， 所以我们可以重用 ShadowSocks 的客户端。</p><p>对于电脑来说，你同样可以 <a href="https://github.com/ginuerzh/gost/releases">下载 gost 程序</a>，然后使用下面的命令行：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># 此处的ss服务端加密协议(eg: aes-128-gcm)必须是ss客户端支持的协议</span><br><span class="hljs-attribute">gost</span> -L ss://aes-128-gcm:passcode@:1984 -F <span class="hljs-string">&#x27;https://USER:PASS<span class="hljs-variable">@DOMAIN</span>:443&#x27;</span><br></code></pre></td></tr></table></figure><p>这样用 gost 在你的本机启动了一个 <code>ShadowSocks</code> 的服务，然后，把请求转到你在上面配置的 HTTPS服务器上，这样就完成转接。</p>  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">┌─────────────┐  ┌─────────────┐            ┌─────────────┐<br>│ ShadowSocks │  │             │   <span class="hljs-built_in"> WAN </span>    │             │<br>│   <span class="hljs-built_in"> Client </span>  ├──► Gost<span class="hljs-built_in"> Client </span>├────────────► Gost<span class="hljs-built_in"> Server </span>│<br>│ (PAC Auto)  │  │             │            │             │<br>└─────────────┘  └─────────────┘            └─────────────┘<br></code></pre></td></tr></table></figure><p>  <strong>ShadowSocks Client 主要完成：自动设置操作系统代理服务器的 pac （自动设置翻墙或是不翻墙的路由）</strong></p><p>  这样，你的ShadowSocks客户端只需要简单的配置一个本机的 SS 配置就好了。</p></blockquote><h3 id="4-2-手机端设置"><a href="#4-2-手机端设置" class="headerlink" title="4.2 手机端设置"></a>4.2 手机端设置</h3><h4 id="4-2-1-Android"><a href="#4-2-1-Android" class="headerlink" title="4.2.1 Android"></a>4.2.1 Android</h4><ul><li><a href="https://github.com/Kr328/ClashForAndroid">Clash for Android</a></li><li>Shadowsocks + ShadowsocksGostPlugin<ul><li><p>安装Shadowsocks (Google Play Store或<a href="https://github.com/shadowsocks/shadowsocks-android">github页面</a>)</p></li><li><p>下载<a href="https://github.com/segfault-bilibili/ShadowsocksGostPlugin">ShadowsocksGostPlugin</a></p></li><li><p>配置</p><ul><li>Server: <code>$DOMAIN</code></li><li>Remote Port: <code>443</code></li><li>Password: <code>gost</code></li><li>Encrypt Method: <code>RC4-MD5</code></li><li>Plugin: 选择ShadowsocksGostPlugin</li><li>Configure: <code>-F https://$USER:$PASS@#SS_HOST:#SS_PORT</code></li></ul><p>其中<code>$DOMAIN</code>, <code>$USER</code>, <code>$PASS</code>分别为服务端的域名&#x2F;子域名, 用户名和密码。</p></li></ul></li></ul><h4 id="4-2-2-iPhone"><a href="#4-2-2-iPhone" class="headerlink" title="4.2.2 iPhone"></a>4.2.2 iPhone</h4><p>对于 Apple 上的 iPhone&#x2F;iPad，就比较麻烦了。因为相关的客户端在国内的 App Store 上全都被下架了。所以，你需要注册一个美国的苹果ID，然后 iTunes&#x2F;App Store 用这个美区的ID登录（不是退出iCloud ，而是退出App Store）。</p><p>关于如何注册美区 Apple ID账号，你需要有两个前提条件：</p><ul><li>你需要有一个美国的手机号码。</li><li>还需要有一个美国的 PayPal 账号。</li></ul><p>关于如何搞到美国的手机号以及美国的 PayPal 账号以及其必要性，可以参看<a href="(#5-%E7%BE%8E%E5%9B%BD%E6%89%8B%E6%9C%BA%E5%92%8C%E6%94%AF%E4%BB%98)">5. 美国手机和支付</a></p><p>然后，你就可以用电脑登录 <a href="https://appleid.apple.com/">https://appleid.apple.com/</a> 全新注册一个帐号，注册的时候，你需要选择美国的地区，然后，你需要用你的美国手机号码接收验证码，最后，你需要用你的美国 PayPal 账号来绑定你的信用卡。</p><p>iPhone 上的客户端我推荐使用下面这两个（需要付费）,这两个客户端都支持很多协议，如：ShadowSocks, HTTP(s), VMess, Socks5,等。</p><ul><li><a href="https://apps.apple.com/us/app/shadowrocket/id932747118">ShadowRocket</a>，又叫小火箭，其中使用 HTTPS 的代理，配置上就好了。</li><li><a href="https://apps.apple.com/us/app/quantumult/id1252015438">Quantumult</a>。这个工具以前用的不多，最近 1-2 年都在有这个工具，感觉还是很好用的。对了，大家一定要不要跟 <code>Quantumult X</code> 搞混，我个人觉得 <code>Quantumult X</code> 非常难用。</li></ul><blockquote><p><strong>Note</strong></p><p><a href="https://apps.apple.com/us/app/potatso-lite/id1239860606">Potatso</a> 作为 shadowsocks 的客户端也是可以的，而且免费，但是无法使用 Gost 的 HTTPS 代理，所以，我不推荐使用。</p></blockquote><h3 id="4-3-平板端设置-服务端使用gost代理"><a href="#4-3-平板端设置-服务端使用gost代理" class="headerlink" title="4.3 平板端设置 (服务端使用gost代理)"></a>4.3 平板端设置 (服务端使用gost代理)</h3><h4 id="4-3-1-iPad"><a href="#4-3-1-iPad" class="headerlink" title="4.3.1 iPad"></a>4.3.1 iPad</h4><ul><li><p>ShadowRocket：打开app，点击右上角<code>+</code>号添加服务器，配置如下几项即可（其余条目采用默认值即可）</p><ul><li>Type: <code>HTTPS</code></li><li>Address: <code>$DOMAIN</code></li><li>Port: <code>443</code></li><li>User: <code>$USER</code></li><li>Password: <code>$PASS</code></li></ul><p>其中，<code>$DOMAIN</code>为服务器的域名&#x2F;子域名，<code>$USER</code>与<code>$PASS</code>分别为服务端启动gost代理时设定的用户名和密码</p></li></ul><h2 id="5-美国手机和支付"><a href="#5-美国手机和支付" class="headerlink" title="5. 美国手机和支付"></a>5. 美国手机和支付</h2><p>现在越来越多 APP 需要使用海外的手机和支付，所以，你需要有一个美国的手机号码和美国的支付方式。</p><h3 id="5-1-美国手机"><a href="#5-1-美国手机" class="headerlink" title="5.1 美国手机"></a>5.1 美国手机</h3><p>美国的手机号目前最好的方式是购买 <a href="https://www.ultramobile.com/zh/paygo/">Ultra Mobile 的 PayGo</a> 月租 3 美金，你可以上淘宝上购买。这个卡是真实的美国手机号码，在中国漫游时，短信和接听电脑会产生漫游费用，所以，你一定要<a href="https://www.ultramobile.com/zh/ufaqs/%E5%A6%82%E4%BD%95%E5%9C%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E8%AE%BE%E7%BD%AEwifi%E9%80%9A%E8%AF%9D%E5%92%8C%E7%9F%AD%E4%BF%A1/">开启 WiFi Calling</a>。有时候，你的网络可能无法让你开启 WiFi Calling，这个可能是运营上 block 了相关路由，你可能需要设置你的路由器，这里<a href="https://zhuanlan.zhihu.com/p/411052451">有篇文章</a>你可以了解一下.</p><p>这里不推荐使用 <a href="https://voice.google.com/">Google Voice</a>。 因为你注册 Google Voice 的时候也需要一个实体卡，如果你有朋友在美国的话，你可以借用朋友的手机帮你生成一个，但是就算是生成了，美国也有很多 APP 无法接收 Google Voice 的验证码，因为风控的问题不支持虚拟运营商。</p><h3 id="5-2-美国支付"><a href="#5-2-美国支付" class="headerlink" title="5.2 美国支付"></a>5.2 美国支付</h3><p>关于美国的支付，你可以注册一个美国的 PayPal，这个对于 iPhone&#x2F;iPad 转美区 App Store 来说是很方便的。</p><p>你可以使用你在国内的币种（支持 VISA&#x2F;MasterCard）的信用卡来开国际 PayPal  帐号。开通国际 PayPal 帐号需要以下几个条件：</p><ul><li>身在美国（系统会自动检测IP地址）</li><li>有效美国地址（最好是私人地址，必要时能提交地址证明）</li><li>有效美国手机号码（必需是能接收短信）</li></ul><p><strong>注意：如果你没有美国的 SSN 或是美国的银行帐号，你是可以支付的，但是不能收款的。所以，千万不要用来收款！</strong></p><p>但是，现在很多美国的公司都不使用 PayPal 做他们的支付网关，而是使用 <a href="https://stripe.com/">Stripe</a>，这两家公司是竞争关系，所以，你是不能使用 PayPal 来支付的，而 Stripe 的风控比较严格，所以你需要有一个美国的信用卡。</p><p>拥有一个美国的信用卡是一件极其麻烦的事，因为你首先需要有一个美国的银行帐户，而美国的银行帐户也分对公和对私，对公的帐户是需要有美国的公司才能开的，对私的帐户是需要你有美国的 SSN 才能开的。所以，这个事情就变得很复杂了。</p><p>下面是一些可行的操作，你可以参考一下：</p><ul><li>找你美国的朋友，让他们帮你开一个虚拟信用卡。</li><li>通过支付加密货币USDT到 <a href="https://www.depay.one/?lang=zh-cn">Depay</a> 上开通虚拟信用卡，操作复杂。</li><li>找淘宝店帮你支付可能会是一个比较好的选择，代价就是你需要把你的帐号和密码给他们，这个风险你需要自己承担。</li><li>有美国B1&#x2F;B2旅游签证就可以在美国的银行开户。</li></ul><p>如果大家有更好的方式，欢迎提交PR。</p><h2 id="6-流量伪装和防探测"><a href="#6-流量伪装和防探测" class="headerlink" title="6. 流量伪装和防探测"></a>6. 流量伪装和防探测</h2><p>无论你用VPN，SS，SSR，都有可以被识别， 我实践下来的结果是，<strong>只有使用 HTTP over TLS 的样子，才会跟正常的流量混在一起，很难被识别</strong>，所以，目前来说，使用Gost 的 HTTPS 的方式 再加上防探测的机制，基本上来说，在网络四层上看到的都是TLS的包，很难被识别。另外，用V2Ray客户端 + Nginx + V2Ray服务端的方式也是可以，不过配置起来比较复杂。 （注：关于流量识别和探测的细节，你可以看查看<a href="https://gfw.report/publications/usenixsecurity23/zh/">这篇文章</a> ）</p><p>也就是说，在启动 Gost 的时候，需要设置 <code>probe_resist</code> 参数，关于这个参数，我们在上面的章节中已经提到过了，这里再说一下。</p><p>你可以先创建一个 如下的  <code>/var/www/html/index.html</code> 的文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">        <span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>For online documentation and support please refer to<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Commercial support is available at<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Thank you for using nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后，在 Gost 的启动上加上这个参数：<code>probe_resist=file:/var/www/html/index.html</code>，这样，当有人探测你的端口的时候，会返回这个文件的内容，这样，就会让探测者以为你的端口是一个 Web 服务器，而不是一个代理服务器。</p><p>完整的启动脚本如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># 下面的四个参数需要改成你的</span><br>DOMAIN=<span class="hljs-string">&quot;YOU.DOMAIN.NAME&quot;</span><br>USER=<span class="hljs-string">&quot;username&quot;</span><br>PASS=<span class="hljs-string">&quot;password&quot;</span><br>PORT=443<br><br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=<span class="hljs-variable">$&#123;CERT_DIR&#125;</span>/live/<span class="hljs-variable">$&#123;DOMAIN&#125;</span>/fullchain.pem<br>KEY=<span class="hljs-variable">$&#123;CERT_DIR&#125;</span>/live/<span class="hljs-variable">$&#123;DOMAIN&#125;</span>/privkey.pem<br>sudo docker run -d --name gost \<br>    -v <span class="hljs-variable">$&#123;CERT_DIR&#125;</span>:<span class="hljs-variable">$&#123;CERT_DIR&#125;</span>:ro \<br>    --net=host ginuerzh/gost \<br>    -L <span class="hljs-string">&quot;http2://<span class="hljs-variable">$&#123;USER&#125;</span>:<span class="hljs-variable">$&#123;PASS&#125;</span>@<span class="hljs-variable">$&#123;BIND_IP&#125;</span>:<span class="hljs-variable">$&#123;PORT&#125;</span>?cert=<span class="hljs-variable">$&#123;CERT&#125;</span>&amp;key=<span class="hljs-variable">$&#123;KEY&#125;</span>&amp;probe_resist=file:/var/www/html/index.html&amp;knock=www.google.com&quot;</span><br></code></pre></td></tr></table></figure><h2 id="7-针对-IP-被封的解决方案"><a href="#7-针对-IP-被封的解决方案" class="headerlink" title="7. 针对 IP 被封的解决方案"></a>7. 针对 IP 被封的解决方案</h2><p>花钱购买的 VPS 即便做了流量伪装依然有很大的几率 IP 被封锁，大多 VPS 服务商并不提供更换 IP 的服务，使用 CDN 可以让被封锁的 VPS 继续发挥翻墙功能。</p><p>Cloudflare 是一个 CDN 服务商，目前国内依然能正常的访问，可以作为跳板来实现翻墙。</p><p>注册 Cloudflare 帐号，并有一个空闲域名（ 需要使用二级域名），交给 Cloudflare 托管并将域名指向被封的 VPS IP。Cloudflare 只需免费方案足以，不必花钱。</p><p>使用 Cloudflare 进行套壳需要有如下的条件：</p><ul><li>无论是 V2Ray 还是 gost，都需要使用 WebSocket 传输协议</li><li>Cloudflare 的端口号只能代理有限的几个， 推荐使用： <code>80</code>, <code>8080</code>, <code>443</code> 或 <code>8443</code></li><li>客户端这边需要使用对应的客户端，比如 gost 或 v2ray 的客户端进行 WebSocket 的连接</li></ul><p>关于优选IP，可以手动更改本地hosts文件指向最佳IP。</p><p>目前支持 WebSocket 的免费 CDN 似乎只有 Cloudflare 一家，国内 CDN 服务商既不支持也不安全，不要考虑了。如果有更好的服务商欢迎补充。</p><p>网络延迟比直连增加不少，如果是频繁操作会很痛苦。网络带宽如果运气好可能比直连还优化了，用来看 Youtube 搞不好更流畅。</p><h2 id="8-家用透明网关"><a href="#8-家用透明网关" class="headerlink" title="8. 家用透明网关"></a>8. 家用透明网关</h2><h3 id="8-1-OpenWRT-路由器"><a href="#8-1-OpenWRT-路由器" class="headerlink" title="8.1 OpenWRT 路由器"></a>8.1 OpenWRT 路由器</h3><p>所谓透明网关的意思是，一切都交给网关来做。最好的方式是你需要一个 OpenWRT 的路由器，推荐使用华硕的路由器，贵是贵一些，但是这几年用下来，非常不错。我用的是  <strong>华硕（ASUS） RT-AC68U 1900M AC 双频智能无线路由路</strong> 。</p><p>路由器买来后，要刷一下固件。首先 Asuswrt 是华硕公司为他的路由器所开发的固件。Asuswrt-merlin是一个对Asuswrt固件二次开发进行各种改进和修正的项目。源代码在这里：<a href="https://github.com/RMerl/asuswrt-merlin">https://github.com/RMerl/asuswrt-merlin</a></p><p>不必担心把路由器刷废了，华硕的路由器可以让你一键重置回来</p><p><strong>1）下载固件</strong>。先到 <a href="https://www.asuswrt-merlin.net/download">https://www.asuswrt-merlin.net/download</a> 下载相应的固件，并解压。（我下载的是 <code>RT-AC68U_380.61_0.zip</code> ）</p><p><strong>2）升级固件</strong>。登录到你的路由器后台 <code>http://192.168.1.1/</code> ，在 <code>系统管理</code> -&gt; <code>固件升级</code> 中上传固件文件（我上传的是：<code>RT-AC68U_380.61_0.trx</code>）</p><p><strong>3）打开 JFFS 分区</strong>。<code>系统管理</code> -&gt; <code>系统设置</code> -&gt; <code>Persistent JFFS2 partition</code></p><ul><li><code>Format JFFS partition at next boot</code> - <code>否</code></li><li><code>Enable JFFS custom scripts and configs</code> - <code>是</code></li></ul><p><strong>4）打开 ssh 登录</strong>。 <code>系统管理</code> -&gt; <code>系统设置</code> -&gt; <code>SSH Daemon</code></p><ul><li><code>Allow SSH password login</code> - <code>是</code></li></ul><p>接下来，在 WiFi 路由器上安装 Clash，就可以了。</p><p>大概的示意图如下所示。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">    Phone/PC/Pad （无需设置）<br>         │<br>         │<br>         │ 1<br>         │<br>┌────────▼──────┐<br>│               │<br>│  WiFi Router  │ （安装 Clash 网关）<br>│               │<br>└─────┬────┬────┘<br>      │    │<br>      │    │ 2<br>      │    └────────► 墙内 - China<span class="hljs-built_in"> LAN</span><br><span class="hljs-built_in"></span>   3  │<br>┌─────▼──────┐<br>│    VPS     │<br>│  <span class="hljs-built_in"> Proxy </span>   │<br>└─────┬──────┘<br>      │<br>      │<br>      ▼<br>    墙外 - Internet<span class="hljs-built_in"> WAN</span><br><span class="hljs-built_in"></span><br></code></pre></td></tr></table></figure><h3 id="8-2-通过树莓派做旁路网关"><a href="#8-2-通过树莓派做旁路网关" class="headerlink" title="8.2 通过树莓派做旁路网关"></a>8.2 通过树莓派做旁路网关</h3><p>如果你的路由器不能刷 OpenWRT，也就是没法通过SSH登录上去装软件，你就用一个别的设备。比如用一个树莓派。我正好有一个很老旧的树莓派，刷了一个老旧的 Debian 7.5的操作系统。</p><p>把它连上你的路由器上，然后，</p><ul><li>你需要把你设备上的IP地址、网关和DNS服务器都要手动设置到这个树莓派上。</li><li>于是，所有的路由就会通过路由器转到树莓派上，再由树莓派决定是否要走代理。</li></ul><p>大概的示意图如下所示。</p><ul><li>1 –&gt; 2 是设备把所有的请求都发给树莓派。</li><li>3 –&gt; 3.1 或 3.2 是由树莓派来决走是否翻墙。</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">    Phone/PC/Pad （设置<span class="hljs-string">&quot;网关&quot;</span>和<span class="hljs-string">&quot;DNS&quot;</span>为树莓派）<br>         │<br>         │<br>         │ 1<br>         │                    （安装 Clash 网关）<br>┌────────▼──────┐      2       ┌───────────┐<br>│               ├──────────────►           │<br>│  WiFi Router  │              │   树莓派   │<br>│               ◄──────────────┤           │<br>└─────┬────┬────┘      3       └───────────┘<br>      │    │<br>      │    │ 3.2<br>      │    └────────► 墙内 - China<span class="hljs-built_in"> LAN</span><br><span class="hljs-built_in"></span>  3.1 │<br>┌─────▼──────┐<br>│    VPS     │<br>│  <span class="hljs-built_in"> Proxy </span>   │<br>└─────┬──────┘<br>      │<br>      │<br>      ▼<br>    墙外 - Internet<span class="hljs-built_in"> WAN</span><br><span class="hljs-built_in"></span><br></code></pre></td></tr></table></figure><h3 id="8-3-安装-Clash"><a href="#8-3-安装-Clash" class="headerlink" title="8.3 安装 Clash"></a>8.3 安装 Clash</h3><p>Clash 的 Github项目是：<a href="https://github.com/Dreamacro/clash">Dreamacro&#x2F;clash</a> ，在它的 Release 页面上，你可以找到相关的下载。（注：在本文更新的时候，如果你需要支持 Tun，你需要下载 Clash 的 <a href="https://github.com/Dreamacro/clash/releases/tag/premium">Premium 版本</a></p><p>Clash 支持很多翻墙协议：ShadowSocks(R), Vmess, Socks5, HTTP(s)，Snell，Trojan。</p><p>在你的 OpenWRT 或 树莓派 下用 <code>uname -m</code> 查看一下你的硬件架构是什么的，比如，我的是华硕和树莓派都是 <code>armv7l</code> 的，所以，需要下载 <code>clash-linux-armv7-....</code>的版本（注：根据 clash 官方仓库 <a href="https://github.com/Dreamacro/clash/issues/189">Dreamacro&#x2F;clash#189</a> 系列固件不适用 armv7l 架构的 AC68U，需选择 armv5）。 下载完解压后，加个可执行权限 <code>chmod +x clash</code> 就可以运行了，不过，还差一个界面和两个配置文件，它们的目录关系如下：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">├── clash                &lt;- 建一个 clash 的目录<br>│   ├── clash            &lt;- 运行文件<br>│   ├── config.yaml      &lt;- 配置文件<br>│   ├── Country.mmdb     &lt;- IP地址库<br>│   └── ui               &lt;- Clash 的 UI<br>│       ├── index.html<br>│       ├── ...<br></code></pre></td></tr></table></figure><ul><li><p>UI界面可以到 <a href="https://github.com/haishanh/yacd">haishah&#x2F;yacd</a> 下载。放到clash的配置目录下 <code>ui</code> 目录下</p></li><li><p>一个是 <code>Country.mmdb</code> 这是IP地址的在哪个国家的数据库。你需要到这里下载 - <a href="https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb">Country.mmdb</a> （当然，clash启动时，会自动下载，我这里给你一个手动下载的链接）</p></li><li><p>另一个是 <code>config.yaml</code> 文件，这个文件详细解释可参看 - <a href="https://github.com/Dreamacro/clash/wiki/configuration">官方Wiki</a></p></li></ul><p>下面是个示例：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">port:</span> <span class="hljs-number">7890</span><br><span class="hljs-attr">socks-port:</span> <span class="hljs-number">7891</span><br><span class="hljs-attr">redir-port:</span> <span class="hljs-number">7892</span><br><span class="hljs-attr">mixed-port:</span> <span class="hljs-number">7893</span><br><span class="hljs-attr">ipv6:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">allow-lan:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">mode:</span> <span class="hljs-string">Rule</span><br><span class="hljs-attr">log-level:</span> <span class="hljs-string">info</span><br><span class="hljs-attr">external-controller:</span> <span class="hljs-string">&#x27;0.0.0.0:9090&#x27;</span><br><span class="hljs-attr">external-ui:</span> <span class="hljs-string">ui</span><br><span class="hljs-attr">secret:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attr">tun:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">stack:</span> <span class="hljs-string">system</span><br>  <span class="hljs-attr">dns-hijack:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tcp://8.8.8.8:53</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">udp://8.8.8.8:53</span><br><span class="hljs-attr">dns:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">ipv6:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">listen:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:53</span><br>  <span class="hljs-attr">default-nameserver:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>  <span class="hljs-comment">#enhanced-mode: redir-host</span><br>  <span class="hljs-attr">enhanced-mode:</span> <span class="hljs-string">fake-ip</span> <span class="hljs-comment">#如果要玩netflix，需要使用fake-ip</span><br>  <span class="hljs-attr">fake-ip-range:</span> <span class="hljs-number">198.18</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">/16</span><br>  <span class="hljs-attr">nameserver:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tls://8.8.8.8:853</span><br>  <span class="hljs-attr">fallback:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">tls://8.8.8.8:853</span><br><br><span class="hljs-comment"># 两个代理服务器</span><br><span class="hljs-attr">proxies:</span><br>  <span class="hljs-comment"># http</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;https01&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https.server.domain</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">user</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;password&quot;</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># https</span><br>    <span class="hljs-attr">skip-cert-verify:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;https01&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https.server.domain</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">user</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;passowrd&quot;</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># https</span><br>    <span class="hljs-attr">skip-cert-verify:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 配置 Group</span><br><span class="hljs-attr">proxy-groups:</span><br>  <span class="hljs-comment"># 自动切换</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;auto&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">url-test</span><br>    <span class="hljs-attr">proxies:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us01_https</span><br>      <span class="hljs-comment">#- us02_https</span><br>      <span class="hljs-comment">#- hk_https</span><br>    <span class="hljs-comment"># tolerance: 150</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://www.google.com/&#x27;</span><br>    <span class="hljs-attr">interval:</span> <span class="hljs-number">300</span><br>  <span class="hljs-comment"># 按需选择 - 可以在UI上选择</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;netflix&quot;</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">select</span><br>    <span class="hljs-attr">proxies:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us01_https</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">us02_https</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">hk_https</span><br><br><span class="hljs-attr">rules:</span><br><span class="hljs-comment"># LAN</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,local,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,127.0.0.0/8,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,172.16.0.0/12,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,192.168.0.0/16,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,10.0.0.0/8,DIRECT</span><br><br><span class="hljs-comment"># Netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,fast.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,api-global.netflix.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,netflix.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,netflix.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxext.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflximg.com,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflximg.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxso.net,netflix</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,nflxvideo.net,netflix</span><br><br><span class="hljs-comment"># 最终规则（除了中国区的IP之外的，全部翻墙）</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">GEOIP,CN,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">MATCH,auto</span><br><br></code></pre></td></tr></table></figure><p>更多的规则网上可以找到很多，也可以参看这里：<a href="https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/clash.yaml">SS-Rule-Snippet&#x2F;LAZY_RULES&#x2F;clash.yaml</a></p><p>这个时候你就可以启动 clash 了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/path/to/clash/cash -d /path/to/clash &amp;<br></code></pre></td></tr></table></figure><p>然后，你就可以把你的上网设备上的 路由网关 和 DNS 服务器都手动地配置成这个网关就好了（OpenWRT应该不用配置了，树莓派的方式需要手动配置一下）</p><h3 id="8-4-设置-iptables-转发"><a href="#8-4-设置-iptables-转发" class="headerlink" title="8.4 设置 iptables 转发"></a>8.4 设置 <code>iptables</code> 转发</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">iptables -t nat -N CLASH<br>iptables -t nat -A CLASH -d 10.0.0.0/8 -j RETURN<br>iptables -t nat -A CLASH -d 127.0.0.0/8 -j RETURN<br>iptables -t nat -A CLASH -d 169.254.0.0/16 -j RETURN<br>iptables -t nat -A CLASH -d 172.16.0.0/12 -j RETURN<br>iptables -t nat -A CLASH -d 192.168.0.0/16 -j RETURN<br>iptables -t nat -A CLASH -d 224.0.0.0/4 -j RETURN<br>iptables -t nat -A CLASH -d 240.0.0.0/4 -j RETURN<br>iptables -t nat -A CLASH -p tcp -j REDIRECT --to-ports 7892<br></code></pre></td></tr></table></figure><p>然后，你可以保存一下这些 iptables 的规则</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">iptables-save &gt; /etc/iptables.up.rules<br></code></pre></td></tr></table></figure><p>编辑  <code>/etc/network/if-pre-up.d/iptables</code>，在网卡启动的时候加载这些规则</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>/sbin/iptables-restore &lt; /etc/iptables.up.rules<br></code></pre></td></tr></table></figure><p>然后，再 <code>chmod +x /etc/network/if-pre-up.d/iptables</code> 加上可执行权限就好了。</p><h2 id="9-数据中心透明网关"><a href="#9-数据中心透明网关" class="headerlink" title="9. 数据中心透明网关"></a>9. 数据中心透明网关</h2><p>这里仅针对 AWS 进行说明，其它云平台应该大同小异，大家可以补充。</p><h3 id="9-1-AWS-网络构建"><a href="#9-1-AWS-网络构建" class="headerlink" title="9.1 AWS 网络构建"></a>9.1 AWS 网络构建</h3><ol><li><p>构建一个 <code>172.20.0.0/16</code> 的 VPC，分成两个子网：</p><ul><li>有公网IP的公有子网 - <code>172.20.1.0/24</code></li><li>无公网IP的私有子网 - <code>172.20.2.0/24</code></li></ul></li><li><p>在公有子网里创建 <a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/VPC_NAT_Instance.html">EC2 NAT Instance</a></p><ul><li>创建时，指定私网IP为 <code>172.20.1.1</code></li><li>（Option）为该实例分配弹性IP，可成为外网访问内网的跳板机</li></ul></li><li><p>建立路由规则</p><ul><li>创建“互联网网关”，并把“互联网网关”添加到公有子网 <code>172.20.1.0/24</code> 的路由表中</li><li>把 EC2 NAT Instance  <code>172.20.1.1</code> 添加到私有子网<code>172.20.2.0/24</code>的路由表中。</li></ul></li></ol><p>于是整个网络就如下所示。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dns">                                  ┌──────────┐<br>                                  │          │<br>                                  │          │<br>                                  └──────────┘<br>        弹性IP                      互联网网关<br>      ┌───────────────┐                ▲<br>      │xxx.xxx.xxx.xxx├─┐              │<br>      └───────────────┘ │  ┌───────────┘<br>                        │  │<br>                ┌───────┼──┼────────┐       ┌───────────────────┐<br>                │       │  │        │       │                   │<br>                │     ┌─┴──▼──┐     │       │  ┌─┐ ┌─┐ ┌─┐ ┌─┐  │<br>Public Network  │     │       │◄────┼───┬───┼─►└─┘ └─┘ └─┘ └─┘  │  Private Network<br>                │     └───────┘     │   │   │                   │<br>                │  EC2 NAT Instance │   │   │  ┌─┐ ┌─┐ ┌─┐ ┌─┐  │<br>                │    <span class="hljs-number">172.20.1.1</span>     │   ├───┼─►└─┘ └─┘ └─┘ └─┘  │<br>                │                   │   │   │                   │<br>                │   (NAT Instance)  │   │   │    ┌─┐ ┌─┐ ┌─┐    │<br>                │                   │   └───┼─►  └─┘ └─┘ └─┘    │<br>                │                   │       │                   │<br>                └───────────────────┘       └───────────────────┘<br><br>                    <span class="hljs-number">172.20.1.0</span>/<span class="hljs-number">24</span>              <span class="hljs-number">172.20.2.0</span>/<span class="hljs-number">24</span><br>                         ▲                            ▲<br>                  subnet │                            │ subnet<br>                         │                            │<br>                         └──────────  VPC  ───────────┘<br>                                 <span class="hljs-number">172.20.0.0</span>/<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><p>注：你需要认真的按照 <a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/VPC_NAT_Instance.html">EC2 NAT Instance</a> 的文档进行设置这个NAT实例。尤其需要设置下面几项：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo sysctl -w net.ipv4.ip_forward=1<br>sudo iptables -A FORWARD -i eth0 -j ACCEPT<br>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>顺便科普一下：</p><ul><li><code>net.ipv4.ip_forward</code> 是内核参数，主要是用来把Linux当成路由器来用的参数。一般来说，一个路由器至少要有两个网络接口，一个是WAN，的一个是LAN的，为了让LAN和WAN的流量相通，需要进行内核上路由。</li><li><code>iptables -A FORWARD -i eth0 -j ACCEPT</code> 通行所有需要转发的包，只有机器成为一个路由器时，需要在两个网卡间进行网络包转发时，才需要配置这条规则。</li><li><code>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code>  关键字 <code>MASQUERADE</code> 意思是“伪装“，NAT的工作原理是就像是一个宿舍收发室对学生宿舍一样，学生宿舍的地址外部不可见，邮递员只看得见整栋宿舍收发室的地址，邮递员把快递交给收发室，收发室再把快递转给学习宿舍（反之，如果学生要对外寄邮件，也是先到收发室，收发室传给邮局）。现在的问题是，所有的学生宿舍如何才能参与到任何快递的通信中，如果把学生宿舍地址发到外部，则没人能把信送回来。如果这个收发室是个自动化的机器人，他要干的事就是，把学生宿舍的地址换成收发室地址。这就是 <code>MASQUERADE</code> 的意思——<strong>来自具有接收方 IP 地址的本地网络到达 Internet 某处的数据包必须进行修改，也就是让发送方的地址等于路由器的地</strong>址。</li></ul><h3 id="9-2-安装-Clash"><a href="#9-2-安装-Clash" class="headerlink" title="9.2 安装 Clash"></a>9.2 安装 Clash</h3><p>在 EC2 NAT Instance 上安装 clash 透明网关，安装配置参看 <a href="#83-%E5%AE%89%E8%A3%85-clash">8.3 安装 Clash</a> ，基本一致。</p><blockquote><p>注：在实际操作中，没有设置 <code>iptables</code> 转发规则</p></blockquote><h3 id="9-3-配置私有子网中的-EC2"><a href="#9-3-配置私有子网中的-EC2" class="headerlink" title="9.3 配置私有子网中的 EC2"></a>9.3 配置私有子网中的 EC2</h3><p>只需要配置 <code>/etc/resolv.conf</code> 文件，把 EC2 NAT Instance 加入其中。如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs conf"># /etc/resolv.conf<br>nameserver 172.20.1.1  #&lt;--- 透明网关 EC2 NAT 实例<br>nameserver 172.20.0.2  #&lt;--- AWS 的 DNS 服务<br>search [zone].compute.internal<br></code></pre></td></tr></table></figure><blockquote><p><strong>Note</strong></p><p>新版的 Ubuntu 已经把 DNS Resolver 托管给了 systemd 的 <code>systemd-resolved</code> 服务，所以需要把 <code>/etc/resolv.conf</code> 文件改成软链接，指向 <code>systemd-resolved</code> 的配置文件，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">ln</span> -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf<br></code></pre></td></tr></table></figure><p>然后，在 <code>/etc/systemd/resolved.conf</code> 文件中，把 <code>DNS</code> 和 <code>Domains</code> 配置项加上，如：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs conf">DNS=172.20.0.2<br></code></pre></td></tr></table></figure></blockquote><h3 id="9-4-私有子网中的-Kubernetes"><a href="#9-4-私有子网中的-Kubernetes" class="headerlink" title="9.4 私有子网中的 Kubernetes"></a>9.4 私有子网中的 Kubernetes</h3><p>K8s 里有两组 CoreDNS 部署和配置，一组是边缘的（或是叫本地的），一组是中心的。</p><ul><li>边缘的 Pod 名叫 <code>nodelocaldns</code>，侦听在本机。如：<code>169.254.25.10:53</code></li><li>中心的 Pod 名叫 <code>coredns</code>，侦听在 cluster IP 上，如：<code>10.233.0.3:53</code></li></ul><p>边缘的规则会把k8s的域名 <code>cluster.local</code>, <code>in-addr.arp</code> <code>ip6.arpa</code> 转给中心的 CoreDNS 处理，其它的交给本地的 <code>/etc/resolv.conf</code> 处理。</p><p>Kubernetes 会把如下内容打到 Pod 里的 <code>/etc/resolv.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs conf">nameserver 169.254.25.10<br>search default.svc.cluster.local svc.cluster.local cluster.local cn-northwest-1.compute.internal<br>options ndots:5<br></code></pre></td></tr></table></figure><p>查看一下 <code>nodelocaldns</code> 的配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get cm nodelocaldns -n kube-system -o yaml<br></code></pre></td></tr></table></figure><p>我们可以看到，除了 K8s 自己的域名外，其它的都交给了本机的 <code>/etc/resolv.conf</code>，如下所示：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">.:53</span> &#123;<br>    <span class="hljs-string">errors</span><br>    <span class="hljs-string">cache</span> <span class="hljs-number">30</span><br>    <span class="hljs-string">reload</span><br>    <span class="hljs-string">loop</span><br>    <span class="hljs-string">bind</span> <span class="hljs-number">169.254</span><span class="hljs-number">.25</span><span class="hljs-number">.10</span><br>    <span class="hljs-string">forward</span> <span class="hljs-string">.</span> <span class="hljs-string">/etc/resolv.conf</span>  <span class="hljs-comment"># &lt;--- 注意这条语句</span><br>    <span class="hljs-string">prometheus</span> <span class="hljs-string">:9253</span><br>&#125;<br></code></pre></td></tr></table></figure><p>然而，本机的 <code>/etc/resolv.conf</code> 里有两个 DNS，一个是我们的透明网关，一个是AWS的。而 CoreDNS 的 <code>forward</code> 策略是随机挑选，所以，这样的会导致，时而交给AWS处理，时而交给我们自己的clash处理。最终导致IP解析紊乱。</p><p>通过以下命令进行修改：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl edit cm nodelocaldns -n kube-system<br></code></pre></td></tr></table></figure><p>修改如下：（AWS的归 172.20.0.2， 其它的走我们自己的网关）</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+    compute.internal:53 &#123;</span><br><span class="hljs-addition">+        errors</span><br><span class="hljs-addition">+        cache 30</span><br><span class="hljs-addition">+        reload</span><br><span class="hljs-addition">+        loop</span><br><span class="hljs-addition">+        bind 169.254.25.10</span><br><span class="hljs-addition">+        forward . 172.20.0.2</span><br><span class="hljs-addition">+        prometheus :9253</span><br><span class="hljs-addition">+    &#125;</span><br>     .:53 &#123;<br>         errors<br>         cache 30<br>         reload<br>         loop<br>         bind 169.254.25.10<br><span class="hljs-deletion">-        forward . /etc/resolv.conf</span><br><span class="hljs-addition">+        forward . /etc/resolv.conf &#123;</span><br><span class="hljs-addition">+            policy sequential</span><br><span class="hljs-addition">+        &#125;</span><br>         prometheus: 9253<br>     &#125;<br></code></pre></td></tr></table></figure><p>退出保存后，等大约30秒左右配置就会生效。</p><h2 id="10-代理技巧"><a href="#10-代理技巧" class="headerlink" title="10. 代理技巧"></a>10. 代理技巧</h2><p>看到这里，相信已经能够按照上面的教程搭建好自己的上网环境，但是灵活的应用网络，你还需要了解一些技巧，比如 SOCKS 协议, http 隧道 和 ssh 网络隧道等。</p><ol><li><a href="https://zh.m.wikipedia.org/zh-hans/SOCKS">SOCKS 协议</a></li><li><a href="https://zh.m.wikipedia.org/zh-hans/HTTP%E9%9A%A7%E9%81%93">HTTP 隧道</a></li></ol><h3 id="10-1-HTTP-隧道"><a href="#10-1-HTTP-隧道" class="headerlink" title="10.1 HTTP 隧道"></a>10.1 HTTP 隧道</h3><p>常见的软件 curl , git, wget 都能通过设置 <code>HTTP_PROXY</code>,<code>HTTPS_PROXY</code>，<code>NO_PROXY</code> 来配置一个网络代理，<code>NO_PROXY</code>用来配置不需要代理的主机(多个用逗号隔开), 那么我们就可以编写一个 <code>bash </code> 函数来运行需要走代理的命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">with_proxy()&#123;<br>   HTTPS_PROXY=http://127.0.0.1:7890 HTTP_PROXY=http://127.0.0.1:7890 &quot;$@&quot;<br>&#125;<br></code></pre></td></tr></table></figure><p>把上面的 <code>127.0.0.1:7890</code> 改成你自己的网络代理, 将上面脚本写入到 <code>~/.bashrc</code> 中， <code>source ~/.bashrc</code> 后就能使用 <code>with_proxy</code> 这个函数了，比如我想要使用代理网络下载一个文件 <code>with_proxy wget https://....</code>, 想要使用代理网络从 <code>github</code> clone 一个项目 <code>with_proxy git clone https://...</code>, 当我们不用 <code>with_proxy</code> 这个函数的时候命令是不会走代理的，如果在 <code>windows</code> 上你也想要使用这样的功能，可以使用这个项目<a href="https://github.com/hellojukay/with-env">with-env</a>。</p><p>另外，你也可以使用如下的两个 alias:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">SOCKS=&quot;socks5://127.0.0.1:1085&quot;<br>alias proxy=&quot;export http_proxy=$&#123;SOCKS&#125; https_proxy=$&#123;SOCKS&#125; all_proxy=$&#123;SOCKS&#125;&quot;<br>alias unproxy=&#x27;unset all_proxy http_proxy https_proxy&#x27;<br></code></pre></td></tr></table></figure><p>这样，你就可以在需要代理的时候输入 <code>proxy</code>，不需要的时候输入 <code>unproxy</code>。</p><h3 id="10-2-SSH-隧道"><a href="#10-2-SSH-隧道" class="headerlink" title="10.2 SSH 隧道"></a>10.2 SSH 隧道</h3><p>另外，我们可以使用 SSH Tunnel 来建立 SOCKS5 的代理（假设本地电脑无法访问，但是某台可以 SSH 的服务器能够访问外网，那么我们就可以使用如下的命令来建议翻墙代理：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -D 1080 -qCN username@server:port<br></code></pre></td></tr></table></figure><p>解释：</p><ul><li><code>-D</code>：本机SOCKS 服务端口</li><li><code>-q</code> : quiet 模式，没有输出</li><li><code>-C</code> : 数据压缩，可以节约一些带宽</li><li><code>-N</code> : 不运行远程命令，只做端口转发</li></ul><p>登录成功以后,本地 <code>1080</code>端口会开启一个 <code>SOCKS5</code> 协议的代理，只要配置好代理就能使用这个端口上网。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">with_proxy()&#123;<br>   HTTPS_PROXY=socks5://127.0.0.1:1080 HTTP_PROXY=socks5://127.0.0.1:1080 &quot;$@&quot;<br>&#125;<br></code></pre></td></tr></table></figure><p>如果是浏览器，配置好<code>SwitchyOmega</code>插件也能实现上外网。</p><h3 id="10-3-Github-x2F-Git-SSH-代理"><a href="#10-3-Github-x2F-Git-SSH-代理" class="headerlink" title="10.3 Github &#x2F; Git SSH 代理"></a>10.3 Github &#x2F; Git SSH 代理</h3><p>现在访问 Github 速度很慢甚至不通，我们可以使用代理来加速，首先我们需要配置好代理，然后配置好 <code>git</code> 的代理，这样就能加速 <code>git clone</code> 和 <code>git push</code> 了。</p><p>当你使用  <code>git clone ssh://[user@]server/project.git</code> 或是 <code>git clone [user@]server:project.git</code> 的时候，你是在使用 SSH 协议。你需要配置  <code>~/.ssh/config</code> 来使用代理，比如我的本地有一个Sock5代理，端口是 1085，那么我可以这样配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs s">### github.com<br>Host github.com<br>    Hostname github.com<br>    ProxyCommand nc -x localhost:1085 %h %p<br>    # git-for-windows 下可以用 connect 代替 nc<br>    # ProxyCommand connect -S localhost:1085 %h %p<br></code></pre></td></tr></table></figure><h3 id="10-4-Cloudflare-Warp-原生-IP"><a href="#10-4-Cloudflare-Warp-原生-IP" class="headerlink" title="10.4 Cloudflare Warp 原生 IP"></a>10.4 Cloudflare Warp 原生 IP</h3><p>很多我们需要访问的网站都需要使用“原生 IP”，比如：<a href="https://www.disneyplus.com/">Disney+</a>， <a href="https://chat.openai.com/">ChatGPT</a>，<a href="https://www.bing.com/">New Bing</a> 等。</p><p>所谓“原生 IP”就是指该网站的 IP 地址和其机房的 IP 地址是一致的，但是，很多 IDC 提供商的 IP 都是从其它国家调配来的，这导致我们就算是翻墙了，也是使用了美国的 VPS，但是还是访问不了相关的服务。所以，我们需要使用 Cloudflare Warp 来访问这些网站。</p><p>下面有几种安装方式：</p><ul><li>全局模式。这种模式下，所有流量都会通过 Cloudflare 的网络，相当于VPN。</li><li>代理模式。通过在服务器本机启动一个 SOCKS5 代理，然后把需要的流量转发到这个代理上。</li></ul><h4 id="10-4-1-WARP-模式"><a href="#10-4-1-WARP-模式" class="headerlink" title="10.4.1 WARP 模式"></a>10.4.1 WARP 模式</h4><p>WARP 模式是 Cloudflare 提供的一种全局代理模式，就是一个客户端的 VPN，它会将你的所有流量都通过 Cloudflare 的网络，这样就能访问到原生 IP 了。</p><p>你可以使用这个一键安装的脚本来快速完成安装 <a href="https://github.com/P3TERX/warp.sh">https://github.com/P3TERX/warp.sh</a></p><p>下载脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget git.io/warp.sh<br>chmod +x warp.sh<br></code></pre></td></tr></table></figure><p>运行脚本 中文菜单</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./warp.sh menu<br></code></pre></td></tr></table></figure><p>先后执行如下安装：</p><ul><li>1 - 安装 Cloudflare WARP 官方客户端</li><li>4 - 安装 WireGuard 相关组件</li><li>7 - 自动配置 WARP WireGuard 双栈全局网络</li></ul><blockquote><p><strong>Note</strong></p><ol><li><p>如果没有 IPv6 网络，那么第 7 步可以换成第 5 步 自动配置 WARP WireGuard IPv4 网络，或是执行 <code>./warp.sh 4</code>。</p></li><li><p>你需要备份一下你的帐号和配置文件，在 <code>/etc/warp/</code> 目录下，主要是两个文件，一个是 <code>wgcf-account.toml</code>，一个是 <code>wgcf-profile.conf</code></p></li><li><p>这个脚本会启动两个 Systemd 服务，一个是 <code>warp-svc</code>，另一个是 <code>wg-quick@wgcf</code>。第一个是 Cloudflare Warp 的服务，第二个是 WireGuard 的服务。</p></li><li><p>你可以使用 <code>./warp.sh status</code> 来查看服务的状态，如果正常的话，会显示如下的信息。如果你的服务没有正常启动，那么会自动 <code>disable wg-quick@wgcf</code>，如果这样的话，你可以使用 <code>./warp.sh d</code>（IPv4 + IPv6 双栈网格）或是 <code>./warp.sh 4</code>（IPv4 网络） 来重头走一遍所有的安装过程。</p>   <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">WireGuard: <span class="hljs-type">Running</span><br>IPv4 Network: <span class="hljs-type">WARP</span><br>IPv6 Network: <span class="hljs-type">WARP</span><br></code></pre></td></tr></table></figure></li></ol></blockquote><p>使用 <code>curl ipinfo.io</code> 命令来检查你的 IP 地址，如果显示的是 Cloudflare 的 IP 地址，那么恭喜你，你已经成功了。如：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;104.28.227.191&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Los Angeles&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;region&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;California&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;country&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;US&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;loc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;34.0522,-118.2437&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;org&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AS13335 Cloudflare, Inc.&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;postal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;90009&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;timezone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;readme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://ipinfo.io/missingauth&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="10-4-2-代理模式"><a href="#10-4-2-代理模式" class="headerlink" title="10.4.2 代理模式"></a>10.4.2 代理模式</h4><p>如果 WARP 模式安装不能成功，那么你可以使用如下的代理模式。代理模式也就是通过一个代理来访问 Cloudflare WARP 的服务，这样就可以访问到原生 IP 了。</p><blockquote><p><strong>Note</strong></p><p>下面的步骤主要使用 Cloudflare 的官方客户端，也许会随时间流逝导致过时，你可以参考 <a href="https://developers.cloudflare.com/warp-client/get-started/linux/">Cloudflare WARP 的官方文档</a></p></blockquote><p><strong>1） 安装软件包</strong></p><p>如果是 Ubuntu，那么可以使用以下命令在添加安装源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install curl<br>curl https://pkg.cloudflareclient.com/pubkey.gpg | gpg --yes --dearmor --output /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg<br>echo &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/cloudflare-client.list<br></code></pre></td></tr></table></figure><p>添加完源后，安装 Cloudflare WARP 客户端：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt install cloudflare-warp<br></code></pre></td></tr></table></figure><blockquote><p><strong>Note</strong></p><p>安装过程中，可能会出现如下错误：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs applescript">The following packages have unmet dependencies:<br>cloudflare-warp : Depends: nftables <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>                  Depends: gnupg2 <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>                  Depends: desktop-<span class="hljs-built_in">file</span>-utils <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>                  Depends: libnss3-tools <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>linux-headers-aws : Depends: linux-headers<span class="hljs-number">-5.3</span><span class="hljs-number">.0</span><span class="hljs-number">-1028</span>-aws <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>E: Unmet dependencies. Try &#x27;apt <span class="hljs-comment">--fix-broken install&#x27; with no packages (or specify a solution).</span><br></code></pre></td></tr></table></figure><p>你先执行 <code>sudo apt --fix-broken install</code>，然后再执行 <code>sudo apt install cloudflare-warp</code> 即可。</p></blockquote><p><strong>2） 配置 Cloudflare WARP</strong></p><p>如果是第一次安装，你需要先注册一个帐号。其注册信息会在这里<code>/var/lib/cloudflare-warp/reg.json</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">warp-cli register<br></code></pre></td></tr></table></figure><p>然后设置代理模式，这点非常重要，因为默认是 WARP 模式，这个会把你的整个 VPS 带到 Cloudflare 的 VPN 网络中，那么就会出现无法连接的情况。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">warp-cli set-mode proxy<br></code></pre></td></tr></table></figure><p>然后，设置永久连接模式。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">warp-cli enable-always-on<br></code></pre></td></tr></table></figure><p>配置完后，你可以使用 <code>warp-cli settings</code> 来查看配置。你也可以通过查看配置文件来看是否配置成功，配置文件在 <code>/var/lib/cloudflare-warp/settings.json</code>。</p><p><strong>3) 连接 Cloudflare WARP</strong></p><p>使用如下命令来连接 Cloudflare WARP：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">warp-cli connect<br></code></pre></td></tr></table></figure><p>你可以使用 <code>warp-cli status</code> 来查看连接状态。如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">warp-cli status</span><br>Status update: Connected<br>Success<br></code></pre></td></tr></table></figure><p>连接成功后，你可以会在本地有一个 Socks5 代理， <code>127.0.0.1:40000</code>，你可以使用如下命令来查看：</p><p><strong>4）验证 Cloudflare WARP</strong></p><p>你可以使用如下命令来验证是否成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -x &quot;socks5://127.0.0.1:40000&quot; ipinfo.io<br></code></pre></td></tr></table></figure><p>如果输出现如下的信息，那么恭喜你，你已经成功了</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;104.28.247.70&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;org&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AS13335 Cloudflare, Inc.&quot;</span><br></code></pre></td></tr></table></figure><p><strong>5）配置 Gost 路由转发</strong></p><p>你可以使用如下命令来启动 gost 转发规则。下面的命行行意思是，把本地的 8080 端口转发到 Cloudflare WARP 的 Socks5 代理上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gost -L &quot;http://:8080&quot; -F &quot;socks5://127.0.0.1:40000&quot;<br></code></pre></td></tr></table></figure><p>当然，上面的配置是不够好的，我们最好使用有证书的 HTTPS 代理。这里的内容参见于 前的面 <a href="#33-%E7%94%A8-gost-%E8%AE%BE%E7%BD%AE-https-%E6%9C%8D%E5%8A%A1">3.3 用 Gost 设置 HTTPS 服务</a>。</p><p>为了使用两种不同的代理，你可以启动两个 gost 服务：</p><ul><li>一个是通过 443 端口直接代理</li><li>另一个是通过 8443 端口转发到 Cloudflare WARP 的 Socks5 代理上</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">下面的四个参数需要改成你的</span><br>DOMAIN=&quot;YOU.DOMAIN.NAME&quot;<br>USER=&quot;username&quot;<br>PASS=&quot;password&quot;<br>PORT=443<br><br>BIND_IP=0.0.0.0<br>CERT_DIR=/etc/letsencrypt<br>CERT=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/fullchain.pem<br>KEY=$&#123;CERT_DIR&#125;/live/$&#123;DOMAIN&#125;/privkey.pem<br>sudo docker run -d --name gost \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;USER&#125;:$&#123;PASS&#125;@$&#123;BIND_IP&#125;:$&#123;PORT&#125;?cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=code:404&amp;knock=www.google.com&quot;<br><br>sudo docker run -d --name gost-warp \<br>    -v $&#123;CERT_DIR&#125;:$&#123;CERT_DIR&#125;:ro \<br>    --net=host ginuerzh/gost \<br>    -L &quot;http2://$&#123;USER&#125;:$&#123;PASS&#125;@$&#123;BIND_IP&#125;:8443?cert=$&#123;CERT&#125;&amp;key=$&#123;KEY&#125;&amp;probe_resist=code:404&amp;knock=www.google.com&quot; \<br>    -F &quot;socks://localhost:40000&quot;<br></code></pre></td></tr></table></figure><blockquote><p><strong>Note</strong></p><ol><li><p>你也可以使用 gost 的 <code>bypass</code>参数来让相应的域名的流量转发到 Cloudflare WARP 的 Socks5 代理上。如：<code> -F=socks5://localhost:40000?bypass=~*.openai.com,openai.com&amp;notls=true</code></p></li><li><p>你也可以使用 V2Ray 的路由模式，参见 <a href="https://www.v2ray.com/chapter_02/03_routing.html">V2Ray 的路由功能</a>。V2Ray的路由模式就比 gost 要强很多。你还可以通过使用预定义域名列表 <code>geolocation-cn</code> 把其的路由转发到 Cloudflare WARP 的 Socks5 代理上，以避免你的 VPS 的 IP 被暴露。</p></li></ol></blockquote><p><strong>6）其它事宜</strong></p><ul><li><p><strong>查看运行状态</strong>。 <code>warp-cli</code> 是 <code>warp-svc</code> 的客户端，真正的程序是 <code>warp-svc</code>，你可以使用如下命令来查看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status warp-svc<br></code></pre></td></tr></table></figure></li><li><p><strong>内存泄漏问题</strong>。 目前，<code>warp-svc</code> 这个程序有内存泄漏的问题（参看 <a href="https://github.com/haoel/haoel.github.io/issues/124">#124</a>），所以，你需要定期重启服务。你可以使用cronjob来重启服务。运行 <code>crontab -e</code>，然后添加如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cron">0 * * * * /bin/systemctl resetart warp-svc<br></code></pre></td></tr></table></figure></li><li><p><strong>文件描述符不足</strong>。另外，如果你的程序出现文件描述不足的情况：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">warp-cli connect<br>Status update: Unable to connect. Reason: Insufficient system resource: file descriptor<br></code></pre></td></tr></table></figure><p>你需要修改文件描述符的限制，这类的文章比较多，你自行 Google，这里就不再赘述了。如果你想配置 Cloudflare WARP 文件描述符的限制，你可以编辑 <code>/lib/systemd/system/warp-svc.service</code>，在 <code>[Service]</code> 下面添加如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">LimitNOFILE</span>=<span class="hljs-number">65535</span><br><span class="hljs-attr">LimitNOFILESoft</span>=<span class="hljs-number">65535</span><br></code></pre></td></tr></table></figure><p>然后，重启服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo systemctl daemon-reload<br>sudo systemctl restart warp-svc.service<br></code></pre></td></tr></table></figure></li></ul><h4 id="10-4-3-Docker-代理"><a href="#10-4-3-Docker-代理" class="headerlink" title="10.4.3 Docker 代理"></a>10.4.3 Docker 代理</h4><p>用 Docker 可以更方便地部署起一个 Cloudflare WARP Proxy，只需要一行命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -v $HOME/.warp:/var/lib/cloudflare-warp:rw \<br>  --restart=always --name=cloudflare-warp e7h4n/cloudflare-warp<br></code></pre></td></tr></table></figure><p>这条命令会在容器上的 40001 开启一个 socks5 代理，接下来查看这个容器的 ip:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker inspect -f &#x27;&#123;&#123;range.NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; cloudflare-warp<br></code></pre></td></tr></table></figure><p>然后可以通过 curl 镜像来测试，例如，如果容器的 ip 是 <code>172.17.0.2</code>，则可以运行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --rm curlimages/curl --connect-timeout 2 -x &quot;socks5://172.17.0.2:40001&quot; ipinfo.io<br></code></pre></td></tr></table></figure><p>返回的结果中 <code>org</code> 字段应该能看到 Cloudflare 相关的信息。</p><p>接下来我们给 Gost 增加一个条件转发规则，转发我们希望的域名、地址到 cloudflare 的 warp 网络:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">-F</span>=socks5://<span class="hljs-number">172.17</span>.<span class="hljs-number">0.2</span>:<span class="hljs-number">40001</span>?bypass=~*.openai.com,openai.com&amp;notls=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>Note</strong></p><p><code>bypass=~</code> 的含义是，只有命中后面规则时才转发请求到 <code>172.17.0.2:40001</code> 这个 socks5 代理。接下来，通过这个 Gost 代理访问 <code>openai.com</code> 时，就会走 warp 网络了。</p></blockquote><h2 id="11-其它"><a href="#11-其它" class="headerlink" title="11. 其它"></a>11. 其它</h2><h3 id="11-1-其它方式"><a href="#11-1-其它方式" class="headerlink" title="11.1 其它方式"></a>11.1 其它方式</h3><p>如下还有一些其它的方式（注：均由网友提供，我没有验证过）</p><p><a href="https://getoutline.org/en/home">Outline</a> 是由 Google 旗下 <a href="https://jigsaw.google.com/">Jigsaw</a> 团队开发的整套翻墙解决方案。Server 端使用 Shadowsocks，MacOS, Windows, iOS, Android 均有官方客户端。使用 Outline Manager 可以一键配置 DigitalOcean。其他平台例如 AWS, Google Cloud 也提供相应脚本。主要优点就是使用简单并且整个软件栈全部<a href="https://github.com/Jigsaw-Code/?q=outline">开源</a>，有专业团队长期维护。</p><h3 id="11-2-搭建脚本"><a href="#11-2-搭建脚本" class="headerlink" title="11.2 搭建脚本"></a>11.2 搭建脚本</h3><p>上述的搭建和安装脚本可参看本库的 scripts 目录下的脚本（感谢网友 <a href="https://github.com/gongzili456">@gongzili456</a> 开发）</p><ul><li><a href="https://github.com/haoel/haoel.github.io/blob/master/scripts/install.ubuntu.18.04.sh">Ubuntu 18.04 Installation Script</a></li></ul><p><strong>注意：这个脚本可能年久失修，不一定能用，但是可以参考，如果有问题，可以提交 PR</strong>。</p><p>欢迎补充和改善！</p><p>（全文完）</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/05/26/hello-world/"/>
    <url>/2023/05/26/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>python 学习之旅总结</title>
    <link href="/2023/05/26/xiaojiayu/"/>
    <url>/2023/05/26/xiaojiayu/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="000-愉快的开始"><a href="#000-愉快的开始" class="headerlink" title="000. 愉快的开始"></a>000. 愉快的开始</h1><h1 id="001-我和Python的第一次亲密接触"><a href="#001-我和Python的第一次亲密接触" class="headerlink" title="001. 我和Python的第一次亲密接触"></a>001. 我和Python的第一次亲密接触</h1><h1 id="002-用Python设计第一个游戏"><a href="#002-用Python设计第一个游戏" class="headerlink" title="002. 用Python设计第一个游戏"></a>002. 用Python设计第一个游戏</h1><h1 id="003-小插曲之变量和字符串"><a href="#003-小插曲之变量和字符串" class="headerlink" title="003. 小插曲之变量和字符串"></a>003. 小插曲之变量和字符串</h1><h1 id="004-改进我们的小游戏"><a href="#004-改进我们的小游戏" class="headerlink" title="004. 改进我们的小游戏"></a>004. 改进我们的小游戏</h1><h1 id="005-闲聊之Python的数据类型"><a href="#005-闲聊之Python的数据类型" class="headerlink" title="005. 闲聊之Python的数据类型"></a>005. 闲聊之Python的数据类型</h1><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>Python的一些数值类型： 整型，布尔类型，浮点型， e记法</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-number">5</span>)</span><br>&lt;class &#x27;int&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-literal">True</span>)</span><br>&lt;class &#x27;bool&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-literal">False</span>)</span><br>&lt;class &#x27;bool&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-literal">True</span> + <span class="hljs-literal">False</span></span><br>1<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-literal">True</span>+<span class="hljs-literal">False</span>)</span><br>&lt;class &#x27;int&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">0.0000000001</span></span><br>1e-10<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">1.5e10</span></span><br>15000000000.0<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-number">1.5e10</span>)</span><br>&lt;class &#x27;float&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(<span class="hljs-number">0.000000000001</span>)</span><br>&lt;class &#x27;float&#x27;&gt;<br></code></pre></td></tr></table></figure><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><ul><li>BIF 函数： int(), str(), float()</li><li>浮点数转成整数，不是四舍五入，而是直接向下去整</li></ul><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = <span class="hljs-string">&#x27;520&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = <span class="hljs-built_in">int</span>(a)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b</span><br>520<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>ValueError: invalid literal for int() with base 10: &#x27;小甲鱼&#x27;<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = <span class="hljs-number">5.99</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = <span class="hljs-built_in">str</span>(a)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b</span><br>&#x27;5.99&#x27;<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = <span class="hljs-built_in">int</span>(a)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b</span><br>5<br></code></pre></td></tr></table></figure><h3 id="判断类型"><a href="#判断类型" class="headerlink" title="判断类型"></a>判断类型</h3><ul><li><em>type()</em>, 返回值True，False</li><li>函数 _isinstance( __ obj, __class_or_tuple)_， 返回值True，False</li><li>字符串模块 str.isdigital(), 返回值True，False</li></ul><h2 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz"><a href="#Quiz" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li>在 Python 中，int 表示整型，那你还记得 bool、float 和 str 分别表示什么吗？ </li><li>你知道为什么布尔类型(bool)的 True 和 False 分别用 1 和 0 来代替吗？ </li><li>使用 int() 将小数转换为整数，结果是向上取整还是向下取整呢？ </li><li>我们人类思维是习惯于“四舍五入”法，你有什么办法使得 int() 按照“四舍五入”的方式取整吗？ </li><li>取得一个变量的类型，视频中介绍可以使用 type() 和 isinstance()，你更倾向于使用哪个？ </li><li>Python3 可以给变量命名中文名，知道为什么吗？ </li><li>【该题针对零基础的鱼油】你觉得这个系列教学有难度吗？</li></ol><h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>针对视频中小甲鱼提到的小漏洞，再次改进我们的小游戏：当用户输入错误类型的时候，及时提醒用户重新输入，防止程序崩溃。 </p><p>如果你尝试过以下做法，请举下小手： </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;不妨猜一下小甲鱼现在心里想的是哪个数字：&quot;</span>) <br><span class="hljs-comment"># 这种想法是因为type(1)会返回&lt;class &#x27;int&#x27;&gt;，如果type(temp)返回结果一致说明输入是整数。 </span><br><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">type</span>(temp) != <span class="hljs-built_in">type</span>(<span class="hljs-number">1</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;抱歉，输入不合法，&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>) <br>temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入一个整数：&quot;</span>)<br></code></pre></td></tr></table></figure><p>或者可能这样:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;不妨猜一下小甲鱼现在心里想的是哪个数字：&quot;</span>)<br><span class="hljs-comment"># not操作符的作用是将布尔类型的结果翻转：即取反的意思，not True == Flase</span><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(temp, <span class="hljs-built_in">int</span>):<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;抱歉，输入不合法，&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>  temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入一个整数：&quot;</span>)<br></code></pre></td></tr></table></figure><p>以上方法的思路是正确的，不过似乎忽略了一点儿：就是input()的返回值始终是字符串，所以type(temp)永远是&lt;class ‘str’&gt; ！ 其实有蛮多的做法可以实现的，不过就目前我们学习过的内容来看，还不足够。 所以，在让大家动手完成这道题之前，小甲鱼介绍一点新东西给大家！</p><blockquote><p>s为字符串 </p><p>s.isalnum() 所有字符都是数字或者字母，为真返回 Ture，否则返回 False</p><p>s.isalpha() 所有字符都是字母，为真返回 Ture，否则返回 False</p><p>s.isdigit() 所有字符都是数字，为真返回 Ture，否则返回 False </p><p>s.islower() 所有字符都是小写，为真返回 Ture，否则返回 False</p><p>s.isupper() 所有字符都是大写，为真返回 Ture，否则返回 False</p></blockquote><p>好了，文字教程就到这里，大家赶紧趁热打铁，改造我们的小游戏吧！ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Design the game, guess a number, try maximum 3 times</span><br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;This is the game program&quot;</span>)<br><br>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br><br>guess = <span class="hljs-number">0</span><br>count = <span class="hljs-number">3</span><br><br><span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> guess != secret:<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input a number:&quot;</span>)<br>    <br>    <span class="hljs-comment">## 判断输入格式是否正确</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> temp.isdigit():<br>        temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;your input is not a number, please input again, please input a correct number:&quot;</span>)<br>    guess = <span class="hljs-built_in">int</span>(temp)<br>    <span class="hljs-keyword">if</span> guess &gt; secret:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;your guess number is big, input a smaller one&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;your input number is small, input a bigger one&quot;</span>)<br><br>    count = count - <span class="hljs-number">1</span><br><br><span class="hljs-keyword">if</span> guess == secret:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your guess is exactly right!! Congrats!&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;You already tried three times, game over!&#x27;</span>)<br></code></pre></td></tr></table></figure><p>​</p></li><li><p>写一个程序，判断给定年份是否为闰年。（注意：请使用已学过的 BIF 进行灵活运用） </p><p>这样定义闰年的:能被4整除但不能被100整除,或者能被400整除都是闰年。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 判断闰年</span><br><span class="hljs-comment"># 能被4整除但不能被100整除,或者能被400整除都是闰年。</span><br><br>temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;清输入一个年份：&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> temp.isdigit():<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入的不是年份，清重新输入：&#x27;</span>)<br><br>year = <span class="hljs-built_in">int</span>(temp)<br><br><span class="hljs-comment"># 采用取余数的方法</span><br><span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> (year % <span class="hljs-number">100</span> != <span class="hljs-number">0</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 是闰年&#x27;</span> % year)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">if</span> year % <span class="hljs-number">400</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 是闰年&#x27;</span> % year)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 不是闰年&#x27;</span> % year)<br></code></pre></td></tr></table></figure></li><li><p>请写下这一节课你学习到的内容：格式不限，回忆并复述是加强记忆的好方式！ </p><p>参考知识点总结内容</p></li></ol><h1 id="006-Pyhon之常用操作符"><a href="#006-Pyhon之常用操作符" class="headerlink" title="006. Pyhon之常用操作符"></a>006. Pyhon之常用操作符</h1><h2 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h2><h3 id="算术操作符"><a href="#算术操作符" class="headerlink" title="算术操作符"></a>算术操作符</h3><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = b = c = d = <span class="hljs-number">10</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a += <span class="hljs-number">1</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b -= <span class="hljs-number">3</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c *= <span class="hljs-number">10</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">d /= <span class="hljs-number">8</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a</span><br>11<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b</span><br>7<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c</span><br>100<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">d</span><br>1.25<br></code></pre></td></tr></table></figure><ul><li><p>幂运算： **</p></li><li><p>地板除法：&#x2F;&#x2F;</p><blockquote><p><strong>python3.0</strong></p><p>&#x2F;总是执行真除法，不管操作数的类型，都返回浮点数结果（即使能整除，如4&#x2F;2&#x3D;&#x3D;2.0）；<br>&#x2F;&#x2F;执行Floor除法，会截断余数直接返回一个整数，如果有任何一个操作数是浮点数则返回浮点数（如4&#x2F;&#x2F;2&#x3D;&#x3D;2,3&#x2F;&#x2F;2&#x3D;&#x3D;1, 4.0&#x2F;&#x2F;2&#x3D;&#x3D;2.0）</p><p>总之：在python3.0中，&#x2F;为真除法，不会截断，且结果无论能否整除都是浮点数；&#x2F;&#x2F;为地板除法，会对除法的结果进行取整返回，至于返回的结果是否是浮点数取决于操作数中有无浮点数，如两个操作数都是整数那么就直接返回一个取整后的整数，如果操作数中有浮点数则返回结果是浮点数。</p><p><strong>python2.0</strong></p><p>&#x2F;表示传统除法，如果两个操作数都是整数的话执行截断除法，否则执行浮点除法，&#x2F;&#x2F;执行Floor除法，同3.0</p></blockquote></li></ul><h3 id="优先级问题"><a href="#优先级问题" class="headerlink" title="优先级问题"></a>优先级问题</h3><ul><li><p>先乘除后加减，遇到括号先算括号</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">&gt;&gt;&gt; <span class="hljs-string">-3</span> * 2 + 5 / <span class="hljs-string">-2</span> <span class="hljs-string">-4</span><br><span class="hljs-string">-12</span>.5<br></code></pre></td></tr></table></figure></li><li><p>比较操作符优先级大于逻辑操作符</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tap">&gt;&gt;&gt;<span class="hljs-number"> 3 </span>&lt;<span class="hljs-number"> 4 </span>and<span class="hljs-number"> 4 </span>&lt; 5<br>True<br></code></pre></td></tr></table></figure></li><li><p>加括号让代码可读性更高</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tap">&gt;&gt;&gt; (3 &lt;<span class="hljs-number"> 4 </span>) and (<span class="hljs-number"> 4 </span>&lt;<span class="hljs-number"> 5 </span>)<br>True<br></code></pre></td></tr></table></figure></li><li><p>幂预算操作符比起左侧运算符优先级高，比其右侧操作符优先级低</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">- <span class="hljs-number">3</span> ** <span class="hljs-number">2</span></span><br>-9<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">-(<span class="hljs-number">3</span> ** <span class="hljs-number">2</span>)</span><br>-9<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> ** -<span class="hljs-number">2</span></span><br>0.1111111111111111<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> ** (-<span class="hljs-number">2</span>)</span><br>0.1111111111111111<br></code></pre></td></tr></table></figure></li></ul><h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><ul><li>and</li><li>or</li><li>not</li></ul><p>not or and 的优先级是不同的：not &gt; and &gt; or </p><h4 id="短路逻辑（short-circuit-logic"><a href="#短路逻辑（short-circuit-logic" class="headerlink" title="短路逻辑（short-circuit logic)"></a>短路逻辑（short-circuit logic)</h4><p>逻辑操作符有个有趣的特性：在不需要求值的时候不进行操作。这么说可能比较“高深”，举个例子，表达式 x and y，需要 x 和 y 两个变量同时为真(True)的时候，结果才为真。因此，如果当 x 变量得知是假(False)的时候，表达式就会立刻返回 False，而不用去管 y 变量的值。 这种行为被称为短路逻辑（short-circuit logic）或者惰性求值（lazy evaluation），这种行为同样也应用与 or 操作符</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python-repl">首先，and’、‘or’和‘not’的优先级是not&gt;and&gt;or<br>其次，逻辑操作符and 和or 也称作短路操作符（short-circuitlogic）或者惰性求值（lazy evaluation）：<br>它们的参数从左向右解析，一旦结果可以确定就停止。<br> <br>and ：x and y 返回的结果是决定表达式结果的值。如果 x 为真，则 y 决定结果，返回 y ；如果 x 为假，x 决定了结果为假，返回 x。<br>       由于是短路操作符，是因为and运算符必须所有的运算数都是true才会把所有的运算数都解析，并且返回最后一个变量，<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">4</span></span><br>4<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">4</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3</span></span><br>3<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3</span></span><br>0<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">0</span></span><br>0<br> <br>or ： x or y   逻辑（or），即只要有一个是true，即停止解析运算数，返回最近为true的变量，<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> <span class="hljs-keyword">or</span> <span class="hljs-number">4</span></span><br>3<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">4</span> <span class="hljs-keyword">or</span> <span class="hljs-number">3</span></span><br>4<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">3</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span></span><br>3<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-number">3</span></span><br>3<br> <br>not : 返回表达式结果的“相反的值”。如果表达式结果为真，则返回false；如果表达式结果为假，则返回true。<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">not</span> <span class="hljs-number">3</span></span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">not</span> <span class="hljs-number">0</span></span><br>True<br></code></pre></td></tr></table></figure><img src="/Users/felix/Library/Application Support/typora-user-images/image-20220402102743013.png" alt="image-20220402102743013" style="zoom:20%;" /><h2 id="课后作业-1"><a href="#课后作业-1" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-1"><a href="#Quiz-1" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>Python 的 floor 除法现在使用 “&#x2F;&#x2F;” 实现，那 3.0 &#x2F;&#x2F; 2.0 您目测会显示什么内容呢？ </p><p>1.0； <em>有任何一个操作数是浮点数则返回结果为浮点数</em></p></li><li><p>a &lt; b &lt; c 事实上是等于？ </p><p>a &lt; b and b &lt; c</p></li><li><p>不使用 IDLE，你可以轻松说出 5 ** -2 的值吗？ </p><p>0.04</p></li><li><p>如何简单判断一个数是奇数还是偶数？ </p><p>a % 2 &#x3D;&#x3D; 0 ; a % 2 &#x3D;&#x3D; 1</p></li><li><p>请用最快速度说出答案：not 1 or 0 and 1 or 3 and 4 or 5 and 6 or 7 and 8 and 9</p><p>not or and 的优先级是不同的：not &gt; and &gt; or </p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs smali">&gt;&gt;&gt;<span class="hljs-built_in"> not </span>1<span class="hljs-built_in"> or </span>0<span class="hljs-built_in"> and </span>1<span class="hljs-built_in"> or </span>3<span class="hljs-built_in"> and </span>4<span class="hljs-built_in"> or </span>5<span class="hljs-built_in"> and </span>6<span class="hljs-built_in"> or </span>7<span class="hljs-built_in"> and </span>8<span class="hljs-built_in"> and </span>9<br>4<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; (not 1)<span class="hljs-built_in"> or </span>(0<span class="hljs-built_in"> and </span>1)<span class="hljs-built_in"> or </span>(3<span class="hljs-built_in"> and </span>4)<span class="hljs-built_in"> or </span>(5<span class="hljs-built_in"> and </span>6)<span class="hljs-built_in"> or </span>(7<span class="hljs-built_in"> and </span>8<span class="hljs-built_in"> and </span>9)<br>4<br></code></pre></td></tr></table></figure></li><li><p>还记得我们上节课那个求闰年的作业吗？如果还没有学到“求余”操作，还记得用什么方法可以“委曲求全”代替“%”的功能呢？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 判断闰年</span><br><span class="hljs-comment"># 能被4整除但不能被100整除,或者能被400整除都是闰年。</span><br><br>temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;清输入一个年份：&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> temp.isdigit():<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入的不是年份，清重新输入：&#x27;</span>)<br><br>year = <span class="hljs-built_in">int</span>(temp)<br><br><span class="hljs-keyword">if</span> (year/<span class="hljs-number">4</span> == <span class="hljs-built_in">int</span>(year/<span class="hljs-number">4</span>)) <span class="hljs-keyword">and</span> (year/<span class="hljs-number">100</span> != <span class="hljs-built_in">int</span>(year/<span class="hljs-number">100</span>)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 是闰年&#x27;</span> % year)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">if</span> year/<span class="hljs-number">400</span> == <span class="hljs-built_in">int</span>(year/<span class="hljs-number">400</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 是闰年&#x27;</span> % year)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 不是闰年&#x27;</span> % year)<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-1"><a href="#Practice-1" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>请写一个程序打印出 0~100 所有的奇数。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 打印出 0~100 所有的奇</span><br><br>number = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> number &lt;= <span class="hljs-number">100</span>:<br>    <span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(number)<br>    number += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>我们说过现在的 Python 可以计算很大很大的数据，但是……真正的大数据计算可是要靠刚刚的硬件滴，不妨写一个小代码，让你的计算机为之崩溃？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">   <br></code></pre></td></tr></table></figure></li><li><p>爱因斯坦曾出过这样一道有趣的数学题：有一个长阶梯，若每步上2阶，最后剩1阶；若每步上3阶，最后剩2阶；若每步上5阶，最后剩4阶；若每步上6阶，最后剩5阶；只有每步上7阶，最后刚好一阶也不剩。 （小甲鱼温馨提示：步子太大真的容易扯着蛋~~~） </p><p>题目：请编程求解该阶梯至少有多少阶？ </p><p>119 级</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 爱因斯坦曾出过这样一道有趣的数学题：有一个长阶梯，若每步上2阶，最后剩1阶；若每步上3阶，最后剩2阶；若每步上5阶，最后剩4阶；若每步上6阶，最后剩5阶；只有每步上7阶，最后刚好一阶也不剩。</span><br><br><span class="hljs-comment"># 设定初始值为7级台阶</span><br>stage = <span class="hljs-number">7</span><br><br><span class="hljs-comment"># 算出的符合条件的结果，当为1 的时候，表示第一个算出的，也是至少有多少级台阶</span><br>result = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> stage &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> result != <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">if</span> (stage % <span class="hljs-number">7</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> (stage % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> (stage % <span class="hljs-number">5</span> == <span class="hljs-number">4</span>) <span class="hljs-keyword">and</span> (stage % <span class="hljs-number">6</span> == <span class="hljs-number">5</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;至少有 %d 级台阶&#x27;</span> % stage)<br>        result = <span class="hljs-number">1</span><br>    stage += <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure></li></ol><h1 id="007-了不起的分支和循环-1"><a href="#007-了不起的分支和循环-1" class="headerlink" title="007. 了不起的分支和循环-1"></a>007. 了不起的分支和循环-1</h1><h2 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h2><h3 id="打飞机编程"><a href="#打飞机编程" class="headerlink" title="打飞机编程"></a>打飞机编程</h3><ul><li>判断： 该不该做某事； if… else; if…elif….else</li><li>循环： 持续的做某事； while 循环，for 循环</li></ul><h1 id="008-了不起的分支和循环-2"><a href="#008-了不起的分支和循环-2" class="headerlink" title="008. 了不起的分支和循环-2"></a>008. 了不起的分支和循环-2</h1><h2 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h2><h3 id="分支编程实例"><a href="#分支编程实例" class="headerlink" title="分支编程实例"></a>分支编程实例</h3><p>按照100分制，90分以上成绩为A， 80到90为B，60到80为C，60以下为D，写一个程序，当用户输入分数，自动转换为ABCD的形式打印。</p><ul><li><p>程序-1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">score = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个分数：&#x27;</span>))<br><span class="hljs-keyword">if</span> <span class="hljs-number">100</span> &gt;= score &gt;= <span class="hljs-number">90</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-number">90</span> &gt; score &gt;= <span class="hljs-number">80</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B&#x27;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-number">80</span> &gt; score &gt;= <span class="hljs-number">60</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C&#x27;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-number">60</span> &gt; score &gt;= <span class="hljs-number">0</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;D&#x27;</span>)<br><span class="hljs-keyword">if</span> score &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> score &gt; <span class="hljs-number">100</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入错误！&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>程序-2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">score = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个分数：&#x27;</span>))<br><span class="hljs-keyword">if</span> <span class="hljs-number">100</span> &gt;= score &gt;= <span class="hljs-number">90</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>  <span class="hljs-keyword">if</span> <span class="hljs-number">90</span> &gt; score &gt;= <span class="hljs-number">80</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B&#x27;</span>)<br>  <span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-number">80</span> &gt; score &gt;= <span class="hljs-number">60</span>:<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>      <span class="hljs-keyword">if</span> <span class="hljs-number">60</span> &gt; score &gt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;D&#x27;</span>)<br>      <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入错误！&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>程序-3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">score = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个分数：&#x27;</span>))<br><span class="hljs-keyword">if</span> <span class="hljs-number">100</span> &gt;= score &gt;= <span class="hljs-number">90</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">90</span> &gt; score &gt;= <span class="hljs-number">80</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">80</span> &gt; score &gt;= <span class="hljs-number">60</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">60</span> &gt; score &gt;= <span class="hljs-number">0</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;D&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入错误！&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ul><h3 id="编程思维"><a href="#编程思维" class="headerlink" title="编程思维"></a>编程思维</h3><ol><li><p>应该考虑程序的高效性； if and elif….； 程序-1 所有的if 每次都要执行一遍，效率低下; 程序-3 体现了python的简洁和可读性好</p></li><li><p>Python 可以有效避免“悬挂” else</p><ul><li><p>什么是“悬挂else”</p></li><li><p>我们举个例子，初学C语言的朋友可能很容易被以下代码欺骗：C 语言采用就近if。。。else 匹配原则</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( hi &gt; <span class="hljs-number">2</span> )<br>  <span class="hljs-keyword">if</span> ( hi &gt; <span class="hljs-number">7</span> )<br>    <span class="hljs-built_in">printf</span>( <span class="hljs-string">&quot;好棒！好棒！&quot;</span> )；<br><span class="hljs-keyword">else</span><br>  print( <span class="hljs-string">&quot;切～&quot;</span> )；<br></code></pre></td></tr></table></figure></li><li><p>Python 采用强制规定锁进原则，否则程序无法跑起来，给程序猿自己决定if-else 搭配</p></li></ul></li><li><p>条件表达式（三元操作符）</p><p>有了这个三元操作符的条件表达式，你可以使用一条语句来完成以下的条件判断和赋值操作：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">x, y = <span class="hljs-number">4</span>, <span class="hljs-number">5</span><br><span class="hljs-keyword">if</span> x &gt; y:<br>  small = x<br><span class="hljs-keyword">else</span>:<br>  small = y<br><br><span class="hljs-comment"># 这个例子可以改进为</span><br>small = x <span class="hljs-keyword">if</span> x &lt; y <span class="hljs-keyword">else</span> y<br></code></pre></td></tr></table></figure></li><li><p>断言 （assert）</p><p>assert 这个关键字我们称之为断言，当这个关键字后面的条件为假的时候，程序自动崩溃并抛出AssertionError的异常。</p><p>举个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> <span class="hljs-number">3</span> &gt; <span class="hljs-number">4</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AssertionError<br></code></pre></td></tr></table></figure><p>一般来说我们可以用它再程序中置入检查点，当需要确保程序中的某个条件一定为真才能让程序正常工作的话，assert 关键字就非常有用了</p></li></ol><h2 id="课后作业-2"><a href="#课后作业-2" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-2"><a href="#Quiz-2" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>if not (money &lt; 100): 上边这行代码相当于？ </p><p>if money &gt;&#x3D; 100</p></li><li><p>assert 的作用是什么？ </p><p>在程序中置入检查点，当需要确保程序中的某个条件一定为真才能让程序正常工作的话，assert 关键字就非常有用</p></li><li><p>假设有 x &#x3D; 1，y &#x3D; 2，z &#x3D; 3，请问如何快速将三个变量的值互相交换？ </p><p>x, y, z &#x3D; z, y, x</p></li><li><p>猜猜 (x &lt; y and [x] or [y])[0] 实现什么样的功能？</p><p>三元运算的功能, 相当于  &#x3D;  [x] if x &lt; y else [y] </p></li><li><p>你听说过成员资格运算符吗？ </p><p>in 运算符</p></li></ol><h3 id="Practice-2"><a href="#Practice-2" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>视频中小甲鱼使用 if elif else 在大多数情况下效率要比全部使用 if 要高，但根据一般的统计规律，一个班的成绩一般服从正态分布，也就是说平均成绩一般集中在 70~80 分之间，因此根据统计规律，我们还可以改进下程序以提高效率</p><blockquote><p>题目备忘：按照100分制，90分以上成绩为A，80到90为B，60到80为C，60以下为D，写一个程序，当用户输入分数，自动转换为ABCD的形式打印。</p></blockquote></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">score = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个分数：&#x27;</span>))<br><span class="hljs-keyword">if</span> <span class="hljs-number">80</span> &gt; score &gt;= <span class="hljs-number">60</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">90</span> &gt; score &gt;= <span class="hljs-number">80</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">60</span> &gt; score &gt;= <span class="hljs-number">0</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;D&#x27;</span>)<br><span class="hljs-keyword">elif</span> <span class="hljs-number">100</span> &gt;= score &gt;= <span class="hljs-number">90</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入错误！&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li><p>Python 的作者在很长一段时间不肯加入三元操作符就是怕跟C语言一样搞出国际乱码大赛，蛋疼的复杂度让初学者望而生畏，不过，如果你一旦搞清楚了三元操作符的使用技巧，或许一些比较复杂的问题反而迎刃而解。 请将以下代码修改为三元操作符实现： </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">x, y, z = <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span> <br><span class="hljs-keyword">if</span> x &lt; y:<br>  small = x <br>  <span class="hljs-keyword">if</span> z &lt; small:<br>    small = z <br><span class="hljs-keyword">elif</span> y &lt; z:<br>  small = y <br><span class="hljs-keyword">else</span>:<br>  small = z<br></code></pre></td></tr></table></figure></li></ol><p>可以改为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">small = x <span class="hljs-keyword">if</span> (x &lt; y <span class="hljs-keyword">and</span> z &gt;= x) <span class="hljs-keyword">else</span> (y <span class="hljs-keyword">if</span> y &lt; z <span class="hljs-keyword">else</span> z)<br></code></pre></td></tr></table></figure><ol start="3"><li>请写下这一节课你学习到的内容：格式不限，回忆并复述是加强记忆的好方式！</li></ol><h1 id="009-了不起的分支和循环-3"><a href="#009-了不起的分支和循环-3" class="headerlink" title="009. 了不起的分支和循环-3"></a>009. 了不起的分支和循环-3</h1><h2 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a>知识点</h2><h3 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h3><h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h3><p>虽然说pytohn 是由C 语言编写而来，但是他的for 循环跟C 语言循环不太一样，python的for 循环会自动捕获iteration 异常并且结束循环，因此显得更为智能和强大</p><ul><li>range()<ul><li>语法：range(start, stop[, step&#x3D;1])</li><li>这个BIF 有三个参数，其中用中括号括起来的两个表示的参数是可选的</li><li>step&#x3D;1 表示第三个参数的值默认是1</li><li>range这个BIF的作用是生成一个从start 参数的值开始到stop 参数的值结束的数字序列</li></ul></li></ul><h3 id="break-和-continue"><a href="#break-和-continue" class="headerlink" title="break 和 continue"></a>break 和 continue</h3><ul><li>break 用来终止这一层的循环，跳出</li><li>continue 用来终止本轮循环，开始下一轮循环</li><li>Break 和 Continue 都只能影响一层</li></ul><h2 id="课后作业-3"><a href="#课后作业-3" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-3"><a href="#Quiz-3" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>下面的循环会打印多少次”I Love FishC”？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>):<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I Love FishC&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><p>​5次</p><ol start="2"><li><p>下面的循环会打印多少次”I Love FishC”？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I Love FishC&#x27;</span>)<br></code></pre></td></tr></table></figure><p>0次, “TypeError: ‘int’ object is not iterable”</p></li><li><p>回顾一下 break 和 continue 在循环中起到的作用？ </p><p>Break 是终止循环，跳出循环体； Continue 是结束本次循环，立即开始下次循环</p></li><li><p>请谈下你对列表的理解？ </p><p>列表本质上是一个可迭代器</p></li><li><p>请问 range(10) 生成哪些数？ </p><p>0，1，2， 3， 4，5 ，6，7 ，8， 9</p></li><li><p>目测以下程序会打印什么？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>  <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">break</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)<br>  <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(<span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure></li></ol><p>​2</p><p>​3</p><ol start="7"><li><p>什么情况下我们要使循环永远为真？ </p><p>保证循环体的内容一定要执行的情况下</p></li><li><p>【学会提高代码的效率】你的觉得以下代码效率方面怎样？有没有办法可以大幅度改进(仍然使用while)？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">i = <span class="hljs-number">0</span><br>string = <span class="hljs-string">&#x27;ILoveFishC.com&#x27;</span><br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(string)):<br>  <span class="hljs-built_in">print</span>(i)<br>  i += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 修改后的程序，避免每次循环都要run 一次len() 函数</span><br>string = <span class="hljs-string">&#x27;ILoveFishC.com&#x27;</span><br>count = <span class="hljs-built_in">len</span>(string)<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> i &lt; count:<br>  <span class="hljs-built_in">print</span>(i)<br>  i += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-3"><a href="#Practice-3" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>设计一个验证用户密码程序，用户只有三次机会输入错误，不过如果用户输入的内容中包含**”*“**则不计算在内。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 设计一个验证用户密码程序，用户只有三次机会输入错误，不过如果用户输入的内容中包含**&quot;\*&quot;**则不计算在内。</span><br><br>password = <span class="hljs-string">&quot;novirus&quot;</span><br>count = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> count &lt;= <span class="hljs-number">2</span>:<br>        userInputPass = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input the password:&#x27;</span>)<br>        <span class="hljs-keyword">if</span> userInputPass == password:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is correct! Congrats!&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> userInputPass:<br>                count += <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is incorrect, please input again!&#x27;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;you already input 3 times, the password input is frozen!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 优化一下上述程序</span><br><br>password = <span class="hljs-string">&quot;novirus&quot;</span><br>count = <span class="hljs-number">3</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">0</span>:<br>        userInputPass = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input the password:&#x27;</span>)<br>        <span class="hljs-keyword">if</span> userInputPass == password:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is correct! Congrats!&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> userInputPass:<br>            count -= <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is incorrect, you have %d tries left&#x27;</span> % count)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is incorrect, you have %d tries left&#x27;</span> % count)<br>            <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;you already input 3 times, the password input is frozen!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 进一步优化</span><br><br>password = <span class="hljs-string">&quot;novirus&quot;</span><br>count = <span class="hljs-number">3</span><br><span class="hljs-keyword">while</span> count:<br>    userInputPass = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input the password:&#x27;</span>)<br>    <span class="hljs-keyword">if</span> userInputPass == password:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is correct! Congrats!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-keyword">in</span> userInputPass:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is incorrect, you have %d tries left&#x27;</span> % count )<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;your password input is incorrect, you have %d tries left&#x27;</span> % (count-<span class="hljs-number">1</span>))<br>    count -= <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，求 100~999 之间的所有水仙花数。</p></li></ol><blockquote><p>如果一个 3 位数等于其各位数字的立方和，则称这个数为水仙花数。例如：153 &#x3D; 1^3 + 5^3 + 3^3，因此 153 就是一个水仙花数。 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. 编写一个程序，求 100~999 之间的所有水仙花数。</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># &gt; 如果一个 3 位数等于其各位数字的立方和，则称这个数为水仙花数。例如：153 = 1^3 + 5^3 + 3^3，因此 153 就是一个水仙花数。</span><br><br><span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>):<br>    hundreds = number // <span class="hljs-number">100</span><br>    tens = (number // <span class="hljs-number">10</span>) % <span class="hljs-number">10</span><br>    single = number % <span class="hljs-number">10</span><br><br>    <span class="hljs-keyword">if</span> number == hundreds ** <span class="hljs-number">3</span> + tens ** <span class="hljs-number">3</span> + single ** <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(number, end=<span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 另外一种方法，通过字符串和整型的互相转换</span><br><span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>):<br>    numstr = <span class="hljs-built_in">str</span>(number)<br>    <span class="hljs-keyword">if</span> number == <span class="hljs-built_in">int</span>(numstr[<span class="hljs-number">0</span>])**<span class="hljs-number">3</span> + <span class="hljs-built_in">int</span>(numstr[<span class="hljs-number">1</span>])**<span class="hljs-number">3</span> + <span class="hljs-built_in">int</span>(numstr[<span class="hljs-number">2</span>])**<span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(number, end=<span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="3"><li>三色球问题</li></ol><blockquote><p>有红、黄、蓝三种颜色的求，其中红球 3 个，黄球 3 个，蓝球 6 个。先将这 12 个球混合放在一个盒子中，从中任意摸出 8 个球，编程计算摸出球的各种颜色搭配。 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 3. 三色球问题</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># &gt; 有红、黄、蓝三种颜色的求，其中红球 3 个，黄球 3 个，蓝球 6 个。先将这 12 个球混合放在一个盒子中，从中任意摸出 8 个球，编程计算摸出球的各种颜色搭配。</span><br><br><br><span class="hljs-comment"># x + y + z = 8</span><br><span class="hljs-comment"># x is red, y is yellow, z is blue</span><br><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>):<br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-number">7</span>):<br>            <span class="hljs-keyword">if</span> x + y + z == <span class="hljs-number">8</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;totally we can have %d red, %d yellow, %d blue&#x27;</span> % (x, y, z))<br></code></pre></td></tr></table></figure><ol start="4"><li>请写下这一节课你学习到的内容：格式不限，回忆并复述是加强记忆的好方式！</li></ol><h1 id="010-列表：一个打了激素的数组-1"><a href="#010-列表：一个打了激素的数组-1" class="headerlink" title="010. 列表：一个打了激素的数组-1"></a>010. 列表：一个打了激素的数组-1</h1><h2 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h2><h3 id="创建列表"><a href="#创建列表" class="headerlink" title="创建列表"></a>创建列表</h3><ul><li>创建一个普通列表</li><li>创建一个混合列表</li><li>创建一个空列表</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member = [<span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(member)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;list&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>number = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>number<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>mix = [<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] ]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>mix<br>[<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>empty = []<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>empty<br>[]<br></code></pre></td></tr></table></figure><h3 id="向列表添加元素"><a href="#向列表添加元素" class="headerlink" title="向列表添加元素"></a>向列表添加元素</h3><ul><li><p>append()</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">member.append(<span class="hljs-string">&#x27;福禄娃娃&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">member</span><br>[&#x27;小布丁&#x27;, &#x27;小甲鱼&#x27;, &#x27;福禄娃娃&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">len</span>(member)</span><br>3<br></code></pre></td></tr></table></figure></li><li><p>extend()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member.extend([<span class="hljs-string">&#x27;竹林小溪&#x27;</span>, <span class="hljs-string">&#x27;crybaby&#x27;</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;福禄娃娃&#x27;</span>, <span class="hljs-string">&#x27;竹林小溪&#x27;</span>, <span class="hljs-string">&#x27;crybaby&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">len</span>(member)<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></li><li><p>insert()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member.insert(<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;牡丹&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;牡丹&#x27;</span>, <span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;福禄娃娃&#x27;</span>, <span class="hljs-string">&#x27;竹林小溪&#x27;</span>, <span class="hljs-string">&#x27;crybaby&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">len</span>(member)<br><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>append() 和 extend()  只有一个参数，默认都是添加到列表的末尾</p><p>extend() 是用一个列表追加另一个列表，所以参数是一个列表</p><p>insert() 第一个参数是插入位置</p></blockquote><h2 id="课后作业-4"><a href="#课后作业-4" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-4"><a href="#Quiz-4" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>列表都可以存放一些什么东西？</p><p>整数，浮点数，字符串，对象</p></li><li><p>向列表增加元素有哪些方法？</p></li></ol><p>   append(), extend(), insert() </p><ol start="3"><li><p>append() 方法和 extend() 方法都是向列表的末尾增加元素，请问他们有什么区别？ </p><p>extend() 的参数是列表</p></li><li><p>member.append([‘竹林小溪’, ‘Crazy迷恋’]) 和 member.extend([‘竹林小溪’, ‘Crazy迷恋’]) 实现的效果一样吗？</p><p> 不一样，append 增加的是一个元素：1个列表对象； extend 增加的是2个元素：列表中的2个元素</p></li><li><p>有列表 name &#x3D; [‘F’, ‘i’, ‘h’, ‘C’]，如果小甲鱼想要在元素 ‘i’ 和 ‘h’ 之间插入元素 ‘s’，应该使用什么方法来插入？ </p><p>name.insert(2, ‘s’)</p></li></ol><h3 id="Practice-4"><a href="#Practice-4" class="headerlink" title="Practice"></a>Practice</h3><ol><li>自己动手试试看，并分析在这种情况下，向列表添加数据应当采用哪种方法比较好？</li></ol><blockquote><p>假设给定以下列表： </p><p>member &#x3D; [‘小甲鱼’, ‘黑夜’, ‘迷途’, ‘怡静’, ‘秋舞斜阳’] </p><p>要求将列表修改为： </p><p>member &#x3D; [‘小甲鱼’, 88, ‘黑夜’, 90, ‘迷途’, 85, ‘怡静’, 90, ‘秋舞斜阳’, 88] </p><p>方法一：使用 insert() 和 append() 方法修改列表。</p><p> 方法二：重新创建一个同名字的列表覆盖。 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 方法一</span><br>member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>]<br>index = <span class="hljs-number">1</span><br><br><br>member.insert(<span class="hljs-number">1</span>, <span class="hljs-number">88</span>)<br>member.insert(<span class="hljs-number">3</span>, <span class="hljs-number">90</span>)<br>member.insert(<span class="hljs-number">5</span>, <span class="hljs-number">85</span>)<br>member.insert(<span class="hljs-number">7</span>, <span class="hljs-number">90</span>)<br>member.append(<span class="hljs-number">88</span>)<br><br><span class="hljs-built_in">print</span>(member)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 方法二：</span><br>member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>]<br>number = [<span class="hljs-number">88</span>, <span class="hljs-number">90</span>,  <span class="hljs-number">85</span>, <span class="hljs-number">90</span>,  <span class="hljs-number">88</span>]<br>new = []<br><br>index = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> index &lt; <span class="hljs-built_in">len</span>(member):<br>    new.extend([member[index], number[index]])<br>    index += <span class="hljs-number">1</span><br><br>member = new<br><span class="hljs-built_in">print</span>(member)<br></code></pre></td></tr></table></figure><ol start="2"><li>利用 for 循环打印上边 member 列表中的每个内容，如图：</li></ol><p><img src="https://img-blog.csdnimg.cn/20200330223209818.png" alt="member = [&#39;小甲鱼&#39;, 88, &#39;黑夜&#39;, 90, &#39;迷途&#39;, 85, &#39;怡静&#39;, 90, &#39;秋舞斜阳&#39;, 88]"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> member:<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><ol start="3"><li>上一题打印的样式不是很好，能不能修改一下代码打印成下图的样式呢？【请至少使用两种方法实现】</li></ol><p><img src="https://img-blog.csdnimg.cn/20200330223316122.png" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 上一题打印的样式不是很好，能不能修改一下代码打印成下图的样式呢？【请至少使用两种方法实现】</span><br><br><span class="hljs-comment"># 方法一</span><br>member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><br>lenth = <span class="hljs-built_in">len</span>(member)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, lenth, <span class="hljs-number">2</span>):<br>    <span class="hljs-built_in">print</span>(member[i], member[i+<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 方法二</span><br>member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><br><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(member)):<br>    <span class="hljs-keyword">if</span> each % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(member[each], member[each+<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><h1 id="011-列表：一个打了激素的数组-2"><a href="#011-列表：一个打了激素的数组-2" class="headerlink" title="011. 列表：一个打了激素的数组-2"></a>011. 列表：一个打了激素的数组-2</h1><h2 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h2><h3 id="从列表中获取元素"><a href="#从列表中获取元素" class="headerlink" title="从列表中获取元素"></a>从列表中获取元素</h3><p>通过索引值index 获取单个元素，从0开始</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member = [<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>] <br><span class="hljs-meta">&gt;&gt;&gt; </span>member[<span class="hljs-number">0</span>]<br><span class="hljs-string">&#x27;小甲鱼&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member[<span class="hljs-number">1</span>]<br><span class="hljs-number">88</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><br><span class="hljs-comment"># 交换数组元素</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>temp = member[<span class="hljs-number">0</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member[<span class="hljs-number">0</span>] = member[<span class="hljs-number">1</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member[<span class="hljs-number">1</span>] = temp<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-number">88</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br></code></pre></td></tr></table></figure><h3 id="从列表中删除元素"><a href="#从列表中删除元素" class="headerlink" title="从列表中删除元素"></a>从列表中删除元素</h3><ul><li><p>remove() ; 参数是具体的存在于列表中的元素值，不需要知道位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member.remove(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member.remove(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>ValueError: <span class="hljs-built_in">list</span>.remove(x): x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span><br></code></pre></td></tr></table></figure></li><li><p>del</p><ul><li>del &lt;列表名字&gt;；del member ， 会删除整个列表</li><li>del &lt;列表元素&gt;； del member[0]， 删除某个特定的列表元素</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-number">88</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> member[<span class="hljs-number">0</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> member<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: name <span class="hljs-string">&#x27;member&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></li><li><p>pop()</p><ul><li>列表是通过栈存储数据的，可以通过pop 来弹栈数据</li><li>不加任何参数，默认从列表中取出最后一个元素，并且弹出来</li><li>可以加上参数index，弹出具体某个元素</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>member = [<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>, <span class="hljs-number">88</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>member.pop()<br><span class="hljs-number">88</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;秋舞斜阳&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>name = member.pop()<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>name<br><span class="hljs-string">&#x27;秋舞斜阳&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>member.pop(<span class="hljs-number">1</span>)<br><span class="hljs-number">90</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>member<br>[<span class="hljs-string">&#x27;黑夜&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>]<br></code></pre></td></tr></table></figure></li></ul><h3 id="列表分片（slice）"><a href="#列表分片（slice）" class="headerlink" title="列表分片（slice）"></a>列表分片（slice）</h3><ul><li><p>利用索引可以每次获取一个元素；但是如果需要每次获取多个元素，需要采用列表分片</p></li><li><p>利用列表分片，得到一个列表的拷贝，返回值是列表</p></li><li><p>列表分片操作，原列表不会有任何改变</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pyth">&gt;&gt;&gt; member<br>[&#x27;黑夜&#x27;, &#x27;迷途&#x27;, 85, &#x27;怡静&#x27;, 90]<br>&gt;&gt;&gt; member[1:3]<br>[&#x27;迷途&#x27;, 85]<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; member<br>[&#x27;黑夜&#x27;, &#x27;迷途&#x27;, 85, &#x27;怡静&#x27;, 90]<br>&gt;&gt;&gt; member[:3]<br>[&#x27;黑夜&#x27;, &#x27;迷途&#x27;, 85]<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; member[1:]<br>[&#x27;迷途&#x27;, 85, &#x27;怡静&#x27;, 90]<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; member[:]<br>[&#x27;黑夜&#x27;, &#x27;迷途&#x27;, 85, &#x27;怡静&#x27;, 90]<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-5"><a href="#课后作业-5" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-5"><a href="#Quiz-5" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>下边的列表分片操作会打印什么内容？<br>list1 &#x3D; [1, 3, 2, 9, 7, 8]<br>list1[2:5]</p><p>[2, 9, 7]</p></li><li><p>请问 list1[0] 和 list1[0:1] 一样吗？</p><p>不一样，list1[0] 是一个元素：1， list[0:1] 是一个列表：[1]</p></li><li><p>如果你每次想从列表的末尾取出一个元素，并将这个元素插入到列表的最前边，你会怎么做？</p><p>list.insert(0, list.pop())</p></li><li><p>有些鱼油比较调皮，他说我想试试 list1[-3:-1] 会不会报错，怎么知道一试居然显示 [9, 7]，这是怎么回事呢？</p><p>Python 列表逆向切片，从右至左</p></li><li><p>在进行分片的时候，我们知道分片的开始和结束位置需要进行指定，但其实还有另外一个隐藏的设置：步长。<br>list1[0:6:2]</p><ul><li><p>简洁分片操作：<br>list1[::2]</p></li><li><p>步长不能为0，会报错<br>list1 &#x3D; [1, 3, 2, 9, 7, 8]<br>list1 &#x3D; [ : : 0 ]</p></li><li><p>步长可以是负数，改变方向（从尾部开始向左走）<br>list1[::-2]</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>list1[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>:<span class="hljs-number">2</span>]<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>list1[::<span class="hljs-number">2</span>]<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>=[::<span class="hljs-number">0</span>]<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-built_in">list</span>=[::<span class="hljs-number">0</span>]<br>          ^<br>SyntaxError: invalid syntax<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>list1[::-<span class="hljs-number">2</span>]<br>[<span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure></li></ul></li><li><p>课堂上小甲鱼说可以利用分片完成列表的拷贝 list2 &#x3D; list1[:]，那事实上可不可以直接写成 list2 &#x3D; list1 更加简洁呢？</p><p>不能，list2 &#x3D; list1 并没有拷贝数据存储在内存中，而是给同一份内存数据加上了一个新的标签：list2</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"> list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br> list2 = list1[:]<br> list2 <br>[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br> list3 = list1<br> list3<br>[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br> list1.sort()<br> list1<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] <br> list2<br>[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br> list3<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] <br></code></pre></td></tr></table></figure><p>6.请写下这一节课你学习到的内容：格式不限，回忆并复述是加强记忆的好方式</p><h1 id="012-列表：一个打了激素的数组-3"><a href="#012-列表：一个打了激素的数组-3" class="headerlink" title="012. 列表：一个打了激素的数组-3"></a>012. 列表：一个打了激素的数组-3</h1><h2 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a>知识点</h2><h3 id="列表操作符"><a href="#列表操作符" class="headerlink" title="列表操作符"></a>列表操作符</h3><ul><li><p>比较操作符</p><p>列表比较，当有多个元素的时候，默认从第0个元素开始比较</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>list1 = [<span class="hljs-number">123</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list2 = [<span class="hljs-number">234</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list1 &gt; list2<br><span class="hljs-literal">False</span> <br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>list1 = [<span class="hljs-number">123</span>, <span class="hljs-number">456</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list2 = [<span class="hljs-number">234</span>, <span class="hljs-number">123</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>list1 &gt; list2<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure></li><li><p>逻辑操作符</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3 = [<span class="hljs-number">123</span>, <span class="hljs-number">456</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">(list1 &lt; list2) <span class="hljs-keyword">and</span> (list1 == list3)</span><br>True<br></code></pre></td></tr></table></figure></li><li><p>连接操作符</p><p>类似于extend（），但是不建议使用 + 来扩展或添加列表元素，建议使用insert，append，extend</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list4 = list1 + list2</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list4</span><br>[123, 456, 234, 123]<br></code></pre></td></tr></table></figure></li><li><p>重复操作符</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3 * <span class="hljs-number">3</span></span><br>[123, 456, 123, 456, 123, 456]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3 *= <span class="hljs-number">3</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3</span><br>[123, 456, 123, 456, 123, 456]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3 *= <span class="hljs-number">5</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3</span><br>[123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456]<br></code></pre></td></tr></table></figure></li><li><p>成员关系操作符</p><ul><li>列表中的列表的操作</li></ul><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">123</span> <span class="hljs-keyword">in</span> list3</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">&#x27;xiaojiayu&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> list3</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-number">123</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> list3</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list5 = [<span class="hljs-number">123</span>, [<span class="hljs-string">&#x27;xiaojiayu&#x27;</span>, <span class="hljs-string">&#x27;mudan&#x27;</span>], <span class="hljs-number">456</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">&#x27;xiaojiayu&#x27;</span>  <span class="hljs-keyword">in</span> list5</span><br>False <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">&#x27;xiaojiayu&#x27;</span> <span class="hljs-keyword">in</span> list5[<span class="hljs-number">1</span>]</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list5[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]</span><br>&#x27;mudan&#x27;<br></code></pre></td></tr></table></figure></li></ul><h3 id="列表的小伙伴们"><a href="#列表的小伙伴们" class="headerlink" title="列表的小伙伴们"></a>列表的小伙伴们</h3> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">dir</span>(<span class="hljs-built_in">list</span>)<br>[<span class="hljs-string">&#x27;__add__&#x27;</span>, <span class="hljs-string">&#x27;__class__&#x27;</span>, <span class="hljs-string">&#x27;__class_getitem__&#x27;</span>, <span class="hljs-string">&#x27;__contains__&#x27;</span>, <span class="hljs-string">&#x27;__delattr__&#x27;</span>, <span class="hljs-string">&#x27;__delitem__&#x27;</span>, <span class="hljs-string">&#x27;__dir__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__eq__&#x27;</span>, <span class="hljs-string">&#x27;__format__&#x27;</span>, <span class="hljs-string">&#x27;__ge__&#x27;</span>, <span class="hljs-string">&#x27;__getattribute__&#x27;</span>, <span class="hljs-string">&#x27;__getitem__&#x27;</span>, <span class="hljs-string">&#x27;__gt__&#x27;</span>, <span class="hljs-string">&#x27;__hash__&#x27;</span>, <span class="hljs-string">&#x27;__iadd__&#x27;</span>, <span class="hljs-string">&#x27;__imul__&#x27;</span>, <span class="hljs-string">&#x27;__init__&#x27;</span>, <span class="hljs-string">&#x27;__init_subclass__&#x27;</span>, <span class="hljs-string">&#x27;__iter__&#x27;</span>, <span class="hljs-string">&#x27;__le__&#x27;</span>, <span class="hljs-string">&#x27;__len__&#x27;</span>, <span class="hljs-string">&#x27;__lt__&#x27;</span>, <span class="hljs-string">&#x27;__mul__&#x27;</span>, <span class="hljs-string">&#x27;__ne__&#x27;</span>, <span class="hljs-string">&#x27;__new__&#x27;</span>, <span class="hljs-string">&#x27;__reduce__&#x27;</span>, <span class="hljs-string">&#x27;__reduce_ex__&#x27;</span>, <span class="hljs-string">&#x27;__repr__&#x27;</span>, <span class="hljs-string">&#x27;__reversed__&#x27;</span>, <span class="hljs-string">&#x27;__rmul__&#x27;</span>, <span class="hljs-string">&#x27;__setattr__&#x27;</span>, <span class="hljs-string">&#x27;__setitem__&#x27;</span>, <span class="hljs-string">&#x27;__sizeof__&#x27;</span>, <span class="hljs-string">&#x27;__str__&#x27;</span>, <span class="hljs-string">&#x27;__subclasshook__&#x27;</span>, <span class="hljs-string">&#x27;append&#x27;</span>, <span class="hljs-string">&#x27;clear&#x27;</span>, <span class="hljs-string">&#x27;copy&#x27;</span>, <span class="hljs-string">&#x27;count&#x27;</span>, <span class="hljs-string">&#x27;extend&#x27;</span>, <span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;pop&#x27;</span>, <span class="hljs-string">&#x27;remove&#x27;</span>, <span class="hljs-string">&#x27;reverse&#x27;</span>, <span class="hljs-string">&#x27;sort&#x27;</span>]<br></code></pre></td></tr></table></figure><ul><li><p>reverse(): 将整个列表反转</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3.reverse()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3</span><br>[456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123, 456, 123]<br></code></pre></td></tr></table></figure></li><li><p>sort(): 用指定的方式，对成员排序，默认是从小到大</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6 = [<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6.sort()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6</span><br>[2, 3, 4, 5, 8, 9, 10]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"> </span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6.sort(reverse=<span class="hljs-literal">True</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6</span><br>[10, 9, 8, 5, 4, 3, 2]<br></code></pre></td></tr></table></figure></li><li><p>count(): 计算一个元素在列表中出现的次数</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3.count(<span class="hljs-number">123</span>)</span><br>15<br></code></pre></td></tr></table></figure></li><li><p>index(): 返回参数在列表中的位置</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3.index(<span class="hljs-number">123</span>)</span><br>0<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list3.index(<span class="hljs-number">123</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>)</span><br>4<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-6"><a href="#课后作业-6" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-6"><a href="#Quiz-6" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li>请问如何将下边这个列表的’小甲鱼’修改为’小鱿鱼’？</li></ol><blockquote><p>list1 &#x3D; [1, [1, 2, [‘小甲鱼’]], 3, 5, 8, 13, 18] </p></blockquote><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">list1[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;小鱿鱼&#x27;</span><br></code></pre></td></tr></table></figure><ol start="2"><li><p>要对一个列表进行顺序排序，请问使用什么方法？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">list</span>.sort()<br></code></pre></td></tr></table></figure></li><li><p>要对一个列表进行逆序排序，请问使用什么方法？ </p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade">list.<span class="hljs-built_in">sort</span>(<span class="hljs-built_in">reverse</span>=<span class="hljs-literal">true</span>)<br><br>或者：<br>list.<span class="hljs-built_in">sort</span>()<br>list.<span class="hljs-built_in">reverse</span>()<br></code></pre></td></tr></table></figure></li><li><p>列表还有两个内置方法没给大家介绍，不过聪明的你应该可以自己摸索使用的门道吧：copy() 和 clear()</p></li></ol><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list7 = list6.copy()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list7</span><br>[4, 2, 3, 5, 9, 8, 10]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6.sort()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list6</span><br>[2, 3, 4, 5, 8, 9, 10]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list7</span><br>[4, 2, 3, 5, 9, 8, 10]<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list7.clear()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list7</span><br>[]<br></code></pre></td></tr></table></figure><ol start="5"><li>你有听说过列表推导式或列表解析吗？ 没听过？！没关系，我们现场来学习一下吧，看表达式：</li></ol><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">[ i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>) ] </span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">[i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)] </span><br>[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]<br></code></pre></td></tr></table></figure><p>你觉得会打印什么内容？ </p><p>居然分别打印了0到9各个数的平方，然后还放在列表里边了有木有？！</p><p> 列表推导式（List comprehensions）也叫列表解析，灵感取自函数式编程语言 Haskell。Ta 是一个非常有用和灵活的工具，可以用来动态的创建列表，语法如： [有关A的表达式 for A in B] </p><p>例如 </p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1 = [x**<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)] </span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1 </span><br><br>[0, 1, 4, 9, 16, 25, 36, 49, 64, 81] <br></code></pre></td></tr></table></figure><p>相当于 </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">list1 = <span class="hljs-selector-attr">[]</span> <br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>): <br>list1<span class="hljs-selector-class">.append</span>(x**<span class="hljs-number">2</span>) <br></code></pre></td></tr></table></figure><p>问题：请先在 IDLE 中获得下边列表的结果，并按照上方例子把列表推导式还原出来。 </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">list<span class="hljs-number">1</span> <span class="hljs-operator">=</span> [(<span class="hljs-keyword">x</span><span class="hljs-punctuation">,</span> y) for <span class="hljs-keyword">x</span> in range(<span class="hljs-number">10</span>) for y in range(<span class="hljs-number">10</span>) if <span class="hljs-keyword">x</span><span class="hljs-variable">%2</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-number">0</span> if y<span class="hljs-variable">%2</span>!<span class="hljs-operator">=</span><span class="hljs-number">0</span>] <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">if</span> x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> y%<span class="hljs-number">2</span>!=<span class="hljs-number">0</span>:<br><span class="hljs-meta">... </span>                    list1.append((x, y))<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>list1<br>[(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">9</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">9</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">9</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">9</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">9</span>)]<br></code></pre></td></tr></table></figure><ol start="6"><li>活学活用：请使用列表推导式补充被小甲鱼不小心涂掉的部分</li></ol><p><img src="https://img-blog.csdnimg.cn/20200225183701856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01hbWluZ3p1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">list3=[y + <span class="hljs-string">&quot;:&quot;</span> + x[<span class="hljs-number">2</span>:] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> list1 <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> list2 <span class="hljs-keyword">if</span> x[<span class="hljs-number">0</span>] == y[<span class="hljs-number">0</span>]]<br></code></pre></td></tr></table></figure><h1 id="013-元组：戴上了枷锁的列表"><a href="#013-元组：戴上了枷锁的列表" class="headerlink" title="013. 元组：戴上了枷锁的列表"></a>013. 元组：戴上了枷锁的列表</h1><h2 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>由于和列表是近亲关系，所以元组和列表在实际使用上是非常相似的。</p></li><li><p>元组可以切片，但是元组是不可改变的，不能随意插入修改元素</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&gt;&gt;&gt; tuple1 = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>)<br>&gt;&gt;&gt; type(tuple1)<br>&lt;<span class="hljs-keyword">class</span> &#x27;<span class="hljs-symbol">tuple</span>&#x27;&gt;<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple1</span><br>(<span class="hljs-symbol">1, <span class="hljs-symbol">2</span>, <span class="hljs-symbol">3</span>, <span class="hljs-symbol">4</span>, <span class="hljs-symbol">5</span>, <span class="hljs-symbol">6</span>, <span class="hljs-symbol">7</span>, <span class="hljs-symbol">8</span></span>)<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple1</span>[<span class="hljs-symbol">1</span>]<br><span class="hljs-symbol">2</span><br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple1</span>[<span class="hljs-symbol">5:</span>]<br>(<span class="hljs-symbol">6, <span class="hljs-symbol">7</span>, <span class="hljs-symbol">8</span></span>)<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple2</span> = <span class="hljs-symbol">tuple1</span>[:]<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple2</span><br>(<span class="hljs-symbol">1, <span class="hljs-symbol">2</span>, <span class="hljs-symbol">3</span>, <span class="hljs-symbol">4</span>, <span class="hljs-symbol">5</span>, <span class="hljs-symbol">6</span>, <span class="hljs-symbol">7</span>, <span class="hljs-symbol">8</span></span>)<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-symbol">tuple1</span>[<span class="hljs-symbol">1</span>] = <span class="hljs-symbol">3</span><br><span class="hljs-symbol">Traceback</span> (<span class="hljs-symbol">most</span> <span class="hljs-symbol">recent</span> <span class="hljs-symbol">call</span> <span class="hljs-symbol">last</span>):<br>  <span class="hljs-symbol">File</span> &quot;&lt;<span class="hljs-symbol">stdin</span>&gt;&quot;, <span class="hljs-symbol">line</span> <span class="hljs-symbol">1, <span class="hljs-symbol">in</span></span> &lt;<span class="hljs-symbol">module</span>&gt;<br><span class="hljs-symbol">TypeError: </span>&#x27;<span class="hljs-symbol">tuple</span>&#x27; <span class="hljs-symbol">object</span> <span class="hljs-symbol">does</span> <span class="hljs-symbol">not</span> <span class="hljs-symbol">support</span> <span class="hljs-symbol">item</span> <span class="hljs-symbol">assignment</span><br>&gt;&gt;&gt; <br></code></pre></td></tr></table></figure></li><li><p>主要讨论以下知识点：</p><ul><li><p>创建和访问一个元组； 逗号是定义一个元组的关键，而不是小括号</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp = (<span class="hljs-number">1</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp</span><br>1<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(temp)</span><br>&lt;class &#x27;int&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp2 = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp2</span><br>(2, 3, 4)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(temp2)</span><br>&lt;class &#x27;tuple&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp = ()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(temp)</span><br>&lt;class &#x27;tuple&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp</span><br>()<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp = (<span class="hljs-number">1</span>, )</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(temp)</span><br>&lt;class &#x27;tuple&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp</span><br>(1,)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp = <span class="hljs-number">1</span>, </span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">temp</span><br>(1,)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(temp)</span><br>&lt;class &#x27;tuple&#x27;&gt; <br></code></pre></td></tr></table></figure></li><li><p>更新和删除一个元组</p><p>通过连接符来修改一个元组，注意修改完之后，原来的元组还在内存中，过一会python 会检查是否还有标签（变量名）指向它，如果没有，会从内存中回收它</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; <span class="hljs-keyword">temp</span> = (<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>)<br>&gt;&gt;&gt; <span class="hljs-keyword">temp</span><br>(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>)<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-keyword">temp</span> = <span class="hljs-keyword">temp</span>[:<span class="hljs-number">2</span>] + (<span class="hljs-string">&#x27;怡静&#x27;</span>, ) + <span class="hljs-keyword">temp</span>[<span class="hljs-number">2</span>:]<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-keyword">temp</span><br>(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-string">&#x27;迷途&#x27;</span>, <span class="hljs-string">&#x27;黑夜&#x27;</span>)<br></code></pre></td></tr></table></figure><p>如果要强行回收资源，可以使用del 语法 </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; del <span class="hljs-keyword">temp</span><br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-keyword">temp</span><br>Traceback (most recent <span class="hljs-keyword">call</span> last):<br>  File &quot;&lt;stdin&gt;&quot;, <span class="hljs-type">line</span> <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: <span class="hljs-type">name</span> <span class="hljs-string">&#x27;temp&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></li></ul></li><li><p>列表的操作符和元组一样</p></li></ul><h2 id="课后作业-7"><a href="#课后作业-7" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-7"><a href="#Quiz-7" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请用一句话描述什么是列表？再用一句话描述什么是元组？ </p><p>列表：一个大仓库，你可以随时往里边添加和删除任何东西。 </p><p>元组：封闭的列表，一旦定义，就不可改变（不能添加、删除或修改）</p></li><li><p>什么情况下你需要使用元组而不是列表？</p><p>当我们希望内容不被轻易改写的时候，我们使用元组（把权力关进牢笼）。 当我们需要频繁修改数据，我们使用列表。 </p></li><li><p>当元组和列表掉下水，你会救谁？ </p><p>如果是我，我会救列表，因为列表提供了比元组更丰富的内置方法，这相当大的提高了编程的灵活性。 </p><p>回头来看下元组，元组固然安全，但元组一定创建就无法修改（除非通过新建一个元组来间接修改，但这就带来了消耗），而我们人是经常摇摆不定的，所以元组只有在特殊的情况才用到，平时还是列表用的多。 综上所述，小甲鱼会救列表（列表是美眉）</p></li><li><p>请将下图左边列表的内置方法与右边的注释连线，并圈出元组可以使用的方法。 </p><p><img src="https://images2018.cnblogs.com/blog/1274778/201805/1274778-20180510092732778-991558013.png" alt="img"></p><p>元组只能使用2个方法：count（）和index（）</p></li><li><p>创建一个元组，什么情况下逗号和小括号必须同时存在，缺一不可？ </p><p>在通过拼接符创建元组的时候</p></li><li><p>x, y, z &#x3D; 1, 2, 3 请问x, y, z是元组吗？ </p><p>所有的多对象的、逗号分隔的、没有明确用符号定义的这些集合默认的类型都是元组</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">x, y, z = <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(x)</span><br>&lt;class &#x27;int&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">h = x, y, z</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(h)</span><br>&lt;class &#x27;tuple&#x27;&gt;<br></code></pre></td></tr></table></figure></li><li><p>请写出以下情景中应该使用列表还是元组来保存数据： </p><ol><li>游戏中角色的属性： 列表</li><li>你的身份证信息： 元组</li><li>论坛的会员： 列表</li><li>团队合作开发程序，传递给一个你并不了解具体实现的函数的参数：元组 </li><li>航天火箭各个组件的具体配置参数： 元组</li><li>NASA系统中记录已经发现的行星数据： 列表</li></ol></li><li><p>上节课我们通过课后作业的形式学习到了“列表推导式”，那请问如果我把中括号改为小括号，会不会得到“元组推导式”呢？ </p><p>不能，因为元组不能向列表一样迭代更新</p></li></ol><h1 id="014-字符串：各种奇葩的内置方法"><a href="#014-字符串：各种奇葩的内置方法" class="headerlink" title="014. 字符串：各种奇葩的内置方法"></a>014. 字符串：各种奇葩的内置方法</h1><h2 id="知识点-9"><a href="#知识点-9" class="headerlink" title="知识点"></a>知识点</h2><h3 id="字符串，列表，元组"><a href="#字符串，列表，元组" class="headerlink" title="字符串，列表，元组"></a>字符串，列表，元组</h3><ul><li>字符串， 列表，元组 都属于序列类型，很多用法非常类似</li><li>字符串更像元组，一旦被定义，就不能修改。非要“修改”的话，可以参考元组的方式，采用拼接符“+” 的方式，注意旧的字符串还在，并没有改变</li><li>字符串和列表，元组一样可以索引，切片操作</li><li>字符串和列表，元组一样，使用比较操作符，逻辑操作符，成员关系操作符，连接操作符，重复操作符</li></ul><p>{filename: }</p><h3 id="字符串方法及注释"><a href="#字符串方法及注释" class="headerlink" title="字符串方法及注释"></a>字符串方法及注释</h3><blockquote><p>字符串的方法不会改变原来的字符串，一般都是返回一个新的字符串</p></blockquote><table><thead><tr><th>capitalize()</th><th>把字符串的第一个字符改为大写</th></tr></thead><tbody><tr><td>casefold()</td><td>把整个字符串的所有字符改为小写</td></tr><tr><td>center(width)</td><td>将字符串居中，并使用空格填充至长度 width 的新字符串</td></tr><tr><td>count(sub[, start[, end]])</td><td>返回 sub 在字符串里边出现的次数，start 和 end 参数表示范围，可选。</td></tr><tr><td>encode(encoding&#x3D;‘utf-8’, errors&#x3D;‘strict’)</td><td>以 encoding 指定的编码格式对字符串进行编码。</td></tr><tr><td>endswith(sub[, start[, end]])</td><td>检查字符串是否以 sub 子字符串结束，如果是返回 True，否则返回 False。start 和 end 参数表示范围，可选。</td></tr><tr><td>expandtabs([tabsize&#x3D;8])</td><td>把字符串中的 tab 符号（\t）转换为空格，如不指定参数，默认的空格数是 tabsize&#x3D;8。</td></tr><tr><td>find(sub[, start[, end]])</td><td>检测 sub 是否包含在字符串中，如果有则返回索引值，否则返回 -1，start 和 end 参数表示范围，可选。</td></tr><tr><td>index(sub[, start[, end]])</td><td>跟 find 方法一样，不过如果 sub 不在 string 中会产生一个异常。</td></tr><tr><td>isalnum()</td><td>如果字符串至少有一个字符并且所有字符都是字母或数字则返回 True，否则返回 False。</td></tr><tr><td>isalpha()</td><td>如果字符串至少有一个字符并且所有字符都是字母则返回 True，否则返回 False。</td></tr><tr><td>isdecimal()</td><td>如果字符串只包含十进制数字则返回 True，否则返回 False。</td></tr><tr><td>isdigit()</td><td>如果字符串只包含数字则返回 True，否则返回 False。</td></tr><tr><td>islower()</td><td>如果字符串中至少包含一个区分大小写的字符，并且这些字符都是小写，则返回 True，否则返回 False。</td></tr><tr><td>isnumeric()</td><td>如果字符串中只包含数字字符，则返回 True，否则返回 False。</td></tr><tr><td>isspace()</td><td>如果字符串中只包含空格，则返回 True，否则返回 False。</td></tr><tr><td>istitle()</td><td>如果字符串是标题化（所有的单词都是以大写开始，其余字母均小写），则返回 True，否则返回 False。</td></tr><tr><td>isupper()</td><td>如果字符串中至少包含一个区分大小写的字符，并且这些字符都是大写，则返回 True，否则返回 False。</td></tr><tr><td>join(sub)</td><td>以字符串作为分隔符，插入到 sub 中所有的字符之间。</td></tr><tr><td>ljust(width)</td><td>返回一个左对齐的字符串，并使用空格填充至长度为 width 的新字符串。</td></tr><tr><td>lower()</td><td>转换字符串中所有大写字符为小写。</td></tr><tr><td>lstrip()</td><td>去掉字符串左边的所有空格</td></tr><tr><td>partition(sub)</td><td>找到子字符串 sub，把字符串分成一个 3 元组 (pre_sub, sub, fol_sub)，如果字符串中不包含 sub 则返回 (‘原字符串’, ‘’, ‘’)</td></tr><tr><td>replace(old, new[, count])</td><td>把字符串中的 old 子字符串替换成 new 子字符串，如果 count 指定，则替换不超过 count 次。</td></tr><tr><td>rfind(sub[, start[, end]])</td><td>类似于 find() 方法，不过是从右边开始查找。</td></tr><tr><td>rindex(sub[, start[, end]])</td><td>类似于 index() 方法，不过是从右边开始。</td></tr><tr><td>rjust(width)</td><td>返回一个右对齐的字符串，并使用空格填充至长度为 width 的新字符串。</td></tr><tr><td>rpartition(sub)</td><td>类似于 partition() 方法，不过是从右边开始查找。</td></tr><tr><td>rstrip()</td><td>删除字符串末尾的空格。</td></tr><tr><td>split(sep&#x3D;None, maxsplit&#x3D;-1)</td><td>不带参数默认是以空格为分隔符切片字符串，如果 maxsplit 参数有设置，则仅分隔 maxsplit 个子字符串，返回切片后的子字符串拼接的列表。</td></tr><tr><td>splitlines(([keepends]))</td><td>在输出结果里是否去掉换行符，默认为 False，不包含换行符；如果为 True，则保留换行符。。</td></tr><tr><td>startswith(prefix[, start[, end]])</td><td>检查字符串是否以 prefix 开头，是则返回 True，否则返回 False。start 和 end 参数可以指定范围检查，可选。</td></tr><tr><td>strip([chars])</td><td>删除字符串前边和后边所有的空格，chars 参数可以定制删除的字符，可选。</td></tr><tr><td>swapcase()</td><td>翻转字符串中的大小写。</td></tr><tr><td>title()</td><td>返回标题化（所有的单词都是以大写开始，其余字母均小写）的字符串。</td></tr><tr><td>translate(table)</td><td>根据 table 的规则（可以由 str.maketrans(‘a’, ‘b’) 定制）转换字符串中的字符。</td></tr><tr><td>upper()</td><td>转换字符串中的所有小写字符为大写。</td></tr><tr><td>zfill(width)</td><td>返回长度为 width 的字符串，原字符串右对齐，前边用 0 填充。</td></tr></tbody></table><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1.capitalize()</span><br>&#x27;Abdc&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1</span><br>&#x27;abdc&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1.center(<span class="hljs-number">2</span>)</span><br>&#x27;abdc&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1</span><br>&#x27;abdc&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1.center(<span class="hljs-number">12</span>)</span><br>&#x27;    abdc    &#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str1.casefold()</span><br>&#x27;abdc&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str2 = <span class="hljs-string">&#x27;DAXDIExiaoyang&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str2.count(<span class="hljs-string">&#x27;xi&#x27;</span>)</span><br>1<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str2.endswith(<span class="hljs-string">&#x27;ng&#x27;</span>)</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3 = <span class="hljs-string">&#x27;I\tlove\tFishC.com!&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3.expandtabs()</span><br>&#x27;I       love    FishC.com!&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3</span><br>&#x27;I\tlove\tFishC.com!&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(str3)</span><br>IloveFishC.com!<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3 = <span class="hljs-string">&#x27;I\tlove\tFishC.com!&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(str3)</span><br>IloveFishC.com!<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3.expandtabs(tabsize=<span class="hljs-number">18</span>)</span><br>&#x27;I                 love              FishC.com!&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3.find(<span class="hljs-string">&#x27;efc&#x27;</span>)</span><br>-1<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3.find(<span class="hljs-string">&#x27;com&#x27;</span>)</span><br>13<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str3.index(<span class="hljs-string">&#x27;efc&#x27;</span>)</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>ValueError: substring not found<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str4 = <span class="hljs-string">&#x27;FishC&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str4.join(<span class="hljs-string">&#x27;12345&#x27;</span>)</span><br>&#x27;1FishC2FishC3FishC4FishC5&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str5 = <span class="hljs-string">&#x27;    i love you   &#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str5.lstrip()</span><br>&#x27;i love you   &#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str5</span><br>&#x27;    i love you   &#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str5.rstrip()</span><br>&#x27;    i love you&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6 = <span class="hljs-string">&#x27;l love fish&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.partition(<span class="hljs-string">&#x27;ov&#x27;</span>)</span><br>(&#x27;l l&#x27;, &#x27;ov&#x27;, &#x27;e fish&#x27;)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6</span><br>&#x27;l love fish&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.replace(<span class="hljs-string">&#x27;fish&#x27;</span>, <span class="hljs-string">&#x27;felix&#x27;</span>)</span><br>&#x27;l love felix&#x27; <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6</span><br>&#x27;l love fish&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.split()</span><br>[&#x27;l&#x27;, &#x27;love&#x27;, &#x27;fish&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.split(<span class="hljs-string">&#x27;i&#x27;</span>)</span><br>[&#x27;l love f&#x27;, &#x27;sh&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.startswith(<span class="hljs-string">&#x27;I&#x27;</span>)</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.startswith(<span class="hljs-string">&#x27;i&#x27;</span>)</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.startswith(<span class="hljs-string">&#x27;1&#x27;</span>)</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6</span><br>&#x27;l love fish&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str6.startswith(<span class="hljs-string">&#x27;l&#x27;</span>)</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7 = <span class="hljs-string">&#x27;     aaaasssss    &#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7.strip()</span><br>&#x27;aaaasssss&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7 = str7.strip()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7</span><br>&#x27;aaaasssss&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7.strip(<span class="hljs-string">&#x27;s&#x27;</span>)</span><br>&#x27;aaaa&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7.swapcase()</span><br>&#x27;AAAASSSSS&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">str7.title()</span><br>&#x27;Aaaasssss&#x27;<br></code></pre></td></tr></table></figure><h2 id="课后作业-8"><a href="#课后作业-8" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-8"><a href="#Quiz-8" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>还记得如何定义一个跨越多行的字符串吗（请至少写出两种实现的方法）？</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs 1c">方法一： <br>&gt;&gt;&gt; str1 = &#x27;&#x27;&#x27;待我长发及腰，将军归来可好？ <br>此身君子意逍遥，怎料山河萧萧。 <br>天光乍破遇，暮雪白头老。 <br>寒剑默听奔雷，长枪独守空壕。 <br>醉卧沙场君莫笑，一夜吹彻画角。 <br>江南晚来客，红绳结发梢。&#x27;&#x27;&#x27; <br><br>方法二： <br>&gt;&gt;&gt; str2 = &#x27;待卿长发及腰，我必凯旋回朝。\ <br>昔日纵马任逍遥，俱是少年英豪。\ <br>东都霞色好，西湖烟波渺。\ <br>执枪血战八方，誓守山河多娇。\ <br>应有得胜归来日，与卿共度良宵。\ <br>盼携手终老，愿与子同袍。&#x27; <br><br>方法三： <br>&gt;&gt;&gt; str3 = (&#x27;待卿长发及腰，我必凯旋回朝。&#x27; <br>&#x27;昔日纵马任逍遥，俱是少年英豪。&#x27; <br>&#x27;东都霞色好，西湖烟波渺。&#x27; <br>&#x27;执枪血战八方，誓守山河多娇。&#x27; <br>&#x27;应有得胜归来日，与卿共度良宵。&#x27; <br>&#x27;盼携手终老，愿与子同袍。&#x27;)<br></code></pre></td></tr></table></figure></li><li><p>三引号字符串通常我们用于做什么使用？ </p><p>注释</p></li><li><p>file1 &#x3D; open(‘C:\windows\temp\readme.txt’, ‘r’) 表示以只读方式打开“C:\windows\temp\readme.txt”这个文本文件，但事实上这个语句会报错，知道为什么吗？你会如何修改？ </p><p>文件名中包含默认的制表符：\t, \r… 需要指定用原始字符读取文件名，’r’ 置于整个字符串的前面</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">file1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;C:\windows\temp\readme.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>)</span><br></code></pre></td></tr></table></figure></li><li><p>有字符串：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">str1 = &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.fishc.com/dvd&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>鱼C资源打包<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>&#x27;<br></code></pre></td></tr></table></figure><p>请问如何提取出子字符串：’<a href="http://www.fishc.com/">www.fishc.com</a>‘ </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># 使用split() 方法可以以‘/’ 切片字符串，返回一个列表</span><br>str1.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>)[<span class="hljs-number">2</span>]<br><br>或者<br><br><span class="hljs-comment"># 使用partition() 方法可以直接截取，返回一个元组</span><br>str1.partition(<span class="hljs-string">&#x27;www.fishc.com&#x27;</span>)[<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure></li><li><p>如果使用负数作为索引值进行分片操作，按照第三题的要求你能够正确目测出结果吗？ </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">str1<span class="hljs-selector-class">.split</span>(<span class="hljs-string">&#x27;/&#x27;</span>)<span class="hljs-selector-attr">[-3]</span><br></code></pre></td></tr></table></figure></li><li><p>还是第三题那个字符串，请问下边语句会显示什么内容？</p></li></ol><p> </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-meta prompt_">&gt;&gt;</span> str1[<span class="hljs-number">20</span><span class="hljs-symbol">:-</span><span class="hljs-number">36</span>] <br><span class="hljs-string">&#x27;fishc&#x27;</span><br></code></pre></td></tr></table></figure><ol start="7"><li><p>据说只有智商高于150的鱼油才能解开这个字符串（还原为有意义的字符串）：</p><p>str1 &#x3D; ‘i2sl54ovvvb4e3bferi32s56h;$c43.sfc67o0cm99’ </p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&gt;&gt;&gt; str1[::<span class="hljs-number">3</span>]<br><span class="hljs-string">&#x27;ilovefishc.com&#x27;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-5"><a href="#Practice-5" class="headerlink" title="Practice"></a>Practice</h3><ol><li>请写一个密码安全性检查的脚本代码：check.py</li></ol><blockquote><p>密码安全性检查代码 </p><p>低级密码要求： </p><ol><li>密码由单纯的数字或字母组成 </li><li>密码长度小于等于8位</li></ol><p>中级密码要求： </p><ol><li>密码必须由数字、字母或特殊字符（仅限：~!@#$%^&amp;*()_&#x3D;-&#x2F;,.?&lt;&gt;;:[]{}|\）任意两种组合 *</li><li>密码长度不能低于8位</li></ol><p>高级密码要求： </p><ol><li><p>密码必须由数字、字母及特殊字符（仅限：~!@#$%^&amp;*()_&#x3D;-&#x2F;,.?&lt;&gt;;:[]{}|\）三种组合 </p></li><li><p>密码只能由字母开头</p></li><li><p>密码长度不能低于16位</p></li></ol></blockquote><p>程序演示： </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">specialchar = <span class="hljs-string">&quot;~!@#$%^&amp;*()_=-/,.?&lt;&gt;;:[]&#123;&#125;|\\&quot;</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    alphaflag, digitflag, specharflag = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    passstr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Please input your password: &#x27;</span>)<br>    <br><span class="hljs-comment"># 设置标记位</span><br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> passstr:<br>        <span class="hljs-keyword">if</span> each.isalpha():<br>            alphaflag = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> each.isdigit():<br>            digitflag = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> each <span class="hljs-keyword">in</span> specialchar:<br>            specharflag = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">if</span> passstr[<span class="hljs-number">0</span>].isalpha() <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(passstr) &gt;= <span class="hljs-number">16</span> <span class="hljs-keyword">and</span> alphaflag+digitflag+specharflag == <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The password is strong!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(passstr) &gt;= <span class="hljs-number">8</span> <span class="hljs-keyword">and</span> alphaflag+digitflag+specharflag &gt;= <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The password is medium!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(passstr) &lt; <span class="hljs-number">8</span> <span class="hljs-keyword">and</span> (passstr.isdigit() <span class="hljs-keyword">or</span> passstr.isalpha()):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The password is weak!&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The password does not meet requirement, please input again!&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="015-字符串：格式化"><a href="#015-字符串：格式化" class="headerlink" title="015. 字符串：格式化"></a>015. 字符串：格式化</h1><h2 id="知识点-10"><a href="#知识点-10" class="headerlink" title="知识点"></a>知识点</h2><h3 id="format-方法"><a href="#format-方法" class="headerlink" title="format()  方法"></a>format()  方法</h3><ul><li><p>位置参数格式化</p></li><li><p>关键字参数格式化</p></li><li><p>混合位置和关键字参数格式化</p><ul><li>位置参数必须在关键字参数之前</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; <span class="hljs-string">&quot;&#123;0&#125; love &#123;1&#125;.&#123;2&#125;&quot;</span>.format(<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;flish&quot;</span>, <span class="hljs-string">&quot;com&quot;</span>)<br><span class="hljs-string">&#x27;I love flish.com&#x27;</span><br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-string">&quot;&#123;a&#125; love &#123;b&#125;.&#123;c&#125;&quot;</span>.format(<span class="hljs-attribute">a</span>=<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-attribute">b</span>=<span class="hljs-string">&quot;flish&quot;</span>, <span class="hljs-attribute">c</span>=<span class="hljs-string">&quot;com&quot;</span>)<br><span class="hljs-string">&#x27;I love flish.com&#x27;</span><br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-string">&quot;&#123;0&#125; love &#123;b&#125;.&#123;c&#125;&quot;</span>.format(<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-attribute">b</span>=<span class="hljs-string">&quot;flish&quot;</span>, <span class="hljs-attribute">c</span>=<span class="hljs-string">&quot;com&quot;</span>)<br><span class="hljs-string">&#x27;I love flish.com&#x27;</span><br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <span class="hljs-string">&quot;&#123;a&#125; love &#123;b&#125;.&#123;0&#125;&quot;</span>.format(<span class="hljs-attribute">a</span>=<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-attribute">b</span>=<span class="hljs-string">&quot;flish&quot;</span>, <span class="hljs-string">&quot;com&quot;</span>)<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line 1<br>    <span class="hljs-string">&quot;&#123;a&#125; love &#123;b&#125;.&#123;0&#125;&quot;</span>.format(<span class="hljs-attribute">a</span>=<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-attribute">b</span>=<span class="hljs-string">&quot;flish&quot;</span>, <span class="hljs-string">&quot;com&quot;</span>)<br>                                                     ^<br>SyntaxError: positional argument follows keyword argument<br></code></pre></td></tr></table></figure></li><li><p>两个特殊的例子</p><ul><li><p>如果要想打印格式化符号：花括号，该怎么办呢？ 其实类似于加一个反斜杠避免转义字符，可以用花括号把花括号括起来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\\&#x27;</span>)<br>\<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;&#123;0&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;不打印&#x27;</span>))<br>&#123;<span class="hljs-number">0</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#123;&#123;0&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;不打印&#x27;</span>)<br><span class="hljs-string">&#x27;&#123;0&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>为什么下面的这个output 是27.7GB，而不是27.658GB呢？</p><p>位置参数0 后面的冒号：表示格式化符号的开始，后面接的‘.1f’ 就是格式化符号，‘.1’ 表示四舍五入，‘f’ 表示定点数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;&#123;0:.1f&#125;&#123;1&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">27.658</span>,<span class="hljs-string">&#x27;GB&#x27;</span>)<br><span class="hljs-string">&#x27;27.7GB&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Python3-字符串格式化符号含义及转义字符含义"><a href="#Python3-字符串格式化符号含义及转义字符含义" class="headerlink" title="Python3 字符串格式化符号含义及转义字符含义"></a>Python3 字符串格式化符号含义及转义字符含义</h3><ul><li><p>字符串格式化符号含义</p><table><thead><tr><th>符  号</th><th>说   明</th></tr></thead><tbody><tr><td>%c</td><td>格式化字符及其ASCII码</td></tr><tr><td>%s</td><td>格式化字符串</td></tr><tr><td>%d</td><td>格式化整数</td></tr><tr><td>%b</td><td>格式化无符号二进制数</td></tr><tr><td>%o</td><td>格式化无符号八进制数</td></tr><tr><td>%x</td><td>格式化无符号十六进制数</td></tr><tr><td>%X</td><td>格式化无符号十六进制数（大写）</td></tr><tr><td>%f</td><td>格式化定点数，可指定小数点后的精度</td></tr><tr><td>%e</td><td>用科学计数法格式化定点数</td></tr><tr><td>%E</td><td>作用同%e，用科学计数法格式化定点数</td></tr><tr><td>%g</td><td>根据值的大小决定使用%f活%e</td></tr><tr><td>%G</td><td>作用同%g，根据值的大小决定使用%f或者%E</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%c&#x27;</span> % <span class="hljs-number">97</span><br><span class="hljs-string">&#x27;a&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%c %c %c&#x27;</span> % (<span class="hljs-number">97</span>, <span class="hljs-number">98</span>, <span class="hljs-number">99</span>)<br><span class="hljs-string">&#x27;a b c&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%s&#x27;</span> % <span class="hljs-string">&#x27;I love fishC&#x27;</span><br><span class="hljs-string">&#x27;I love fishC&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%d + %d = %d&#x27;</span> %(<span class="hljs-number">4</span>, <span class="hljs-number">5</span> , <span class="hljs-number">4</span>+<span class="hljs-number">5</span>)<br><span class="hljs-string">&#x27;4 + 5 = 9&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%o&#x27;</span> %<span class="hljs-number">10</span><br><span class="hljs-string">&#x27;12&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%x&#x27;</span> %<span class="hljs-number">10</span><br><span class="hljs-string">&#x27;a&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%X&#x27;</span> %<span class="hljs-number">10</span><br><span class="hljs-string">&#x27;A&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%X&#x27;</span> %<span class="hljs-number">160</span><br><span class="hljs-string">&#x27;A0&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%f&#x27;</span> % <span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27;27.658000&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%e&#x27;</span> % <span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27;2.765800e+01&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%E&#x27;</span> % <span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27;2.765800E+01&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%g&#x27;</span> % <span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27;27.658&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%g&#x27;</span> % <span class="hljs-number">27.65843824837284738274832784732</span><br><span class="hljs-string">&#x27;27.6584&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%g&#x27;</span> % <span class="hljs-number">2765843824837284738274832784732</span><br><span class="hljs-string">&#x27;2.76584e+30&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>格式化操作符辅助指令</p><table><thead><tr><th>符  号</th><th>说   明</th></tr></thead><tbody><tr><td>m.n</td><td>m是显示的最小总宽度，n是小数点后的位数</td></tr><tr><td>-</td><td>用于左对齐</td></tr><tr><td>+</td><td>在正数前面显示加号（+）</td></tr><tr><td>#</td><td>在八进制数前面显示 ‘0o’，在十六进制数前面显示 ‘0x’ 或 ‘0X’</td></tr><tr><td>0</td><td>显示的数字前面填充 ‘0’ 取代空格</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%5.1f&#x27;</span> %<span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27; 27.7&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%.2e&#x27;</span> %<span class="hljs-number">27.658</span><br><span class="hljs-string">&#x27;2.77e+01&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%10d&#x27;</span> %<span class="hljs-number">5</span><br><span class="hljs-string">&#x27;         5&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%-10d&#x27;</span> %<span class="hljs-number">5</span><br><span class="hljs-string">&#x27;5         &#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%+10d&#x27;</span> %<span class="hljs-number">5</span><br><span class="hljs-string">&#x27;        +5&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%+10d&#x27;</span> %-<span class="hljs-number">5</span><br><span class="hljs-string">&#x27;        -5&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%+-10d&#x27;</span> %<span class="hljs-number">5</span><br><span class="hljs-string">&#x27;+5        &#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%#o&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;0o12&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%#x&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;0xa&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%#X&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;0XA&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%#d&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;10&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%010d&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;0000000010&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;%-010d&#x27;</span> % <span class="hljs-number">10</span><br><span class="hljs-string">&#x27;10        &#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>字符串转义字符含义</p><table><thead><tr><th>符  号</th><th>说   明</th></tr></thead><tbody><tr><td>&#39;</td><td>单引号</td></tr><tr><td>&quot;</td><td>双引号</td></tr><tr><td>\a</td><td>发出系统响铃声</td></tr><tr><td>\b</td><td>退格符</td></tr><tr><td>\n</td><td>换行符</td></tr><tr><td>\t</td><td>横向制表符（TAB）</td></tr><tr><td>\v</td><td>纵向制表符</td></tr><tr><td>\r</td><td>回车符</td></tr><tr><td>\f</td><td>换页符</td></tr><tr><td>\o</td><td>八进制数代表的字符</td></tr><tr><td>\x</td><td>十六进制数代表的字符</td></tr><tr><td>\0</td><td>表示一个空字符</td></tr><tr><td>\</td><td>反斜杠</td></tr></tbody></table></li></ul><h2 id="课后作业-9"><a href="#课后作业-9" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-9"><a href="#Quiz-9" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>根据说明填写相应的字符串格式化符号</p><table><thead><tr><th>符 号</th><th>说 明</th></tr></thead><tbody><tr><td>%c</td><td>格式化字符及其ASCII码</td></tr><tr><td>%s</td><td>格式化字符串</td></tr><tr><td>%d</td><td>格式化整数</td></tr><tr><td>%o</td><td>格式化无符号八进制数</td></tr><tr><td>%x</td><td>格式化无符号十六进制数</td></tr><tr><td>%X</td><td>格式化无符号十六进制数（大写）</td></tr><tr><td>%f</td><td>格式化定点数，可指定小数点后的精度</td></tr><tr><td>%e</td><td>用科学计数法格式化定点数</td></tr><tr><td>%E</td><td>根据值的大小决定使用%f或者%e</td></tr><tr><td>%g</td><td>根据值的大小决定使用%F或者%E</td></tr></tbody></table></li><li><p>请问以下这行代码会打印什么内容？ </p><blockquote><p>&gt;&gt;&gt;”1“.format(“不打印”, “打印”) </p></blockquote><p>‘{1}’</p></li><li><p>以下代码中，a, b, c是什么参数？</p></li></ol><blockquote><p>&gt;&gt;&gt; “{a} love {b}.{c}”.format(a&#x3D;”I”, b&#x3D;”FishC”, c&#x3D;”com”) ‘</p><p>‘I love FishC.com’ </p></blockquote><p>关键字参数</p><ol start="4"><li>以下代码中，{0}, {1}, {2}是什么参数？</li></ol><blockquote><p>&gt;&gt;&gt; “{0} love {1}.{2}”.format(“I”, “FishC”, “com”) </p><p>‘I love FishC.com’ </p></blockquote><p>位置参数</p><ol start="5"><li>如果想要显示Pi &#x3D; 3.14，format前边的字符串应该怎么填写呢？</li></ol><blockquote><p>‘’.format(‘Pi &#x3D; ‘, 3.1415) </p></blockquote><p>‘{0}{1:.2f}’.format(‘Pi &#x3D; ‘, 3.1415) </p><h3 id="Practice-6"><a href="#Practice-6" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个进制转换程序，程序演示如下（提示，十进制转换二进制可以用bin()这个BIF）： </p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8yMzA4NjI4Mi02NThjNjVjZWNiNzgxZTA2LnBuZw?x-oss-process=image/format,png" alt="img"></p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">number = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个整数（输入Q结束程序）：&#x27;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> number == <span class="hljs-string">&#x27;Q&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;程序结束&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">elif</span> number.isdigit():<br>        intnumber = <span class="hljs-built_in">int</span>(number)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;0&#125;&#123;1:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;十进制 -&gt; 十六进制：&#x27;</span>, intnumber))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;0&#125;&#123;1:#o&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;十进制 -&gt; 八进制：&#x27;</span>, intnumber))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;0&#125;&#123;1:#b&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;十进制 -&gt; 二进制：&#x27;</span>, intnumber))<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        number = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入错误，请重新输入一个整数（输入Q结束程序）：&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><h1 id="016-序列！序列！"><a href="#016-序列！序列！" class="headerlink" title="016. 序列！序列！"></a>016. 序列！序列！</h1><h2 id="知识点-11"><a href="#知识点-11" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>列表，元组和字符串的共同点</p><ul><li>都可以通过索引得到每一个元素</li><li>默认索引值总是从0开始</li><li>可以通过分片的方法得到一个范围内的元素的集合</li><li>有很多共同的操作符（重复操作符，拼接操作符，成员关系操作符）</li></ul></li><li><p>常用BIF</p><ul><li><p>list(),  把一个可迭代器转换成列表</p></li><li><p>tuple(), 把一个可迭代器转换成元组</p></li><li><p>str(), 把obj对象转换成字符串</p></li><li><p>len(), 返回长度</p></li><li><p>max(), 返回序列或者参数集合中的最大值</p></li><li><p>min(), 返回序列或者参数集合中的最小值</p></li><li><p>sum(iterable[, start&#x3D;0]), 返回序列iterable 和可选参数start的总和</p></li><li><p>sorted(), 从小到大排序; list.sort()</p></li><li><p>reversed(), 返回迭代器对象；可以用list(迭代器对象)转换成列表</p></li><li><p>enumerate(), 生成由每个元素的index 值和元素值组成的元组； 返回迭代器对象；可以用list(迭代器对象)转换成列表</p></li><li><p>zip(a, b)， 成双成对打包</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-built_in">list</span>()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a<br>[]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-string">&#x27;I love fishC.com&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-built_in">list</span>(b)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b<br>[<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">21</span>, <span class="hljs-number">34</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = <span class="hljs-built_in">list</span>(c)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c<br>[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">21</span>, <span class="hljs-number">34</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">len</span>(a)<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">len</span>(b)<br><span class="hljs-number">16</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>(b)<br><span class="hljs-string">&#x27;v&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b<br>[<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">18</span>, <span class="hljs-number">13</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">98</span>, <span class="hljs-number">34</span>, <span class="hljs-number">54</span>, <span class="hljs-number">76</span>, <span class="hljs-number">32</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>(numbers)<br><span class="hljs-number">76</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">min</span>(numbers)<br>-<span class="hljs-number">98</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>chars = <span class="hljs-string">&#x27;123456789&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">min</span>(chars)<br><span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>tuple1 = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>(tuple1)<br><span class="hljs-number">9</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>tuple2 = (<span class="hljs-number">3.1</span>, <span class="hljs-number">2.3</span>, <span class="hljs-number">3.4</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>(tuple2)<br><span class="hljs-number">8.8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>(numbers)<br><span class="hljs-number">130</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>(numbers, <span class="hljs-number">8</span>)<br><span class="hljs-number">138</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>chars<br><span class="hljs-string">&#x27;123456789&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>(chars)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: unsupported operand <span class="hljs-built_in">type</span>(s) <span class="hljs-keyword">for</span> +: <span class="hljs-string">&#x27;int&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;str&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sorted</span>(numbers)<br>[-<span class="hljs-number">98</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>, <span class="hljs-number">18</span>, <span class="hljs-number">32</span>, <span class="hljs-number">34</span>, <span class="hljs-number">54</span>, <span class="hljs-number">76</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">reversed</span>(numbers)<br>&lt;list_reverseiterator <span class="hljs-built_in">object</span> at <span class="hljs-number">0x10495e2b0</span>&gt;<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">reversed</span>(numbers))<br>[<span class="hljs-number">32</span>, <span class="hljs-number">76</span>, <span class="hljs-number">54</span>, <span class="hljs-number">34</span>, -<span class="hljs-number">98</span>, <span class="hljs-number">0</span>, <span class="hljs-number">13</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">enumerate</span>(numbers)<br>&lt;<span class="hljs-built_in">enumerate</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x104a0e4c0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">enumerate</span>(numbers))<br>[(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">18</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">13</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">4</span>, -<span class="hljs-number">98</span>), (<span class="hljs-number">5</span>, <span class="hljs-number">34</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">54</span>), (<span class="hljs-number">7</span>, <span class="hljs-number">76</span>), (<span class="hljs-number">8</span>, <span class="hljs-number">32</span>)]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">zip</span>(a, b)<br>&lt;<span class="hljs-built_in">zip</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x104a0e400</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(a, b))<br>[(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">5</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">6</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">7</span>)]<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-10"><a href="#课后作业-10" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-10"><a href="#Quiz-10" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>我们根据列表、元祖和字符串的共同特点，把它们三统称为什么？</p><p>序列 </p></li><li><p>请问分别使用什么BIF，可以把一个可迭代对象转换为列表、元祖和字符串？ </p><p>list([iterable])</p><p>tuple([iterable])</p><p>str(obj)</p></li><li><p>你还能复述出“迭代”的概念吗？</p><p>所谓迭代，是重复反馈过程的活动，其目的通常是为了接近并到达所需的目标或结果。每一次对过程的重复被称为一次“迭代”，而每一次迭代得到的结果会被用来作为下一次迭代的初始值。</p></li><li><p>你认为调用 max(‘I love FishC.com’) 会返回什么值？为什么？ </p><p>‘v’, 因为字符串在计算机中是以ASCII码的形式存储（ASCII对照表：<a href="http://bbs.fishc.com/thread-41199-1-1.html%EF%BC%89%EF%BC%8C%E5%8F%82%E6%95%B0%E4%B8%ADASCII%E7%A0%81%E5%80%BC%E6%9C%80%E5%A4%A7%E7%9A%84%E6%98%AF'v'%E5%AF%B9%E5%BA%94%E7%9A%84118">http://bbs.fishc.com/thread-41199-1-1.html），参数中ASCII码值最大的是&#39;v&#39;对应的118</a></p></li><li><p>哎呀呀，现在的小屁孩太调皮了，邻居家的孩子淘气，把小甲鱼刚写好的代码画了个图案，麻烦各位鱼油恢复下啊，另外这家伙画的是神马吗？怎么那么眼熟啊！？？ </p><p><img src="https://img-blog.csdnimg.cn/img_convert/b8487addfb00c4a6b7cad9c4b5f328f9.gif" alt="Alt"></p></li></ol><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入待查找的用户名：&quot;</span>)<br>score = [ [<span class="hljs-string">&#x27;迷途&#x27;</span>,  <span class="hljs-number">85</span>], [<span class="hljs-string">&#x27;黑夜&#x27;</span>,  <span class="hljs-number">80</span>], [<span class="hljs-string">&#x27;小布丁&#x27;</span>, <span class="hljs-number">65</span>], [<span class="hljs-string">&#x27;福禄娃娃&#x27;</span>, <span class="hljs-number">95</span>], [<span class="hljs-string">&#x27;怡静&#x27;</span>, <span class="hljs-number">90</span>]]<br>IsFind = <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> score:<br>    <span class="hljs-keyword">if</span> name == each[<span class="hljs-number">0</span>]:<br>        <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27;的得分是：&#x27;</span>,  each[<span class="hljs-number">1</span>])<br>        IsFind = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">break</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> IsFind:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;查找的数据不存在！&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="Practice-7"><a href="#Practice-7" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>猜想一下 min() 这个BIF的实现过程 </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">list1 = [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">332</span>, <span class="hljs-number">41</span>, <span class="hljs-number">532</span>, <span class="hljs-number">6</span>]<br><span class="hljs-keyword">minvalue</span> = list1[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">in</span> list1:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">each</span> &lt; <span class="hljs-keyword">minvalue</span>:<br>        <span class="hljs-keyword">minvalue</span> = each<br><br>print(<span class="hljs-keyword">minvalue</span>)<br></code></pre></td></tr></table></figure></li><li><p>视频中我们说 sum() 这个BIF有个缺陷，就是如果参数里有字符串类型的话就会报错，请写出一个新的实现过程，自动“无视”参数里的字符串并返回正确的计算结果 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> list1:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(each, <span class="hljs-built_in">str</span>):<br>        list1.remove(each)<br><br><span class="hljs-built_in">print</span>(list1, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-built_in">sum</span>(list1))<br></code></pre></td></tr></table></figure></li></ol><h1 id="017-函数：Python的乐高积木"><a href="#017-函数：Python的乐高积木" class="headerlink" title="017. 函数：Python的乐高积木"></a>017. 函数：Python的乐高积木</h1><h2 id="知识点-12"><a href="#知识点-12" class="headerlink" title="知识点"></a>知识点</h2><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFirstFunction</span>():</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;这是我创建的第一个函数&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我表示很激动&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">MyFirstFunction()</span><br>这是我创建的第一个函数<br>我表示很激动<br></code></pre></td></tr></table></figure><ul><li>先定义函数</li><li>执行函数时候，就是调用函数，向上面回找，依次执行函数体的内容</li><li>如果Python 向上找函数的时候，没有找到相应的函数名的定义过程，会报错</li></ul><h3 id="函数的参数"><a href="#函数的参数" class="headerlink" title="函数的参数"></a>函数的参数</h3><ul><li>Python 函数支持多个参数，但是尽量不用太多</li><li>函数要写好注释</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">MySecondFunction</span>(<span class="hljs-params">name</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27;I love You!&#x27;</span> )<br><span class="hljs-meta">... </span><br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>MySecondFunction()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: MySecondFunction() missing <span class="hljs-number">1</span> required positional argument: <span class="hljs-string">&#x27;name&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MySecondFunction(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)<br>小甲鱼I love You!<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num1, num2</span>):<br><span class="hljs-meta">... </span>    result = num1 + num2<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(result)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br><span class="hljs-number">3</span><br><br></code></pre></td></tr></table></figure><h3 id="函数的返回值"><a href="#函数的返回值" class="headerlink" title="函数的返回值"></a>函数的返回值</h3><ul><li>采用关键字return</li></ul><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num1, num2</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">return</span> (num1 + num2)</span><br><span class="hljs-meta prompt_">...</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span><br>3<br></code></pre></td></tr></table></figure><h2 id="课后作业-11"><a href="#课后作业-11" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-11"><a href="#Quiz-11" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>你有听说过DRY吗？ </p><p>DRY是程序员们公认的指导原则：Don’t Repeat Yourself.</p></li><li><p>都是重复一段代码，为什么我要使用函数（而不使用简单的拷贝黏贴）呢？ </p><ul><li>维护效率高</li><li>提高代码效率</li><li>降低代码量</li><li>易于阅读</li></ul></li><li><p>函数可以有多个参数吗？ </p><p>可以有多个参数</p></li><li><p>创建函数使用什么关键字，要注意什么？ </p><p>使用“def”关键字，要注意函数名后边要加上小括号“()”，然后小括号后边是冒号“:”，然后缩进部分均属于函数体的内容</p></li><li><p>请问这个函数有多少个参数？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFun</span>(<span class="hljs-params">(<span class="hljs-params">x, y</span>), (<span class="hljs-params">a, b</span>)</span>):<br>  <span class="hljs-keyword">return</span> x * y - a * b<br></code></pre></td></tr></table></figure><p>0，因为类似于这样的写法是错误的！我们分析下，函数的参数需要的是变量，而这里你试图用“元祖”的形式来传递是不可行的。</p></li><li><p>请问调用以下这个函数会打印什么内容？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello World!&#x27;</span>) <br>  <span class="hljs-keyword">return</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Welcome To FishC.com!&#x27;</span>)<br></code></pre></td></tr></table></figure><p>会打印‘Hello World!’。因为return会结束函数的执行。</p></li></ol><h3 id="Practice-8"><a href="#Practice-8" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个函数power()模拟内建函数pow()，即power(x, y)为计算并返回x的y次幂的值。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">power</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> y &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> y == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> x<br>        <span class="hljs-keyword">else</span>:<br>            result = x<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(y-<span class="hljs-number">1</span>):<br>                result *= x<br>            <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> y == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>/x<br>        <span class="hljs-keyword">else</span>:<br>            result = x<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>((-y-<span class="hljs-number">1</span>)):<br>                result *= x<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>/result<br><br><span class="hljs-built_in">print</span>(power(<span class="hljs-number">2</span>, -<span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure></li><li><p>编写一个函数，利用欧几里得算法（脑补链接）求最大公约数，例如gcd(x, y)返回值为参数x和参数y的最大公约数。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcder</span>(<span class="hljs-params">a, b</span>):<br>    flag = a % b<br>    result = b<br>    <span class="hljs-keyword">while</span> flag != <span class="hljs-number">0</span>:<br>        flag = a % b<br>        result = b<br>        a = b<br>        b = flag<br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-built_in">print</span>(gcder(<span class="hljs-number">121</span>, <span class="hljs-number">11</span>))<br></code></pre></td></tr></table></figure></li><li><p>编写一个将十进制转换为二进制的函数，要求采用“除2取余”（脑补链接）的方式，结果与调用bin()一样返回字符串形式。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">biner</span>(<span class="hljs-params">x</span>):<br>    binarylist = []<br>    <span class="hljs-keyword">while</span> x != <span class="hljs-number">0</span>:<br>        flag = <span class="hljs-built_in">str</span>(x % <span class="hljs-number">2</span>)<br>        binarylist.insert(<span class="hljs-number">0</span>, flag)<br>        x = x // <span class="hljs-number">2</span><br>    <span class="hljs-comment"># 将列表或元组转换成字符串的方法：&#x27;&#x27;.join(object)</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(binarylist)<br><br><span class="hljs-built_in">print</span>(biner(<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure></li></ol><h1 id="018-函数：灵活即强大"><a href="#018-函数：灵活即强大" class="headerlink" title="018. 函数：灵活即强大"></a>018. 函数：灵活即强大</h1><h2 id="知识点-13"><a href="#知识点-13" class="headerlink" title="知识点"></a>知识点</h2><h3 id="形参和实参"><a href="#形参和实参" class="headerlink" title="形参和实参"></a>形参和实参</h3><ul><li><code>\&gt;&gt;&gt; def MySecondFunction(name):</code> 函数定义过程中的name是叫形参， # 因为它只是一个形式，表示占据一个位置</li><li><code>\&gt;&gt;&gt; MySecondFunction(&#39;小甲鱼&#39;)</code> ：传递进来的小甲鱼叫做实参，因为它是具体的参数值</li></ul><h3 id="函数文档"><a href="#函数文档" class="headerlink" title="函数文档"></a>函数文档</h3><ul><li><p>系统默认特殊属性： <code>.__doc__</code></p></li><li><p>利用函数文档，对函数的内容，参数，意义以及返回值有一个介绍，让别人可以理解使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFirstFunction</span>(<span class="hljs-params">name</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-string">&#x27;函数定义过程中的name是叫形参&#x27;</span><br><span class="hljs-meta">... </span>    <span class="hljs-comment">#因为它只是一个形式，表示占据一个参数位置</span><br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;传递进来的&#x27;</span> + name + <span class="hljs-string">&#x27;叫做实参，因为它是具体的参数值！&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MyFirstFunction(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)<br>传递进来的小甲鱼叫做实参，因为它是具体的参数值！<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MyFirstFunction.__doc__<br><span class="hljs-string">&#x27;函数定义过程中的name是叫形参&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>.__doc__<br><span class="hljs-string">&quot;print(value, ..., sep=&#x27; &#x27;, end=&#x27;\\n&#x27;, file=sys.stdout, flush=False)\n\nPrints the values to a stream, or to sys.stdout by default.\nOptional keyword arguments:\nfile:  a file-like object (stream); defaults to the current sys.stdout.\nsep:   string inserted between values, default a space.\nend:   string appended after the last value, default a newline.\nflush: whether to forcibly flush the stream.&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br></code></pre></td></tr></table></figure></li></ul><h3 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h3><ul><li><p>利用关键字匹配参数，可以避免搞不清楚顺序按照位置匹配引起的问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">SaySome</span>(<span class="hljs-params">name, words</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27;-&gt;&#x27;</span> + words)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome(<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-string">&#x27;让编程改变世界&#x27;</span>)<br>小甲鱼-&gt;让编程改变世界<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome(<span class="hljs-string">&#x27;让编程改变世界&#x27;</span>, <span class="hljs-string">&#x27;小甲&#x27;</span>)<br>让编程改变世界-&gt;小甲<br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome(words=<span class="hljs-string">&#x27;让编程改变世界&#x27;</span>, name=<span class="hljs-string">&#x27;小甲鱼&#x27;</span>)<br>小甲鱼-&gt;让编程改变世界<br></code></pre></td></tr></table></figure></li></ul><h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><ul><li><p>在参数定义的过程中，为形参赋初始值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">SaySome</span>(<span class="hljs-params">name=<span class="hljs-string">&#x27;小甲鱼&#x27;</span>, words=<span class="hljs-string">&#x27;让编程改变世界&#x27;</span></span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27;-&gt;&#x27;</span> + words)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome()<br>小甲鱼-&gt;让编程改变世界<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome(<span class="hljs-string">&#x27;默默&#x27;</span>)<br>默默-&gt;让编程改变世界<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>SaySome(<span class="hljs-string">&#x27;默默&#x27;</span>, <span class="hljs-string">&#x27;你好&#x27;</span>)<br>默默-&gt;你<br></code></pre></td></tr></table></figure></li></ul><h3 id="收集参数"><a href="#收集参数" class="headerlink" title="收集参数"></a>收集参数</h3><ul><li><p>可变参数，原因是函数的作者有时候也搞不清楚到底需要多少个参数</p></li><li><p>在参数前面加上*号即可</p></li><li><p>Python 把标识为收集参数的参数用一个元组打包起来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">*params</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;参数的长度是&#x27;</span>, <span class="hljs-built_in">len</span>(params))<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第二个参数是&#x27;</span>, params[<span class="hljs-number">1</span>])<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小鲫鱼&#x27;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>)<br>参数的长度是 <span class="hljs-number">5</span><br>第二个参数是 小鲫鱼<br></code></pre></td></tr></table></figure></li><li><p>如果除了收集参数，还有其他定制参数，需要使用关键字参数来定制，不然会报错</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">*params, exp</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;参数的长度是&#x27;</span>, <span class="hljs-built_in">len</span>(params), exp)<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第二个参数是&#x27;</span>, params[<span class="hljs-number">1</span>])<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小鲫鱼&#x27;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: test() missing <span class="hljs-number">1</span> required keyword-only argument: <span class="hljs-string">&#x27;exp&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小鲫鱼&#x27;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, exp=<span class="hljs-number">8</span>)<br>参数的长度是 <span class="hljs-number">5</span> <span class="hljs-number">8</span><br>第二个参数是 小鲫鱼<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-12"><a href="#课后作业-12" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-12"><a href="#Quiz-12" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请问以下哪个是形参哪个是实参？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFun</span>(<span class="hljs-params">x</span>):<br><span class="hljs-keyword">return</span> x ** <span class="hljs-number">3</span><br>y = <span class="hljs-number">3</span><br><span class="hljs-built_in">print</span>(MyFun(y))<br></code></pre></td></tr></table></figure><p>x 是形参，y 是实参；形参指的是函数定义过程中，小括号里面的参数；实参指的是函数调用过程中传递进去的参数</p></li><li><p>函数文档和直接用“#”为函数写注释有什么不同</p><p>函数文档会保存在内置函数：<code>__doc__</code> ，可以通过 <code>help()</code> 或者 <code>.__doc__</code>  来查看</p></li><li><p>使用关键字参数，可以有效避免什么问题的出现呢？</p><p>可以避免忘记参数位置导致传入的实参不匹配的问题</p></li><li><p>使用help(print)查看print()这个BIF有哪些默认参数？分别起到什么作用？</p><p><code>print(value, ..., sep=&#39; &#39;, end=&#39;\n&#39;, file=sys.stdout, flush=False)</code></p></li><li><p>默认参数和关键字参数表面最大的区别是什么</p><p>默认参数会默认指定一个值，如果没有传入任何实参的时候，会使用默认值</p></li></ol><h3 id="Practice-9"><a href="#Practice-9" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个符合以下要求的函数：</p><p>a. 计算打印所有参数的和乘以基数（base&#x3D;3）的结果</p><p>b. 如果参数中最后一个参数为（base&#x3D;5），则设定基数为5，基数不参与求和计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个符合以下要求的函数：</span><br><span class="hljs-comment"># a. 计算打印所有参数的和乘以基数（base=3）的结果</span><br><span class="hljs-comment"># b. 如果参数中最后一个参数为（base=5），则设定基数为5，基数不参与求和计算</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">practice1</span>(<span class="hljs-params">*pram, base=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(pram)*base<br><br><br><span class="hljs-built_in">print</span>(practice1(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(practice1(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,  base=<span class="hljs-number">5</span>))<br></code></pre></td></tr></table></figure></li><li><p>寻找水仙花数</p><p>题目要求：如果一个3位数等于其各位数字的立方和，则称这个数为水仙花数。例如153 &#x3D; 1^3+5^3+3^3，因此153是一个水仙花数。编写一个程序，找出所有的水仙花数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 寻找水仙花数</span><br><span class="hljs-comment"># 题目要求：如果一个3位数等于其各位数字的立方和，则称这个数为水仙花数。例如153 = 1^3+5^3+3^3，因此153是一个水仙花数。编写一个程序，找出所有的水仙花数。</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">narcissistic</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>):<br>        x = i // <span class="hljs-number">100</span><br>        y = (i // <span class="hljs-number">10</span>) % <span class="hljs-number">10</span><br>        z = i % <span class="hljs-number">10</span><br>        <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">pow</span>(x, <span class="hljs-number">3</span>) + <span class="hljs-built_in">pow</span>(y, <span class="hljs-number">3</span>) + <span class="hljs-built_in">pow</span>(z, <span class="hljs-number">3</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;narcissistic number: %d&#x27;</span> % i)<br><br><br>narcissistic()<br></code></pre></td></tr></table></figure></li><li><p>编写一个函数 findstr()，该函数统计一个长度为 2 的子字符串在另一个字符串中出现的次数。例如：假定输入的字符串为“You cannot improve your past, but you can improve your future. Once time is wasted, life is wasted.”，子字符串为“im”，函数执行后打印“子字母串在目标字符串中共出现 3 次”。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个函数 findstr()，该函数统计一个长度为 2 的子字符串在另一个字符串中出现的次数。</span><br><span class="hljs-comment"># 例如：假定输入的字符串为</span><br><span class="hljs-comment"># “You cannot improve your past, but you can improve your future. Once time is wasted, life is wasted.”，</span><br><span class="hljs-comment"># 子字符串为“im”，函数执行后打印“子字母串在目标字符串中共出现 3 次”。</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findstr</span>(<span class="hljs-params">x, y</span>):<br>    a = y[<span class="hljs-number">0</span>]<br>    b = y[<span class="hljs-number">1</span>]<br>    count = <span class="hljs-number">0</span><br>    xlen = <span class="hljs-built_in">len</span>(x)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(xlen):<br>        <span class="hljs-keyword">if</span> x[i] == a <span class="hljs-keyword">and</span> x[i+<span class="hljs-number">1</span>] == b:<br>            count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(count)<br><br><br>findstr(<span class="hljs-string">&#x27;You cannot improve your past, but you can improve your future. Once time is wasted, life is wasted.&#x27;</span>, <span class="hljs-string">&#x27;im&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="019-函数：我的地盘听我的"><a href="#019-函数：我的地盘听我的" class="headerlink" title="019. 函数：我的地盘听我的"></a>019. 函数：我的地盘听我的</h1><h2 id="知识点-14"><a href="#知识点-14" class="headerlink" title="知识点"></a>知识点</h2><h3 id="函数和过程"><a href="#函数和过程" class="headerlink" title="函数和过程"></a>函数和过程</h3><ul><li><p>函数是有返回值的</p></li><li><p>过程是简单的，特殊的，没有返回值的</p></li><li><p>Python 只有函数，没有过程。Python的所有函数都是有返回的，有返回值就返回值，没有返回值就返回None</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello, fishC!&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>temp = hello()<br>hello, fishC!<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>temp<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(temp)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;NoneType&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li></ul><h3 id="再谈谈返回值"><a href="#再谈谈返回值" class="headerlink" title="再谈谈返回值"></a>再谈谈返回值</h3><ul><li><p>Python 动态确定类型，不需要提前定义</p></li><li><p>Python是没有变量的，只有名字</p></li><li><p>Python 是可以返回多个返回值的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">back</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span>[<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span>]<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>back()<br>[<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">back</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>back()<br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>, <span class="hljs-number">3.14</span>)<br></code></pre></td></tr></table></figure></li></ul><h3 id="我的地盘听我的-局部和全局变量"><a href="#我的地盘听我的-局部和全局变量" class="headerlink" title="我的地盘听我的 - 局部和全局变量"></a>我的地盘听我的 - 局部和全局变量</h3><ul><li><p><strong>局部变量</strong>： 作用域范围在函数内，在外面调用会出错；Python 在调用函数时，利用栈来存储函数所需要的代码和局部变量，当执行完函数，函数的栈会自动清空，所以函数执行完之后再试图访问函数体内的变量会出错</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">discounts</span>(<span class="hljs-params">price, rate</span>):<br>    final_price = price * rate<br>    <span class="hljs-keyword">return</span> final_price<br><br><br>old_price = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入原价：&#x27;</span>))<br>rate = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入折扣率：&#x27;</span>))<br>new_price = discounts(old_price, rate)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;打折扣价格是：&#x27;</span>, new_price)<br><br><span class="hljs-comment"># 试图打印局部变量：final_price 会报错</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;试图打印局部变量final_price&#x27;</span>, final_price)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">请输入原价：<span class="hljs-number">12</span><br>请输入折扣率：<span class="hljs-number">0.3</span><br>打折扣价格是： <span class="hljs-number">3.5999999999999996</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;/Users/felix_yang/PycharmProjects/learningpython/19/test01.py&quot;</span>, line <span class="hljs-number">15</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;试图打印局部变量final_price&#x27;</span>, final_price)<br>NameError: name <span class="hljs-string">&#x27;final_price&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></li><li><p><strong>全局变量</strong>：拥有更大的作用域，他们的作用域是整个代码段。那如果在函数体内部访问全局变量是不是可以呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">discounts</span>(<span class="hljs-params">price, rate</span>):<br>    final_price = price * rate<br>  <br>    <span class="hljs-comment"># 试图打印全局变量: old_price 不会报错</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;试图打印全局变量old_price&#x27;</span>, old_price)<br>    <br>    <span class="hljs-keyword">return</span> final_price<br><br><br>old_price = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入原价：&#x27;</span>))<br>rate = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入折扣率：&#x27;</span>))<br>new_price = discounts(old_price, rate)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;打折扣价格是：&#x27;</span>, new_price)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">请输入原价：<span class="hljs-number">12</span><br>请输入折扣率：<span class="hljs-number">0.4</span><br>试图打印全局变量old_price <span class="hljs-number">12.0</span><br>打折扣价格是： <span class="hljs-number">4.800000000000001</span><br></code></pre></td></tr></table></figure><p><em><strong>不要试图在函数内不修改全局变量，因为那样的话，python 会试图在函数内部创建一个名字一样的局部变量存储在函数的栈当中</strong></em></p></li></ul><h2 id="课后作业-13"><a href="#课后作业-13" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-13"><a href="#Quiz-13" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>下边程序会输出什么？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>():  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我在next()函数里...&#x27;</span>)  <br>    pre()  <br>  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pre</span>():  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我在pre()函数里...&#x27;</span>)  <br>  <br><span class="hljs-built_in">next</span>()<br></code></pre></td></tr></table></figure><p>我在next()函数里…</p><p>我在pre()函数里…</p></li><li><p>请问以下这个函数有返回值吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello FishC!&#x27;</span>) <br></code></pre></td></tr></table></figure><p>有，返回值是none</p></li><li><p>请问Python的return语句可以返回多个不同类型的值吗？</p><p>可以，可以return 列表，或者元组，把不同类型的值放到列表&#x2F;元组中返回</p></li><li><p>请目测以下程序会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">var</span>):  <br>    var = <span class="hljs-number">1314</span>  <br>    <span class="hljs-built_in">print</span>(var, end = <span class="hljs-string">&#x27;&#x27;</span>)  <br>  <br>var = <span class="hljs-number">520</span>  <br>fun(var)  <br><span class="hljs-built_in">print</span>(var) <br></code></pre></td></tr></table></figure><p><em>1314520</em></p><p>第一个打印出来的是函数体内的局部变量（名字也叫var），第二个打印出来的是定义在函数之外的全局变量var</p></li><li><p>目测以下程序会打印什么内容？</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> = <span class="hljs-string">&#x27;Hi&#x27;</span>  <br>  <br><span class="hljs-function">def <span class="hljs-title">fun1</span>():  </span><br><span class="hljs-function">    <span class="hljs-keyword">global</span> <span class="hljs-keyword">var</span>  </span><br><span class="hljs-function">    <span class="hljs-keyword">var</span></span> = <span class="hljs-string">&#x27; Baby &#x27;</span>  <br>    <span class="hljs-keyword">return</span> fun2(<span class="hljs-keyword">var</span>)  <br>  <br><span class="hljs-function">def <span class="hljs-title">fun2</span>(<span class="hljs-params"><span class="hljs-keyword">var</span></span>):  </span><br><span class="hljs-function">    <span class="hljs-keyword">var</span> +</span>= <span class="hljs-string">&#x27;I love you&#x27;</span>  <br>    fun3(<span class="hljs-keyword">var</span>)  <br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">var</span>  </span><br><span class="hljs-function">  </span><br><span class="hljs-function">def <span class="hljs-title">fun3</span>(<span class="hljs-params"><span class="hljs-keyword">var</span></span>):  </span><br><span class="hljs-function">    <span class="hljs-keyword">var</span></span> = <span class="hljs-string">&#x27; 小甲鱼 &#x27;</span>  <br>  <br>print(fun1())<br></code></pre></td></tr></table></figure><p>Baby I love you</p></li></ol><h3 id="Practice-10"><a href="#Practice-10" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个函数，判断传入的字符串参数是否为“回文联”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个函数，判断传入的字符串参数是否为“回文联”</span><br><br><span class="hljs-comment"># list的reverse()方法是返回None的，只会对列表内的元素逆序排序。而string的reserved()方法是会返回逆序后的字符串的</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">var</span>):<br>    list1 = <span class="hljs-built_in">list</span>(var)<br>    list2 = list1[:]<br>    list2.reverse()<br><br>    <span class="hljs-keyword">if</span> list1 == list2:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;传入的参数 %s 是：回文联&#x27;</span> % var)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;传入的参数 %s 不是：回文联&#x27;</span> % var)<br><br><br>check(<span class="hljs-string">&#x27;1234321&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>编写一个函数，分别统计传入字符串参数（可能不止一个参数）的英文字母、空格、数字和其它字符的个数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个函数，分别统计传入字符串参数（可能不止一个参数）的英文字母、空格、数字和其它字符的个数。</span><br><br><span class="hljs-comment"># 单个参数的情况</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_str</span>(<span class="hljs-params">var</span>):<br>    str_count = <span class="hljs-number">0</span><br>    space_count = <span class="hljs-number">0</span><br>    number_count = <span class="hljs-number">0</span><br>    other_count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> var:<br>        <span class="hljs-keyword">if</span> i.isdigit():<br>            number_count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> i.isalpha():<br>            str_count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> i.isspace():<br>            space_count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            other_count += <span class="hljs-number">1</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;英文字母个数是：%d&#x27;</span> % str_count)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;数字个数是：%d&#x27;</span> % number_count)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;空格个数是：%d&#x27;</span> % space_count)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;其他字符个数是：%d&#x27;</span> % other_count)<br><br><br>count_str(<span class="hljs-string">&#x27;12d99  safe&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个函数，分别统计传入字符串参数（可能不止一个参数）的英文字母、空格、数字和其它字符的个数。</span><br><br><span class="hljs-comment"># 多个参数的情况</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_str</span>(<span class="hljs-params">*param</span>):<br>    var_number = <span class="hljs-built_in">len</span>(param)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(var_number):<br>        str_count = <span class="hljs-number">0</span><br>        space_count = <span class="hljs-number">0</span><br>        number_count = <span class="hljs-number">0</span><br>        other_count = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> param[i]:<br>            <span class="hljs-keyword">if</span> each.isdigit():<br>                number_count += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> each.isalpha():<br>                str_count += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> each.isspace():<br>                space_count += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                other_count += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第 %d 个参数有 %d 英文字母，%d 数字， %d 空格， %d 其他字符&#x27;</span> % (i, str_count, number_count, space_count, other_count))<br><br><br>count_str(<span class="hljs-string">&#x27;1fe&#x27;</span>, <span class="hljs-string">&#x27;1ssssf sfe&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="020-函数：内嵌函数和闭包"><a href="#020-函数：内嵌函数和闭包" class="headerlink" title="020. 函数：内嵌函数和闭包"></a>020. 函数：内嵌函数和闭包</h1><h2 id="知识点-15"><a href="#知识点-15" class="headerlink" title="知识点"></a>知识点</h2><h3 id="全局Global-关键字"><a href="#全局Global-关键字" class="headerlink" title="全局Global 关键字"></a>全局Global 关键字</h3><ul><li><p>上节课提到不要试图去修改全局变量，python 会使用shadowing 的机制防止全局变量被修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>count = <span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFun</span>():<br><span class="hljs-meta">... </span>    count = <span class="hljs-number">10</span><br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(count)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MyFun()<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(count)<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></li><li><p>如果非要修改，可以使用global 关键字，把想要变成全局变量的局部变量变成全局变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">MyFun</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">global</span> count<br><span class="hljs-meta">... </span>    count = <span class="hljs-number">10</span><br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(count)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MyFun()<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(count)<br><span class="hljs-number">10</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="内嵌函数"><a href="#内嵌函数" class="headerlink" title="内嵌函数"></a>内嵌函数</h3><ul><li><p>python 是支持函数嵌套的，先看一个例子。注意嵌套里面的函数无法在外面调用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun1</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;fun1 is being called&#x27;</span>)<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fun2</span>():<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;fun2 is being called&#x27;</span>)<br><span class="hljs-meta">... </span>    fun2()<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>fun1()<br>fun1 <span class="hljs-keyword">is</span> being called<br>fun2 <span class="hljs-keyword">is</span> being called<br></code></pre></td></tr></table></figure></li></ul><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><ul><li><p>闭包是一种编程范式；其他的编程范式有：面向对象编程，面向过程编程，这些都是对代码的抽象和概括，使得代码的可用性和重用性变高</p></li><li><p>如果在一个内部函数里，对在外部作用域的变量（不是全局作用域的变量）进行引用，那么这个内部函数就是一个闭包</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">FunX</span>(<span class="hljs-params">x</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">FunY</span>(<span class="hljs-params">y</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> x * y<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> FunY<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>i = FunX(<span class="hljs-number">8</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>i<br>&lt;function FunX.&lt;<span class="hljs-built_in">locals</span>&gt;.FunY at <span class="hljs-number">0x103343040</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(i)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;function&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>i(<span class="hljs-number">5</span>)<br><span class="hljs-number">40</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>FunX(<span class="hljs-number">8</span>)(<span class="hljs-number">5</span>)<br><span class="hljs-number">40</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>FunY(<span class="hljs-number">5</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: name <span class="hljs-string">&#x27;FunY&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></li><li><p>因为闭包的概念是由内嵌函数演变而来， 所以也不能从外部函数的外面调用内部函数</p></li><li><p>在内部函数中只能对外部作用域的变量进行引用，不能修改，如果修改的话，这个变量同样会被shadowing，python 会在内部函数创建一个同名的内部作用域变量。以下例子显示了新建的内部作用域变量由于未被事先定义而报错</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun1</span>():<br><span class="hljs-meta">... </span>    x = <span class="hljs-number">5</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun2</span>():<br><span class="hljs-meta">... </span>            x *= x<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> x<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> Fun2()<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>Fun1()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">6</span>, <span class="hljs-keyword">in</span> Fun1<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> Fun2<br>UnboundLocalError: local variable <span class="hljs-string">&#x27;x&#x27;</span> referenced before assignment<br></code></pre></td></tr></table></figure><ul><li><p>有没有解决的办法呢？Python3 之前没有解决办法，只有通过容器类型来解决，比如列表，因为不会存储在栈里面，不会报错</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun1</span>():<br><span class="hljs-meta">... </span>    x = [<span class="hljs-number">5</span>]<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun2</span>():<br><span class="hljs-meta">... </span>            x[<span class="hljs-number">0</span>] *= x[<span class="hljs-number">0</span>]<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> x[<span class="hljs-number">0</span>]<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> Fun2()<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>Fun1()<br><span class="hljs-number">25</span><br></code></pre></td></tr></table></figure></li><li><p>Python3 开始，可以通过<em><strong>nonlocal</strong></em> 关键字来解决，类似于<em><strong>global</strong></em> 关键字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun1</span>():<br><span class="hljs-meta">... </span>    x = <span class="hljs-number">5</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Fun2</span>():<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">nonlocal</span> x<br><span class="hljs-meta">... </span>            x *= x<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> x<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> Fun2()<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>Fun1()<br><span class="hljs-number">25</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="闭包在实际开发中的作用"><a href="#闭包在实际开发中的作用" class="headerlink" title="闭包在实际开发中的作用"></a>闭包在实际开发中的作用</h3><ul><li><p>闭包的实际应用，主要是用来封装变量。即把变量隐藏起来，不让外面拿到和修改。</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mel">闭包就是能够读取其他函数内部变量的函数，说白了闭包就是个函数，只不过是处于其他函数内部而已。<br><br>由于在<span class="hljs-keyword">python</span>中，只有函数内部的子函数才能读取局部变量，所以说，闭包可以简单理解成“定义在一个函数内部的函数“。<br><br>所以，在本质上，闭包是将函数内部和函数外部连接起来的桥梁。<br><br>知乎大神说：闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。<br><br>二：用途是什么?<br><br><span class="hljs-number">1.</span>访问函数内部的变量<br><br><span class="hljs-number">2.</span>防止函数内部的变量执行完城后，被销毁，使其一直保存在内存中。<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-14"><a href="#课后作业-14" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-14"><a href="#Quiz-14" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>如果希望在函数中修改全局变量的值，应该使用什么关键字？</p><p>global</p></li><li><p>在嵌套函数中，如果希望在内部函数修改外部函数的局部变量，应该是用什么关键字？</p><p>nonlocal</p></li><li><p>Python的函数可以嵌套，但是要注意访问的作用域问题，请问以下代码存在什么问题呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">outside</span>():<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I am outside!&#x27;</span>)<br>      <span class="hljs-keyword">def</span> <span class="hljs-title function_">inside</span>():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I am inside!&#x27;</span>)<br>   <br>inside()<br></code></pre></td></tr></table></figure><p>不能直接访问嵌套内函数，只能访问outside()</p></li><li><p>请问为什么代码A没有报错，但是代码B却报错了？应该如何修改？</p><p>代码A：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">outside</span>():<br><span class="hljs-number">2</span>     var = <span class="hljs-number">5</span><br><span class="hljs-number">3</span>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">inside</span>():<br><span class="hljs-number">4</span>         var = <span class="hljs-number">3</span><br><span class="hljs-number">5</span>         <span class="hljs-built_in">print</span>(var )<br><span class="hljs-number">6</span>     inside()<br><span class="hljs-number">7</span> outside()<br></code></pre></td></tr></table></figure><p>代码B：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">outside</span>():<br><span class="hljs-number">2</span>     var = <span class="hljs-number">5</span><br><span class="hljs-number">3</span>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">inside</span>():<br><span class="hljs-number">4</span>         <span class="hljs-built_in">print</span>(var )<br><span class="hljs-number">5</span>         var = <span class="hljs-number">3</span><br><span class="hljs-number">6</span>     inside()<br><span class="hljs-number">7</span> outside()<br></code></pre></td></tr></table></figure><p>在内部函数中只能对外部作用域的变量进行引用，不能修改，如果修改的话，这个变量同样会被shadowing，python 会在内部函数创建一个同名的内部作用域变量。代码B 新建的内部作用域变量var 由于未被事先定义而被打印：print(var) 而报错。而代码A 已经事先定义： var&#x3D;3，所以不会报错</p></li><li><p>请问如何访问FunIn()呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">funOut</span>():<br><span class="hljs-number">2</span>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">funIn</span>():<br><span class="hljs-number">3</span>         <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;宾果！恭喜成功访问到啦~&quot;</span>)<br><span class="hljs-number">4</span>     <span class="hljs-keyword">return</span> funIn()<br></code></pre></td></tr></table></figure><p>funOut()</p></li><li><p>请问如何访问FunIn()呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">funOut</span>():<br><span class="hljs-number">2</span>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">funIn</span>():<br><span class="hljs-number">3</span>         <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;宾果！恭喜成功访问到啦~&quot;</span>)<br><span class="hljs-number">4</span>     <span class="hljs-keyword">return</span> funIn<br></code></pre></td></tr></table></figure></li></ol><p>​funOut()() </p><p>​或者</p><p>​a &#x3D; funOut()</p><p>​a()</p><ol start="7"><li><p>以下是“闭包”的一个例子，请你目测下会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"> <span class="hljs-number">1</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">funX</span>():<br> <span class="hljs-number">2</span>     x=<span class="hljs-number">5</span><br> <span class="hljs-number">3</span>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">funY</span>():<br> <span class="hljs-number">4</span>         <span class="hljs-keyword">nonlocal</span>  x<br> <span class="hljs-number">5</span>         x+=<span class="hljs-number">1</span><br> <span class="hljs-number">6</span>         <span class="hljs-keyword">return</span> x<br> <span class="hljs-number">7</span>     <span class="hljs-keyword">return</span> funY<br> <span class="hljs-number">8</span> a=funX()<br> <span class="hljs-number">9</span> <span class="hljs-built_in">print</span>(a())<br><span class="hljs-number">10</span> <span class="hljs-built_in">print</span>(a())<br><span class="hljs-number">11</span> <span class="hljs-built_in">print</span>(a())<br></code></pre></td></tr></table></figure><p>6</p><p>7</p><p>8</p><p>大家可能会迷惑，这。。。怎么跟全局变量一样了？局部变量x不是应该再每次调用的时候都重新初始化了吗？！</p><p>其实大家自己看看就明白了，当a &#x3D; funX()，只要a变量没有被重新赋值，funX()就没有被释放，也就是说局部变量x就没有被重新初始化。</p><p>所以当全局变量不适用的时候，可以考虑使用闭包更稳定和安全</p></li></ol><p>​</p><h3 id="Practice-11"><a href="#Practice-11" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>统计下边这个长字符串中各个字符出现的次数并找到小甲鱼送给大家的一句话</p><p><a href="https://github.com/felixyh/learningpython/blob/main/20/string1.txt">string1.txt</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_str</span>(<span class="hljs-params">x</span>):<br>    temp_list = []<br>    temp_number = []<br>    lenth = <span class="hljs-built_in">len</span>(x)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>():<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(lenth):<br>            current_char = x[i]<br>            <span class="hljs-keyword">if</span> current_char <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> temp_list:<br>                temp_list.append(current_char)<br>                temp_number.append(x.count(current_char))<br>        final_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(temp_list, temp_number))<br>        <span class="hljs-built_in">print</span>(final_list)<br>        <span class="hljs-comment"># print(&#x27;字符 %s 的数量是：%d&#x27; % (current, number))</span><br>    <span class="hljs-keyword">return</span> show()<br><br><br>count_str(string1)<br></code></pre></td></tr></table></figure><p><code>[(&#39;%&#39;, 6104), (&#39;$&#39;, 6046), (&#39;@&#39;, 6157), (&#39;_&#39;, 6112), (&#39;^&#39;, 6030), (&#39;#&#39;, 6115), (&#39;)&#39;, 6186), (&#39;&amp;&#39;, 6043), (&#39;!&#39;, 6079), (&#39;+&#39;, 6066), (&#39;]&#39;, 6152), (&#39;*&#39;, 6034), (&#39;&#125;&#39;, 6105), (&#39;[&#39;, 6108), (&#39;(&#39;, 6154), (&#39;&#123;&#39;, 6046), (&#39;\n&#39;, 1219), (&#39;G&#39;, 1), (&#39;O&#39;, 2), (&#39;D&#39;, 1), (&#39;L&#39;, 1), (&#39;U&#39;, 1), (&#39;C&#39;, 1), (&#39;K&#39;, 1)]</code></p><p>GOODLUCK</p></li><li><p>请用已经学过的知识编写程序，找出小甲鱼藏在下边这个长字符串中的密码，密码的埋藏点符合以下规律：</p><p><a href="https://github.com/felixyh/learningpython/blob/main/20/string2.txt">string2.txt</a></p><ul><li>每位密码为单个小写字母</li><li>每位密码的左右两边均有且只有三个大写字母</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_pass</span>(<span class="hljs-params">x</span>):<br>    str_length = <span class="hljs-built_in">len</span>(x) - <span class="hljs-number">9</span><br>    pass_list = <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_pass</span>():<br>        <span class="hljs-comment"># 指定pass_list 为nonlocal，因为需要从闭包函数里面调用修改</span><br>        <span class="hljs-keyword">nonlocal</span> pass_list<br><br>        <span class="hljs-comment"># 判断第一个password 字符，其实是从第4个字符开始： xxx[]xxxx，前后3个字符都是大写字母，第8个字符是小写</span><br>        <span class="hljs-keyword">if</span> x[:<span class="hljs-number">3</span>].isupper() <span class="hljs-keyword">and</span> x[<span class="hljs-number">4</span>:<span class="hljs-number">7</span>].isupper() <span class="hljs-keyword">and</span> (x[<span class="hljs-number">3</span>]+x[<span class="hljs-number">7</span>]).islower() <span class="hljs-keyword">and</span> x[:<span class="hljs-number">7</span>].isalpha():<br>            pass_list += x[<span class="hljs-number">3</span>]<br><br>        <span class="hljs-comment"># 每次截取9个字符放到temp_string，判断中间的一个字符和两头的字符是小写，前后3个字符为大写</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(str_length):<br>            temp_string = x[i:i+<span class="hljs-number">9</span>]<br>            temp_low = temp_string[<span class="hljs-number">0</span>] + temp_string[<span class="hljs-number">4</span>] + temp_string[-<span class="hljs-number">1</span>]<br>            temp_up = temp_string[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>] + temp_string[-<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">if</span> temp_low.islower() <span class="hljs-keyword">and</span> temp_up.isupper() <span class="hljs-keyword">and</span> (temp_up + temp_string[<span class="hljs-number">4</span>]).isalpha():<br>                pass_list += temp_string[<span class="hljs-number">4</span>]<br><br>        <span class="hljs-comment"># 判断最后一个password 字符，其实是从倒数第4个字符开始： xxxx[]xxx，前后3个字符都是大写字母，倒数第8个字符是小写</span><br>        <span class="hljs-keyword">if</span> x[-<span class="hljs-number">7</span>:-<span class="hljs-number">4</span>].isupper() <span class="hljs-keyword">and</span> x[-<span class="hljs-number">3</span>:].isupper() <span class="hljs-keyword">and</span> (x[-<span class="hljs-number">4</span>]+x[-<span class="hljs-number">7</span>]).islower() <span class="hljs-keyword">and</span> x[-<span class="hljs-number">7</span>:].isalpha():<br>            pass_list += x[-<span class="hljs-number">4</span>]<br><br>        <span class="hljs-built_in">print</span>(pass_list)<br><br>    <span class="hljs-keyword">return</span> show_pass()<br><br><br>find_pass(string2)<br></code></pre></td></tr></table></figure></li></ol><h1 id="021-函数：Lambda表达式"><a href="#021-函数：Lambda表达式" class="headerlink" title="021. 函数：Lambda表达式"></a>021. 函数：Lambda表达式</h1><h2 id="知识点-16"><a href="#知识点-16" class="headerlink" title="知识点"></a>知识点</h2><h3 id="匿名函数Lambda"><a href="#匿名函数Lambda" class="headerlink" title="匿名函数Lambda"></a>匿名函数Lambda</h3><ul><li><p>Lambda 表达式用冒号分隔，冒号前面是参数，后面是函数体内容</p></li><li><p>先举一个例子 - 1 个参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">ds</span>(<span class="hljs-params">x</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ds(<span class="hljs-number">5</span>)<br><span class="hljs-number">11</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">lambda</span> x : <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span><br>&lt;function &lt;<span class="hljs-keyword">lambda</span>&gt; at <span class="hljs-number">0x1033431f0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>g = <span class="hljs-keyword">lambda</span> x : <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>g(<span class="hljs-number">5</span>)<br><span class="hljs-number">11</span><br></code></pre></td></tr></table></figure></li><li><p>再举一个例子 - 2个参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> x + y<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>add(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br><span class="hljs-number">7</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">lambda</span> x, y : x + y<br>&lt;function &lt;<span class="hljs-keyword">lambda</span>&gt; at <span class="hljs-number">0x103343310</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>g = <span class="hljs-keyword">lambda</span> x, y : x + y<br><span class="hljs-meta">&gt;&gt;&gt; </span>g(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br><span class="hljs-number">7</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="Lambda-表达式的作用"><a href="#Lambda-表达式的作用" class="headerlink" title="Lambda 表达式的作用"></a>Lambda 表达式的作用</h3><ul><li>Python写一些执行脚本的时候，使用lambda就可以省下定义函数的过程，比如说我们只是需要写个简单的脚本来管理服务器时间，我们就不需要专门定义一个函数然后再写调用，使用lambda可以使得代码更加精简。</li><li>对于一些比较抽象并且整个程序执行下来只需要调用一两次的函数，有时候给函数起个名字是比较头疼的问题，使用lambda就不需要考虑命名的问题了。</li><li>简化代码的可读性，由于普通屌丝函数阅读经常要跳到开头def 定义部分，使用lambda函数可以省去这样的步骤</li></ul><h3 id="两个比较牛逼的BIF"><a href="#两个比较牛逼的BIF" class="headerlink" title="两个比较牛逼的BIF"></a>两个比较牛逼的BIF</h3><ul><li><p>filter() : </p><ul><li><p>filter(function or None, iterable)</p></li><li><p>Return an iterator yielding those items of iterable for which function(item) is true. If function is None, return the items that are true. (如果第一个参数是函数，返回一个迭代器，返回iterable中function(item)为true的元素;   如果第一个参数是none，返回值为true的item)</p><p>举例：如果第一个参数为函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">odd</span>(<span class="hljs-params">x</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> x % <span class="hljs-number">2</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>temp = <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>show = <span class="hljs-built_in">filter</span>(odd, temp)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(show)<br>[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>]<br></code></pre></td></tr></table></figure><p>用lambda 实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>show = <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x : x % <span class="hljs-number">2</span>, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(show)<br>[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>]<br></code></pre></td></tr></table></figure><p>举例：如果第一个参数为None：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">False</span>, <span class="hljs-literal">True</span>])<br>&lt;<span class="hljs-built_in">filter</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x103325730</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">False</span>, <span class="hljs-literal">True</span>]))<br>[<span class="hljs-number">1</span>, <span class="hljs-literal">True</span>]<br></code></pre></td></tr></table></figure></li></ul></li><li><p>map()</p><ul><li><p>map(func, *iterables)  第一个参数是函数，后面的参数是一个或者多个序列</p></li><li><p>Make an iterator that computes the function using arguments from each of the iterables. Stops when the shortest iterable is exhausted. (使用每个可迭代对象的参数计算函数，来创建一个迭代器，当最短的可迭代对象耗尽时停止。)</p><p>举例：一个序列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x : x * <span class="hljs-number">2</span>, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)))<br>[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">14</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>]<br></code></pre></td></tr></table></figure><p>举例：多个序列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x, y : x * y, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>), <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)))<br>[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">9</span>, <span class="hljs-number">16</span>]<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-15"><a href="#课后作业-15" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-15"><a href="#Quiz-15" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请使用lambda表达式将下边函数转变为匿名函数？</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">def <span class="hljs-keyword">fun</span><span class="hljs-constructor">_A(<span class="hljs-params">x</span>,<span class="hljs-params">y</span>=3)</span>:<br>    return x*y<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">lambda</span> x, y=<span class="hljs-number">3</span> : x * y<br></code></pre></td></tr></table></figure></li><li><p>请将下边的匿名函数转变为普通的屌丝函数？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ds</span>(<span class="hljs-params">x</span>):<br><span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span>:<br><span class="hljs-keyword">return</span> x<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure></li><li><p>感受一下使用匿名函数后给你的编程生活带来的变化？</p><p>不用为起函数名而烦恼了</p></li><li><p>你可以利用filter()和lambda表达式快速求出100以内所有3的倍数吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x : <span class="hljs-keyword">not</span>( x % <span class="hljs-number">3</span> ), <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)))<br>[<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">24</span>, <span class="hljs-number">27</span>, <span class="hljs-number">30</span>, <span class="hljs-number">33</span>, <span class="hljs-number">36</span>, <span class="hljs-number">39</span>, <span class="hljs-number">42</span>, <span class="hljs-number">45</span>, <span class="hljs-number">48</span>, <span class="hljs-number">51</span>, <span class="hljs-number">54</span>, <span class="hljs-number">57</span>, <span class="hljs-number">60</span>, <span class="hljs-number">63</span>, <span class="hljs-number">66</span>, <span class="hljs-number">69</span>, <span class="hljs-number">72</span>, <span class="hljs-number">75</span>, <span class="hljs-number">78</span>, <span class="hljs-number">81</span>, <span class="hljs-number">84</span>, <span class="hljs-number">87</span>, <span class="hljs-number">90</span>, <span class="hljs-number">93</span>, <span class="hljs-number">96</span>, <span class="hljs-number">99</span>]<br></code></pre></td></tr></table></figure></li><li><p>还记得列表推导式吗？完全可以使用列表推导式代替filter()和lambda组合，你可以做到吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[ x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">if</span> x % <span class="hljs-number">3</span> == <span class="hljs-number">0</span> ]<br>[<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">24</span>, <span class="hljs-number">27</span>, <span class="hljs-number">30</span>, <span class="hljs-number">33</span>, <span class="hljs-number">36</span>, <span class="hljs-number">39</span>, <span class="hljs-number">42</span>, <span class="hljs-number">45</span>, <span class="hljs-number">48</span>, <span class="hljs-number">51</span>, <span class="hljs-number">54</span>, <span class="hljs-number">57</span>, <span class="hljs-number">60</span>, <span class="hljs-number">63</span>, <span class="hljs-number">66</span>, <span class="hljs-number">69</span>, <span class="hljs-number">72</span>, <span class="hljs-number">75</span>, <span class="hljs-number">78</span>, <span class="hljs-number">81</span>, <span class="hljs-number">84</span>, <span class="hljs-number">87</span>, <span class="hljs-number">90</span>, <span class="hljs-number">93</span>, <span class="hljs-number">96</span>, <span class="hljs-number">99</span>]<br></code></pre></td></tr></table></figure></li><li><p>还记得zip吗？使用zip会将两数以元祖的形式绑定在一块，例如：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&gt;&gt;&gt; list<span class="hljs-comment">(zip([1, 3, 5, 7, 9], [2, 4, 6, 8, 10])</span>)<br>[<span class="hljs-comment">(1, 2)</span>, <span class="hljs-comment">(3, 4)</span>, <span class="hljs-comment">(5, 6)</span>, <span class="hljs-comment">(7, 8)</span>, <span class="hljs-comment">(9, 10)</span>]<br></code></pre></td></tr></table></figure><p>但如果我希望打包的形式是灵活多变的列表而不是元祖（希望是[[1, 2], [3, 4], [5, 6], [7, 8], [9, 10]]这种形式），你能做到吗？（采用map和lambda表达式）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x, y :  [x, y], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>] ))<br>[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">10</span>]]<br></code></pre></td></tr></table></figure></li><li><p>请目测以下表达式会打印什么？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_repeat</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">lambda</span> s: s * n<br>double = make_repeat(<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(double(<span class="hljs-number">8</span>))<br><span class="hljs-built_in">print</span>(double(<span class="hljs-string">&#x27;FishC&#x27;</span>))<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">16<br>FishCFishC<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-12"><a href="#Practice-12" class="headerlink" title="Practice"></a>Practice</h3><h1 id="022-函数：递归是神马？"><a href="#022-函数：递归是神马？" class="headerlink" title="022. 函数：递归是神马？"></a>022. 函数：递归是神马？</h1><h2 id="知识点-17"><a href="#知识点-17" class="headerlink" title="知识点"></a>知识点</h2><p>递归其实就是函数调用自己</p><ul><li>汉诺塔游戏： 使用递归会比迭代更好</li><li>树结构的定义： 使用递归定义结构体会比其他方法容易很多</li><li>谢尔宾斯基三角形：递归组成的图案</li><li>女神自拍</li></ul><h3 id="一个递归的例子"><a href="#一个递归的例子" class="headerlink" title="一个递归的例子"></a>一个递归的例子</h3><ul><li><p>写一个求阶乘的函数</p><ul><li>正整数阶乘指从1乘以2乘以3乘以4一直乘到所要求的数</li><li>例如所给的数是5，则阶乘式是1x2x3x4x5，得到的积是120，所以120就是5的阶乘</li></ul><ol><li><p>非递归版本范例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">x</span>):<br>    result = x<br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, x):<br>        result *= n<br>    <span class="hljs-keyword">return</span> result<br><br><br>number = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input a number:&#x27;</span>))<br>final_result = factorial(number)<br><span class="hljs-built_in">print</span>(final_result)<br></code></pre></td></tr></table></figure></li><li><p>递归版本范例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> n * factorial(n-<span class="hljs-number">1</span>)<br><br><br>number = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input a number:&#x27;</span>))<br>final_result = factorial(number)<br><span class="hljs-built_in">print</span>(final_result)<br></code></pre></td></tr></table></figure><p>![image-20220509110226777](&#x2F;Users&#x2F;felix_yang&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20220509110226777.png)</p></li></ol></li></ul><h2 id="课后作业-16"><a href="#课后作业-16" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-16"><a href="#Quiz-16" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>递归在编程上的形式是如何表现的呢？</p><p>函数自己调用自己</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>():<br><span class="hljs-keyword">return</span> fun()<br></code></pre></td></tr></table></figure><p>不过这样是不行的，因为没有停止条件，IDLE会一直报错，直到你按下Ctlr + C。python3默认递归的深度是100层，可以通过以下代码修改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> sys<br><span class="hljs-meta">&gt;&gt;&gt; </span>sys.setrecursionlimit(<span class="hljs-number">1000</span>)<br></code></pre></td></tr></table></figure></li><li><p>递归必须满足哪两个基本条件？</p><p>递和归，调用自身，有停止条件。</p></li><li><p>思考一下，按照递归的特性，在编程中有没有不得不使用递归的情况？</p><p>例如汉诺塔，目录索引（因为你不知道目录里是否还有目录），树结构的定义等</p></li><li><p>用递归去计算阶乘问题或斐波那契数列是很糟糕的算法，你知道为什么吗？</p><p>因为递归是函数调用自身，每一次调用都要进行压栈和出栈，需要很多时间和内存资源。</p></li><li><p>请聊一聊递归的优缺点（无需官方陈词，想到什么写什么就可以）</p><p>优点：可以使代码简洁；在解决一些问题，如汉诺塔问题时比较方便<br>缺点：使用上需要谨慎，因为会占用大量时间和资源；还有可能因为停止条件设置不合适而导致内存爆满。</p></li><li><p>拿手机拍一张“递归自拍照片”</p><p>拍这个的话需要两面镜子，那会是一个没有停止条件的递归，无限循环反射下去。</p></li></ol><h3 id="Practice-13"><a href="#Practice-13" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>使用递归编写一个power()函数内建函数pow()，即power(x,y)为计算并返回x的y次幂的值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用递归编写一个power()函数内建函数pow()，即power(x,y)为计算并返回x的y次幂的值。</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">power</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> y == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> x<br>    <span class="hljs-keyword">elif</span> y == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> x * power(x, y-<span class="hljs-number">1</span>)<br><br><br><span class="hljs-built_in">print</span>(power(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure></li><li><p>使用递归编写一个函数，利用欧几里得算法求最大公约数，例如gcd(x,y)返回值为参数x和参数y的最大公约数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用递归编写一个函数，利用欧几里得算法求最大公约数，例如gcd(x,y)返回值为参数x和参数y的最大公约数。</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcder</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> x % y == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> y<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> gcder(y, x % y)<br><br><br><span class="hljs-built_in">print</span>(gcder(<span class="hljs-number">9</span>, <span class="hljs-number">6</span>))<br></code></pre></td></tr></table></figure></li></ol><h1 id="023-递归：这帮小兔崽子"><a href="#023-递归：这帮小兔崽子" class="headerlink" title="023. 递归：这帮小兔崽子"></a>023. 递归：这帮小兔崽子</h1><h2 id="知识点-18"><a href="#知识点-18" class="headerlink" title="知识点"></a>知识点</h2><h3 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h3><p>![image-20220513210700654](&#x2F;Users&#x2F;felix_yang&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20220513210700654.png)</p><ul><li><p>递归算法 - 思路清晰，但是耗费资源</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> n &lt; <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> fibonacci(n-<span class="hljs-number">1</span>) + fibonacci(n-<span class="hljs-number">2</span>)<br><br><br>n = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input a number:&#x27;</span>)<br>result = fibonacci(<span class="hljs-built_in">int</span>(n))<br><span class="hljs-keyword">if</span> result != -<span class="hljs-number">1</span>:<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure></li><li><p>迭代算法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):<br>    n1 = <span class="hljs-number">1</span><br>    n2 = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The number is incorrect&#x27;</span>)<br><br>    <span class="hljs-keyword">elif</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">while</span> (n-<span class="hljs-number">2</span>) &gt; <span class="hljs-number">0</span>:<br>            n3 = n1 + n2<br>            n1 = n2<br>            n2 = n3<br>            n -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> n3<br><br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input a number:&#x27;</span>))<br>result = fibonacci(n)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure></li></ul><h1 id="024-递归：汉诺塔"><a href="#024-递归：汉诺塔" class="headerlink" title="024. 递归：汉诺塔"></a>024. 递归：汉诺塔</h1><h2 id="知识点-19"><a href="#知识点-19" class="headerlink" title="知识点"></a>知识点</h2><img src="/Users/felix_yang/Library/Application Support/typora-user-images/image-20220515204116145.png" alt="image-20220515204116145" style="zoom:50%;" /><img src="/Users/felix_yang/Library/Application Support/typora-user-images/image-20220516082730879.png" alt="image-20220516082730879" style="zoom:50%;" /><img src="/Users/felix_yang/Library/Application Support/typora-user-images/image-20220516082806121.png" alt="image-20220516082806121" style="zoom:50%;" /><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs lua">In [<span class="hljs-number">1</span>]: def hanoi(n, x, y, z):<br>   ...:     <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>   ...:         <span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;---&gt;&#x27;</span>, z)<br>   ...:     <span class="hljs-keyword">else</span>:<br>   ...:         hanoi(n<span class="hljs-number">-1</span>, x, z, y)<br>   ...:         <span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;---&gt;&#x27;</span>, z)<br>   ...:         hanoi(n<span class="hljs-number">-1</span>, y, x, z)<br>   ...: <br><br><br>In [<span class="hljs-number">2</span>]: n = int(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input the hanoi levels:&#x27;</span>))<br>please <span class="hljs-built_in">input</span> the hanoi levels:<span class="hljs-number">3</span><br><br>In [<span class="hljs-number">3</span>]: hanoi(n, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>)<br>x <span class="hljs-comment">---&gt; z</span><br>x <span class="hljs-comment">---&gt; y</span><br>z <span class="hljs-comment">---&gt; y</span><br>x <span class="hljs-comment">---&gt; z</span><br>y <span class="hljs-comment">---&gt; x</span><br>y <span class="hljs-comment">---&gt; z</span><br>x <span class="hljs-comment">---&gt; z</span><br></code></pre></td></tr></table></figure><h2 id="课后作业-17"><a href="#课后作业-17" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-17"><a href="#Quiz-17" class="headerlink" title="Quiz"></a>Quiz</h3><h3 id="Practice-14"><a href="#Practice-14" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>使用递归编写一个十进制转换为二进制的函数（要求采用“取2取余”的方式，结果与调用bin()一样返回字符串形式）<br>$$<br>b &#x3D; f(x) &#x3D; \left{<br>  \begin{array}{lr}<br>1 &amp; : x &#x3D; 1\<br>f( x &#x2F;&#x2F; 2) \Join x % 2 &amp; : x &gt; 1<br>  \end{array}<br>\right.<br>$$</p><p>$$<br>\Join 表示拼接；<br>公式的意思是：如果十进制正整数 x 等于 1，那它对应的二进制 b 就是 1；<br>否则 x 大于 1，那它的二进制就是 d 整除 2 的商对应的二进制，拼接 x 整除 2 的余数。<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用递归编写一个十进制转换为二进制的函数（要求采用“取2取余”的方式，结果与调用bin()一样返回字符串形式）</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bin_recursion</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(bin_recursion(n // <span class="hljs-number">2</span>)) + <span class="hljs-built_in">str</span>(n % <span class="hljs-number">2</span>)<br><br><br><span class="hljs-built_in">print</span>(bin_recursion(<span class="hljs-number">8</span>))<br></code></pre></td></tr></table></figure></li><li><p>写一个函数get_digits(n)，将参数n分解出每个位的数字并按顺序存放到列表中。举例：get_digits(12345) &#x3D;&#x3D;&gt; [1, 2, 3, 4, 5] </p><p>$$<br>b &#x3D; f(x) &#x3D; \left{  \begin{array}{lr}<br>[ ] &amp; : x &#x3D; 0 \  <br>[f( x &#x2F;&#x2F; 10) , x % 10 ]&amp; : x &gt; 0  <br>\end{array}\right.<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 写一个函数get_digits(n)，将参数n分解出每个位的数字并按顺序存放到列表中。举例：get_digits(12345) ==&gt; [1, 2, 3, 4, 5]</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_digits</span>(<span class="hljs-params">n</span>):<br>    result = []<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> []<br>    <span class="hljs-keyword">else</span>:<br>        result.extend(get_digits(n // <span class="hljs-number">10</span>))<br>        result.append(n % <span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-built_in">print</span>(get_digits(<span class="hljs-number">12342321421321</span>))<br></code></pre></td></tr></table></figure></li><li><p>还记得求回文字符串那道题吗？现在让你使用递归的方式来求解，亲还能骄傲的说我可以吗   </p></li><li><p>使用递归编程求解以下问题： </p><p>有5个人坐在一起，问第五个人多少岁？他说比第4个人大2岁。问第4个人岁数，他说比第3个人大2岁。问第三个人，又说比第2人大两岁。问第2个人，说比第一个人大两岁。最后问第一个人，他说是10岁。请问第五个人多大？ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用递归编程求解以下问题：</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 有5个人坐在一起，问第五个人多少岁？他说比第4个人大2岁。问第4个人岁数，他说比第3个人大2岁。问第三个人，又说比第2人大两岁。问第2个人，说比第一个人大两岁。最后问第一个人，他说是10岁。请问第五个人多大？</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">10</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> age(n-<span class="hljs-number">1</span>) + <span class="hljs-number">2</span><br><br><br><span class="hljs-built_in">print</span>(age(<span class="hljs-number">5</span>))<br></code></pre></td></tr></table></figure></li></ol><h1 id="025-字典：当索引不好用时"><a href="#025-字典：当索引不好用时" class="headerlink" title="025. 字典：当索引不好用时"></a>025. 字典：当索引不好用时</h1><h2 id="知识点-20"><a href="#知识点-20" class="headerlink" title="知识点"></a>知识点</h2><h3 id="字典概念"><a href="#字典概念" class="headerlink" title="字典概念"></a>字典概念</h3><ul><li><p>Python的字典，key-value，也称为HASH，关系数组</p></li><li><p>映射类型区别于序列类型，通过数组的形式进行存储的，通过索引进行存取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">9</span>]: brand = [<span class="hljs-string">&#x27;李宁&#x27;</span>, <span class="hljs-string">&#x27;耐克&#x27;</span>, <span class="hljs-string">&#x27;阿迪达斯&#x27;</span>, <span class="hljs-string">&#x27;鱼C 工作室&#x27;</span>]<br><br>In [<span class="hljs-number">10</span>]: slogan = [<span class="hljs-string">&#x27;一切皆有可能&#x27;</span>, <span class="hljs-string">&#x27;Just Do It&#x27;</span>, <span class="hljs-string">&#x27;Impossible is nothing&#x27;</span>, <span class="hljs-string">&#x27;让编程改变世界&#x27;</span>]<br><br>In [<span class="hljs-number">11</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;鱼C 工作室的口号是：&#x27;</span>, slogan[brand.index(<span class="hljs-string">&#x27;鱼C 工作室&#x27;</span>)])<br>鱼C 工作室的口号是： 让编程改变世界<br></code></pre></td></tr></table></figure></li><li><p>创建和访问字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">12</span>]: dict1 = &#123;<span class="hljs-string">&#x27;李宁&#x27;</span>:<span class="hljs-string">&#x27;一切皆有可能&#x27;</span>, <span class="hljs-string">&#x27;耐克&#x27;</span>:<span class="hljs-string">&#x27;Just Do It&#x27;</span>, <span class="hljs-string">&#x27;阿迪达斯&#x27;</span>:<span class="hljs-string">&#x27;Impossible is nothing&#x27;</span>, <span class="hljs-string">&#x27;鱼C 工作室&#x27;</span>:<span class="hljs-string">&#x27;让编程改变世界&#x27;</span>&#125;<br><br>In [<span class="hljs-number">13</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;鱼C 工作室的口号是：&#x27;</span>, dict1[<span class="hljs-string">&#x27;鱼C 工作室&#x27;</span>])<br>鱼C 工作室的口号是： 让编程改变世界<br><br>In [<span class="hljs-number">14</span>]: dict2 = &#123;<span class="hljs-number">1</span>:<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-number">2</span>:<span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-number">3</span>:<span class="hljs-string">&#x27;three&#x27;</span>&#125;<br><br>In [<span class="hljs-number">15</span>]: dict2<br>Out[<span class="hljs-number">15</span>]: &#123;<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;three&#x27;</span>&#125;<br><br>In [<span class="hljs-number">16</span>]: dict2[<span class="hljs-number">2</span>]<br>Out[<span class="hljs-number">16</span>]: <span class="hljs-string">&#x27;two&#x27;</span><br><br>In [<span class="hljs-number">17</span>]: dict3 = &#123;&#125;<br><br>In [<span class="hljs-number">18</span>]: dict3<br>Out[<span class="hljs-number">18</span>]: &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li><p>dict() 工厂函数 创建字典</p><blockquote><p>工厂函数看上去有点像函数，实质上他们是类，当你调用他们时，实际上是生成了该类型的一个实例，就像工厂生产货物一样，常见的工厂函数有：list(), tuple(), dict(), int(), float()</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">19</span>]: dict3 = <span class="hljs-built_in">dict</span>(((<span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">70</span>), (<span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-number">105</span>), (<span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-number">104</span>), (<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-number">67</span>)))<br><br>In [<span class="hljs-number">20</span>]: dict3<br>Out[<span class="hljs-number">20</span>]: &#123;<span class="hljs-string">&#x27;F&#x27;</span>: <span class="hljs-number">70</span>, <span class="hljs-string">&#x27;i&#x27;</span>: <span class="hljs-number">105</span>, <span class="hljs-string">&#x27;h&#x27;</span>: <span class="hljs-number">104</span>, <span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-number">67</span>&#125;<br></code></pre></td></tr></table></figure></li><li><p>关键字参数创建字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">25</span>]: dict4 = <span class="hljs-built_in">dict</span>(李宁=<span class="hljs-string">&#x27;一切皆有可能&#x27;</span>, 耐克=<span class="hljs-string">&#x27;Just Do It&#x27;</span>)<br><br>In [<span class="hljs-number">26</span>]: dict4<br>Out[<span class="hljs-number">26</span>]: &#123;<span class="hljs-string">&#x27;李宁&#x27;</span>: <span class="hljs-string">&#x27;一切皆有可能&#x27;</span>, <span class="hljs-string">&#x27;耐克&#x27;</span>: <span class="hljs-string">&#x27;Just Do It&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></li><li><p>直接给字典的键赋值，如果这个键不存在，会直接创建这个键</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">29</span>]: dict4[<span class="hljs-string">&#x27;阿迪达斯&#x27;</span>] = <span class="hljs-string">&#x27;Impossible is nothing&#x27;</span><br><br>In [<span class="hljs-number">30</span>]: dict4<br>Out[<span class="hljs-number">30</span>]: &#123;<span class="hljs-string">&#x27;李宁&#x27;</span>: <span class="hljs-string">&#x27;一切皆有可能&#x27;</span>, <span class="hljs-string">&#x27;耐克&#x27;</span>: <span class="hljs-string">&#x27;Just Do It&#x27;</span>, <span class="hljs-string">&#x27;阿迪达斯&#x27;</span>: <span class="hljs-string">&#x27;Impossible is nothing&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="字典常用内建方法"><a href="#字典常用内建方法" class="headerlink" title="字典常用内建方法"></a>字典常用内建方法</h3><blockquote><p>clear()   fromkeys()  items()   pop()    setdefault() values()   </p><p>​        copy()    get()    keys()    popitem()  update()</p></blockquote><h2 id="课后作业-18"><a href="#课后作业-18" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-18"><a href="#Quiz-18" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>当你听到小伙伴们在谈论“映射”、“哈希”、“散列”或者“关系数组”的时候，事实上他们就是在讨论什么呢</p><p>字典</p></li><li><p>尝试一下将数据（‘F’: 70, ‘C’: 67, ‘h’: 104, ‘i’: 105, ‘s’: 115）创建为一个字典并访问键 ‘C’ 对应的值？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>dict1 = <span class="hljs-built_in">dict</span>(F=<span class="hljs-number">70</span>, C=<span class="hljs-number">67</span>, h=<span class="hljs-number">104</span>, i=<span class="hljs-number">105</span>, s=<span class="hljs-number">115</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>dict1<br>&#123;<span class="hljs-string">&#x27;F&#x27;</span>: <span class="hljs-number">70</span>, <span class="hljs-string">&#x27;C&#x27;</span>: <span class="hljs-number">67</span>, <span class="hljs-string">&#x27;h&#x27;</span>: <span class="hljs-number">104</span>, <span class="hljs-string">&#x27;i&#x27;</span>: <span class="hljs-number">105</span>, <span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">115</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>dict1[<span class="hljs-string">&#x27;C&#x27;</span>]<br><span class="hljs-number">67</span><br></code></pre></td></tr></table></figure></li><li><p>用方括号（“[]”）括起来的数据我们叫列表，那么使用大括号（“{}”）括起来的数据我们就叫字典，对吗？</p><p>不对，用大括号括起来的数据还要形成有对应对象的映射关系（即 键 与 值 ）才能构成字典。</p></li><li><p>你如何理解有些东西字典做得到，但“万能的”列表却难以实现（臣妾做不到T_T）？</p><p>列表本身的元素是只有与其所在位置的索引值有对应关系的，而元素与元素之间是无法产生相互映射关系的，并且列表与列表之间要表达映射关系只能通过索引值进行索引之后再提取进行对应，这样会变麻烦很多。所以字典的存在就弥补了这种繁琐过程的缺陷，字典本身内在的元素就通过键(key)与值(value)之间进行了映射关系，所以在调用的时候能很快通过键取得值，省去了列表与列表先索引再对应的过程。</p></li><li><p>下边这些代码，他们都在执行一样的操作吗？你看得出差别吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-built_in">dict</span>(one=<span class="hljs-number">1</span>,two=<span class="hljs-number">2</span>,three=<span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = &#123;<span class="hljs-string">&#x27;one&#x27;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;two&#x27;</span>:<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;three&#x27;</span>:<span class="hljs-number">3</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>c = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>([<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;two&#x27;</span>,<span class="hljs-string">&#x27;three&#x27;</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]))<br><span class="hljs-meta">&gt;&gt;&gt; </span>d = <span class="hljs-built_in">dict</span>([(<span class="hljs-string">&#x27;two&#x27;</span>,<span class="hljs-number">2</span>),(<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-number">1</span>),(<span class="hljs-string">&#x27;three&#x27;</span>,<span class="hljs-number">3</span>)])<br><span class="hljs-meta">&gt;&gt;&gt; </span>e = <span class="hljs-built_in">dict</span>(&#123;<span class="hljs-string">&#x27;three&#x27;</span>:<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;one&#x27;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;two&#x27;</span>:<span class="hljs-number">2</span>&#125;)<br></code></pre></td></tr></table></figure><p>A: 通过关键字定义，关键字不能加引号</p><p>B: 直接定义</p><p>C: 先用zip 生成一个具有映射关系的对象，每个元素就是一个元祖，包含键和值，然后用工厂函数dict 转换成字典</p><p>D: 把一个具有映射关系的列表，用工厂函数dict 转换成字典</p><p>E: 把一个具有映射关系的字典，用工厂函数dict 转换成字典</p></li><li><p>如图，你可以推测出打了马赛克部分的代码吗？</p><p><img src="https://img-blog.csdnimg.cn/20190427184131580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0ODk1OTI3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>​<code>data.split(&#39;,&#39;)</code></p></li></ol><h3 id="Practice-15"><a href="#Practice-15" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>尝试利用字典的特性编写一个通讯录程序吧，功能如图：</p><p><img src="https://img-blog.csdnimg.cn/2019042718425940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0ODk1OTI3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ol><p>​<strong>Version-1</strong>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 尝试利用字典的特性编写一个通讯录程序吧</span><br><br><br>address_book = &#123;<span class="hljs-string">&#x27;小甲鱼&#x27;</span>: <span class="hljs-string">&#x27;020-88974563&#x27;</span>, <span class="hljs-string">&#x27;Felix&#x27;</span>: <span class="hljs-string">&#x27;025-52680000&#x27;</span>&#125;<br>welcome_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">|--- 欢迎进入通讯录程序---|</span><br><span class="hljs-string">|--- 1： 查询联系人资料---|</span><br><span class="hljs-string">|--- 2： 插入新的联系人---|</span><br><span class="hljs-string">|--- 3： 删除已有联系人---|</span><br><span class="hljs-string">|--- 4： 退出通讯录程序---|</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>bye_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">|--- 感谢使用通讯录程序---|</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_search</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        <span class="hljs-built_in">print</span>(address_book[name])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入的联系人不存在！&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_insert</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名在通讯录中已存在 ---&gt;&gt; %s : %s&#x27;</span> %(name, address_book[name]))<br>        edit_check = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否修改用户资料（YES/NO）&#x27;</span>)<br>        <span class="hljs-keyword">if</span> edit_check == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>            address_book[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        phone = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br>        address_book[name] = phone<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_delete</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        del_check = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否删除已有联系人: %s（YES/NO）&#x27;</span> % name)<br>        <span class="hljs-keyword">if</span> del_check == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>            <span class="hljs-keyword">del</span> address_book[name]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入的联系人不存在！&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">address</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(welcome_msg)<br>        code = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入相关的指令代码：&#x27;</span>))<br>        <span class="hljs-keyword">if</span> code == <span class="hljs-number">2</span>:<br>            ad_insert()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">1</span>:<br>            ad_search()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">3</span>:<br>            ad_delete()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">4</span>:<br>            <span class="hljs-built_in">print</span>(bye_msg)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入有误，请重新输入代码&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    address()<br><br></code></pre></td></tr></table></figure><p><strong>Version-2</strong>:  dict.pop() 删除字典键值, dict.setdefault() 修改字典：插入字典键值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 尝试利用字典的特性编写一个通讯录程序吧</span><br><br><br>address_book = &#123;<span class="hljs-string">&#x27;小甲鱼&#x27;</span>: <span class="hljs-string">&#x27;020-88974563&#x27;</span>, <span class="hljs-string">&#x27;Felix&#x27;</span>: <span class="hljs-string">&#x27;025-52680000&#x27;</span>&#125;<br>welcome_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">|--- 欢迎进入通讯录程序---|</span><br><span class="hljs-string">|--- 1： 查询联系人资料---|</span><br><span class="hljs-string">|--- 2： 插入新的联系人---|</span><br><span class="hljs-string">|--- 3： 删除已有联系人---|</span><br><span class="hljs-string">|--- 4： 退出通讯录程序---|</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>bye_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">|--- 感谢使用通讯录程序---|</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_search</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        <span class="hljs-built_in">print</span>(address_book[name])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入的联系人不存在！&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_insert</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名在通讯录中已存在 ---&gt;&gt; %s : %s&#x27;</span> %(name, address_book[name]))<br>        edit_check = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否修改用户资料（YES/NO）&#x27;</span>)<br>        <span class="hljs-keyword">if</span> edit_check == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>            address_book[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># phone = input(&#x27;请输入用户联系电话：&#x27;)</span><br>        <span class="hljs-comment"># address_book[name] = phone</span><br>        address_book.setdefault(name, <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad_delete</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> address_book.keys():<br>        del_check = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否删除已有联系人: %s（YES/NO）&#x27;</span> % name)<br>        <span class="hljs-keyword">if</span> del_check == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>            address_book.pop(name)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入的联系人不存在！&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">address</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(welcome_msg)<br>        code = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入相关的指令代码：&#x27;</span>))<br>        <span class="hljs-keyword">if</span> code == <span class="hljs-number">2</span>:<br>            ad_insert()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">1</span>:<br>            ad_search()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">3</span>:<br>            ad_delete()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-number">4</span>:<br>            <span class="hljs-built_in">print</span>(bye_msg)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入有误，请重新输入代码&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    address()<br></code></pre></td></tr></table></figure><h1 id="026-字典：当索引不好用时2"><a href="#026-字典：当索引不好用时2" class="headerlink" title="026. 字典：当索引不好用时2"></a>026. 字典：当索引不好用时2</h1><h2 id="知识点-21"><a href="#知识点-21" class="headerlink" title="知识点"></a>知识点</h2><h3 id="字典的常用内建方法"><a href="#字典的常用内建方法" class="headerlink" title="字典的常用内建方法"></a>字典的常用内建方法</h3><ul><li><p>创建字典：fromkeys(): </p><blockquote><p><strong>fromkeys</strong>(iterable, value&#x3D;None, &#x2F;) method of builtins.type instance;  Create a new dictionary with keys from iterable and values set to value.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>dict1 = &#123;&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>dict1.fromkeys((<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))<br>&#123;<span class="hljs-number">1</span>: <span class="hljs-literal">None</span>, <span class="hljs-number">2</span>: <span class="hljs-literal">None</span>, <span class="hljs-number">3</span>: <span class="hljs-literal">None</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>dict1.fromkeys((<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-string">&#x27;number&#x27;</span>)<br>&#123;<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;number&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><p>注意这个内置函数不能修改已有的字典，它每次都会生成一个新的字典；比如尝试修改1和3 的键值，但是只会生成一个新的字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>dict1.fromkeys((<span class="hljs-number">1</span>, <span class="hljs-number">3</span>), <span class="hljs-string">&#x27;数字&#x27;</span>)<br>&#123;<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;数字&#x27;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;数字&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></li><li><p>访问字典：keys(), values(), items()</p></li><li><p>查找字典：判断键的成员资格：get(),  in&#x2F;not in 判断</p><ul><li><p>get() : </p><blockquote><p><strong>get</strong>(self, key, default&#x3D;None, &#x2F;)  Return the value for key if key is in the dictionary, else default.</p></blockquote></li></ul></li><li><p>清空字典：clear(),  或者del dict(key&#x3D;)不推荐直接赋值空字典{} 的方式来清空，因为有数据泄漏风险</p></li><li><p>浅拷贝字典：copy(), 拷贝意味着生成一个新字典，与赋值是不同的。</p></li><li><p>删除&#x2F;弹出对应的键值：pop()</p></li><li><p>删除&#x2F;弹出字典键值 - 默认最后一个：popitem()</p></li><li><p>修改字典：追加：setdefault() ：和get() 类似，但是setdefault 找不到对应的值的时候，会自动添加，随机添加到某个位置，因为字典不存在顺序</p></li><li><p>修改字典：用字典去更新另外一个字典：update(), 类似于列表的extend()</p></li></ul><h2 id="课后作业-19"><a href="#课后作业-19" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-19"><a href="#Quiz-19" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>Python的字典是否支持一键（Key）多值（Value）？</p><p>不支持，除非这个值是元祖和列表括起来的</p></li><li><p>在字典中，如果试图为一个不存在的键（Key）赋值会怎样？</p><p>会创建这个key and value</p></li><li><p>成员资格操作符（in和not in）可以检查一个元素是否存在序列中，当然也可以用来检查一个键（Key）是否存在字典中，那么请问哪种的检查效率更高些？为什么？</p><p>字典效率更高，因为是直接查找到相应的Key； 而序列是从第一个元素开始遍历</p></li><li><p>Python对键（Key）和值（Value）有没有类型限制？</p><p>没有</p></li><li><p>请目测下边代码执行后，字典dict1的内容是什么？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">dict1.fromkeys((<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>))</span><br> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">dict1.fromkeys((<span class="hljs-number">1</span>, <span class="hljs-number">3</span>), <span class="hljs-string">&#x27;数字&#x27;</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">（<span class="hljs-number">1</span>:(&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;)， <span class="hljs-number">2</span>:(&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;)， <span class="hljs-number">3</span>:(&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;) ）<br>(<span class="hljs-number">1</span>:&#x27;数字&#x27;, <span class="hljs-number">3</span>:&#x27;数字&#x27; )<br></code></pre></td></tr></table></figure></li><li><p>如果你需要将字典dict1 &#x3D; {1: ‘one’, 2: ‘two’, 3: ‘three’}拷贝到dict2，你应该怎么做？</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">dict2</span> <span class="hljs-operator">=</span> dict1.copy()<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-16"><a href="#Practice-16" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>尝试编写一个用户登录程序（这次尝试将功能封装成函数），程序实现如图</p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDAzLzI0LzE5MDIwMjdrZDcyNTZoNnh5Nzc1ZGQucG5n?x-oss-process=image/format,png" alt="img" style="zoom:100%;" /></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 尝试编写一个用户登录程序（这次尝试将功能封装成函数），程序实现如图</span><br><br>log_user = &#123;&#125;<br><br>welcome_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">|---新建用户：N/n---|</span><br><span class="hljs-string">|---登陆账号：E/e---|</span><br><span class="hljs-string">|---退出程序：Q/q---|</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>register_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">注册成功，赶紧试试登陆吧！</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>logon_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">欢迎进入xxoo系统，请点击右上方的x结束程序！</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>quit_msg = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">已成功退出系统！</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logon</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户名：&#x27;</span>)<br>    <span class="hljs-keyword">while</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> log_user.keys():<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;您输入的用户名不存在，请重新输入：&#x27;</span>)<br>    passwd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入密码：&#x27;</span>)<br>    count = <span class="hljs-number">3</span><br>    <span class="hljs-keyword">while</span> log_user[name] != passwd:<br>        count -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">0</span>:<br>            passwd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;密码错误，请重新输入&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;密码输入错误3次，退出程序&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-built_in">print</span>(logon_msg)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>():<br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户名：&#x27;</span>)<br>    <span class="hljs-keyword">while</span> name <span class="hljs-keyword">in</span> log_user.keys():<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;此用户已经被使用，请重新输入：&#x27;</span>)<br>    log_user.setdefault(name, <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入密码：&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(register_msg)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logon_main</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(welcome_msg, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        code = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;|---请输入指令代码：&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> code == <span class="hljs-string">&#x27;N&#x27;</span> <span class="hljs-keyword">or</span> code == <span class="hljs-string">&#x27;n&#x27;</span>:<br>            create()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-string">&#x27;E&#x27;</span> <span class="hljs-keyword">or</span> code == <span class="hljs-string">&#x27;e&#x27;</span>:<br>            logon()<br>        <span class="hljs-keyword">elif</span> code == <span class="hljs-string">&#x27;Q&#x27;</span> <span class="hljs-keyword">or</span> code == <span class="hljs-string">&#x27;q&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(quit_msg)<br>            <span class="hljs-keyword">break</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    logon_main()<br><br><br></code></pre></td></tr></table></figure><h1 id="027-集合：在我的世界里，你就是唯一"><a href="#027-集合：在我的世界里，你就是唯一" class="headerlink" title="027. 集合：在我的世界里，你就是唯一"></a>027. 集合：在我的世界里，你就是唯一</h1><h2 id="知识点-22"><a href="#知识点-22" class="headerlink" title="知识点"></a>知识点</h2><h3 id="集合的概念"><a href="#集合的概念" class="headerlink" title="集合的概念"></a>集合的概念</h3><ul><li><p>集合是字典的“表亲”,  type &#x3D; set, 用花括号括起一堆没有映射关系的元素</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num = &#123;&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(num)</span><br>&lt;class &#x27;dict&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num2 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(num2)</span><br>&lt;class &#x27;set&#x27;&gt;<br></code></pre></td></tr></table></figure></li><li><p>集合的元素是唯一，会自动过滤掉重复的元素</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num2 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num2</span><br>&#123;1, 2, 3, 4, 5&#125;<br></code></pre></td></tr></table></figure></li><li><p>集合的元素是无序的，无法通过索引操作元素</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">&gt;&gt;&gt; num2[<span class="hljs-number">2</span>]<br>Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">1</span>, in <span class="hljs-symbol">&lt;module&gt;</span><br>TypeError: <span class="hljs-string">&#x27;set&#x27;</span> object <span class="hljs-keyword">is</span> not subscriptable<br></code></pre></td></tr></table></figure></li><li><p>创建集合</p><ul><li><p>直接把一堆元素用花括号括起来</p></li><li><p>使用set() 工厂函数,  可以传入序列参数</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">set1 = <span class="hljs-built_in">set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>])</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">set1</span><br>&#123;1, 2, 3, 4, 5&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>一个例子</p><p>要求：去掉列表中重复的元素  [0, 1, 2, 3, 4, 5, 5, 3, 1]</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1 = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(list1))</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2</span><br>[0, 1, 2, 3, 4, 5]<br></code></pre></td></tr></table></figure><p>注意：set 函数得到的集合是无序的！！！</p></li></ul><h3 id="集合的常用内建方法"><a href="#集合的常用内建方法" class="headerlink" title="集合的常用内建方法"></a>集合的常用内建方法</h3><ul><li>add()</li><li>remove()</li></ul><h3 id="Frozenset"><a href="#Frozenset" class="headerlink" title="Frozenset"></a>Frozenset</h3><ul><li><p>不可变集合： 通过frozenset()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>num3 = <span class="hljs-built_in">frozenset</span>([<span class="hljs-number">1</span>, <span class="hljs-number">23</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span>num3<br><span class="hljs-built_in">frozenset</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">23</span>&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>num3.add(<span class="hljs-number">0</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;frozenset&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;add&#x27;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-20"><a href="#课后作业-20" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-20"><a href="#Quiz-20" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请问集合的唯一作用是什么呢？</p><p>确保集合中的元素具有唯一性</p></li><li><p>如果你希望创建的集合是不变的，应该怎么做？</p><p>frozenset()</p></li><li><p>请问如何确定一个集合里边有多少个元素？</p><p>len() 函数</p></li><li><p>请目测一下代码会打印什么内容？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num_set = <span class="hljs-built_in">set</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>])</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">num_set[<span class="hljs-number">0</span>]</span><br></code></pre></td></tr></table></figure><p>报错，集合是无序的，没有索引</p></li><li><p>请问set1 &#x3D; {[1,2]}和set1 &#x3D; set([1,2])执行的结果一样吗？</p><p>不一样，第一个会报错，第二个会生成一个集合</p></li><li><p>打开你的IDLE，输入set1 &#x3D;{1,1.0},你发现了什么？</p><p>过滤掉相同的元素，得到{1}</p></li><li><p>请问如何给集合添加和删除元素？</p><p>add(), remove()</p></li></ol><h3 id="Practice-17"><a href="#Practice-17" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>自学扩展：自己花点时间看下这个表格</p><p><img src="https://www.pianshen.com/images/918/769b9a085dba5f8b204a3f5abb4b2976.png" alt="image.png"></p></li></ol><h1 id="028-文件：因为懂你，所以永恒"><a href="#028-文件：因为懂你，所以永恒" class="headerlink" title="028. 文件：因为懂你，所以永恒"></a>028. 文件：因为懂你，所以永恒</h1><h2 id="知识点-23"><a href="#知识点-23" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>文件的处理流程： 输入，处理， 输出</p></li><li><p>什么是文件：.exe, .txt, .ppt, .jpg, .mp4, .avi</p></li><li><p>打开文件：</p><table><thead><tr><th>打开模式</th><th>执行操作</th></tr></thead><tbody><tr><td>‘r’</td><td>以只读方式打开文件（默认）</td></tr><tr><td>‘w’</td><td>以写入的方式打开文件，会覆盖已存在的文件</td></tr><tr><td>‘x’</td><td>如果文件已存在，使用此模式打开将引发异常</td></tr><tr><td>‘a’</td><td>以写入模式打开，如果文件存在，则在末尾追加写入</td></tr><tr><td>‘b’</td><td>以二进制模式打开文件</td></tr><tr><td>‘t’</td><td>以文本模式打开（默认）</td></tr><tr><td>‘+’</td><td>可读写模式（可添加到其他模式中使用）</td></tr><tr><td>‘U’</td><td>通用换行符支持</td></tr></tbody></table></li><li><p>文件对象方法：</p><table><thead><tr><th>文件对象方法</th><th>执行操作</th></tr></thead><tbody><tr><td>f.close()</td><td>关闭文件</td></tr><tr><td>f.read([size&#x3D;-1])</td><td>从文件读取size个字符，当未给定size或给定负值的时候，读取剩余的所有字符，然后作为字符串返回</td></tr><tr><td>f.readline([size&#x3D;-1])</td><td>从文件中读取并返回一行（包括行结束符），返回字符串，如果有size有定义则返回size个字符</td></tr><tr><td>f.write(str)</td><td>将字符串str写入文件</td></tr><tr><td>f.writelines(seq)</td><td>向文件写入字符串序列seq，seq应该是一个返回字符串的可迭代对象</td></tr><tr><td>f.seek(offset, from)</td><td>在文件中移动文件指针，从from（0代表文件起始位置，1代表当前位置，2代表文件末尾）偏移offset个字节</td></tr><tr><td>f.tell()</td><td>返回当前在文件中的位置</td></tr><tr><td>f.truncate([size&#x3D;file.tell()])</td><td>截取文件到size个字节，默认是截取到文件指针当前位置</td></tr><tr><td>f.readlines()</td><td>readlines()方法读取整个文件所有行，保存在一个列表(list)变量中，每行作为一个元素，但读取大文件会比较占内存。</td></tr></tbody></table><ul><li><p>f.read() 读一次，文件指针移动（类似于书签）一次；如果未指定size，会读取所有字符，指针移动到文件末尾；再次运行f.read()，就什么都读不出来了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;record.txt&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>f.read()<br><span class="hljs-string">&#x27;小客服:小甲鱼?,今天有?客户问你有没有女朋友?\n小甲鱼:咦???\n小客服:我跟她说你有女朋友了!\n小甲鱼:。。。。。\n小客服:&quot;她让你分手后考虑下她!然后我说您要买个优盘，我就帮您留意~\n小甲鱼:下次有人想调戏你我不阻止~\n小客服:滚!!!\n==========================================================\n小客服:小甲鱼,有个好评很好笑哈。\n小甲鱼:哦?\n小客服:&quot;有了小甲小客服:嗯嗯,我看了你的微博丫~小甲鱼哟西~\n小客服:那个有条回复&quot;左手拿著小甲魚,右手拿著打火機,哪裡不會點哪裡,?soeasy^...^&quot;\n小甲鱼:T_T\n======================================鱼?,今天一?一个会员想找你\n小甲鱼:哦?什么事?\n小客服:他说你一个学生月薪已经超过12k了!?!\n小甲鱼:哪里的?\n小客服:上海的\n小甲鱼:那正常,哪家公司?\n小客服:他没说呀。\n小甲鱼:哦:滚!!!\n&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>f.read()<br><span class="hljs-string">&#x27;&#x27;</span><br><br></code></pre></td></tr></table></figure></li><li><p>f.tell() 可以查看当前文件指针位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;record.txt&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>f.read(<span class="hljs-number">5</span>)<br><span class="hljs-string">&#x27;小客服:小&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>f.tell()<br><span class="hljs-number">13</span><br><br></code></pre></td></tr></table></figure><p>注意： 由于我实验里面的record.txt 是utf-8 编码，所以一个中文字符是3个字节；如果是gbk编码的话，一个中文字符是2个字节</p></li><li><p>f.seek(offset, from) 可以用来修改文件指针位置; f.readline() 打印一行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>f.seek(<span class="hljs-number">46</span>,<span class="hljs-number">0</span>)<br><span class="hljs-number">46</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>f.readline()<br><span class="hljs-string">&#x27;没有女朋友?\n&#x27;</span><br><br></code></pre></td></tr></table></figure></li><li><p>可以直接迭代文件对象，来打印出文件的每一行</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;record.txt&#x27;</span>)<br><span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>    <span class="hljs-built_in">print</span>(each_line, <span class="hljs-keyword">end</span>=<span class="hljs-string">&#x27;&#x27;</span>)<br>f.<span class="hljs-built_in">close</span>()<br></code></pre></td></tr></table></figure></li><li><p>f.write(str), f.writelines(seq, 比如list对象), 写入的类型都是字符串类型</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f.write(<span class="hljs-string">&#x27;I love fishc&#x27;</span>)</span><br>12<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f.close()</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1 = [<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;live&#x27;</span>, <span class="hljs-string">&#x27;fishc&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1</span><br>[&#x27;I&#x27;, &#x27;live&#x27;, &#x27;fishc&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f.writelines(list1)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">f.close()</span><br><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-21"><a href="#课后作业-21" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-21"><a href="#Quiz-21" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>下边只有一种方式不能打开文件，请问是哪一种，为什么？</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">f</span> = open(<span class="hljs-string">&#x27;E:/test.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)  <span class="hljs-comment">#A</span><br><span class="hljs-attr">f</span> = open(<span class="hljs-string">&#x27;E:\test.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)  <span class="hljs-comment">#B</span><br><span class="hljs-attr">f</span> = open(<span class="hljs-string">&#x27;E://test.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-comment">#C</span><br><span class="hljs-attr">f</span> = open(<span class="hljs-string">&#x27;E:\\test.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-comment">#D</span><br></code></pre></td></tr></table></figure></li></ol><p>​<em><strong>B，没有对反斜杠进行转义</strong></em>， Windows在路径名中既可以接受斜线（&#x2F;）也可以接受反斜线（\），不过如果使用反斜线作为路径名的<a href="https://so.csdn.net/so/search?q=%E5%88%86%E9%9A%94%E7%AC%A6&spm=1001.2101.3001.7020">分隔符</a>的话，要注意使用双反斜线（\）进行转义，否则Python会将反斜线进行转义，例如（\n）看成一个换行符，（\t）看作一个制表符等</p><ol start="2"><li><p>打开一个文件我们使用open()函数，通过设置文件的打开模式，决定打开的文件具有哪些性质，请问默认的打开模式是什么呢？</p><p>‘rt’，即可读，文本的模式打开</p></li><li><p>请问&gt;&gt;&gt;open(‘E:\Test.bin’,‘xb’)是以什么样的模式打开文件的？</p><p>以“可写入以及二进制模式”打开文件“E:\Test.bin”。<br>这里要注意的是’x’和’w’均是以“可写入”的模式打开文件，但以’x’模式打开的时候，如果路径下已经存在相同的文件名，会抛出异常，而’w’模式的话会直接覆盖同名文件。<br>因此，’w’模式打开文件会比较危险，容易导致此前的内容遗失，因此使用’w’模式打开文件前先检查该文件名是否已经存在显得非常重要！</p></li><li><p>尽管python有所谓的“垃圾回收机制”，但对于打开了的文件，在不需要用到的时候我们仍然需要使用f.close()将文件对象“关闭”，这是为什么呢？</p><p>Python拥有垃圾收集机制，会在文件对象的引用计数降至零的时候自动关闭文件，所以在Python编程里，如果忘记关闭文件并不会造成内存泄漏那么危险。<br>但并不是说就可以不要关闭文件，如果你对文件进行了写入操作，那么你应该在完成写入之后进行关闭文件。因为Python可能会缓存你写入的数据，如果这中间断电了神马的，那些缓存的数据根本就不会写入到文件中。所以，为了安全起见，要养成使用完文件后立刻关闭的优雅习惯。</p></li><li><p>如何将一个文件对象(f)中的数据存放进列表中？</p><p>list(f)</p></li><li><p>如何迭代打印出文件对象(f)中的每一行数据？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>  <span class="hljs-built_in">print</span>(each_line)<br></code></pre></td></tr></table></figure></li><li><p>文件对象的内置方法f.read([size&#x3D;-1])作用是读取文件对象内容，size参数是可选的，那如果设置了size&#x3D;10，例如f.read(10),将返回什么内容呢？</p><p>读取文件指针当前位置往后读10个字符</p></li><li><p>如何获得文件对象(f)当前文件指针的位置？</p><p><code>f.tell()</code></p></li><li><p>还是视频中的那个演示文件(record.txt),请问为何f.seek(45,0)不会出错，但f.seek(46)就出错了呢？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; f.seek(46)</span><br>46<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; f.readline()</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">Traceback (most recent call last):</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">File <span class="hljs-string">&quot;&lt;pyshell#18&gt;&quot;</span>, line 1, <span class="hljs-keyword">in</span> &lt;module&gt;</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">f.readline()</span><br><br></code></pre></td></tr></table></figure><p>因为使用f.seek()定位的文件指针是按字节为单位进行计算的，演示文件（record.txt）是以GBK进行编码的，按照规则，一个汉字需要占用两个字节，f.seek(45)的位置位于字符“小”的开始位置，因此可以正常打印，而f.seek(46)的位置刚好位于字符“小”的中间位置，因此按照GBK编码的形式无法将其解码</p></li></ol><h3 id="Practice-18"><a href="#Practice-18" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>尝试将某个文件(OpenMe.mp3)打印到屏幕上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;OpenMe.mp3&#x27;</span>)<br><span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>    <span class="hljs-built_in">print</span>(each_line, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>f.close()<br></code></pre></td></tr></table></figure></li><li><p>编写代码，将上一题中的文件（OpenMe.mp3）保存为新文件（OpenMe.txt）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;OpenMe.mp3&#x27;</span>)<br>f2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;OpenMe.txt&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>) <span class="hljs-comment"># 使用&#x27;x&#x27;打开更安全，避免使用‘w’打开覆盖已有的文件</span><br><br>f2.write(f1.read())<br><br>f1.close()<br>f2.close()<br></code></pre></td></tr></table></figure></li></ol><h1 id="029-文件：一个任务"><a href="#029-文件：一个任务" class="headerlink" title="029. 文件：一个任务"></a>029. 文件：一个任务</h1><h2 id="知识点-24"><a href="#知识点-24" class="headerlink" title="知识点"></a>知识点</h2><blockquote><p>任务：将文件(record.txt)中的数据进行分割，并按照以下规则保存起来。<br> 1.小甲鱼的对话单独保存为boy_*.txt的文件(去掉”小甲鱼:”)<br> 2.小客服的对话单独保存为girl_*.txt的文件(去掉”小客服:”)<br> 3.文件中总共有三段对话，分别保存为boy_1.txt、boy_2.txt、boy_3.txt、gilr_1.txt、gilr_2.txt、gilr_3.txt<br>   共6个文件。(提示：不同的对话已经使用”&#x3D;&#x3D;&#x3D;&#x3D;”进行分割)</p></blockquote><p>我的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 任务：将文件(record.txt)中的数据进行分割，并按照以下规则保存起来。</span><br><span class="hljs-comment">#  1.小甲鱼的对话单独保存为boy_*.txt的文件(去掉&quot;小甲鱼:&quot;)</span><br><span class="hljs-comment">#  2.小客服的对话单独保存为girl_*.txt的文件(去掉&quot;小客服:&quot;)</span><br><span class="hljs-comment">#  3.文件中总共有三段对话，分别保存为boy_1.txt、boy_2.txt、boy_3.txt、gilr_1.txt、gilr_2.txt、gilr_3.txt</span><br><span class="hljs-comment">#    共6个文件。(提示：不同的对话已经使用&quot;====&quot;进行分割)</span><br><br><br>f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../28/record.txt&#x27;</span>, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>count = <span class="hljs-number">1</span><br><br>boy_list = []<br>girl_list = []<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_file</span>(<span class="hljs-params">file_name, file_list</span>):<br>    f_file_name = <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;x&#x27;</span>)<br>    f_file_name.writelines(file_list)<br>    f_file_name.close()<br><br><br><span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f1:<br>    temp_list = each_line.split(<span class="hljs-string">&#x27;:&#x27;</span>)<br>    <span class="hljs-keyword">if</span> temp_list[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;小甲鱼&#x27;</span>:<br>        boy_list.append(temp_list[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">elif</span> temp_list[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;小客服&#x27;</span>:<br>        girl_list.append(temp_list[<span class="hljs-number">1</span>])<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;====&quot;</span> <span class="hljs-keyword">in</span> each_line:<br>        file_name_boy = <span class="hljs-string">&#x27;boy_&#x27;</span> + <span class="hljs-built_in">str</span>(count) + <span class="hljs-string">&#x27;.txt&#x27;</span><br>        file_name_girl = <span class="hljs-string">&#x27;girl_&#x27;</span> + <span class="hljs-built_in">str</span>(count) + <span class="hljs-string">&#x27;.txt&#x27;</span><br><br>        generate_file(file_name_boy, boy_list)<br>        generate_file(file_name_girl, girl_list)<br><br>        boy_list = []<br>        girl_list = []<br>        count += <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 循环结束，写入最后一段内容</span><br>file_name_boy = <span class="hljs-string">&#x27;boy_&#x27;</span> + <span class="hljs-built_in">str</span>(count) + <span class="hljs-string">&#x27;.txt&#x27;</span><br>file_name_girl = <span class="hljs-string">&#x27;girl_&#x27;</span> + <span class="hljs-built_in">str</span>(count) + <span class="hljs-string">&#x27;.txt&#x27;</span><br><br>generate_file(file_name_boy, boy_list)<br>generate_file(file_name_girl, girl_list)<br><br><br><span class="hljs-comment"># 关闭原始文件</span><br>f1.close()<br></code></pre></td></tr></table></figure><h2 id="课后作业-22"><a href="#课后作业-22" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-22"><a href="#Quiz-22" class="headerlink" title="Quiz"></a>Quiz</h3><h3 id="Practice-19"><a href="#Practice-19" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个程序，接受用户的输入并保存为新的文件，程序实现如图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDA0LzAyLzIxNDAwMmw4bXd3Y2I1MmY5ZjVxOWYucG5n?x-oss-process=image/format,png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，接受用户的输入并保存为新的文件，程序实现如图</span><br><br><br>name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入文件名：&#x27;</span>)<br><span class="hljs-comment"># lines = []</span><br>f = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;x&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请输入内容【单独输入\&#x27;:w\&#x27; 保存退出】:&#x27;</span>)<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-comment"># 其实是循环等待每行输入，但是让input的输入提示符为空，效果是看起来一直没有打断的输入</span><br>    content = <span class="hljs-built_in">input</span>()<br>    <span class="hljs-keyword">if</span> content != <span class="hljs-string">&#x27;:w&#x27;</span>:<br>        content += <span class="hljs-string">&#x27;\n&#x27;</span><br>        f.write(content)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br>        f.close()<br></code></pre></td></tr></table></figure><p>另一种实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，接受用户的输入并保存为新的文件，程序实现如图</span><br><br>name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入文件名：&#x27;</span>)<br>f = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;x&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请输入内容【单独输入\&#x27;:w\&#x27; 保存退出】:&#x27;</span>)<br><br><span class="hljs-comment"># 用内置函数iter实现等待输入， 让input()遇到回车键也能持续输入</span><br>txt = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">iter</span>(<span class="hljs-built_in">input</span>, <span class="hljs-string">&#x27;:w&#x27;</span>):<br>    txt += line + <span class="hljs-string">&#x27;\n&#x27;</span><br><br><br>f.write(txt)<br>f.close()<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，比较用户输入的两个文件，如果不同，显示出所有不同处的行号与第一个不同字符的位置，程序实现如图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDA0LzA2LzIyMjYxNWlrM2J5cnB4NmpyampiNGIucG5n?x-oss-process=image/format,png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，比较用户输入的两个文件，如果不同，显示出所有不同处的行号与第一个不同字符的位置，程序实现如图：</span><br><br>name1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的头一个文件名：&#x27;</span>)<br>name2 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的另一个文件名：&#x27;</span>)<br><br>name1_f = <span class="hljs-built_in">open</span>(name1, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>name2_f = <span class="hljs-built_in">open</span>(name2, <span class="hljs-string">&#x27;rt&#x27;</span>)<br><br>name1_list = name1_f.readlines()<br>name2_list = name2_f.readlines()<br><br>name1_f.close()<br>name2_f.close()<br><br><br>diff_count = []<br>name1_len = <span class="hljs-built_in">len</span>(name1_list)<br>name2_len = <span class="hljs-built_in">len</span>(name2_list)<br><br><br><span class="hljs-keyword">if</span> name1_len &gt;= name2_len:<br>    file_min_len = name2_len<br><span class="hljs-keyword">else</span>:<br>    file_min_len = name1_len<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(file_min_len):<br>    <span class="hljs-keyword">if</span> name1_list[i] != name2_list[i]:<br>        diff_count.append(i)<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件共有【 %d 】处不同：&#x27;</span> % <span class="hljs-built_in">len</span>(diff_count))<br><br><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> diff_count:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第 %d 行不一样&#x27;</span> % each)<br></code></pre></td></tr></table></figure><p>另一种写法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">cp_file</span>(<span class="hljs-params">fname1, fname2</span>):<br>    name1_f = <span class="hljs-built_in">open</span>(fname1, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>    name2_f = <span class="hljs-built_in">open</span>(fname2, <span class="hljs-string">&#x27;rt&#x27;</span>)<br><br>    diff_row = []<br>    count = <span class="hljs-number">0</span><br>    row_number = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> name1_f:<br>        <span class="hljs-keyword">if</span> each_line != name2_f.readline():<br>            count += <span class="hljs-number">1</span><br>            diff_row.append(row_number)<br>        row_number += <span class="hljs-number">1</span><br>    name2_f.close()<br>    name2_f.close()<br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件相同&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件共有【 %d 】处不同：&#x27;</span> % count)<br>        <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> diff_row:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第 %d 行不一样&#x27;</span> % each)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cp_main</span>():<br>    name1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的头一个文件名：&#x27;</span>)<br>    name2 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的另一个文件名：&#x27;</span>)<br><br>    cp_file(name1, name2)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    cp_main()<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，当用户输入文件名和行数（N）后，将该文件的前N行内容打印到屏幕上，程序实现如图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDA0LzAyLzIxNTEzM3FzMml0dHRnMTFidnQwMTAucG5n?x-oss-process=image/format,png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，当用户输入文件名和行数（N）后，将该文件的前N行内容打印到屏幕上，程序实现如图：</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_file</span>(<span class="hljs-params">name, rows</span>):<br>    f_open = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(rows)):<br>        <span class="hljs-built_in">print</span>(f_open.readline(), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    f_open.close()<br><br><br>f_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入要打开的文件：&#x27;</span>)<br>f_rows = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要显示该文件前几行：&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件 %s 的前 %s 的内容如下：&#x27;</span> % (f_name, f_rows))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    show_file(f_name, f_rows)<br></code></pre></td></tr></table></figure></li><li><p>呃，不得不说我们的用户变得越来越刁钻了。要求在上一题的基础上扩展，用户可以随意输入需要显示的行数。（如输入13:21打印第13行到第21行，输入:21打印前21行，输入21:则打印从第21行开始到文件结尾所有内容）</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDA0LzAyLzIxNTMzMXhmMTg2amYzd21qcjVyeHoucG5n?x-oss-process=image/format,png" alt="img"></p></li></ol><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 呃，不得不说我们的用户变得越来越刁钻了。</span><br><span class="hljs-comment"># 要求在上一题的基础上扩展，用户可以随意输入需要显示的行数。</span><br><span class="hljs-comment"># （如输入13:21打印第13行到第21行，输入:21打印前21行，输入21:则打印从第21行开始到文件结尾所有内容）</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_file</span>(<span class="hljs-params">name, rows</span>):<br>    f_open = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>    f_lines = f_open.readlines()<br><br>    start_s, end_s = rows.split(<span class="hljs-string">&#x27;:&#x27;</span>)<br>    <span class="hljs-keyword">if</span> start_s == <span class="hljs-string">&#x27;&#x27;</span>:<br>        row_start = <span class="hljs-number">0</span><br>        row_start_msg = <span class="hljs-string">&#x27;开始&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        row_start = <span class="hljs-built_in">int</span>(start_s)-<span class="hljs-number">1</span><br>        row_start_msg = <span class="hljs-string">&#x27;第&#x27;</span> + start_s + <span class="hljs-string">&#x27;行&#x27;</span><br>    <span class="hljs-keyword">if</span> end_s == <span class="hljs-string">&#x27;&#x27;</span>:<br>        row_end = <span class="hljs-built_in">len</span>(f_lines)<br>        row_end_msg = <span class="hljs-string">&#x27;末尾&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        row_end = <span class="hljs-built_in">int</span>(end_s)<br>        row_end_msg = <span class="hljs-string">&#x27;第&#x27;</span> + end_s + <span class="hljs-string">&#x27;行&#x27;</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件 %s 从 %s 到 %s 行的内容如下：&#x27;</span> % (f_name, row_start_msg, row_end_msg))<br>    <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(row_start, row_end):<br>        <span class="hljs-built_in">print</span>(f_lines[each_line], end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    f_open.close()<br><br><br>f_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入要打开的文件：&#x27;</span>)<br>f_rows = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要显示的行数【格式如 13：21 或 ：21 或 21：】：&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    show_file(f_name, f_rows)<br></code></pre></td></tr></table></figure><ol start="5"><li><p>编写一个程序，实现“全部替换”功能，程序实现如图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly94eHguaWxvdmVmaXNoYy5jb20vZm9ydW0vMjAxNDA0LzAyLzIxNTM1NHZzNms4Nmw4bGZnMGw5cXEucG5n?x-oss-process=image/format,png" alt="img"></p><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，实现“全部替换”功能，程序实现如图：</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">file_replace</span>(<span class="hljs-params">name, o_str, n_str</span>):<br>    f_read = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;rt&#x27;</span>)<br>    f_content = f_read.read()<br>    f_read.close()<br>    count = f_content.count(o_str)<br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;没有找到需要替换的字符&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件 %s 中共有 %d 个 【%s】&#x27;</span> %(name, count, o_str))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;你确定要把所有【%s】的替换为【%s】吗&#x27;</span> %(o_str, n_str))<br>        answer = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;[YES/NO]:&#x27;</span>)<br>        <span class="hljs-keyword">if</span> answer == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>            f_content = f_content.replace(o_str, n_str)<br>            f_write = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;w&#x27;</span>)<br>            f_write.write(f_content)<br>            f_write.close()<br><br><br>f_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入文件名：&#x27;</span>)<br>old_str = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要替换的单词或字符：&#x27;</span>)<br>new_str = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入新的单词或字符：&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    file_replace(f_name, old_str, new_str)<br></code></pre></td></tr></table></figure></li></ol><h1 id="030-文件系统：介绍一个高大上的东西"><a href="#030-文件系统：介绍一个高大上的东西" class="headerlink" title="030. 文件系统：介绍一个高大上的东西"></a>030. 文件系统：介绍一个高大上的东西</h1><h2 id="知识点-25"><a href="#知识点-25" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>模块：它是包含所有你定义的函数和变量的文件，后缀是py；模块可以被别的程序引入，以使用该模块的函数等功能</p><p>使用模块之前，需要先导入模块：import <em>module</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: name <span class="hljs-string">&#x27;random&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> random<br><span class="hljs-meta">&gt;&gt;&gt; </span>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>secret<br><span class="hljs-number">4</span><br></code></pre></td></tr></table></figure></li><li><p>OS 模块：</p><blockquote><p>我们所知道常用的操作系统有：windows，Mac OS， Linux， Unix等等，这些操作系统底层对于文件系统的访问工作原理是不一样的，因此你可能要针对不同的系统来考虑使用哪些文件系统模块。这样的做法是非常不友好且麻烦的，因为这样就意味着当你的程序运行环境一旦改变，你就要相应的去修改大量的代码来应付</p></blockquote><blockquote><p>有了OS 模块，我们不需要关心什么操作系统下使用什么模块，OS模块会帮你选择正确的模块并调用</p></blockquote><ul><li><strong>os模块中关于文件&#x2F;目录常用的函数使用方法</strong></li></ul><table><thead><tr><th><strong>函数名</strong></th><th><strong>使用方法</strong></th></tr></thead><tbody><tr><td>getcwd()</td><td>返回当前工作目录</td></tr><tr><td>chdir(path)</td><td>改变工作目录</td></tr><tr><td>listdir(path&#x3D;’.’)</td><td>列举指定目录中的文件名（’.’表示当前目录，’..’表示上一级目录）</td></tr><tr><td>mkdir(path)</td><td>创建单层目录，如该目录已存在抛出异常</td></tr><tr><td>makedirs(path)</td><td>递归创建多层目录，如该目录已存在抛出异常，注意：’E:\a\b’和’E:\a\c’并不会冲突</td></tr><tr><td>remove(path)</td><td>删除文件</td></tr><tr><td>rmdir(path)</td><td>删除单层目录，如该目录非空则抛出异常</td></tr><tr><td>removedirs(path)</td><td>递归删除目录，从子目录到父目录逐层尝试删除，遇到目录非空则抛出异常</td></tr><tr><td>rename(old, new)</td><td>将文件old重命名为new</td></tr><tr><td>system(command)</td><td>运行系统的shell命令</td></tr><tr><td>walk(top)</td><td>遍历top路径以下所有的子目录，返回一个三元组：(路径, [包含目录], [包含文件])【具体实现方案请看：第30讲课后作业^_^】</td></tr><tr><td><em>以下是支持路径操作中常用到的一些定义，支持所有平台</em></td><td></td></tr><tr><td>os.curdir</td><td>指代当前目录（’.’）</td></tr><tr><td>os.pardir</td><td>指代上一级目录（’..’）</td></tr><tr><td>os.sep</td><td>输出操作系统特定的路径分隔符（Win下为’\‘，Linux下为’&#x2F;‘）</td></tr><tr><td>os.linesep</td><td>当前平台使用的行终止符（Win下为’\r\n’，Linux下为’\n’）</td></tr><tr><td>os.name</td><td>指代当前使用的操作系统（包括：’posix’, ‘nt’, ‘mac’, ‘os2’, ‘ce’, ‘java’）</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> os<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.getcwd()<br><span class="hljs-string">&#x27;/Users/felix&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.chdir(<span class="hljs-string">&#x27;/Users/felix/PycharmProjects/learningpython/30&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir(<span class="hljs-string">&#x27;.&#x27;</span>)<br>[]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.mkdir(<span class="hljs-string">&#x27;A&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.mkdir(<span class="hljs-string">&#x27;B&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.mkdir(<span class="hljs-string">&#x27;./C/D&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>FileNotFoundError: [Errno <span class="hljs-number">2</span>] No such file <span class="hljs-keyword">or</span> directory: <span class="hljs-string">&#x27;./C/D&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir(<span class="hljs-string">&#x27;.&#x27;</span>)<br>[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.makedirs(<span class="hljs-string">&#x27;./C/D&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir()<br>[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.remove<br>os.remove(      os.removedirs(  <br><span class="hljs-meta">&gt;&gt;&gt; </span>os.removedirs(<span class="hljs-string">&#x27;C&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;/usr/local/Cellar/python@3.9/3.9.12_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/os.py&quot;</span>, line <span class="hljs-number">243</span>, <span class="hljs-keyword">in</span> removedirs<br>    rmdir(name)<br>OSError: [Errno <span class="hljs-number">66</span>] Directory <span class="hljs-keyword">not</span> empty: <span class="hljs-string">&#x27;C&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.removedirs(<span class="hljs-string">&#x27;./C/D&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir()<br>[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.rename(<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir()<br>[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.system(<span class="hljs-string">&#x27;ls -l&#x27;</span>)<br>total <span class="hljs-number">0</span><br>drwxr-xr-x  <span class="hljs-number">2</span> felix  staff  <span class="hljs-number">64</span> May <span class="hljs-number">24</span> 08:<span class="hljs-number">57</span> A<br>drwxr-xr-x  <span class="hljs-number">2</span> felix  staff  <span class="hljs-number">64</span> May <span class="hljs-number">24</span> 08:<span class="hljs-number">58</span> D<br><span class="hljs-number">0</span><br>  <br>  <br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir(os.curdir)<br>[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir(os.pardir)<br>[<span class="hljs-string">&#x27;03&#x27;</span>, <span class="hljs-string">&#x27;04&#x27;</span>, <span class="hljs-string">&#x27;05&#x27;</span>, <span class="hljs-string">&#x27;02&#x27;</span>, <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;29&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;28&#x27;</span>, <span class="hljs-string">&#x27;17&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>, <span class="hljs-string">&#x27;19&#x27;</span>, <span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-string">&#x27;test.py&#x27;</span>, <span class="hljs-string">&#x27;README.md&#x27;</span>, <span class="hljs-string">&#x27;09&#x27;</span>, <span class="hljs-string">&#x27;30&#x27;</span>, <span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-string">&#x27;06&#x27;</span>, <span class="hljs-string">&#x27;.git&#x27;</span>, <span class="hljs-string">&#x27;24&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;15&#x27;</span>, <span class="hljs-string">&#x27;14&#x27;</span>, <span class="hljs-string">&#x27;22&#x27;</span>, <span class="hljs-string">&#x27;.idea&#x27;</span>, <span class="hljs-string">&#x27;25&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir(os.pardir+ <span class="hljs-string">&#x27;/29&#x27;</span>)<br>[<span class="hljs-string">&#x27;05.py&#x27;</span>, <span class="hljs-string">&#x27;task.py&#x27;</span>, <span class="hljs-string">&#x27;example_2.py&#x27;</span>, <span class="hljs-string">&#x27;01_1.py&#x27;</span>, <span class="hljs-string">&#x27;04.py&#x27;</span>, <span class="hljs-string">&#x27;boy_1.txt&#x27;</span>, <span class="hljs-string">&#x27;boy_2.txt&#x27;</span>, <span class="hljs-string">&#x27;boy_3.txt&#x27;</span>, <span class="hljs-string">&#x27;03.py&#x27;</span>, <span class="hljs-string">&#x27;girl_1.txt&#x27;</span>, <span class="hljs-string">&#x27;02_1.py&#x27;</span>, <span class="hljs-string">&#x27;girl_2.txt&#x27;</span>, <span class="hljs-string">&#x27;p_02.py&#x27;</span>, <span class="hljs-string">&#x27;input_nonstop.py&#x27;</span>, <span class="hljs-string">&#x27;girl_3.txt&#x27;</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.name<br><span class="hljs-string">&#x27;posix&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>OS.PATH 模块</p><ul><li><strong>os.path模块中关于路径常用的函数使用方法</strong></li></ul><table><thead><tr><th><strong>函数名</strong></th><th><strong>使用方法</strong></th></tr></thead><tbody><tr><td>basename(path)</td><td>去掉目录路径，单独返回文件名</td></tr><tr><td>dirname(path)</td><td>去掉文件名，单独返回目录路径</td></tr><tr><td>join(path1[, path2[, …]])</td><td>将path1, path2各部分组合成一个路径名</td></tr><tr><td>split(path)</td><td>分割文件名与路径，返回(f_path, f_name)元组。如果完全使用目录，它也会将最后一个目录作为文件名分离，且不会判断文件或者目录是否存在</td></tr><tr><td>splitext(path)</td><td>分离文件名与扩展名，返回(f_name, f_extension)元组</td></tr><tr><td>getsize(file)</td><td>返回指定文件的尺寸，单位是字节</td></tr><tr><td>getatime(file)</td><td>返回指定文件最近的访问时间（浮点型秒数，可用time模块的gmtime()或localtime()函数换算）</td></tr><tr><td>getctime(file)</td><td>返回指定文件的创建时间（浮点型秒数，可用time模块的gmtime()或localtime()函数换算）</td></tr><tr><td>getmtime(file)</td><td>返回指定文件最新的修改时间（浮点型秒数，可用time模块的gmtime()或localtime()函数换算）</td></tr><tr><td><em>以下为函数返回 True 或 False</em></td><td></td></tr><tr><td>exists(path)</td><td>判断指定路径（目录或文件）是否存在</td></tr><tr><td>isabs(path)</td><td>判断指定路径是否为绝对路径</td></tr><tr><td>isdir(path)</td><td>判断指定路径是否存在且是一个目录</td></tr><tr><td>isfile(path)</td><td>判断指定路径是否存在且是一个文件</td></tr><tr><td>islink(path)</td><td>判断指定路径是否存在且是一个符号链接</td></tr><tr><td>ismount(path)</td><td>判断指定路径是否存在且是一个挂载点</td></tr><tr><td>samefile(path1, paht2)</td><td>判断path1和path2两个路径是否指向同一个文件</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> os.path<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.basename(os.curdir + <span class="hljs-string">&#x27;A/sexy.txt&#x27;</span>)<br><span class="hljs-string">&#x27;sexy.txt&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.dirname(os.curdir + <span class="hljs-string">&#x27;A/sexy.txt&#x27;</span>)<br><span class="hljs-string">&#x27;.A&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.join(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>)<br><span class="hljs-string">&#x27;A/B/C&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.join(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>)<br><span class="hljs-string">&#x27;./A/B/C&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.split(os.curdir + <span class="hljs-string">&#x27;A/sexy.txt&#x27;</span>)<br>(<span class="hljs-string">&#x27;.A&#x27;</span>, <span class="hljs-string">&#x27;sexy.txt&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.getsize(os.pardir+ <span class="hljs-string">&#x27;/29/05.py&#x27;</span>)<br><span class="hljs-number">926</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.getatime(os.pardir+ <span class="hljs-string">&#x27;/29/05.py&#x27;</span>)<br><span class="hljs-number">1653282351.295187</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.getmtime(os.pardir+ <span class="hljs-string">&#x27;/29/05.py&#x27;</span>)<br><span class="hljs-number">1653279681.7378166</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> time<br><span class="hljs-meta">&gt;&gt;&gt; </span>time.gmtime(os.path.getmtime(os.pardir+ <span class="hljs-string">&#x27;/29/05.py&#x27;</span>))<br>time.struct_time(tm_year=<span class="hljs-number">2022</span>, tm_mon=<span class="hljs-number">5</span>, tm_mday=<span class="hljs-number">23</span>, tm_hour=<span class="hljs-number">4</span>, tm_min=<span class="hljs-number">21</span>, tm_sec=<span class="hljs-number">21</span>, tm_wday=<span class="hljs-number">0</span>, tm_yday=<span class="hljs-number">143</span>, tm_isdst=<span class="hljs-number">0</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>time.localtime(os.path.getmtime(os.pardir+ <span class="hljs-string">&#x27;/29/05.py&#x27;</span>))<br>time.struct_time(tm_year=<span class="hljs-number">2022</span>, tm_mon=<span class="hljs-number">5</span>, tm_mday=<span class="hljs-number">23</span>, tm_hour=<span class="hljs-number">12</span>, tm_min=<span class="hljs-number">21</span>, tm_sec=<span class="hljs-number">21</span>, tm_wday=<span class="hljs-number">0</span>, tm_yday=<span class="hljs-number">143</span>, tm_isdst=<span class="hljs-number">0</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.exists(os.curdir + <span class="hljs-string">&#x27;/A/sexy.txt&#x27;</span>)<br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.exists(os.curdir + <span class="hljs-string">&#x27;/A&#x27;</span>)<br><span class="hljs-literal">True</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.isabs(os.curdir + <span class="hljs-string">&#x27;/A&#x27;</span>)<br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.isdir(os.curdir + <span class="hljs-string">&#x27;/A&#x27;</span>)<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-23"><a href="#课后作业-23" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-23"><a href="#Quiz-23" class="headerlink" title="Quiz"></a>Quiz</h3><h3 id="Practice-20"><a href="#Practice-20" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>编写一个程序，统计当前目录下每个文件类型的文件数，程序实现如图：</p><p><img src="https://img-blog.csdn.net/20180829233232993?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，统计当前目录下每个文件类型的文件数，程序实现如图：</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_ext</span>(<span class="hljs-params">file_path</span>):<br>    ext_dic = &#123;&#125;<br>    count = <span class="hljs-number">0</span><br>    dir_elements = os.listdir(file_path)<br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> dir_elements:<br>        ext = os.path.splitext(each)[<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> ext_dic.keys():<br>            ext_dic.setdefault(ext, <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">else</span>:<br>            ext_dic[ext] += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> each_ext <span class="hljs-keyword">in</span> ext_dic.keys():<br>        <span class="hljs-keyword">if</span> each_ext ==<span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件夹：【 %s 】下共有类型为文件夹的文件 %d 个&#x27;</span> % (file_path, ext_dic[each_ext]))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件夹：【 %s 】下共有类型为 [ %s ] 的文件 %d 个&#x27;</span> % (file_path, each_ext, ext_dic[each_ext]))<br><br><br>count_ext(os.path.curdir)<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，计算当前文件夹下所有文件的大小，程序实现如图：</p><p><img src="https://img-blog.csdn.net/20180829233243506?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，计算当前文件夹下所有文件的大小，程序实现如图：</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">file_size</span>(<span class="hljs-params">f_path</span>):<br>    os.chdir(f_path)<br>    file_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: os.path.isfile(x), os.listdir(f_path)))<br>    <span class="hljs-keyword">for</span> each_file <span class="hljs-keyword">in</span> file_list:<br>        <span class="hljs-built_in">print</span>(each_file + <span class="hljs-string">&#x27;  【%d Bytes】 &#x27;</span> % os.path.getsize(each_file))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    file_size(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input the path:&#x27;</span>))<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，用户输入文件名以及开始搜索的路径，搜索该文件是否存在。如遇到文件夹，则进入文件夹继续搜索，程序实现如图：</p><p><img src="https://img-blog.csdn.net/20180829233256964?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，用户输入文件名以及开始搜索的路径，搜索该文件是否存在。如遇到文件夹，则进入文件夹继续搜索，程序实现如图</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_file</span>(<span class="hljs-params">path, file_name</span>):<br>    os.chdir(path)<br>    temp_folder_name = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: os.path.isdir(x), os.listdir(path)))<br>    temp_file_name = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: os.path.isfile(x), os.listdir(path)))<br>    <span class="hljs-keyword">if</span> file_name <span class="hljs-keyword">in</span> temp_file_name:<br>        <span class="hljs-built_in">print</span>(os.path.join(path, file_name))<br>    <span class="hljs-keyword">if</span> temp_folder_name:<br>        <span class="hljs-keyword">for</span> sub_folder_name <span class="hljs-keyword">in</span> temp_folder_name:<br>            search_file(os.path.join(path, sub_folder_name), file_name)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    search_file(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入待查找的初始目录：&#x27;</span>), <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要查找的目标文件：&#x27;</span>))<br></code></pre></td></tr></table></figure><p>还可以通过os.walk() 来实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，用户输入文件名以及开始搜索的路径，搜索该文件是否存在。如遇到文件夹，则进入文件夹继续搜索，程序实现如图</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_file</span>(<span class="hljs-params">path, file_name</span>):<br>    <span class="hljs-comment"># os.walk() 返回的是一个三元组迭代器，有三元组参数，通过for 循环使用</span><br>    <span class="hljs-keyword">for</span> folder, sub_folders, sub_files <span class="hljs-keyword">in</span> os.walk(path): <br>        <span class="hljs-keyword">if</span> file_name <span class="hljs-keyword">in</span> sub_files:<br>            <span class="hljs-built_in">print</span>(os.path.join(folder, file_name))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    search_file(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入待查找的初始目录：&#x27;</span>), <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要查找的目标文件：&#x27;</span>))<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，用户输入开始搜索的路径，查找该路径下（包含子文件夹）所有的视频格式文件（要求查找mp4，rmvb，avi的格式即可），并创建一个文件（vedioList.txt）存放找到的文件的路径，程序实现如图：</p><p><img src="https://img-blog.csdn.net/20180829233514332?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><p><img src="https://img-blog.csdn.net/20180829233329338?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，用户输入开始搜索的路径，查找该路径下（包含子文件夹）所有的视频格式文件（要求查找mp4，rmvb，avi的格式即可），</span><br><span class="hljs-comment"># 并创建一个文件（vedioList.txt）存放找到的文件的路径，程序实现如图：</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br>file_list = []<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_video</span>(<span class="hljs-params">path, format_list=[<span class="hljs-string">&#x27;.mp4&#x27;</span>, <span class="hljs-string">&#x27;.rmvb&#x27;</span>, <span class="hljs-string">&#x27;.avi&#x27;</span>]</span>):<br>    os.chdir(path)<br>    temp_folder = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: os.path.isdir(x), os.listdir(path)))<br>    temp_file = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: (os.path.isfile(x) <span class="hljs-keyword">and</span> os.path.splitext(x)[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> format_list), os.listdir(path)))<br>    file_list.extend(os.path.join(path, each_file) <span class="hljs-keyword">for</span> each_file <span class="hljs-keyword">in</span> temp_file)<br>    <span class="hljs-keyword">if</span> temp_folder:<br>        <span class="hljs-keyword">for</span> sub_folder <span class="hljs-keyword">in</span> temp_folder:<br>            search_video(os.path.join(path, sub_folder))<br><br>    f_video_list = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/Users/felix/PycharmProjects/learningpython/vedioList.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 如果直接使f_video_list.writelines(file_list) 写入的文件内容没有换行</span><br>    <span class="hljs-comment"># f_video_list.writelines(file_list)</span><br>    <span class="hljs-keyword">for</span> each_file_path <span class="hljs-keyword">in</span> file_list:<br>        f_video_list.write(each_file_path)<br>        f_video_list.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    f_video_list.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    search_video(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入待查找的初始目录：&#x27;</span>))<br></code></pre></td></tr></table></figure></li><li><p>编写一个程序，用户输入关键字，查找当前文件夹内（如果当前文件夹内包含文件夹，则进入文件夹继续搜索）所有含有该关键字的文本文件（.txt后缀），要求显示该文件所在的位置以及关键字在文件中的具体位置（第几行第几个字符），程序实现如图：</p><p><img src="https://img-blog.csdn.net/20180829233344730?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTQ2MTM3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，用户输入关键字，查找当前文件夹内（如果当前文件夹内包含文件夹，则进入文件夹继续搜索）所有含有该关键字的文本文件（.txt后缀），</span><br><span class="hljs-comment"># 要求显示该文件所在的位置以及关键字在文件中的具体位置（第几行第几个字符），程序实现如图</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-comment"># 存放所有目录和子目录下的txt 文件，并且是绝对路径</span><br>sub_full_txt = []<br>file_row_keyword = &#123;&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_keyword</span>(<span class="hljs-params">path, keyword</span>):<br>    <span class="hljs-keyword">for</span> folder, sub_folders, sub_files <span class="hljs-keyword">in</span> os.walk(path):<br>        <span class="hljs-comment"># 过滤出txt 文件</span><br>        sub_files_txt = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: os.path.splitext(x)[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;.txt&#x27;</span>, sub_files))<br>        <span class="hljs-comment"># 转换成绝对路径的txt 文件</span><br>        sub_full_txt.extend(os.path.join(folder, each_file) <span class="hljs-keyword">for</span> each_file <span class="hljs-keyword">in</span> sub_files_txt)<br><br>    <span class="hljs-keyword">for</span> file_name <span class="hljs-keyword">in</span> sub_full_txt:<br>        f_open = <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        f_lines = f_open.readlines()<br>        f_open.close()<br><br>        <span class="hljs-comment"># 预先定义一个子字典存储行数和关键字位置关系信息</span><br>        row_keyword = &#123;&#125;<br><br>        <span class="hljs-keyword">for</span> row_number <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(f_lines)):<br>            f_keyword_index = []<br>            start_flag = <span class="hljs-number">0</span><br>            f_keyword_number = f_lines[row_number].find(keyword, start_flag)<br><br>            <span class="hljs-keyword">while</span> f_keyword_number &gt;= <span class="hljs-number">0</span>:<br>                f_keyword_index.append(f_keyword_number)<br>                start_flag = f_keyword_number + <span class="hljs-number">1</span><br>                f_keyword_number = f_lines[row_number].find(keyword, start_flag)<br>                <span class="hljs-keyword">if</span> f_keyword_number == -<span class="hljs-number">1</span>:<br>                    row_keyword.setdefault(row_number+<span class="hljs-number">1</span>, f_keyword_index)<br>                    <span class="hljs-keyword">if</span> file_name <span class="hljs-keyword">in</span> file_row_keyword.keys():<br>                        file_row_keyword[file_name] = row_keyword<br>                    <span class="hljs-keyword">else</span>:<br>                        file_row_keyword.setdefault(file_name, row_keyword)<br><br>    <span class="hljs-comment"># 函数返回一个字典，key=文件路径，value=（以行数为key，以位置信息列表为value 的字典），如下</span><br>    <span class="hljs-comment"># &#123;</span><br>    <span class="hljs-comment">#   &#x27;C:/Users/felix_yang/PycharmProjects/learningpython\\28\\record.txt&#x27;: &#123;5: [16], 6: [4]&#125;,</span><br>    <span class="hljs-comment">#  &#x27;C:/Users/felix_yang/PycharmProjects/learningpython\\29\\boy_1.txt&#x27;: &#123;3: [0]&#125;,</span><br>    <span class="hljs-comment">#  &#x27;C:/Users/felix_yang/PycharmProjects/learningpython\\29\\boy_2.txt&#x27;: &#123;3: [0]&#125;,</span><br>    <span class="hljs-comment">#  &#x27;C:/Users/felix_yang/PycharmProjects/learningpython\\29\\girl_1.txt&#x27;: &#123;3: [12, 23], 7: [12, 23]&#125;</span><br>    <span class="hljs-comment"># &#125;</span><br><br>    <span class="hljs-keyword">return</span> file_row_keyword<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    filename = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入待查找的初始目录：&#x27;</span>)<br>    keyword = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要查找的关键字：&#x27;</span>)<br>    search_keyword(filename, keyword)<br>    <span class="hljs-keyword">for</span> file_key <span class="hljs-keyword">in</span> file_row_keyword.keys():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;============================================&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;在文件【%s】中找到关键字【%s】&#x27;</span> % (file_key, keyword))<br>        <span class="hljs-keyword">for</span> rows <span class="hljs-keyword">in</span> file_row_keyword[file_key].keys():<br>            <span class="hljs-comment"># 将字典存储的位置信息转换成字符串打印</span><br>            key_str = [<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> file_row_keyword[file_key][rows]]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;关键字出现在第 %d 行，第 【 %s 】 位置&#x27;</span> % (rows, <span class="hljs-string">&#x27;,&#x27;</span>.join(key_str)))<br><br></code></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs tap"><br>请输入待查找的初始目录：C:/Users/felix_yang/PycharmProjects/learningpython<br>请输入需要查找的关键字：小甲鱼<br>============================================<br>在文件【C:/Users/felix_yang/PycharmProjects/learningpython\28\record.txt】中找到关键字【小甲鱼】<br>关键字出现在第<span class="hljs-number"> 1 </span>行，第 【<span class="hljs-number"> 4 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 2 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 4 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 6 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 8 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 10 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 13 </span>行，第 【<span class="hljs-number"> 4 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 14 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 15 </span>行，第 【<span class="hljs-number"> 7 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 16 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 17 </span>行，第 【<span class="hljs-number"> 16 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 19 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 21 </span>行，第 【<span class="hljs-number"> 4 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 22 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 24 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 26 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 28 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 30 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>============================================<br>在文件【C:/Users/felix_yang/PycharmProjects/learningpython\29\girl_1.txt】中找到关键字【小甲鱼】<br>关键字出现在第<span class="hljs-number"> 1 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>============================================<br>在文件【C:/Users/felix_yang/PycharmProjects/learningpython\29\girl_2.txt】中找到关键字【小甲鱼】<br>关键字出现在第<span class="hljs-number"> 1 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 2 </span>行，第 【<span class="hljs-number"> 3 </span>】 位置<br>关键字出现在第<span class="hljs-number"> 3 </span>行，第 【<span class="hljs-number"> 12 </span>】 位置<br>============================================<br>在文件【C:/Users/felix_yang/PycharmProjects/learningpython\29\girl_3.txt】中找到关键字【小甲鱼】<br>关键字出现在第<span class="hljs-number"> 1 </span>行，第 【<span class="hljs-number"> 0 </span>】 位置<br><br>Process finished with exit code 0<br><br></code></pre></td></tr></table></figure></li></ol><h1 id="031-永久存储：腌制一缸美味的泡菜"><a href="#031-永久存储：腌制一缸美味的泡菜" class="headerlink" title="031. 永久存储：腌制一缸美味的泡菜"></a>031. 永久存储：腌制一缸美味的泡菜</h1><h2 id="知识点-26"><a href="#知识点-26" class="headerlink" title="知识点"></a>知识点</h2><h3 id="pickle-模块"><a href="#pickle-模块" class="headerlink" title="pickle 模块"></a>pickle 模块</h3><blockquote><p>我们之前学习了文件和文件系统，我们知道从一个文件里面去读取字符串是非常简单的，但是你如果要试图读取出数值的话，那么就要多费点周折了，因为无论你是使用read()方法还是readline()方法，都是返回一个字符串，如果我们希望从字符串中取出数值的话，我们会使用int()或float()函数，把类似于1,2,3或者3.14的字符串强制转换为整型或者浮点型数值，我们一直在讲保存文件，然而当你要保存的数据像列表，字典，集合甚至是类的实例这些更加复杂的数据类型的时候，你就会举手无措了，兴许你可能会把这些都转化为字符串，然后再写入到一个文本文件中保存起来，但是很快你就会发现，把这个过程反过来的时候，也就是从文本文件中恢复数据对象，即把一个字符串恢复成列表，字典，集合，类的实例的时候，你会发现这异常的困难，所幸的是，Python提供了一个标准的模块（pickle）使用这个模块，我们就可以轻松地将列表，字典，集合，类的实例这类复杂的类型转换为二进制文件了。这个模块就是我们要学习的pickle模块了。</p></blockquote><ul><li><p>令人惊叹的模块，几乎可以把所有的python 对象 转换成二进制的形式存储. <code>import pickle</code></p></li><li><p>存取数据：pickling - pickle.dump(src_object, pickle_file_object)</p></li><li><p>读取数据：unpickling - pickle.load(pickle_file_object)</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> pickle</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_list = [<span class="hljs-number">123</span>, <span class="hljs-number">1232</span>, <span class="hljs-string">&#x27;小甲鱼&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">pickle_file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;my_list.pkl&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">pickle.dump(my_list, pickle_file)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">pickle_file.close()</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">pickle_file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;my_list.pkl&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_list2 = pickle.load(pickle_file)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_list2</span><br>[123, 1232, &#x27;小甲鱼&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">pickle_file.close()</span><br></code></pre></td></tr></table></figure></li><li><p>可以把一些大数据“腌制成泡菜“ ，即保存成一个pkl 二进制文件，在代码中导入进行引用，使得代码更加简洁优雅</p></li></ul><h2 id="课后作业-24"><a href="#课后作业-24" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-24"><a href="#Quiz-24" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>pickle的实质是什么？</p><p>pickle的实质就是利用一些算法将你的数据对象“腌制”成二进制文件，存储在磁盘上，当然也可以放在数据库或者通过网络传输到另一台计算机上。</p></li><li><p>使用pickle的什么方法存储数据？</p><p>pickle.dump(src_object, pickle_file_object); 第一个参数是待存储的数据对象，第二个参数是目标存储的文件对象，注意要先使用’wb’的模式open文件哦</p></li><li><p>使用pickle的什么方法读取数据？</p><p>pickle.load(pickle_file_object); 参数是目标存储的文件对象，注意要先使用’rb’的模式open文件哦</p></li><li><p>使用pickle能不能保存为”*.txt”类型的文件？</p><p>可以，不过打开后是乱码，因为是以二进制的模式写入的。</p></li></ol><h3 id="Practice-21"><a href="#Practice-21" class="headerlink" title="Practice"></a>Practice</h3><ol><li>编写一个程序，这次要求使用pickle将文件（ record.txt (1.1 KB, 下载次数: 3561) ）里的对话按照以下要求腌制成不同文件（没错，是第29讲的内容小改，考考你自己能写出来吗？）：<br>        ※小甲鱼的对话单独保存为boy_*.txt的文件（去掉“小甲鱼:”）<br>        ※小客服的对话单独保存为girl_*.txt的文件（去掉“小客服:”）<br>        ※文件中总共有三段对话，分别保存为boy_1.txt, girl_1.txt，boy_2.txt, girl_2.txt, boy_3.txt, gril_3.txt共6个文件（提示：文件中不同的对话间已经使用“&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;”分割）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编写一个程序，这次要求使用pickle将文件（ record.txt (1.1 KB, 下载次数: 3561) ）里的对话按照以下要求腌制成不同文件（没错，是第29讲的内容小改，考考你自己能写出来吗？）：</span><br><span class="hljs-comment">#             ※小甲鱼的对话单独保存为boy_*.txt的文件（去掉“小甲鱼:”）</span><br><span class="hljs-comment">#             ※小客服的对话单独保存为girl_*.txt的文件（去掉“小客服:”）</span><br><span class="hljs-comment">#             ※文件中总共有三段对话，分别保存为boy_1.txt, girl_1.txt，boy_2.txt, girl_2.txt, boy_3.txt, gril_3.txt共6个文件</span><br><span class="hljs-comment">#             （提示：文件中不同的对话间已经使用“==========”分割）</span><br><br><br><span class="hljs-keyword">import</span> pickle<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract</span>(<span class="hljs-params">file_name</span>):<br>    count = <span class="hljs-number">0</span><br>    boy_list = []<br>    girl_list = []<br>    record_file = <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;r&#x27;</span>)<br>    <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> record_file:<br>        temp_list = each_line.split(<span class="hljs-string">&#x27;:&#x27;</span>)<br>        <span class="hljs-keyword">if</span> temp_list[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;小甲鱼&#x27;</span>:<br>            boy_list.append(temp_list[<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">elif</span> temp_list[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;小客服&#x27;</span>:<br>            girl_list.append(temp_list[<span class="hljs-number">1</span>])<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;========&#x27;</span> <span class="hljs-keyword">in</span> each_line:<br>            count += <span class="hljs-number">1</span><br>            pickle_file_boy = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;boy_%d.txt&#x27;</span> % count, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>            pickle_file_girl = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;girl_%d.txt&#x27;</span> % count, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>            pickle.dump(boy_list, pickle_file_boy)<br>            pickle.dump(girl_list, pickle_file_girl)<br>            pickle_file_boy.close()<br>            pickle_file_girl.close()<br>            boy_list = []<br>            girl_list = []<br>    count += <span class="hljs-number">1</span><br>    pickle_file_boy = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;boy_%d.txt&#x27;</span> % count, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>    pickle_file_girl = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;girl_%d.txt&#x27;</span> % count, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>    pickle.dump(boy_list, pickle_file_boy)<br>    pickle.dump(girl_list, pickle_file_girl)<br>    pickle_file_boy.close()<br>    pickle_file_girl.close()<br><br>    record_file.close()<br><br><br>extract(<span class="hljs-string">&#x27;record.txt&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="032-异常处理：你不可能总是对的"><a href="#032-异常处理：你不可能总是对的" class="headerlink" title="032. 异常处理：你不可能总是对的"></a>032. 异常处理：你不可能总是对的</h1><h2 id="知识点-27"><a href="#知识点-27" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Python-标准异常总结"><a href="#Python-标准异常总结" class="headerlink" title="Python 标准异常总结"></a>Python 标准异常总结</h3><table><thead><tr><th>异常</th><th>描述</th></tr></thead><tbody><tr><td>AssertionError</td><td>断言语句（assert）失败</td></tr><tr><td>AttributeError</td><td>尝试访问未知的对象属性</td></tr><tr><td>EOFError</td><td>用户输入文件末尾标志EOF（Ctrl+d）</td></tr><tr><td>FloatingPointError</td><td>浮点计算错误</td></tr><tr><td>GeneratorExit</td><td>generator.close()方法被调用的时候</td></tr><tr><td>ImportError</td><td>导入模块失败的时候</td></tr><tr><td>IndexError</td><td>索引超出序列的范围</td></tr><tr><td>KeyError</td><td>字典中查找一个不存在的关键字</td></tr><tr><td>KeyboardInterrupt</td><td>用户输入中断键（Ctrl+c）</td></tr><tr><td>MemoryError</td><td>内存溢出（可通过删除对象释放内存）</td></tr><tr><td>NameError</td><td>尝试访问一个不存在的变量</td></tr><tr><td>NotImplementedError</td><td>尚未实现的方法</td></tr><tr><td>OSError</td><td>操作系统产生的异常（例如打开一个不存在的文件）</td></tr><tr><td>OverflowError</td><td>数值运算超出最大限制</td></tr><tr><td>ReferenceError</td><td>弱引用（weak reference）试图访问一个已经被垃圾回收机制回收了的对象</td></tr><tr><td>RuntimeError</td><td>一般的运行时错误</td></tr><tr><td>StopIteration</td><td>迭代器没有更多的值</td></tr><tr><td>SyntaxError</td><td>Python的语法错误</td></tr><tr><td>IndentationError</td><td>缩进错误</td></tr><tr><td>TabError</td><td>Tab和空格混合使用</td></tr><tr><td>SystemError</td><td>Python编译器系统错误</td></tr><tr><td>SystemExit</td><td>Python编译器进程被关闭</td></tr><tr><td>TypeError</td><td>不同类型间的无效操作</td></tr><tr><td>UnboundLocalError</td><td>访问一个未初始化的本地变量（NameError的子类）</td></tr><tr><td>UnicodeError</td><td>Unicode相关的错误（ValueError的子类）</td></tr><tr><td>UnicodeEncodeError</td><td>Unicode编码时的错误（UnicodeError的子类）</td></tr><tr><td>UnicodeDecodeError</td><td>Unicode解码时的错误（UnicodeError的子类）</td></tr><tr><td>UnicodeTranslateError</td><td>Unicode转换时的错误（UnicodeError的子类）</td></tr><tr><td>ValueError</td><td>传入无效的参数</td></tr><tr><td>ZeroDivisionError</td><td>除数为零</td></tr></tbody></table><h3 id="常见异常"><a href="#常见异常" class="headerlink" title="常见异常"></a>常见异常</h3><ul><li>AssertionError</li><li>AttributeError</li><li>IndexError</li><li>KeyError</li><li>NameError</li><li>SyntaxError</li><li>TypeError</li><li>ZeroDivisionError</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>mylist = [<span class="hljs-string">&#x27;小甲鱼是帅哥&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(mylist) &gt; <span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>mylist.pop()<br><span class="hljs-string">&#x27;小甲鱼是帅哥&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>mylist<br>[]<br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(mylist) &gt; <span class="hljs-number">0</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AssertionError<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>mylist.fishc<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;list&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;fishc&#x27;</span><br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span>my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>my_list[<span class="hljs-number">3</span>]<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>IndexError: <span class="hljs-built_in">list</span> index out of <span class="hljs-built_in">range</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>my_dict = &#123;<span class="hljs-string">&#x27;one&#x27;</span>:<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;two&#x27;</span>:<span class="hljs-number">2</span>&#125;<br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>my_dict[<span class="hljs-string">&#x27;one&#x27;</span>]<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>my_dict[<span class="hljs-string">&#x27;four&#x27;</span>]<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>KeyError: <span class="hljs-string">&#x27;four&#x27;</span><br>&gt;&gt;&gt;<br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>my_dict.get(<span class="hljs-string">&#x27;four&#x27;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>mylist1<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: name <span class="hljs-string">&#x27;mylist1&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;I love FishC&#x27;</span><br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;I love FishC&#x27;</span><br>          ^<br>SyntaxError: Missing parentheses <span class="hljs-keyword">in</span> call to <span class="hljs-string">&#x27;print&#x27;</span>. Did you mean <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I love FishC&#x27;</span>)?<br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span> + <span class="hljs-string">&#x27;1&#x27;</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: unsupported operand <span class="hljs-built_in">type</span>(s) <span class="hljs-keyword">for</span> +: <span class="hljs-string">&#x27;int&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;str&#x27;</span><br>        <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span>/<span class="hljs-number">0</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>ZeroDivisionError: division by zero<br></code></pre></td></tr></table></figure><h2 id="课后作业-25"><a href="#课后作业-25" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-25"><a href="#Quiz-25" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>结合你自身的编程经验，总结下<a href="https://so.csdn.net/so/search?q=%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6&spm=1001.2101.3001.7020">异常处理机制</a>的重要性？</p><p>由于环境的不确定性和用户操作的不可以预知性都可能导致程序出现各种问题，因此异常机制最重要的无非就是：增强程序的健壮性和用户体验，尽可能的捕获所有预知的异常并写好处理的代码，当异常出现的时候，程序自动消化并恢复正常（不至于崩溃）。|</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,,]<br></code></pre></td></tr></table></figure><p>SyntaxError</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(my_list[<span class="hljs-built_in">len</span>(my_list)])<br></code></pre></td></tr></table></figure><p>IndexError</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>my_list = [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>my_list.<span class="hljs-built_in">sorted</span>()<br></code></pre></td></tr></table></figure><p>列表的排序方法叫 list.sort()，sorted() 是BIF。因此会引发 AttributeError: ‘list’ object has no attribute ‘sorted’ 异常。</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>my_dict = &#123;<span class="hljs-string">&#x27;host&#x27;</span>: <span class="hljs-string">&#x27;http://bbs.fishc.com&#x27;</span>, <span class="hljs-string">&#x27;port&#x27;</span>: <span class="hljs-string">&#x27;80&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(my_dict[<span class="hljs-string">&#x27;server&#x27;</span>])<br></code></pre></td></tr></table></figure><p>KeyError</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun</span>(<span class="hljs-params">x, y</span>):<br>        <span class="hljs-built_in">print</span>(x, y)<br><br>my_fun(x=<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>SyntaxError 如果使用关键字参数的话，需要两个参数均使用关键字参数 my_fun(x&#x3D;1, y&#x3D;2)</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;C:\\test.txt&#x27;</span>, wb)<br>f.write(<span class="hljs-string">&#x27;I love FishC.com!\n&#x27;</span>)<br>f.close()<br></code></pre></td></tr></table></figure><p>NameError</p><p>注意 open() 第二个参数是字符串，应该 f &#x3D; open(‘C:\test.txt’, ‘wb’) 。wb不加双引号 Python 还以为是变量名呢，往上一找，艾玛没找着……引发 NameError 异常。由于打开文件失败，接着下边一连串与 f 相关的均会报同样异常。</p></li><li><p>请问以下代码是否会产生异常，如果会的话，请写出异常的名称：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun1</span>():<br>        x = <span class="hljs-number">5</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun2</span>():<br>                x *= x<br>                <span class="hljs-keyword">return</span> x<br>        <span class="hljs-keyword">return</span> my_fun2()<br><br>my_fun1()<br></code></pre></td></tr></table></figure><p>闭包的知识大家还记得不？ Python 认为在内部函数的 x 是局部变量的时候，外部函数的 x 就被屏蔽了起来，所以执行 x *&#x3D; x 的时候，在右边根本就找不到局部变量 x 的值，因此报错。<br>在 Python3 之前没有直接的解决方案，只能间接地通过容器类型来存放，因为容器类型不是放在栈里，所以不会被“屏蔽”掉。容器类型这个词儿大家是不是似曾相识？我们之前介绍的字符串、列表、元祖，这些啥都可以往里的扔的就是容器类型啦。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun1</span>():<br>        x = [<span class="hljs-number">5</span>]<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun2</span>():<br>                x[<span class="hljs-number">0</span>] *= x[<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">return</span> x[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">return</span> my_fun2()<br><br>my_fun1()<br></code></pre></td></tr></table></figure><p>但是到了 Python3 的世界里，又有了不少的改进，如果我们希望在内部函数里可以修改外部函数里的局部变量的值，那么也有一个关键字可以使用，就是 nonlocal：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun1</span>():<br>        x = <span class="hljs-number">5</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fun2</span>():<br>                <span class="hljs-keyword">nonlocal</span> x<br>                x *= x<br>                <span class="hljs-keyword">return</span> x<br>        <span class="hljs-keyword">return</span> my_fun2()<br><br>my_fun1()<br></code></pre></td></tr></table></figure></li></ol><h1 id="033-异常处理：你不可能总是对的-2"><a href="#033-异常处理：你不可能总是对的-2" class="headerlink" title="033. 异常处理：你不可能总是对的-2"></a>033. 异常处理：你不可能总是对的-2</h1><h2 id="知识点-28"><a href="#知识点-28" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>try-except 语句 ： Try 语句一旦检测到异常，剩下的语句不会被执行</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">try</span>:<br>检测范围<br><span class="hljs-keyword">except</span> Exceptions[<span class="hljs-keyword">as</span> reason]<br>出现异常（exception）后的处理代码<br></code></pre></td></tr></table></figure><p><strong>Example-1:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># OSError，尝试打开一个不存在的文件</span><br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(f.read())<br>    f.close()<br><span class="hljs-keyword">except</span> OSError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件出错啦@&#x27;</span>)<br></code></pre></td></tr></table></figure><p>output:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">文件出错啦@ <br></code></pre></td></tr></table></figure><p><strong>Example-2:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># OSError，尝试打开一个不存在的文件</span><br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(f.read())<br>    f.close()<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件出错啦@ \n错误的原因是：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br></code></pre></td></tr></table></figure><p>output:</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">文件出错啦@ <br>错误的原因是：[Errno <span class="hljs-number">2</span>] <span class="hljs-keyword">No</span> such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory: <span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>Example-3:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment">#TypeError</span><br>    sum_umber = <span class="hljs-number">1</span> + <span class="hljs-string">&#x27;1&#x27;</span><br>    <br>    <span class="hljs-comment"># OSError，尝试打开一个不存在的文件</span><br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(f.read())<br>    f.close()<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件出错啦@ \n错误的原因是：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br><span class="hljs-keyword">except</span> TypeError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;类型出错啦@ \n错误的原因是：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br></code></pre></td></tr></table></figure><p>output:</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">类型出错啦@ <br>错误的原因是：unsupported operand <span class="hljs-keyword">type</span>(s) <span class="hljs-keyword">for</span> +: <span class="hljs-symbol">&#x27;int</span>&#x27; <span class="hljs-keyword">and</span> <span class="hljs-symbol">&#x27;str</span>&#x27;<br></code></pre></td></tr></table></figure><p><strong>注意由于检测到<code>sum_umber = 1 + &#39;1&#39;</code> 异常，会直接跳到<code>except TypeError as reason</code>, 主程序的剩余代码不会被执行</strong></p><p><strong>Example-4:</strong> 直接用except，无论什么出错，都能cover到;  <em><strong>但是太笼统，实际中并不推荐</strong></em> ，比如如果用户用<code>ctrl+c</code>想中断关闭程序，会由于KeyboardInterrupt 异常被捕获而触发出错Error，反而导致程序不会中断关闭</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;abc&#x27;</span>)<br>    sum_umber = <span class="hljs-number">1</span> + <span class="hljs-string">&#x27;1&#x27;</span><br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(f.read())<br>    f.close()<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦@&#x27;</span>)<br></code></pre></td></tr></table></figure><p> output:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">出错啦@<br></code></pre></td></tr></table></figure><p><strong>Example-5:</strong> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    sum_umber = <span class="hljs-number">1</span> + <span class="hljs-string">&#x27;1&#x27;</span><br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(f.read())<br>    f.close()<br><span class="hljs-keyword">except</span> (OSError, TypeError):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件出错啦@&#x27;</span>)<br></code></pre></td></tr></table></figure><p>output:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">出错啦@<br></code></pre></td></tr></table></figure></li><li><p>try-finally 语句:  做收尾工作</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">try</span>:<br>检测范围<br><span class="hljs-keyword">except</span> Exceptions[<span class="hljs-keyword">as</span> reason]:<br>出现异常（Exception）后的处理代码<br><span class="hljs-keyword">finally</span>:<br>无论如何都会被执行的代码<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;我为什么是个文件.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)<br>    f.write(<span class="hljs-string">&#x27;我存在了！&#x27;</span>)<br>    sum_umber = <span class="hljs-number">1</span> + <span class="hljs-string">&#x27;1&#x27;</span><br><br><span class="hljs-keyword">except</span> (OSError, TypeError):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;文件出错啦@&#x27;</span>)<br><span class="hljs-keyword">finally</span>:<br>    f.close()<br></code></pre></td></tr></table></figure></li><li><p>raise 语句触发异常</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span>/<span class="hljs-number">0</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>ZeroDivisionError: division by zero<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">raise</span> ZeroDivisionError<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>ZeroDivisionError<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-26"><a href="#课后作业-26" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-26"><a href="#Quiz-26" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>我们使用什么方法来处理程序中出现的异常？</p><p>try-except-finally</p></li><li><p>一个 try 语句可以和多个 except 语句搭配吗？为什么？</p><p>可以，针对不同的errortype 可以使用不同的except的语句</p></li><li><p>你知道如何统一处理多类异常吗？</p><p>使用元祖：<code>except (OSError, TypeError):</code></p></li><li><p>except 后边如果不带任何异常类，Python 会捕获所有（try 语句块内）的异常并统一处理，但小甲鱼却不建议这么做，你知道为什么吗？</p><p><strong>太笼统，实际中并不推荐</strong>* ，比如如果用户用<code>ctrl+c</code>想中断关闭程序，会由于KeyboardInterrupt 异常被捕获而触发出错Error，反而导致程序不会中断关闭</p></li><li><p>如果异常发生在成功打开文件后，Python 跳到 except 语句执行，并没有执行关闭文件的命令（用户写入文件的数据就可能没有保存起来），因此我们需要确保无论如何（就算出了异常退出）文件也要被关闭，我们应该怎么做呢？</p><p>使用finally 保证代码块一定会被执行； 如果 try 语句块中没有出现任何运行时错误，会跳过 except 语句块执行 finally 语句块的内容。</p></li><li><p>请恢复以下代码中马赛克挡住的内容，使得程序执行后可以按要求输出。</p><p><img src="https://img-blog.csdnimg.cn/20200728115630241.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200728115633801.png" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            <span class="hljs-keyword">if</span> i == <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">raise</span> KeyboardInterrupt<br>            <span class="hljs-built_in">print</span>(i, j)<br><span class="hljs-keyword">except</span> KeyboardInterrupt:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;推出啦！&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-22"><a href="#Practice-22" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>还记得我们第一个小游戏吗？只要用户输入非整型数据，程序立刻就会蹦出不和谐的异常信息然后崩溃。请使用刚学的<a href="https://so.csdn.net/so/search?q=%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86&spm=1001.2101.3001.7020">异常处理</a>方法修改以下程序，提高用户体验。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------我爱鱼C工作室------------------&#x27;</span>)<br>temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;不妨猜一下小甲鱼现在心里想的是哪个数字：&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    guess = <span class="hljs-built_in">int</span>(temp)<br><span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入类型出错啦@ \n出错类型： %s&#x27;</span> % <span class="hljs-built_in">str</span>(reason))<br>    guess = secret<br><span class="hljs-keyword">while</span> guess != secret:<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;哎呀，猜错了，请重新输入吧：&quot;</span>)<br>    guess = <span class="hljs-built_in">int</span>(temp)<br>    <span class="hljs-keyword">if</span> guess == secret:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我草，你是小甲鱼心里的蛔虫吗？！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;哼，猜中了也没有奖励！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> guess &gt; secret:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;哥，大了大了~~~&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;嘿，小了，小了~~~&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;游戏结束，不玩啦^_^&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>input() 函数有可能产生两类异常：EOFError（文件末尾endoffile，当用户按下组合键 Ctrl+d 产生）和 KeyboardInterrupt（取消输入，当用户按下组合键 Ctrl+c 产生），再次修改上边代码，捕获处理 input() 的两类异常，提高用户体验</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------我爱鱼C工作室------------------&#x27;</span>)<br><span class="hljs-keyword">try</span>:<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;不妨猜一下小甲鱼现在心里想的是哪个数字：&quot;</span>)<br>    guess = <span class="hljs-built_in">int</span>(temp)<br><span class="hljs-keyword">except</span> (KeyboardInterrupt, EOFError) <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;用户中断 \n原因： %s&#x27;</span> % <span class="hljs-built_in">str</span>(reason))<br>    guess = secret<br><span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入类型出错啦@ \n出错类型： %s&#x27;</span> % <span class="hljs-built_in">str</span>(reason))<br>    guess = secret<br><br><span class="hljs-keyword">while</span> guess != secret:<br>    temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;哎呀，猜错了，请重新输入吧：&quot;</span>)<br>    guess = <span class="hljs-built_in">int</span>(temp)<br>    <span class="hljs-keyword">if</span> guess == secret:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我草，你是小甲鱼心里的蛔虫吗？！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;哼，猜中了也没有奖励！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> guess &gt; secret:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;哥，大了大了~~~&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;嘿，小了，小了~~~&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;游戏结束，不玩啦^_^&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>尝试一个新的函数 int_input()，当用户输入整数的时候正常返回，否则提示出错并要求重新输入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 尝试一个新的函数 int_input()，当用户输入整数的时候正常返回，否则提示出错并要求重新输入</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">int_input</span>(<span class="hljs-params">msg=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    flag = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">try</span>:<br>        number = <span class="hljs-built_in">input</span>(msg)<br>        temp = <span class="hljs-built_in">int</span>(number)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> reason:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;输入类型出错啦@ \n出错类型： %s&#x27;</span> % <span class="hljs-built_in">str</span>(reason))<br>        flag = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">while</span> flag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(temp, <span class="hljs-built_in">int</span>):<br>            <span class="hljs-keyword">return</span> temp<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            temp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;error captured, please input again\n&#x27;</span>)<br><br><br><span class="hljs-built_in">print</span>(int_input())<br></code></pre></td></tr></table></figure><p>优化的程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">int_input</span>(<span class="hljs-params">prompt=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(prompt))<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span> ValueError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错，您输入的不是整数！&#x27;</span>)<br><br><br>int_input(<span class="hljs-string">&#x27;请输入一个整数：&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>把文件关闭放在 finally 语句块中执行还是会出现问题，像下边这个代码，当前文件夹中并不存在”My_File.txt”这个文件，那么程序执行起来会发生什么事情呢？你有办法解决这个问题吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;My_File.txt&#x27;</span>) <span class="hljs-comment"># 当前文件夹中并不存在&quot;My_File.txt&quot;这个文件T_T</span><br>    <span class="hljs-built_in">print</span>(f.read())<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br><span class="hljs-keyword">finally</span>:<br>f.close()<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;My_File.txt&#x27;</span>)  <span class="hljs-comment"># 当前文件夹中并不存在&quot;My_File.txt&quot;这个文件T_T</span><br>    <span class="hljs-built_in">print</span>(f.read())<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br><span class="hljs-keyword">finally</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;f&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">locals</span>():  <span class="hljs-comment"># 如果文件对象变量存在当前局部变量符号表的话，说明打开成功</span><br>        f.close()<br></code></pre></td></tr></table></figure></li></ol><h1 id="034-丰富的else语句及简洁的with语句"><a href="#034-丰富的else语句及简洁的with语句" class="headerlink" title="034. 丰富的else语句及简洁的with语句"></a>034. 丰富的else语句及简洁的with语句</h1><h2 id="知识点-29"><a href="#知识点-29" class="headerlink" title="知识点"></a>知识点</h2><h3 id="丰富的else语句"><a href="#丰富的else语句" class="headerlink" title="丰富的else语句"></a>丰富的else语句</h3><ul><li><p>要么怎样，要么不怎样</p><ul><li>if-else</li></ul></li><li><p>干完了能怎样，干不完就别想怎样 ；</p><ul><li><p>和for 语句或者while 语句搭配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">showMaxFactor</span>(<span class="hljs-params">number</span>):<br>    count = number // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> number % count == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 的最大约数是 %d&#x27;</span> %(number, count))<br>            <span class="hljs-keyword">break</span><br>        count -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d 是一个素数&#x27;</span> % number)<br><br><br>num = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;please input a number:&#x27;</span>))<br>showMaxFactor(num)<br></code></pre></td></tr></table></figure></li></ul></li><li><p>没有问题，那就干吧</p><ul><li><p>和异常处理搭配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    a = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;input a number:&#x27;</span>))<br><span class="hljs-keyword">except</span> ValueError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦！&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(a)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="间接的with语句"><a href="#间接的with语句" class="headerlink" title="间接的with语句"></a>间接的with语句</h3><ul><li><p>一个例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)<br>    <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>        <span class="hljs-built_in">print</span>(each_line)<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦！&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br><span class="hljs-keyword">finally</span>:<br>    f.close()<br></code></pre></td></tr></table></figure><p>使用with 改进之后：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>            <span class="hljs-built_in">print</span>(each_line)<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦！&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br></code></pre></td></tr></table></figure></li><li><p>with 语句会monitor 打开的文件，会自动关闭，不需要再用<code>f.close()</code></p></li></ul><h2 id="课后作业-27"><a href="#课后作业-27" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-27"><a href="#Quiz-27" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>在 Python 中，else 语句能跟哪些语句进行搭配？</p><p>if, while, for 和 try-except</p></li><li><p>请问以下例子中，循环中的 break 语句会跳过 else 语句吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">showMaxFactor</span>(<span class="hljs-params">num</span>):<br>    count = num // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> num % count == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d最大的约数是%d&#x27;</span> % (num, count))<br>            <span class="hljs-keyword">break</span><br>        count -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d是素数！&#x27;</span> % num)<br><br>num = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入一个数：&#x27;</span>))<br>showMaxFactor(num)<br></code></pre></td></tr></table></figure><p>会，因为如果将 else 语句与循环语句（while 和 for 语句）进行搭配，那么只有在循环正常执行完成后才会执行 else 语句块的内容。</p></li><li><p>请目测以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ABC&#x27;</span>)<br><span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;DEF&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GHI&#x27;</span>)<br><span class="hljs-keyword">finally</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;JKL&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>ABC</p><p>GHI</p><p>JKL</p></li><li><p>使用什么语句可以使你不必再担心文件打开后却忘了关闭的尴尬？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> each_line <span class="hljs-keyword">in</span> f:<br>            <span class="hljs-built_in">print</span>(each_line)<br><span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> reason:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出错啦：&#x27;</span> + <span class="hljs-built_in">str</span>(reason))<br></code></pre></td></tr></table></figure><p>使用with语句</p></li><li><p>使用 with 语句固然方便，但如果出现异常的话，文件还会自动正常关闭吗？</p><p>with 语句会自动处理文件的打开和关闭，如果中途出现异常，会执行清理代码，然后确保文件自动关闭。g</p></li><li><p>你可以换一种形式写出下边的伪代码吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> A() <span class="hljs-keyword">as</span> a:<br>    <span class="hljs-keyword">with</span> B() <span class="hljs-keyword">as</span> b:<br>        suite<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> A() <span class="hljs-keyword">as</span> a, B() <span class="hljs-keyword">as</span> b:<br>    suite<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-23"><a href="#Practice-23" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>使用 with 语句改写以下代码，让 Python 去关心文件的打开与关闭吧。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">file_compare</span>(<span class="hljs-params">file1, file2</span>):<br>    f1 = <span class="hljs-built_in">open</span>(file1)<br>    f2 = <span class="hljs-built_in">open</span>(file2)<br>    count = <span class="hljs-number">0</span> <span class="hljs-comment"># 统计行数</span><br>    differ = [] <span class="hljs-comment"># 统计不一样的数量</span><br><br>    <span class="hljs-keyword">for</span> line1 <span class="hljs-keyword">in</span> f1:<br>        line2 = f2.readline()<br>        count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> line1 != line2:<br>            differ.append(count)<br><br>    f1.close()<br>    f2.close()<br>    <span class="hljs-keyword">return</span> differ<br><br>file1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的头一个文件名：&#x27;</span>)<br>file2 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的另一个文件名：&#x27;</span>)<br><br>differ = file_compare(file1, file2)<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(differ) == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件完全一样！&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件共有【%d】处不同：&#x27;</span> % <span class="hljs-built_in">len</span>(differ))<br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> differ:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第 %d 行不一样&#x27;</span> % each)<br></code></pre></td></tr></table></figure><p>使用with 之后的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">file_compare</span>(<span class="hljs-params">file1, file2</span>):<br>    <span class="hljs-comment"># f1 = open(file1)</span><br>    <span class="hljs-comment"># f2 = open(file2)</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file1) <span class="hljs-keyword">as</span> f1, <span class="hljs-built_in">open</span>(file2) <span class="hljs-keyword">as</span> f2:<br>        count = <span class="hljs-number">0</span>  <span class="hljs-comment"># 统计行数</span><br>        differ = []  <span class="hljs-comment"># 统计不一样的数量</span><br>    <br>        <span class="hljs-keyword">for</span> line1 <span class="hljs-keyword">in</span> f1:<br>            line2 = f2.readline()<br>            count += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> line1 != line2:<br>                differ.append(count)<br>                <br>        <span class="hljs-keyword">return</span> differ<br><br><br>file1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的头一个文件名：&#x27;</span>)<br>file2 = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入需要比较的另一个文件名：&#x27;</span>)<br><br>differ = file_compare(file1, file2)<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(differ) == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件完全一样！&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;两个文件共有【%d】处不同：&#x27;</span> % <span class="hljs-built_in">len</span>(differ))<br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> differ:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第 %d 行不一样&#x27;</span> % each)<br></code></pre></td></tr></table></figure></li><li><p>你可以利用异常的原理，修改下面的代码使得更高效率的实现吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 欢迎进入通讯录程序 ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 1：查询联系人资料  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 2：插入新的联系人  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 3：删除已有联系人  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 4：退出通讯录程序  ---|&#x27;</span>)<br><br>contacts = <span class="hljs-built_in">dict</span>()<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    instr = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;\n请输入相关的指令代码：&#x27;</span>))<br>    <br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">1</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> contacts:<br>            <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27; : &#x27;</span> + contacts[name])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名不再通讯录中！&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">2</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> contacts:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名在通讯录中已存在 --&gt;&gt; &#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27; : &#x27;</span> + contacts[name])<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否修改用户资料（YES/NO）：&#x27;</span>) == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>                contacts[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            contacts[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">3</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> contacts:<br>            <span class="hljs-keyword">del</span>(contacts[name])         <span class="hljs-comment"># 也可以使用dict.pop()</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的联系人不存在。&#x27;</span>)<br>            <br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 感谢使用通讯录程序 ---|&#x27;</span>)<br></code></pre></td></tr></table></figure><p>使用条件语句的代码非常直观明了，但是效率不高。因为程序会两次访问字典的键，一次判断是否存在（例如 <code>if name in contacts）</code>，一次获得值（例如 <code>print(name + &#39; : &#39; + contacts[name])</code>）</p><p>如果利用异常解决方案，我们可以简单避开每次需要使用 in 判断是否键存在字典中的操作。因为只要当键不存在字典中时，会触发 KeyError 异常，利用此特性我们可以修改代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 欢迎进入通讯录程序 ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 1：查询联系人资料  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 2：插入新的联系人  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 3：删除已有联系人  ---|&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 4：退出通讯录程序  ---|&#x27;</span>)<br><br>contacts = <span class="hljs-built_in">dict</span>()<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    instr = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;\n请输入相关的指令代码：&#x27;</span>))<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">1</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27; : &#x27;</span> + contacts[name])<br>        <span class="hljs-keyword">except</span> KeyError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名不再通讯录中！&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">2</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的姓名在通讯录中已存在 --&gt;&gt; &#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27; : &#x27;</span> + contacts[name])<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;是否修改用户资料（YES/NO）：&#x27;</span>) == <span class="hljs-string">&#x27;YES&#x27;</span>:<br>                contacts[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br>        <span class="hljs-keyword">except</span> KeyError:<br>            contacts[name] = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入用户联系电话：&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">3</span>:<br>        name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入联系人姓名：&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">del</span> (contacts[name])  <span class="hljs-comment"># 也可以使用dict.pop()</span><br>        <span class="hljs-keyword">except</span> KeyError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;您输入的联系人不存在。&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> instr == <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;|--- 感谢使用通讯录程序 ---|&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="035-图形用户界面入门：EasyGui"><a href="#035-图形用户界面入门：EasyGui" class="headerlink" title="035. 图形用户界面入门：EasyGui"></a>035. 图形用户界面入门：EasyGui</h1><h2 id="知识点-30"><a href="#知识点-30" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p><a href="http://easygui.sourceforge.net/">官方文档</a></p></li><li><p>导入easygui模块 - 3种方法； 推荐使用<code>import easygui as g</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> easygui<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>easygui.msgbox(<span class="hljs-string">&#x27;hi&#x27;</span>)<br><span class="hljs-string">&#x27;OK&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> easygui <span class="hljs-keyword">import</span> *<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>msgbox(<span class="hljs-string">&#x27;hi&#x27;</span>)<br><span class="hljs-string">&#x27;OK&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-meta">&gt;&gt;&gt; </span>g.msgbox(<span class="hljs-string">&#x27;hi&#x27;</span>)<br><span class="hljs-string">&#x27;OK&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>使用easygui</p><ul><li><p>建议不要在IDLE上运行Easygui</p></li><li><p>一个简单的例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    g.msgbox(<span class="hljs-string">&quot;嗨，欢迎进入第一个界面小游戏&quot;</span>)<br>    msg = <span class="hljs-string">&quot;请问你但愿在鱼C工做室学习到什么知识呢&quot;</span><br>    title=<span class="hljs-string">&quot;小游戏互动&quot;</span><br>    choices=[<span class="hljs-string">&quot;谈恋爱&quot;</span>,<span class="hljs-string">&quot;编程&quot;</span>,<span class="hljs-string">&quot;OOXX&quot;</span>,<span class="hljs-string">&quot;琴棋书画&quot;</span>]<br>    choice=g.choicebox(msg,title,choices)<br><br>    <span class="hljs-comment">#note that we convert choice to string,in case</span><br>    <span class="hljs-comment">#the user cancelled the choice,and we got None</span><br>    g.msgbox(<span class="hljs-string">&quot;你的选择是:&quot;</span>+<span class="hljs-built_in">str</span>(choice),<span class="hljs-string">&quot;结果&quot;</span>)<br>    msg=<span class="hljs-string">&quot;你但愿从新开始小游戏吗?&quot;</span><br>    title=<span class="hljs-string">&quot; 请选择&quot;</span><br>    <span class="hljs-keyword">if</span> g.ccbox(msg,title):  <span class="hljs-comment">#show a Contiue/Cancel dialog</span><br>        <span class="hljs-keyword">pass</span> <span class="hljs-comment">#user chose Contonue</span><br>    <span class="hljs-keyword">else</span>:<br>        sys.exit(<span class="hljs-number">0</span>)  <span class="hljs-comment">#user chose Cancel</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="知识点-补充"><a href="#知识点-补充" class="headerlink" title="知识点 - 补充"></a>知识点 - 补充</h2><ol start="0"><li><p>安装 EasyGUI</p><p>官网：<a href="https://github.com/robertlugg/easygui">https://github.com/robertlugg/easygui</a></p><p>使用 pip 进行安装：</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714172112548-1358634293.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714172112548-1358634293.png" alt="img"></a></p></li><li><p>什么是 EasyGUI？</p><p>EasyGUI 是 Python 中一个非常简单的 GUI 编程模块，不同于其他的 GUI 生成器，它不是事件驱动的。相反，所有的 GUI 交互都是通过简单函数调用就可以实现。</p><p>EasyGUI 为用户提供了简单的 GUI 交互接口，不需要程序员知道任何有关 tkinter，框架，部件，回调或 lambda 的任何细节。</p><p>EasyGUI 可以很好地兼容 Python 2 和 3，并且不存在任何依赖关系。</p><p>EasyGUI 是运行在 Tkinter 上并拥有自身的事件循环，而 IDLE 也是 Tkinter 写的一个应用程序并也拥有自身的事件循环。因此当两者同时运行的时候，有可能会发生冲突，且带来不可预测的结果。因此如果你发现你的 EasyGUI 程序有这样的问题，请尝试在 IDLE 外去运行你的程序。</p></li><li><p>一个简单的例子</p><p>在 EasyGui 中，所有的 GUI 互动均是通过简单的函数调用，下边一个简单的例子告诉你 EasyGui 确实很 Easy！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"> <span class="hljs-number">1</span> <span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br> <span class="hljs-number">2</span> <span class="hljs-keyword">import</span> sys<br> <span class="hljs-number">3</span> <br> <span class="hljs-number">4</span> <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br> <span class="hljs-number">5</span>         g.msgbox(<span class="hljs-string">&quot;嗨，欢迎进入第一个界面小游戏^_^&quot;</span>)<br> <span class="hljs-number">6</span> <br> <span class="hljs-number">7</span>         msg =<span class="hljs-string">&quot;请问你希望在鱼C工作室学习到什么知识呢？&quot;</span><br> <span class="hljs-number">8</span>         title = <span class="hljs-string">&quot;小游戏互动&quot;</span><br> <span class="hljs-number">9</span>         choices = [<span class="hljs-string">&quot;谈恋爱&quot;</span>, <span class="hljs-string">&quot;编程&quot;</span>, <span class="hljs-string">&quot;OOXX&quot;</span>, <span class="hljs-string">&quot;琴棋书画&quot;</span>]<br><span class="hljs-number">10</span>         <br><span class="hljs-number">11</span>         choice = g.choicebox(msg, title, choices)<br><span class="hljs-number">12</span> <br><span class="hljs-number">13</span>         <span class="hljs-comment"># 注意，msgbox的参数是一个字符串</span><br><span class="hljs-number">14</span>         <span class="hljs-comment"># 如果用户选择Cancel，该函数返回None</span><br><span class="hljs-number">15</span>         g.msgbox(<span class="hljs-string">&quot;你的选择是: &quot;</span> + <span class="hljs-built_in">str</span>(choice), <span class="hljs-string">&quot;结果&quot;</span>)<br><span class="hljs-number">16</span> <br><span class="hljs-number">17</span>         msg = <span class="hljs-string">&quot;你希望重新开始小游戏吗？&quot;</span><br><span class="hljs-number">18</span>         title = <span class="hljs-string">&quot;请选择&quot;</span><br><span class="hljs-number">19</span> <br><span class="hljs-number">20</span>         <span class="hljs-comment"># 弹出一个Continue/Cancel对话框</span><br><span class="hljs-number">21</span>         <span class="hljs-keyword">if</span> g.ccbox(msg, title):<br><span class="hljs-number">22</span>                 <span class="hljs-keyword">pass</span>            <span class="hljs-comment"># 如果用户选择Continue</span><br><span class="hljs-number">23</span>         <span class="hljs-keyword">else</span>:<br><span class="hljs-number">24</span>                 sys.exit(<span class="hljs-number">0</span>)     <span class="hljs-comment"># 如果用户选择Cancel</span><br></code></pre></td></tr></table></figure></li><li><p>EasyGUI 的各种功能演示</p><p>要运行 EasyGUI 的演示程序，在命令行调用 EasyGUI 是这样的：</p><p><code>python easygui.py</code></p><p>或者可以从 IDE（例如 IDLE, PythonWin, Wing, 等等）上调用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> easygui<br><span class="hljs-meta">&gt;&gt;&gt; </span>easygui.egdemo()<br></code></pre></td></tr></table></figure><p>成功调用后将可以尝试 EasyGUI 拥有的各种功能，并将结果打印至控制台。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714192216412-982535486.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714192216412-982535486.png" alt="img"></a></p></li><li><p>导入 EasyGUI</p><p>为了使用 EasyGUI 这个模块，你应该先导入它。</p><p>最简单的导入语句是：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> easygui<br></code></pre></td></tr></table></figure><p>如果使用上面这种形式导入的话，那么你使用 EasyGUI 的函数的时候，必须在函数的前面加上前缀 easygui，像这样：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">easygui.<span class="hljs-built_in">msgbox</span>(...)<br></code></pre></td></tr></table></figure><p>另一种选择是导入整个 EasyGUI 包：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">from</span> easygui <span class="hljs-keyword">import</span> *<br></code></pre></td></tr></table></figure><p>这使得我们更容易调用 EasyGUI 的函数，可以直接这样编写代码：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">msgbox</span>(<span class="hljs-params">...</span>)</span><br></code></pre></td></tr></table></figure><p>第三种方案是使用类似下边的 import 语句：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br></code></pre></td></tr></table></figure><p>这种方法还可以让你保持 EasyGUI 的命名空间，同时减少你的打字数量。</p><p>导入之后就可以这么调用 EasyGUI 的函数：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">g.<span class="hljs-built_in">msgbox</span>(...)<br></code></pre></td></tr></table></figure></li><li><p>使用 EasyGUI</p><p>一旦你的模块导入 EasyGUI，GUI 操作就是一个简单的调用 EasyGUI 函数的几个参数的问题了。</p><p>例如，使用 EasyGUI 来实现世界上最著名的打招呼：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><br>g.msgbox(<span class="hljs-string">&quot;Hello, world!&quot;</span>)<br></code></pre></td></tr></table></figure><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714192630885-1374238834.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714192630885-1374238834.png" alt="img"></a></p></li><li><p>EasyGUI 函数的默认参数</p><p>对于所有对话框而言，前两个参数都是消息主体和对话框标题。</p><p>按照这个规律，在某种情况下，这可能不是理想的布局设计（比如当对话框在获取目录或文件名的时候会选择忽略消息参数），但保持这种一致性且贯穿于所有的窗口部件是更为得体的考虑！<br>绝大部分的 EasyGUI 函数都有默认参数，几乎所有的组件都会显示消息主体和对话框标题。</p><p>标题默认是空字符串，消息主体通常有一个简单的默认值。</p><p>这使得你可以尽可能少的去设置参数，比如 msgbox() 函数标题部分的参数是可选的，因此你调用 msgbox() 的时候只需要指定一个消息参数即可，例如：</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl">&gt;&gt;&gt; <span class="hljs-function"><span class="hljs-title">msgbox</span>(<span class="hljs-string">&#x27;我爱hale^_^&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>当然你也可以指定标题参数和消息参数，例如：</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">msgbox(<span class="hljs-string">&#x27;我爱hale^_^&#x27;</span>, <span class="hljs-string">&#x27;AG自述&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714193213861-730996074.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714193213861-730996074.png" alt="img"></a></p><p>在各类按钮组件里，默认的消息是 “Shall I continue?”，所以你可以不带任何参数地去调用它们。</p><p>这里我们演示不带任何参数地去调用 ccbox()，当选择 “cancel” 或关闭窗口的时候返回一个布尔类型的值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> ccbox(): <br>        <span class="hljs-keyword">pass</span>         <span class="hljs-comment"># 用户选择继续</span><br><span class="hljs-keyword">else</span>: <br>        <span class="hljs-keyword">return</span>      <span class="hljs-comment"># 用户选择取消</span><br></code></pre></td></tr></table></figure><p><strong>这里return会报错SyntaxError: ‘return’ outside function</strong></p><p><strong><code>return</code>关键字只能在<code>def</code>自定义函数里面使用，（在<code>while</code>循环中只能使用<code>break</code>关键字来结束循环！这里没有自定义函数，所以不能出现<code>return</code>这样的关键字！）</strong></p></li><li><p>使用关键字参数调用 EasyGUI 的函数</p><p>调用 EasyGUI 函数还可以使用关键字参数哦。</p><p>现在假设你需要使用一个按钮组件，但你不想指定标题参数（第二个参数），你仍可以使用关键字参数的方法指定 choices 参数（第三个参数），像这样：</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">choices = [<span class="hljs-string">&#x27;愿意&#x27;</span>, <span class="hljs-string">&#x27;不愿意&#x27;</span>, <span class="hljs-string">&#x27;有钱的时候就愿意&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">reply = choicebox(<span class="hljs-string">&#x27;你愿意购买资源打包支持小甲鱼吗？&#x27;</span>, choices = choices)</span><br></code></pre></td></tr></table></figure><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714194606615-944741941.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714194606615-944741941.png" alt="img"></a></p></li><li><p>使用按钮组件</p><p>根据需求，EasyGUI 在 buttonbox() 上建立了一系列的函数供调用。</p><p>8.1.msgbox()</p><p>msgbox(msg&#x3D;’(Your message goes here)’, title&#x3D;’ ‘, ok_button&#x3D;’OK’, image&#x3D;None, root&#x3D;None)</p><p>msgbox() 显示一个消息和提供一个 “OK” 按钮，你可以指定任意的消息和标题，你甚至可以重写 “OK” 按钮的内容。</p><p>重写 “OK” 按钮最简单的方法是使用关键字参数：</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">msgbox(<span class="hljs-string">&quot;我一定要学会编程!&quot;</span>, ok_button=<span class="hljs-string">&quot;加油!&quot;</span>)</span><br></code></pre></td></tr></table></figure><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714194911513-2109612713.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714194911513-2109612713.png" alt="img"></a></p><p> 8.2.ccbox()</p><p>ccbox(msg&#x3D;’Shall I continue?’, title&#x3D;’ ‘, choices&#x3D;(‘C[o]ntinue’, ‘C[a]ncel’), image&#x3D;None, default_choice&#x3D;’C[o]ntinue’, cancel_choice&#x3D;’C[a]ncel’)</p><p>ccbox() 提供一个选择：“C[o]ntinue” 或者 “C[a]ncel”，并相应的返回 True 或者 False。</p><p>注意：“C[o]ntinue” 中的 [o] 表示快捷键，也就是说当用户在键盘上敲一下 o 字符，就相当于点击了 “C[o]ntinue” 按键。</p><p>8.3.ynbox()</p><p>ynbox(msg&#x3D;’Shall I continue?’, title&#x3D;’ ‘, choices&#x3D;(‘[<F1>]Yes’, ‘[<F2>]No’), image&#x3D;None, default_choice&#x3D;’[<F1>]Yes’, cancel_choice&#x3D;’[<F2>]No’)</p><p>跟 ccbox() 一样，只不过这里默认的 choices 参数值不同而已，[<F1>] 表示将键盘上的 F1 功能按键作为 “Yes” 的快捷键使用。</p><p>8.4.buttonbox()</p><p>buttonbox(msg&#x3D;’’, title&#x3D;’ ‘, choices&#x3D;(‘Button[1]’, ‘Button[2]’, ‘Button[3]’), image&#x3D;None, images&#x3D;None, default_choice&#x3D;None, cancel_choice&#x3D;None, callback&#x3D;None, run&#x3D;True)</p><p>可以使用 buttonbox() 定义自己的一组按钮，buttonbox() 会显示一组由你自定义的按钮。</p><p>当用户点击任意一个按钮的时候，buttonbox() 返回按钮的文本内容。</p><p>如果用户点击取消或者关闭窗口，那么会返回默认选项（第一个选项）。</p><p>请看例子：</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714200023069-1294875944.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714200023069-1294875944.png" alt="img"></a></p><p>8.5. indexbox()</p><p><em>indexbox(msg&#x3D;’Shall I continue?’, title&#x3D;’ ‘, choices&#x3D;(‘Yes’, ‘No’), image&#x3D;None, default_choice&#x3D;’Yes’, cancel_choice&#x3D;’No’)</em></p><p>基本跟 buttonbox() 一样，区别就是当用户选择第一个按钮的时候返回序号 0， 选择第二个按钮的时候返回序号 1。</p><p>8.6.boolbox()</p><p><em>boolbox(msg&#x3D;’Shall I continue?’, title&#x3D;’ ‘, choices&#x3D;(‘[Y]es’, ‘[N]o’), image&#x3D;None, default_choice&#x3D;’Yes’, cancel_choice&#x3D;’No’)</em></p><p>如果第一个按钮被选中则返回 True，否则返回 False。</p></li><li><p>如何在 buttonbox 里边显示图片</p><p>当你调用一个 buttonbox 函数（例如 msgbox(), ynbox(), indexbox() 等等）的时候，你还可以为关键字参数 image 赋值，可以设置一个 .gif 格式的图像（PNG 格式的图像也是支持的哦^_^）：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">buttonbox</span><span class="hljs-params">(<span class="hljs-string">&#x27;大家说我长得帅吗？&#x27;</span>, image=<span class="hljs-string">&#x27;turtle.gif&#x27;</span>, choices=(<span class="hljs-string">&#x27;帅&#x27;</span>, <span class="hljs-string">&#x27;不帅&#x27;</span>, <span class="hljs-string">&#x27;!@#$%&#x27;</span>)</span></span>)<br></code></pre></td></tr></table></figure><p>这里Python3需要安装pillow库才可加载jpg等其他图像</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714201305682-1560100367.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714201305682-1560100367.png" alt="img"></a></p></li><li><p>为用户提供一系列选项</p><p>10.1.choicebox()</p><p><em>choicebox(msg&#x3D;’Pick an item’, title&#x3D;’’, choices&#x3D;[], preselect&#x3D;0, callback&#x3D;None, run&#x3D;True)</em></p><p>按钮组件方便提供用户一个简单的按钮选项，但如果有很多选项，或者选项的内容特别长的话，更好的策略是为它们提供一个可选择的列表。<br>choicebox() 为用户提供了一个可选择的列表，使用序列（元祖或列表）作为选项，这些选项会按照字母进行排序。</p><p>另外还可以使用键盘来选择其中一个选项（比较纠结，但一点儿都不重要）：</p><ul><li>例如当按下键盘上的 “g” 键，将会选中的第一个以 “g” 开头的选项。再次按下 “g” 键，则会选中下一个以 “g” 开头的选项。在选中最后一个以 “g” 开头的选项的时候，再次按下 “g” 键将重新回到在列表的开头的第一个以 “g” 开头的选项。</li><li>如果选项中没有以 “g” 开头的，则会选中字符排序在 “g” 之前（“f”）的那个字符开头的选项</li><li>如果选项中没有字符的排序在 “g” 之前的，那么在列表中第一个元素将会被选中。 <a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714201858460-688480039.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714201858460-688480039.png" alt="img"></a></li></ul><p>10.2.multchoicebox()</p><p><em>multchoicebox(msg&#x3D;’Pick an item’, title&#x3D;’’, choices&#x3D;[], preselect&#x3D;0, callback&#x3D;None, run&#x3D;True)</em></p><p>multchoicebox() 函数也是提供一个可选择的列表，与 choicebox() 不同的是，multchoicebox() 支持用户选择 0 个，1 个或者同时选择多个选项。</p><p>multchoicebox() 函数也是使用序列（元祖或列表）作为选项，这些选项显示前会按照不区分大小写的方法排好序。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202023050-15996395.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202023050-15996395.png" alt="img"></a></p><p>​</p></li></ol><p>​</p><ol start="11"><li><p>让用户输入消息</p><p>11.1.enterbox()</p><p><em>enterbox(msg&#x3D;’Enter something.’, title&#x3D;’ ‘, default&#x3D;’’, strip&#x3D;True, image&#x3D;None, root&#x3D;None)</em></p><p>enterbox() 为用户提供一个最简单的输入框，返回值为用户输入的字符串。</p><p>默认返回的值会自动去除首尾的空格，如果需要保留首尾空格的话请设置参数 strip&#x3D;False。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202400343-1120620975.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202400343-1120620975.png" alt="img"></a></p><p>11.2.integerbox()</p><p><em>integerbox(msg&#x3D;’’, title&#x3D;’ ‘, default&#x3D;None, lowerbound&#x3D;0, upperbound&#x3D;99, image&#x3D;None, root&#x3D;None)</em></p><p>integerbox() 为用户提供一个简单的输入框，用户只能输入范围内（lowerbound 参数设置最小值，upperbound 参数设置最大值）的整型数值，否则会要求用户重新输入。</p><p>11.3 multenterbox()</p><p><em>multenterbox(msg&#x3D;’Fill in values for the fields.’, title&#x3D;’ ‘, fields&#x3D;[], values&#x3D;[], callback&#x3D;None, run&#x3D;True)</em></p><p>multenterbox() 为用户提供多个简单的输入框，要注意以下几点：</p><ul><li>如果用户输入的值比选项少的话，则返回列表中的值用空字符串填充用户未输入的选项。</li><li>如果用户输入的值比选项多的话，则返回的列表中的值将截断为选项的数量。</li><li>如果用户取消操作，则返回域中的列表的值或者 None 值。</li></ul><p>实现如下图（<em>源代码在第35讲的课后作业中^_^</em>）：</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202836630-1172692665.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714202836630-1172692665.png" alt="img"></a></p></li></ol><p>​     </p><ol start="12"><li><p>让用户输入密码</p><p>有时候可能需要让用户输入密码等敏感信息，那么界面看上去应该是这样的：******。</p><p>12.1.passwordbox()</p><p><em>passwordbox(msg&#x3D;’Enter your password.’, title&#x3D;’ ‘, default&#x3D;’’, image&#x3D;None, root&#x3D;None)</em></p><p>passwordbox() 跟 enterbox() 样式一样，不同的是用户输入的内容用星号（*）显示出来，该函数返回用户输入的字符串：</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714203118959-2140893646.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714203118959-2140893646.png" alt="img"></a></p><p> <em><strong>12.2 multpasswordbox()</strong></em></p><p><em>multpasswordbox(msg&#x3D;’Fill in values for the fields.’, title&#x3D;’ ‘, fields&#x3D;(), values&#x3D;(), callback&#x3D;None, run&#x3D;True)</em></p><p>multpasswordbox() 跟 multenterbox() 使用相同的接口，但当它显示的时候，最后一个输入框显示为密码的形式（*）：</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714203407291-1287204336.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714203407291-1287204336.png" alt="img"></a></p></li></ol><p><strong>13. 显示文本</strong></p><p>EasyGUI 还提供函数用于显示文本。</p><p><em><strong>13.1 textbox()</strong></em></p><p><em>textbox(msg&#x3D;’’, title&#x3D;’ ‘, text&#x3D;’’, codebox&#x3D;False, callback&#x3D;None, run&#x3D;True)</em></p><p>textbox() 函数默认会以比例字体（参数 codebox&#x3D;True 设置为等宽字体）来显示文本内容（自动换行），这个函数适合用于显示一般的书面文字。</p><p>注：text 参数设置可编辑文本区域的内容，可以是字符串、列表或者元祖类型。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714204601580-1727704146.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714204601580-1727704146.png" alt="img"></a></p><p> <em><strong>13.2 codebox()</strong></em></p><p><em>codebox(msg&#x3D;’’, title&#x3D;’ ‘, text&#x3D;’’)</em></p><p>codebox() 以等宽字体显示文本内容（不自动换行），相当于 textbox(codebox&#x3D;True)</p><p>注：等宽字体很丑的，但适合代码编写，不信你试试看@_@</p><p><strong>14. 目录与文件</strong></p><p>GUI 编程中一个常见的场景是要求用户输入目录及文件名，EasyGUI 提供了一些基本函数让用户来浏览文件系统，选择一个目录或文件。</p><p><em><strong>14.1 diropenbox()</strong></em></p><p><em>diropenbox(msg&#x3D;None, title&#x3D;None, default&#x3D;None)</em></p><p>diropenbox() 函数用于提供一个对话框，返回用户选择的目录名（带完整路径哦），如果用户选择 “Cancel” 则返回 None。</p><p>default 参数用于设置默认的打开目录（请确保设置的目录已存在）。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714212045322-541743005.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714212045322-541743005.png" alt="img"></a></p><p> <em><strong>14.2 fileopenbox()</strong></em></p><p><em>fileopenbox(msg&#x3D;None, title&#x3D;None, default&#x3D;’*‘, filetypes&#x3D;None, multiple&#x3D;False)</em></p><p>fileopenbox() 函数用于提供一个对话框，返回用户选择的文件名（带完整路径哦），如果用户选择 “Cancel” 则返回 None。</p><p>关于 default 参数的设置方法：</p><ul><li>default 参数指定一个默认路径，通常包含一个或多个通配符。</li><li>如果设置了 default 参数，fileopenbox() 显示默认的文件路径和格式。</li><li>default 默认的参数是 ‘*’，即匹配所有格式的文件。</li></ul><p>例如：</p><ul><li>default&#x3D;”c:&#x2F;fishc&#x2F;*.py” 即显示 C:\fishc 文件夹下所有的 Python 文件。</li><li>default&#x3D;”c:&#x2F;fishc&#x2F;test*.py” 即显示 C:\fishc 文件夹下所有的名字以 test 开头的 Python 文件。</li></ul><p>关于 filetypes 参数的设置方法：</p><ul><li>可以是包含文件掩码的字符串列表，例如：filetypes &#x3D; [“*.txt”]</li><li>可以是字符串列表，列表的最后一项字符串是文件类型的描述，例如：filetypes &#x3D; [“<em>.css”, [“</em>.htm”, “*.html”, “HTML files”]]</li></ul><p>最后是 multiple 参数，如果为 True 则表示可以同时选择多个文件。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714213405295-1488798206.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714213405295-1488798206.png" alt="img"></a></p><p><em><strong>14.3 filesavebox()</strong></em></p><p><em>filesavebox(msg&#x3D;None, title&#x3D;None, default&#x3D;’’, filetypes&#x3D;None)</em></p><p>filesavebox() 函数提供一个对话框，让用于选择文件需要保存的路径（带完整路径哦），如果用户选择 “Cancel” 则返回 None。</p><p>default 参数应该包含一个文件名（例如当前需要保存的文件名），当然也可以设置为空的，或者包含一个文件格式掩码的通配符。</p><p>filetypes 参数的设置方法请参考 fileopenbox() 函数。</p><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714214027910-1110083280.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714214027910-1110083280.png" alt="img"></a></p><p> <strong>15. 记住用户的设置</strong></p><p><em><strong>15.1 EgStore</strong></em></p><p>GUI 编程中一个常见的场景就是要求用户设置一下参数，然后保存下来，以便下次用户使用你的程序的时候可以记住他的设置。</p><p>为了实现对用户的设置进行存储和恢复这一过程，EasyGUI 提供了一个叫做 EgStore 的类。</p><p>为了记住某些设置，你的应用程序必须定义一个类（下面案例中的 “Settings”）继承自 EgStore 类。</p><p>然后你的应用程序必须创建一个该类的实例化对象（下面案例中的 “settings”）。</p><p>设置类的构造函数（<strong>init</strong> 方法）必须初始化所有的你想要它所记住的那些值。</p><p>一旦你这样做了，你就可以在 settings 对象中通过设定值去实例化变量，从而很简单地记住设置。</p><p>之后使用 settings.store() 方法在硬盘上持久化保存。</p><p>2020-07-14 21:53:13  类的知识暂未掌握！！！</p><p>下面创建一个叫做 “Settings” 的类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> easygui <span class="hljs-keyword">import</span> EgStore<br><br><span class="hljs-comment"># 定义一个叫做“Settings”的类，继承自EgStore类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">EgStore</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, filename</span>):  <span class="hljs-comment"># 需要指定文件名</span><br>        <span class="hljs-comment"># 指定要记住的属性名称</span><br>        self.author = <span class="hljs-string">&quot;&quot;</span><br>        self.book = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-comment"># 必须执行下面两个语句</span><br>        self.filename = filename<br>        self.restore()<br><br><span class="hljs-comment"># 创建“Settings”的实例化对象“settings”</span><br>settingsFilename = <span class="hljs-string">&quot;settings.txt&quot;</span><br>settings = Settings(settingsFilename)<br><br>author = <span class="hljs-string">&quot;小甲鱼&quot;</span><br>book = <span class="hljs-string">&quot;《零基础入门学习Pyhon》&quot;</span><br><br><span class="hljs-comment"># 将上面两个变量的值保存到“settings”对象中</span><br>settings.author = author<br>settings.book = book<br>settings.store()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n保存完毕\n&quot;</span>)<br></code></pre></td></tr></table></figure><p> <strong>16. 捕获异常</strong></p><p><em><strong>exceptionbox()</strong></em></p><p>使用 EasyGUI 编写 GUI 程序，有时候难免会产生异常。当然这取决于你如何运行你的应用程序，当你的应用程序崩溃的时候，堆栈追踪可能会被抛出，或者被写入到 stdout 标准输出函数中。</p><p>EasyGUI 通过 exceptionbox() 函数提供了更好的方式去处理异常。</p><p>当异常出现的时候，exceptionbox() 会将堆栈追踪显示在一个 codebox() 中，并且允许你做进一步的处理。</p><p>exceptionbox() 很容易使用，下面举个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I Love FishC.com!&#x27;</span>)<br>        <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;FISHC&#x27;</span>) <span class="hljs-comment"># 这里会产生异常</span><br><span class="hljs-keyword">except</span>:<br>        exceptionbox()<br></code></pre></td></tr></table></figure><p><a href="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714220025132-312819337.png"><img src="https://img2020.cnblogs.com/blog/2096605/202007/2096605-20200714220025132-312819337.png" alt="img"></a></p><h2 id="课后作业-28"><a href="#课后作业-28" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-28"><a href="#Quiz-28" class="headerlink" title="Quiz"></a>Quiz</h3><h3 id="Practice-24"><a href="#Practice-24" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>先练练手，把我们的刚开始的那个猜数字小游戏加上界面吧?</p><p><img src="https://img2018.cnblogs.com/blog/1442115/201812/1442115-20181209223851175-1976371461.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 先练练手，把我们的刚开始的那个猜数字小游戏加上界面吧?</span><br><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><br>g.msgbox(<span class="hljs-string">&quot;嗨，欢迎进入第一个界面小游戏^_^&quot;</span>)<br>secret = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>msg = <span class="hljs-string">&quot;不妨猜一下小甲鱼现在心里想的是哪个数字（1~10）：&quot;</span><br>title = <span class="hljs-string">&quot;数字小游戏&quot;</span><br>guess = g.integerbox(msg, title, lowerbound=<span class="hljs-number">1</span>, upperbound=<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 如果选择cancel，直接退出</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> guess:<br>    sys.exit()<br>    <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> guess == secret:<br>        g.msgbox(<span class="hljs-string">&quot;我草，你是小甲鱼心里的蛔虫吗？！&quot;</span>)<br>        g.msgbox(<span class="hljs-string">&quot;哼，猜中了也没有奖励！&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> guess &gt; secret:<br>            g.msgbox(<span class="hljs-string">&quot;哥，大了大了~~~&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            g.msgbox(<span class="hljs-string">&quot;嘿，小了，小了~~~&quot;</span>)<br>        guess = g.integerbox(msg, title, lowerbound=<span class="hljs-number">1</span>, upperbound=<span class="hljs-number">10</span>)<br><br>g.msgbox(<span class="hljs-string">&quot;游戏结束，不玩啦^_^&quot;</span>)<br><br><br></code></pre></td></tr></table></figure></li><li><p>实现一个用于登记用户账号信息的界面（如果是带*号的必填项，要求一定要有输入并且不能是空格）</p><p><img src="https://img2018.cnblogs.com/blog/1442115/201812/1442115-20181209223900309-1800557256.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 实现一个用于登记用户账号信息的界面（如果是带*号的必填项，要求一定要有输入并且不能是空格）</span><br><br><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-keyword">import</span> sys<br><br><br>message = <span class="hljs-string">&quot;【真实姓名】为必填项 \n【手机号码】为必填项 \n【*E-mail地址】为必填项 &quot;</span><br>title = <span class="hljs-string">&quot;账号中心&quot;</span><br>fields = [<span class="hljs-string">&#x27;*用户名&#x27;</span>, <span class="hljs-string">&#x27;*真实姓名&#x27;</span>, <span class="hljs-string">&#x27;固定电话&#x27;</span>, <span class="hljs-string">&#x27;*手机号码&#x27;</span>,  <span class="hljs-string">&#x27;QQ&#x27;</span>, <span class="hljs-string">&#x27;*E-mail&#x27;</span>]<br>result = g.multenterbox(msg=message, title=title, fields=fields, values=[<span class="hljs-string">&#x27;小甲鱼&#x27;</span>], callback=<span class="hljs-literal">None</span>, run=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result:<br>        sys.exit()<br>    <span class="hljs-keyword">elif</span> result[<span class="hljs-number">1</span>].isspace() <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> result[<span class="hljs-number">1</span>]:<br>        g.msgbox(<span class="hljs-string">&#x27;【真实姓名】为必填项, 一定要有输入并且不能是空格&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> result[<span class="hljs-number">3</span>].isspace() <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> result[<span class="hljs-number">3</span>]:<br>        g.msgbox(<span class="hljs-string">&#x27;【手机号码】为必填项, 一定要有输入并且不能是空格&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> result[<span class="hljs-number">5</span>].isspace() <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> result[<span class="hljs-number">5</span>]:<br>        g.msgbox(<span class="hljs-string">&#x27;【E-mail】为必填项, 一定要有输入并且不能是空格&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br>    result = g.multenterbox(msg=message, title=title, fields=fields, values=[<span class="hljs-string">&#x27;小甲鱼&#x27;</span>], callback=<span class="hljs-literal">None</span>, run=<span class="hljs-literal">True</span>)<br><br>g.msgbox(<span class="hljs-string">&#x27;登记成功@！&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>提供一个文件浏览框，让用户选择需要打开的文本文件，打开并显示文件内容</p><p><img src="https://img2018.cnblogs.com/blog/1442115/201812/1442115-20181209223908751-1868690450.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 提供一个文件浏览框，让用户选择需要打开的文本文件，打开并显示文件内容</span><br><br><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-keyword">import</span> sys<br><br>f_name = g.fileopenbox(msg=<span class="hljs-literal">None</span>, title=<span class="hljs-literal">None</span>, default=<span class="hljs-string">&#x27;*&#x27;</span>, filetypes=<span class="hljs-literal">None</span>, multiple=<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">if</span> f_name:<br>    message = <span class="hljs-string">&quot;文件&quot;</span> + f_name + <span class="hljs-string">&quot;的内容如下： &quot;</span><br>    title = <span class="hljs-string">&quot;显示文件内容&quot;</span><br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f_content = f.readlines()<br>    g.textbox(msg=message, title=title, text=f_content, codebox=<span class="hljs-literal">False</span>, callback=<span class="hljs-literal">None</span>, run=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">else</span>:<br>    sys.exit()<br></code></pre></td></tr></table></figure></li><li><p>在上一题的基础上增强功能：当用户点击“OK”按钮的时候，比较当前文件是否修改过，如果修改过，则提示“覆盖保存”、“放弃保存”或“另存为…”并实现相应的功能。</p><p><img src="https://img2018.cnblogs.com/blog/1442115/201812/1442115-20181209223915368-1198875933.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 在上一题的基础上增强功能：当用户点击“OK”按钮的时候，比较当前文件是否修改过，</span><br><span class="hljs-comment"># 如果修改过，则提示“覆盖保存”、“放弃保存”或“另存为…”并实现相应的功能。</span><br><br><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mfile_action</span>(<span class="hljs-params">m_choice</span>):<br>    <span class="hljs-keyword">if</span> m_choice == <span class="hljs-string">&#x27;覆盖保存&#x27;</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> fo:<br>            temp_content = fo.readlines()<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> fw:<br>                fw.writelines(temp_content)<br>    <span class="hljs-keyword">elif</span> m_choice == <span class="hljs-string">&#x27;放弃保存&#x27;</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> fw:<br>            fw.writelines(f_content)<br>    <span class="hljs-keyword">elif</span> m_choice == <span class="hljs-string">&#x27;另存为&#x27;</span>:<br>        <span class="hljs-comment"># with open(f_name, &#x27;r&#x27;) as fo:</span><br>        <span class="hljs-comment">#     temp_content = fo.readlines()</span><br>        new_fname = g.filesavebox(msg=<span class="hljs-literal">None</span>, title=<span class="hljs-literal">None</span>, default=<span class="hljs-string">&#x27;&#x27;</span>, filetypes=<span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">if</span> new_fname:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> fo:<br>                temp_content = fo.readlines()<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(new_fname, <span class="hljs-string">&#x27;x&#x27;</span>) <span class="hljs-keyword">as</span> fs:<br>                fs.writelines(temp_content)<br>    <span class="hljs-keyword">else</span>:<br>        sys.exit()<br><br><br>f_name = g.fileopenbox(msg=<span class="hljs-literal">None</span>, title=<span class="hljs-literal">None</span>, default=<span class="hljs-string">&#x27;*&#x27;</span>, filetypes=<span class="hljs-literal">None</span>, multiple=<span class="hljs-literal">False</span>)<br>old_mtime = os.path.getmtime(f_name)<br><span class="hljs-keyword">if</span> f_name:<br>    message = <span class="hljs-string">&quot;文件&quot;</span> + f_name + <span class="hljs-string">&quot;的内容如下： &quot;</span><br>    title = <span class="hljs-string">&quot;显示文件内容&quot;</span><br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(f_name, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f_content = f.readlines()<br>        <span class="hljs-built_in">print</span>(f_content)<br>    <span class="hljs-keyword">if</span> g.textbox(msg=message, title=title, text=f_content, codebox=<span class="hljs-literal">False</span>, callback=<span class="hljs-literal">None</span>, run=<span class="hljs-literal">True</span>):<br>        new_mtime = os.path.getmtime(f_name)<br>        <span class="hljs-keyword">if</span> new_mtime != old_mtime:<br>            warn_msg = <span class="hljs-string">&#x27;检测到文件内容发生改变，请选择以下操作：&#x27;</span><br>            warn_title = <span class="hljs-string">&#x27;警告&#x27;</span><br>            warn_choices = [<span class="hljs-string">&#x27;覆盖保存&#x27;</span>, <span class="hljs-string">&#x27;放弃保存&#x27;</span>, <span class="hljs-string">&#x27;另存为&#x27;</span>]<br>            choice = g.buttonbox(msg=warn_msg, title=warn_title, choices=warn_choices, image=<span class="hljs-literal">None</span>, images=<span class="hljs-literal">None</span>,<br>                        default_choice=<span class="hljs-literal">None</span>, cancel_choice=<span class="hljs-literal">None</span>, callback=<span class="hljs-literal">None</span>, run=<span class="hljs-literal">True</span>)<br>            mfile_action(choice)<br><span class="hljs-keyword">else</span>:<br>    sys.exit()<br><br></code></pre></td></tr></table></figure></li><li><p>写一个程序统计你当前代码量的总和，并显示离十万行代码量还有多远？ </p><p>要求一：递归搜索各个文件夹 要求二：显示各个类型的源文件和源代码数量 要求三：显示总行数与百分比</p><p><img src="https://img2018.cnblogs.com/blog/1442115/201812/1442115-20181209223924767-1833087716.png" alt="img"></p><p><img src="https://www.programminghunter.com/images/121/3f/3f4dda2326c5bf9b6508d481ad974ee1.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 写一个程序统计你当前代码量的总和，并显示离十万行代码量还有多远？</span><br><span class="hljs-comment"># 要求一：递归搜索各个文件夹 要求二：显示各个类型的源文件和源代码数量 要求三：显示总行数与百分比</span><br><br><span class="hljs-keyword">import</span> easygui <span class="hljs-keyword">as</span> g<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">code_cal</span>(<span class="hljs-params">dir_path</span>):<br>    format_list = [<span class="hljs-string">&#x27;.py&#x27;</span>, <span class="hljs-string">&#x27;.tf&#x27;</span>, <span class="hljs-string">&#x27;.sh&#x27;</span>]<br>    code_lines = <span class="hljs-number">0</span><br>    ext_dic = &#123;<span class="hljs-string">&#x27;.py&#x27;</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-string">&#x27;.tf&#x27;</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-string">&#x27;.sh&#x27;</span>:[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]&#125;<br><br>    <span class="hljs-comment"># os.walk() 返回的是一个三元组迭代器，有三元组参数，通过for 循环使用</span><br>    <span class="hljs-keyword">for</span> folder, sub_folders, sub_files <span class="hljs-keyword">in</span> os.walk(dir_path):<br>        <span class="hljs-keyword">for</span> each_file <span class="hljs-keyword">in</span> sub_files:<br>            ext_temp = os.path.splitext(each_file)[<span class="hljs-number">1</span>]<br><br>            <span class="hljs-keyword">if</span> ext_temp <span class="hljs-keyword">in</span> format_list:<br><br>                ext_dic[ext_temp][<span class="hljs-number">0</span>] += <span class="hljs-number">1</span><br><br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(folder, each_file), <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f_py:<br>                    len_temp = <span class="hljs-built_in">len</span>(f_py.readlines())<br>                    ext_dic[ext_temp][<span class="hljs-number">1</span>] += len_temp<br>                    code_lines += len_temp<br><br>    <span class="hljs-keyword">return</span> code_lines, ext_dic<br><br><br>f_path = g.diropenbox(msg=<span class="hljs-literal">None</span>, title=<span class="hljs-literal">None</span>, default=<span class="hljs-literal">None</span>)<br><br><span class="hljs-keyword">if</span> f_path:<br>    total_lines, ext_row_line = code_cal(f_path)<br>    message = <span class="hljs-string">&#x27;您目前共累计编写了 &#123;0&#125; 行代码，完成进度 &#123;1:.2%&#125; \n 离 &#123;2&#125; 行代码还差 &#123;3&#125; 行，请继续努力&#x27;</span>.<span class="hljs-built_in">format</span>(<br>        total_lines,<br>        total_lines/<span class="hljs-number">100000</span>,<br>        <span class="hljs-number">100000</span>,<br>        <span class="hljs-number">100000</span>-total_lines<br>    )<br>    text_title = <span class="hljs-string">&#x27;统计结果&#x27;</span><br>    text_content = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> ext_row_line.keys():<br>        text_content += <span class="hljs-string">&#x27;[&#123;0&#125;]源文件 &#123;1&#125; 个，源代码 &#123;2&#125; 行 \n&#x27;</span>.<span class="hljs-built_in">format</span>(<br>            each,<br>            ext_row_line[each][<span class="hljs-number">0</span>],<br>            ext_row_line[each][<span class="hljs-number">1</span>]<br>        )<br>    g.textbox(msg=message, title=text_title, text=text_content)<br><span class="hljs-keyword">else</span>:<br>    sys.exit()<br><br></code></pre></td></tr></table></figure></li></ol><h1 id="036-类和对象：给大家介绍对象"><a href="#036-类和对象：给大家介绍对象" class="headerlink" title="036. 类和对象：给大家介绍对象"></a>036. 类和对象：给大家介绍对象</h1><h2 id="知识点-31"><a href="#知识点-31" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>对象 &#x3D; 属性 + 方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Turtle</span>: <span class="hljs-comment"># python中的类名约定以大写字母开头； 函数名以小写字母开头</span><br>    <span class="hljs-string">&quot;&quot;&quot;关于类的一个简单的例子&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 属性</span><br>    color = <span class="hljs-string">&#x27;green&#x27;</span><br>    weight = <span class="hljs-number">10</span><br>    legs = <span class="hljs-number">4</span><br>    shell = <span class="hljs-literal">True</span><br>    mouth = <span class="hljs-string">&#x27;大嘴&#x27;</span><br><br>    <span class="hljs-comment"># 方法</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">climb</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我正很努力的往前爬。。。&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我正飞快的向前跑。。。&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bite</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;咬死你，咬死你。。。&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;有的吃，真满足！&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;困了，睡了，晚安。Zzzz&#x27;</span>)<br>        <br><span class="hljs-comment"># 类的实例化</span><br>turtle_01 = Turtle()<br>turtle_01.sleep()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> example_1 <span class="hljs-keyword">import</span> *<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>tt = Turtle()<br><span class="hljs-meta">&gt;&gt;&gt; </span>Turtle()<br>&lt;example_1.Turtle <span class="hljs-built_in">object</span> at <span class="hljs-number">0x102adb370</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>tt.climb()<br>我正很努力的往前爬。。。<br><span class="hljs-meta">&gt;&gt;&gt; </span>tt.bite()<br>咬死你，咬死你。。。<br><span class="hljs-meta">&gt;&gt;&gt; </span>tt.sleep()<br>困了，睡了，晚安。Zzzz<br><br></code></pre></td></tr></table></figure></li><li><p>OO(object oriented) 面向对象的特征</p><ul><li><p>封装</p><p>从表面上看对象封装了属性（变量）和方法（函数），封装更是一种信息隐蔽技术；</p><p>列表事实上就是一个对象，提供了若干种方法；但是我们不知道列表的方法是如何实现的，也不知道有多少变量，这就是封装</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1 = [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1.sort()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1</span><br>[1, 2, 3, 5, 7]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1.append(<span class="hljs-number">9</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list1</span><br>[1, 2, 3, 5, 7, 9]<br><br></code></pre></td></tr></table></figure></li><li><p>继承</p><p>子类共享父类的数据和方法的机制;</p><p>下面这个例子就是定义一个子类：MyList 继承父类list 的所有数据和方法</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyList</span>(<span class="hljs-title class_ inherited__">list</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">pass</span></span><br><span class="hljs-meta prompt_">...</span> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2 = MyList()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2.append(<span class="hljs-number">3</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2.append(<span class="hljs-number">5</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2.append(<span class="hljs-number">7</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2</span><br>[3, 5, 7]<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2.reverse()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">list2</span><br>[7, 5, 3]<br><br></code></pre></td></tr></table></figure></li><li><p>多态</p><p>不同对象对同一方法响应不同的行动</p><p>下面这个例子，都调用同样一个名字为fun的方法，但是实现不一样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我是小A&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我是小B&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A()<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = B()<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a.fun()<br>我是小A<br><span class="hljs-meta">&gt;&gt;&gt; </span>b.fun()<br>我是小B<br><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-29"><a href="#课后作业-29" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-29"><a href="#Quiz-29" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>对象中的属性和方法，在编程中实际是什么？</p><p>变量和函数</p></li><li><p>类和对象是什么关系呢？</p><p>类和对象的关系就如同模具和用这个模具制作出的物品之间的关系。一个类为它的全部对象给出了一个统一的定义，而他的对象则是符合这种定义的一个实体，因此类和对象的关系就是抽象和具体的关系。对象是类的实例化。</p></li><li><p>如果我们定义了一个猫类，那你能想象出由“猫”类实例化的对象有哪些？</p><p>叮当猫，Tom猫，Hello Kitty&#96;&#96;&#96;&#96;&#96;&#96;&#96;</p></li><li><p>类的定义有些时候或许不那么“拟物”，有时候会抽象一些，例如我们定义一个矩形类，那你会为此添加哪些属性和方法呢？</p><p>属性：长，宽</p><p>方法：计算周长，面积</p></li><li><p>类的属性定义应该尽可能抽象还是尽可能具体？</p><p>抽象</p></li><li><p>请用一句话概括面向对象的几个特征？</p><p>封装：对外部隐藏对象的工作细节；</p><p>继承：子类自动共享父类之间数据和方法的机制；</p><p>多态：可以对不同类的对象调用相同的方法，产生不同的结果。</p></li><li><p>函数和方法有什么区别？</p><p>函数和方法几乎一样。主要有一点区别在于方法默认有一个self参数。</p></li></ol><h3 id="Practice-25"><a href="#Practice-25" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>按照以下提示尝试定义一个Person类并生成类实例对象。</p><p>属性：姓名（默认姓名为“小甲鱼”）</p><p>方法：打印姓名</p><p>提示：方法中对属性的引用形式需加上self，如self.name</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 按照以下提示尝试定义一个Person类并生成类实例对象。</span><br><span class="hljs-comment"># 属性：姓名（默认姓名为“小甲鱼”）</span><br><span class="hljs-comment"># 方法：打印姓名</span><br><span class="hljs-comment"># 提示：方法中对属性的引用形式需加上self，如self.name</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>    name = <span class="hljs-string">&#x27;小甲鱼&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">printname</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(self.name)<br><br><br>p1 = Person()<br>p1.name = <span class="hljs-string">&#x27;FishC&#x27;</span><br>p1.printname()<br></code></pre></td></tr></table></figure></li><li><p>按照以下提示尝试定义一个矩阵类并生成类实例对象。</p><p>属性：长和宽</p><p>方法：设置长和宽-&gt;setRect(self)，获得长和宽-&gt;getRect(self)，获得面积-&gt;getArea(self)</p><p>提示：方法中对属性的引用形式需加上self，如self.width</p><p><img src="https://img2020.cnblogs.com/blog/1986620/202007/1986620-20200730235936219-1196502492.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.width = <span class="hljs-literal">None</span><br>        self.length = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_rect</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请输入矩形的长和宽...&#x27;</span>)<br>        self.length = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;长：&#x27;</span>))<br>        self.width = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;宽：&#x27;</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_rect</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;这个矩形的长是：&#123;0:.2f&#125; 宽是：&#123;1:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.length, self.width))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_area</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.length * self.width<br><br><br>rect = Rectangle()<br>rect.set_rect()<br>rect.get_rect()<br>rect.get_area()<br></code></pre></td></tr></table></figure></li></ol><h1 id="037-类和对象：面向对象编程"><a href="#037-类和对象：面向对象编程" class="headerlink" title="037. 类和对象：面向对象编程"></a>037. 类和对象：面向对象编程</h1><h2 id="知识点-32"><a href="#知识点-32" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Self-是什么？"><a href="#Self-是什么？" class="headerlink" title="Self 是什么？"></a>Self 是什么？</h3><ul><li><p>python的self 相当于C&#x2F;C++ 的指针</p></li><li><p>类是图纸，对象就是根据图纸建造出来的房子，self 相当于每个房子的门牌号</p></li><li><p>当一个对象的方法被调用的时候，对象会将自身作为第一个参数传给self参数，接收到self的时候，python就知道是哪个对象在调用这个方法了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ball</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params">self, name</span>):<br><span class="hljs-meta">... </span>            self.name = name<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">kick</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;my name is %s, fuck, who kick me#@#&#x27;</span> % self.name)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = Ball()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.setName(<span class="hljs-string">&#x27;球A&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = Ball()<br><span class="hljs-meta">&gt;&gt;&gt; </span>b.setName(<span class="hljs-string">&#x27;球B&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.kick()<br>my name <span class="hljs-keyword">is</span> 球A, fuck, who kick me<span class="hljs-comment">#@#</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b.kick()<br>my name <span class="hljs-keyword">is</span> 球B, fuck, who kick me<span class="hljs-comment">#@#</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="Python的魔法方法"><a href="#Python的魔法方法" class="headerlink" title="Python的魔法方法"></a>Python的魔法方法</h3><p>魔法方法都是被双下划线包围</p><ul><li><p><code>__init__(self, param1, param2...)</code> </p><p>对象创建完后，在初始化实例对象时，该魔法方法会自动调用。可以根据需要自行改写该方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ball</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br><span class="hljs-meta">... </span>            self.name = name<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">kick</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;my name is %s, fuck, who kick me#@#&#x27;</span> % self.name)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = Ball(<span class="hljs-string">&#x27;土豆&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.kick()<br>my name <span class="hljs-keyword">is</span> 土豆, fuck, who kick me<span class="hljs-comment">#@#</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="公有和私有"><a href="#公有和私有" class="headerlink" title="公有和私有"></a>公有和私有</h3><ul><li><p>公有：</p><ul><li><p>能直接被访问的属性和方法都是公有的。</p></li><li><p>默认对象的属性都是公有的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br><span class="hljs-meta">... </span>    name = <span class="hljs-string">&#x27;FishC&#x27;</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>p = Person()<br><span class="hljs-meta">&gt;&gt;&gt; </span>p.name<br><span class="hljs-string">&#x27;FishC&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>私有：</p><ul><li><p>name mangling - 名字改编&#x2F;名字重整</p></li><li><p>在python中定义私有变量只需要在变量名或者函数名前加上“__” 两个下划线，那么这个函数或者变量就成为私有的了</p></li><li><p>要访问私有变量，可以定义一个方法，从内部self 访问隐藏的变量并返回</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>p = Person()<br><span class="hljs-meta">&gt;&gt;&gt; </span>p.__name<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;Person&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;__name&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>p.name<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;Person&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;name&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br><span class="hljs-meta">... </span>    __name = <span class="hljs-string">&#x27;FishC&#x27;</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> self.__name<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>p = Person()<br><span class="hljs-meta">&gt;&gt;&gt; </span>p.__name<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;Person&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;__name&#x27;</span><br>  <br>  <br><span class="hljs-meta">&gt;&gt;&gt; </span>p.getName()<br><span class="hljs-string">&#x27;FishC&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>name mangling的背后原理是，python把双下划线的变量改成了<code>_类名__变量名</code> ，所以可以通过这种格式访问私有变量。所以python 类的私有变量其实是”伪私有”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>p._Person__name<br><span class="hljs-string">&#x27;FishC&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-30"><a href="#课后作业-30" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-30"><a href="#Quiz-30" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>以下代码体现了面向对象编程的什么特征？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;FishC.com&quot;</span>.count(<span class="hljs-string">&#x27;o&#x27;</span>)<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>].count(<span class="hljs-number">1</span>)<br><span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">18</span>).count(<span class="hljs-number">1</span>)<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li></ol><p>​多态</p><ol start="2"><li><p>当程序员不想把同一段代码写几次，他们发明了函数解决了这种情况。当程序员已经有了一个类，而又想建立一个非常相近的新类，他们会怎么做呢？</p><p>可以采用集成的方法。 <code>class Newclass(Oldclass)</code></p></li><li><p>self参数的作用是什么？</p><p>当一个对象的方法被调用的时候，对象会将自身作为第一个参数传给self参数，接收到self的时候，python就知道是哪个对象在调用这个方法了</p></li><li><p>如果我们不希望对象的属性或方法被外部直接引用，我们可以怎么做？</p><p>在变量名或者函数名前加上“__” 两个下划线，那么这个函数或者变量就成为私有的了</p></li><li><p>类在实例化后哪个方法会被自动调用？</p><p><code>__init__(self, param1, param2...)</code> 我们称之为魔法方法。你可以重写这个方法，为对象定制初始化方案</p></li><li><p>请解释下边代码错误的原因： </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>        name = <span class="hljs-string">&#x27;FishC&#x27;</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">myFun</span>(<span class="hljs-params">self</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC!&quot;</span>)<br>                <br><span class="hljs-meta">&gt;&gt;&gt; </span>MyClass.name<br><span class="hljs-string">&#x27;FishC&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>MyClass.myFun()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#6&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    MyClass.myFun()<br>TypeError: myFun() missing <span class="hljs-number">1</span> required positional argument: <span class="hljs-string">&#x27;self&#x27;</span><br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure><p>首先你要明白类、类对象、实例对象是三个不同的名词<br>我们常说的类指的是类定义，由于“Python无处不对象”，所以当类定义完之后，自然就是类对象。在这个时候，你可以对类的属性（变量）进行直接访问（MyClass.name）。<br>一个类可以实例化出无数的对象（实例对象），Python 为了区分是哪个实例对象调用了方法，<strong>于是要求方法必须绑定（通过 self 参数）才能调用</strong>。而未实例化的类对象直接调用方法，因为缺少 self 参数，所以就会报错。</p></li></ol><h3 id="Practice-26"><a href="#Practice-26" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>按照以下要求定义一个游乐园门票的类，并尝试计算2个成人+1个小孩平日票价。</p><ul><li>平日票价100元</li><li>周末票价为平日的120%</li><li>儿童半票</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, day, adult_count, child_count</span>):<br>        self.day = day<br>        self.adult_count = adult_count<br>        self.child_count = child_count<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">price</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.day == <span class="hljs-string">&quot;WD&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;总票价为：&#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">100</span> * self.adult_count + <span class="hljs-number">50</span> * self.child_count))<br>        <span class="hljs-keyword">elif</span> self.day == <span class="hljs-string">&quot;WED&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;总票价为：&#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>((<span class="hljs-number">100</span> * self.adult_count + <span class="hljs-number">50</span> * self.child_count) * <span class="hljs-number">1.2</span>))<br><br><br>ticket1 = Ticket(<span class="hljs-string">&#x27;WD&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)<br>ticket1.price()<br></code></pre></td></tr></table></figure></li><li><p>游戏编程：按以下要求定义一个乌龟类和鱼类并尝试编写游戏。（初学者不一定可以完整实现，但请务必先自己动手，你会从中学习到很多知识的^_^）</p><ul><li>假设游戏场景为范围（x, y）为0&lt;&#x3D;x&lt;&#x3D;10，0&lt;&#x3D;y&lt;&#x3D;10</li><li>游戏生成1只乌龟和10条鱼</li><li>它们的移动方向均随机</li><li>乌龟的最大移动能力是2（Ta可以随机选择1还是2移动），鱼儿的最大移动能力是1</li><li>当移动到场景边缘，自动向反方向移动</li><li>乌龟初始化体力为100（上限）</li><li>乌龟每移动一次，体力消耗1</li><li>当乌龟和鱼坐标重叠，乌龟吃掉鱼，乌龟体力增加20</li><li>鱼暂不计算体力</li><li>当乌龟体力值为0（挂掉）或者鱼儿的数量为0游戏结束</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 游戏编程：按以下要求定义一个乌龟类和鱼类并尝试编写游戏。（初学者不一定可以完整实现，但请务必先自己动手，你会从中学习到很多知识的^_^）</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># - 假设游戏场景为范围（x, y）为0&lt;=x&lt;=10，0&lt;=y&lt;=10</span><br><span class="hljs-comment"># - 游戏生成1只乌龟和10条鱼</span><br><span class="hljs-comment"># - 它们的移动方向均随机</span><br><span class="hljs-comment"># - 乌龟的最大移动能力是2（Ta可以随机选择1还是2移动），鱼儿的最大移动能力是1</span><br><span class="hljs-comment"># - 当移动到场景边缘，自动向反方向移动</span><br><span class="hljs-comment"># - 乌龟初始化体力为100（上限）</span><br><span class="hljs-comment"># - 乌龟每移动一次，体力消耗1</span><br><span class="hljs-comment"># - 当乌龟和鱼坐标重叠，乌龟吃掉鱼，乌龟体力增加20</span><br><span class="hljs-comment"># - 鱼暂不计算体力</span><br><span class="hljs-comment"># - 当乌龟体力值为0（挂掉）或者鱼儿的数量为0, 游戏结束</span><br><br><span class="hljs-keyword">import</span> random <span class="hljs-keyword">as</span> r<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Turtle</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, energy</span>):<br>        self.init_position = <span class="hljs-literal">None</span><br>        self.XY_list = [<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>]<br>        self.direction_list = [<span class="hljs-string">&#x27;forward&#x27;</span>, <span class="hljs-string">&#x27;backward&#x27;</span>]<br>        self.message = <span class="hljs-string">&#x27;&#x27;</span><br>        self.move_param = <span class="hljs-literal">None</span><br>        self.move_points = <span class="hljs-literal">None</span><br>        self.energy = energy<br>        self.max_energy = <span class="hljs-number">100</span><br>        self.position = &#123;self.XY_list[<span class="hljs-number">0</span>]: r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>), self.XY_list[<span class="hljs-number">1</span>]: r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)&#125;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Turtle initial position is [&#123;:d&#125;, &#123;:d&#125;], energy: &#123;:d&#125;&#x27;</span>.<br>              <span class="hljs-built_in">format</span>(self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>], self.energy))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">self, init_position</span>):<br>        self.init_position = init_position<br>        self.move_param = (r.choice(self.XY_list), r.choice(self.direction_list))<br>        self.move_points = r.randint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">if</span> self.move_param[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;forward&#x27;</span>:<br>            self.position[self.move_param[<span class="hljs-number">0</span>]] = self.init_position[self.move_param[<span class="hljs-number">0</span>]] + self.move_points<br>            <span class="hljs-keyword">if</span> self.position[self.move_param[<span class="hljs-number">0</span>]] &gt; <span class="hljs-number">10</span>:<br>                self.position[self.move_param[<span class="hljs-number">0</span>]] = <span class="hljs-number">20</span> - self.position[self.move_param[<span class="hljs-number">0</span>]]<br>                self.message = <span class="hljs-string">&#x27;触顶反弹&#x27;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;乌龟沿着&#123;:s&#125;轴 前进了&#123;:d&#125;步，&#123;:s&#125;！！！！！！now new position is [&#123;:d&#125;, &#123;:d&#125;], energy: &#123;:d&#125;&#x27;</span><br>                  .<span class="hljs-built_in">format</span>(self.move_param[<span class="hljs-number">0</span>], self.move_points, self.message, self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>], self.energy-<span class="hljs-number">1</span>))<br>        <span class="hljs-keyword">else</span>:<br>            self.position[self.move_param[<span class="hljs-number">0</span>]] = self.init_position[self.move_param[<span class="hljs-number">0</span>]] - self.move_points<br>            <span class="hljs-keyword">if</span> self.position[self.move_param[<span class="hljs-number">0</span>]] &lt; <span class="hljs-number">0</span>:<br>                self.position[self.move_param[<span class="hljs-number">0</span>]] = <span class="hljs-number">0</span> - self.position[self.move_param[<span class="hljs-number">0</span>]]<br>                self.message = <span class="hljs-string">&#x27;触底反弹&#x27;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;乌龟沿着&#123;:s&#125;轴 后退了&#123;:d&#125;步，&#123;:s&#125;！！！！！！now new position is [&#123;:d&#125;, &#123;:d&#125;], energy: &#123;:d&#125;&#x27;</span><br>                  .<span class="hljs-built_in">format</span>(self.move_param[<span class="hljs-number">0</span>], self.move_points, self.message, self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>], self.energy-<span class="hljs-number">1</span>))<br><br>        <span class="hljs-comment"># 乌龟每移动一步，能量减少1</span><br>        self.energy -= <span class="hljs-number">1</span><br><br>        <span class="hljs-comment"># print(&#x27;Turtle moved once, now new position is [&#123;:d&#125;, &#123;:d&#125;, energy: &#123;:d&#125;]&#x27;</span><br>        <span class="hljs-comment"># .format(self.position[&#x27;X&#x27;], self.position[&#x27;Y&#x27;], self.energy))</span><br><br>        <span class="hljs-keyword">return</span> self.position<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.init_position = <span class="hljs-literal">None</span><br>        self.XY_list = [<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>]<br>        self.direction_list = [<span class="hljs-string">&#x27;forward&#x27;</span>, <span class="hljs-string">&#x27;backward&#x27;</span>]<br>        self.message = <span class="hljs-string">&#x27;&#x27;</span><br>        self.position = &#123;self.XY_list[<span class="hljs-number">0</span>]: r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>), self.XY_list[<span class="hljs-number">1</span>]: r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)&#125;<br>        self.move_param = <span class="hljs-literal">None</span><br>        self.move_points = <span class="hljs-number">1</span><br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Fish initial position is [&#123;:d&#125;, &#123;:d&#125;]&#x27;</span>.<span class="hljs-built_in">format</span>(self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>]))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">self, init_position</span>):<br>        self.init_position = init_position<br>        self.move_param = (r.choice(self.XY_list), r.choice(self.direction_list))<br>        <span class="hljs-keyword">if</span> self.move_param[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;forward&#x27;</span>:<br>            self.position[self.move_param[<span class="hljs-number">0</span>]] = self.init_position[self.move_param[<span class="hljs-number">0</span>]] + self.move_points<br>            <span class="hljs-keyword">if</span> self.position[self.move_param[<span class="hljs-number">0</span>]] &gt; <span class="hljs-number">10</span>:<br>                self.position[self.move_param[<span class="hljs-number">0</span>]] = <span class="hljs-number">20</span> - self.position[self.move_param[<span class="hljs-number">0</span>]]<br>                self.message = <span class="hljs-string">&#x27;触顶反弹&#x27;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;小鱼沿着&#123;:s&#125;轴 前进了 &#123;:d&#125;步，&#123;:s&#125;！！！！！！now new position is [&#123;:d&#125;, &#123;:d&#125;]&#x27;</span><br>                  .<span class="hljs-built_in">format</span>(self.move_param[<span class="hljs-number">0</span>], self.move_points, self.message, self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>]))<br>        <span class="hljs-keyword">else</span>:<br>            self.position[self.move_param[<span class="hljs-number">0</span>]] = self.init_position[self.move_param[<span class="hljs-number">0</span>]] - self.move_points<br>            <span class="hljs-keyword">if</span> self.position[self.move_param[<span class="hljs-number">0</span>]] &lt; <span class="hljs-number">0</span>:<br>                self.position[self.move_param[<span class="hljs-number">0</span>]] = <span class="hljs-number">0</span> - self.position[self.move_param[<span class="hljs-number">0</span>]]<br>                self.message = <span class="hljs-string">&#x27;触底反弹&#x27;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;小鱼沿着&#123;:s&#125;轴 后退了 &#123;:d&#125;步，&#123;:s&#125;！！！！！！now new position is [&#123;:d&#125;, &#123;:d&#125;]&#x27;</span><br>                  .<span class="hljs-built_in">format</span>(self.move_param[<span class="hljs-number">0</span>], self.move_points, self.message, self.position[<span class="hljs-string">&#x27;X&#x27;</span>], self.position[<span class="hljs-string">&#x27;Y&#x27;</span>]))<br><br>        <span class="hljs-comment"># print(&#x27;Fish moved once, now new position is [&#123;:d&#125;, &#123;:d&#125;]&#x27;.format(self.position[&#x27;X&#x27;], self.position[&#x27;Y&#x27;]))</span><br><br>        <span class="hljs-keyword">return</span> self.position<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;初始化游戏！！！&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;生成1只乌龟和10条小鱼&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br><span class="hljs-comment"># 生成1只乌龟和位置</span><br>turtle = Turtle(<span class="hljs-number">100</span>)<br>turtle_position = turtle.position<br><br><span class="hljs-comment"># 鱼对象列表</span><br>fish = []<br><br><span class="hljs-comment"># key=鱼对象，value=鱼位置</span><br>fish_position = &#123;&#125;<br><br><span class="hljs-comment"># 生成10条小鱼和位置，分别放在列表和字典中</span><br>createVar = <span class="hljs-built_in">locals</span>()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    createVar[<span class="hljs-string">&#x27;fish&#x27;</span>+<span class="hljs-built_in">str</span>(i)] = Fish()<br>    fish.append(createVar[<span class="hljs-string">&#x27;fish&#x27;</span> + <span class="hljs-built_in">str</span>(i)])<br>    fish_position.setdefault(fish[i], fish[i].position)<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-number">3</span> * <span class="hljs-string">&#x27;\n&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;游戏开始！！！&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br><span class="hljs-comment"># 初始化鱼的数量</span><br>fish_count = <span class="hljs-built_in">len</span>(fish_position)<br><br>init_round = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">while</span> fish_count &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> turtle.energy &gt; <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Game on-going, Round: [&#123;:&#125;]&#x27;</span>.<span class="hljs-built_in">format</span>(init_round))<br>    turtle_position = turtle.move(turtle_position)<br>    <span class="hljs-keyword">for</span> each_fish <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(fish_position.keys()):<br>        fish_position[each_fish] = each_fish.move(fish_position[each_fish])<br>        <span class="hljs-comment"># 当乌龟和鱼坐标重叠, 乌龟吃掉鱼,乌龟体力增加20</span><br>        <span class="hljs-keyword">if</span> fish_position[each_fish] == turtle_position:<br>            fish_position.pop(each_fish)<br>            fish_count = <span class="hljs-built_in">len</span>(fish_position)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;一条鱼在位置 [&#123;:d&#125;, &#123;:d&#125;] 被吃掉！还剩&#123;:&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(turtle_position[<span class="hljs-string">&#x27;X&#x27;</span>], turtle_position[<span class="hljs-string">&#x27;Y&#x27;</span>], fish_count))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;------------------------------&#x27;</span>)<br><br>            turtle.energy += <span class="hljs-number">20</span><br>            <span class="hljs-keyword">if</span> turtle.energy &gt;= turtle.max_energy:<br>                turtle.energy = turtle.max_energy<br>    init_round += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-keyword">if</span> fish_count == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Game Over, Turtle win!!&#x27;</span>)<br><span class="hljs-keyword">elif</span> turtle.energy == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Game Over, Fish win!!&#x27;</span>)<br><br></code></pre></td></tr></table></figure></li></ol><h1 id="038-类和对象：继承"><a href="#038-类和对象：继承" class="headerlink" title="038. 类和对象：继承"></a>038. 类和对象：继承</h1><h2 id="知识点-33"><a href="#知识点-33" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>继承语法：<code>class DerivedClassName(BaseClassName):</code>，被继承的类叫做父类，基类或超类，继承者叫做子类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在调用父类的方法。。&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(<span class="hljs-title class_ inherited__">Parent</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>p = Parent()<br><span class="hljs-meta">&gt;&gt;&gt; </span>p.hello()<br>正在调用父类的方法。。<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = Child()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.hello()<br>正在调用父类的方法。<br></code></pre></td></tr></table></figure></li><li><p>如果子类中定了和父类相同的属性或者方法，则会自动覆盖父类对应的属性或方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>c = Child()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.hello()<br>正在调用父类的方法。。<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(<span class="hljs-title class_ inherited__">Parent</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在调用子类的方法。。&#x27;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = Child()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.hello()<br>正在调用子类的方法。<br></code></pre></td></tr></table></figure></li><li><p>一个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random <span class="hljs-keyword">as</span> r<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.x = r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)<br>        self.y = r.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">self</span>):<br>        self.x -= <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我现在的位置是：&#x27;</span>, self.x, self.y)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GlodFish</span>(<span class="hljs-title class_ inherited__">Fish</span>):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Salmon</span>(<span class="hljs-title class_ inherited__">Fish</span>):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shark</span>(<span class="hljs-title class_ inherited__">Fish</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.hungary = <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.hungary:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我好饿，吃，吃，吃&#x27;</span>)<br>            self.hungary = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我已经吃饱啦！&#x27;</span>)<br></code></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>goldfish = GoldFish()<br><span class="hljs-meta">&gt;&gt;&gt; </span>goldfish.move()<br>我现在的位置是： <span class="hljs-number">9</span> <span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>goldfish.move()<br>我现在的位置是： <span class="hljs-number">8</span> <span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>goldfish.move()<br>我现在的位置是： <span class="hljs-number">7</span> <span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>goldfish.move()<br>我现在的位置是： <span class="hljs-number">6</span> <span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>shark = Shark()<br><span class="hljs-meta">&gt;&gt;&gt; </span>shark.eat()<br>我好饿，吃，吃，吃<br><span class="hljs-meta">&gt;&gt;&gt; </span>shark.eat()<br>我已经吃饱啦！<br><span class="hljs-meta">&gt;&gt;&gt; </span>shark.move()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;/Users/felix_yang/PycharmProjects/learningpython/38/example_01.py&quot;</span>, line <span class="hljs-number">10</span>, <span class="hljs-keyword">in</span> move<br>    self.x -= <span class="hljs-number">1</span><br>AttributeError: <span class="hljs-string">&#x27;Shark&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;x&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><br></code></pre></td></tr></table></figure><p>上述例子中，shark 对象调用父类的move 方法时报错，是因为shark字类中重新定义了 <code>__init__(self)</code>方法，导致父类中的 <code>__init__(self)</code>方法被覆盖，造成找不到x 属性</p><p>要解决这个问题可以有如下两种方法：</p><ul><li><p>调用未绑定的父类方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shark</span>(<span class="hljs-title class_ inherited__">Fish</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>      <span class="hljs-comment"># 调用未绑定的父类方法</span><br>        Fish.__init__(self)<br>        self.hungary = <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.hungary:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我好饿，吃，吃，吃&#x27;</span>)<br>            self.hungary = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我已经吃饱啦！&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>super()</p><p>推荐使用，super 函数会自动找到基类的方法，不用给定任何基类的名字，并且传入self 参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shark</span>(<span class="hljs-title class_ inherited__">Fish</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 使用super函数</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.hungary = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></li><li><p>输出</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">shark = Shark()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">shark.move()</span><br>我现在的位置是： 3 9<br></code></pre></td></tr></table></figure></li></ul></li><li><p>多重继承</p><p>同时继承多个基类的属性和方法：<code>class DerivedClassName(Base1, Base2, Base3)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base1</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo1</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我代表基类 base1&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base2</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo2</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我代表基类 base2&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(Base1, Base2):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>child = Child()<br><span class="hljs-meta">&gt;&gt;&gt; </span>child.foo1<br>&lt;bound method Base1.foo1 of &lt;example_02.Child <span class="hljs-built_in">object</span> at <span class="hljs-number">0x10a5a98e0</span>&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>child.foo1()<br>我代表基类 base1<br><span class="hljs-meta">&gt;&gt;&gt; </span>child.foo2()<br>我代表基类 base2<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-31"><a href="#课后作业-31" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-31"><a href="#Quiz-31" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>继承机制给程序猿带来最明显的好处是？</p><p>不需要写多个类包含相同的属性和方法</p></li><li><p>如果按以下方式重写魔法方法 __ init __，结果会怎样？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br><br></code></pre></td></tr></table></figure><p>实例化对象时会有如下错误，魔法方法应该返回none，不能return 其他的值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>  File &quot;&lt;stdin&gt;&quot;, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">module</span><span class="hljs-operator">&gt;</span><br>TypeError: __init__() should <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>, <span class="hljs-keyword">not</span> <span class="hljs-string">&#x27;str&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>当子类定义了与相同名字的属性或方法时，Python 是否会自动删除父类的相关属性或方法？</p><p>不会，只会覆盖，当子类对象调用属性和方法时，会调用子类的属性和方法而已，而父类的属性和方法并未删除</p></li><li><p>假设已经有鸟类的定义，现在我要定义企鹅类继承于鸟类，但我们都知道企鹅是不会飞的，我们应该如何屏蔽父类（鸟类）中飞的方法？</p><p>重写一个相同的飞的方法，例如将函数体内容写 pass，这样调用 fly 方法就没有任何反应了。</p></li><li><p>super 函数有什么“超级”的地方？</p><p>super 函数超级之处在于你不需要明确给出任何基类的名字，它会自动帮您找出所有基类以及对应的方法。由于你不用给出基类的名字，这就意味着你如果需要改变了类继承关系，你只要改变 class 语句里的父类即可，而不必在大量代码中去修改所有被继承的方法</p></li><li><p>多重继承使用不当会导致重复调用（也叫钻石继承、菱形继承）的问题，请分析以下代码在实际编程中有可能导致什么问题？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入A…&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开A…&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入B…&quot;</span>)<br>        A.__init__(self)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开B…&quot;</span>)<br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入C…&quot;</span>)<br>        A.__init__(self)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开C…&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span>(B, C):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入D…&quot;</span>)<br>        B.__init__(self)<br>        C.__init__(self)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开D…&quot;</span>)<br><br><br></code></pre></td></tr></table></figure><p>子类D重复调用了基类A的魔法方法：init</p></li><li><p>如何解决上一题中出现的问题？</p><p>采用super() 方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入A…&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开A…&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入B…&quot;</span>)<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开B…&quot;</span>)<br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入C…&quot;</span>)<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开C…&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span>(B, C):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入D…&quot;</span>)<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;离开D…&quot;</span>)<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-27"><a href="#Practice-27" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>定义一个点（Point）类和直线（Line）类，使用 getLen 方法可以获得直线的长度。</p><p>提示：</p><ul><li>设点 A(X1,Y1)、点 B(X2,Y2)，则两点构成的直线长度 |AB| &#x3D; √((x1-x2)2+(y1-y2)2)</li><li>Python 中计算开根号可使用 math 模块中的 sqrt 函数</li><li>直线需有两点构成，因此初始化时需有两个点（Point）对象作为参数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math <span class="hljs-keyword">as</span> m<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>        self.x = x<br>        self.y = y<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Line</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, point_a, point_b</span>):<br>        self.point_a = point_a<br>        self.point_b = point_b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> m.sqrt((self.point_a.x-self.point_b.x)**<span class="hljs-number">2</span> + (self.point_a.y-self.point_b.y)**<span class="hljs-number">2</span>)<br><br><br>point_a = Point(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>point_b = Point(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br>line = Line(point_a, point_b)<br><span class="hljs-built_in">print</span>(line.getLen())<br></code></pre></td></tr></table></figure></li><li><p>展示一个你的作品：你已经掌握了 Python 大部分的基础知识，要开始学会自食其力了！请花一个星期做一个你能做出来的最好的作品（可以是游戏、应用软件、脚本），使用上你学过的任何东西（类，函数，字典，列表……）来改进你的程序。</p></li></ol><h1 id="039-类和对象：拾遗"><a href="#039-类和对象：拾遗" class="headerlink" title="039. 类和对象：拾遗"></a>039. 类和对象：拾遗</h1><h2 id="知识点-34"><a href="#知识点-34" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>组合： 把类的实例化放到一个新类里面，这样也就不需要继承了。解决了没有继承关系，也需要组合使用的问题</p><p>python的继承很有用，但容易把代码复杂化以及依赖隐含继承。因此，可以用组合代替。直接在类定义中把需要的类放进去实例化就可以了</p><p>那什么时候用组合，什么时候用继承呢？</p><ul><li>组合：“有一个”，例如，水池里有一个乌龟，天上有一个鸟。</li><li>继承：“是一个”，例如，青瓜是瓜，女人是人，鲨鱼是鱼。</li></ul><p>例子：现在要定一个类，叫水池，水池里要有乌龟和鱼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Turtle</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.number = x<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.number = x<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pool</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>        self.turtle = Turtle(x)<br>        self.fish = Fish(y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_num</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;水池里总共由%d只乌龟，%d只鱼&#x27;</span> %(self.turtle.number, self.fish.number))<br><br><br>p1 = Pool(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>p1.print_num()<br></code></pre></td></tr></table></figure></li><li><p>类，类对象和实例对象</p><p><img src="http://img.5iqiqu.com/images11/1f/1f387407ff014d1267ec2361780beb32.png" alt="在这里插入图片描述"></p><ul><li><p>当类定义完的时候，类定义就变成了类对象，可以直接通过”类名.属性”或者”类名.方法名()”引用属性和方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    count = <span class="hljs-number">0</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.count += <span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.count<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>C.count<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>C.count += <span class="hljs-number">100</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a.count<br><span class="hljs-number">100</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b.count<br><span class="hljs-number">100</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.count<br><span class="hljs-number">10</span><br><br></code></pre></td></tr></table></figure></li><li><p>如果属性和名字和方法相同，属性会把方法覆盖掉</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self</span>):   <span class="hljs-comment">#定义x方法</span><br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;X-man&quot;</span>)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x()              <span class="hljs-comment">#调用C类的x方法</span><br>X-man<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">1</span>            <span class="hljs-comment">#此时给实例对象c定义一个x属性并赋值1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x                <span class="hljs-comment">#调用c的x属性是正常的</span><br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x()              <span class="hljs-comment">#但此时再调用x方法就不可以了，因为重名的x属性覆盖了x方法</span><br>Traceback (most recent call last):<br>File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: <span class="hljs-string">&#x27;int&#x27;</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">callable</span><br>  <br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x<br>&lt;bound method C.x of &lt;__main__.C <span class="hljs-built_in">object</span> at <span class="hljs-number">0x109d21a00</span>&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x()<br>X-man<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>什么是绑定？</p><p>python严格要求方法需要有实例才能被调用，这种限制就是绑定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">printB</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;BB&quot;</span>)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>B.printB()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: printB() missing <span class="hljs-number">1</span> required positional argument: <span class="hljs-string">&#x27;self&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = B()<br><span class="hljs-meta">&gt;&gt;&gt; </span>b.printB()<br>BB<br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-32"><a href="#课后作业-32" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-32"><a href="#Quiz-32" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>什么是组合（组成）？</p><p>继承机制很有用，但容易把代码复杂化以及依赖隐含继承。因此，经常的时候，我们可以使用组合来代替。在Python里组合其实很简单，直接在类定义中把需要的类放进去实例化就可以了。</p></li><li><p>什么时候用组合，什么时候用继承？</p><p>根据实际应用场景确定。简单的说，组合用于“有一个”的场景中，继承用于“是一个”的场景中。例如，水池里有一个乌龟，天上有一个鸟，地上有一个小甲鱼，这些适合使用组合。青瓜是瓜，女人是人，鲨鱼是鱼，这些就应该使用继承啦。</p></li><li><p>类对象是在什么时候产生？</p><p>当你这个类 定义完的时候，类定义(类)就变成类对象，可以直接通过“类名.属性”或者“类名.方法名()”引用或使用相关的属性或方法。</p></li><li><p>如果对象的属性跟方法名字相同，会怎样？</p><p>如果对象的属性跟方法名相同，属性会覆盖方法。</p></li><li><p>请问以下类定义中哪些是类属性，哪些是实例属性？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>        num = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                self.x = <span class="hljs-number">4</span><br>                self.y = <span class="hljs-number">5</span><br>                C.count = <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p><em><strong>num 和 count 是类属性（静态变量）-&gt;(类被删除了仍然存在)，x 和 y 是实例属性-&gt;(实例变量删除后不存在)。大多数情况下</strong></em>，你应该考虑使用实例属性，而不是类属性（类属性通常仅用来跟踪与类相关的值）</p></li><li><p>请问以下代码中，bb 对象为什么调用 printBB() 方法失败？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BB</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">printBB</span>():<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;no zuo no die&quot;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>bb = BB()<br><span class="hljs-meta">&gt;&gt;&gt; </span>bb.printBB()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#8&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    bb.printBB()<br>TypeError: printBB() takes <span class="hljs-number">0</span> positional arguments but <span class="hljs-number">1</span> was given<br>  <br></code></pre></td></tr></table></figure><p>因为 Python 严格要求方法需要有实例才能被调用，这种限制其实就是 Python 所谓的绑定概念。 (任意一个实例对象调用函数都会传入自己作为参数 当然是python帮我们传入 我们不用写出来)所以 Python 会自动把 bb 对象作为第一个参数传入，所以才会出现 TypeError：“需要 0 个参数，但实际传入了 1 个参数“。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BB</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">printBB</span>(<span class="hljs-params">self</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;no zuo no die&quot;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>bb = BB()<br><span class="hljs-meta">&gt;&gt;&gt; </span>bb.printBB()<br>no zuo no die<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-28"><a href="#Practice-28" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>在类中定义一个变量，用来追踪有多少个实例被创建; </p><p>实例化一个对象，变量+1；销毁一个对象，变量-1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 在类中定义一个变量，用来追踪有多少个实例被创建;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 实例化一个对象，变量+1；销毁一个对象，变量-1</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InstanceCount</span>:<br>    count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        InstanceCount.count += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        InstanceCount.count -= <span class="hljs-number">1</span><br><br><br>instance1 = InstanceCount()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;目前共计有%d个实例被创建&#x27;</span> % InstanceCount.count)<br>instance2 = InstanceCount()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;目前共计有%d个实例被创建&#x27;</span> % InstanceCount.count)<br><span class="hljs-keyword">del</span> instance1<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;目前共计有%d个实例被创建&#x27;</span> % InstanceCount.count)<br><span class="hljs-keyword">del</span> instance2<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;目前共计有%d个实例被创建&#x27;</span> % InstanceCount.count)<br></code></pre></td></tr></table></figure></li><li><p>定义一个栈（Stack）类，用于模拟一种具有后进先出（LIFO）特性的数据结构</p><p><img src="http://img.5iqiqu.com/images11/52/524e01c5292d03e0ef6807153b1aa395.png" alt="在这里插入图片描述"></p><p>至少需要有以下方法：</p><ul><li><p>isEmpty():判断当前栈是否为空（返回True或Talse）</p></li><li><p>push():往栈的顶部压入一个数据项</p></li><li><p>pop():从栈顶弹出一个数据项（并在栈中删除）</p></li><li><p>top():显示当前栈顶的一个数据项</p></li><li><p>bottom():显示当前栈底的一个数据项</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.data = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.data) == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self, x</span>):<br>        self.data.append(x)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>):<br>        self.data.pop()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">top</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(self.data[-<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">except</span> IndexError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;no data in stack&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bottom</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(self.data[<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">except</span> IndexError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;no data in stack&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="040-类和对象：一些相关的BIF"><a href="#040-类和对象：一些相关的BIF" class="headerlink" title="040. 类和对象：一些相关的BIF"></a>040. 类和对象：一些相关的BIF</h1><h2 id="知识点-35"><a href="#知识点-35" class="headerlink" title="知识点"></a>知识点</h2><ul><li><code>issubclass(cls, class_or_tuple)</code>  判断子类</li></ul><blockquote><p>&gt;&gt;&gt; help(issubclass)</p><p>Help on built-in function issubclass in module builtins:</p><p><strong>issubclass</strong>(cls, class_or_tuple, &#x2F;)</p><p> Return whether ‘cls’ is a derived from another class or is the same class.</p><p> A tuple, as in <code>issubclass(x, (A, B, ...))</code>, may be given as the target to</p><p> check against. This is equivalent to &#96;&#96;issubclass(x, A) or issubclass(x, B)</p><p> or …&#96;&#96; etc.</p></blockquote><ul><li><p>一个类被认为是自身的子类</p></li><li><p>classinfo可以是类对象组成的元组，只要class是其中任何一个候选类的子类，则返回True</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(B, A)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(B, B)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(B, <span class="hljs-built_in">object</span>)   <span class="hljs-comment"># object 是所有类的默认基类</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(B, C)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure></li><li><p><code>isinstance(object, class_or_tuple)</code></p><blockquote><p>&gt;&gt;&gt; help(isinstance)</p><p>Help on built-in function isinstance in module builtins:</p><p><strong>isinstance</strong>(obj, class_or_tuple, &#x2F;)</p><p>  Return whether an object is an instance of a class or of a subclass thereof.</p><p>  A tuple, as in <code>isinstance(x, (A, B, ...))</code>, may be given as the target to</p><p>  check against. This is equivalent to &#96;&#96;isinstance(x, A) or isinstance(x, B)</p><p>  or …&#96;&#96; etc.</p></blockquote><ul><li><p>如果第一个参数不是对象，则永远返回False</p></li><li><p>如果第二个参数不是类或者由类对象组成的元组，会抛出一个TypeError异常</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b1 = B()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">isinstance</span>(b1, B)</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">isinstance</span>(b1, A)</span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">isinstance</span>(b1, C)</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">isinstance</span>(b1, (A, B, C))</span><br>True<br></code></pre></td></tr></table></figure></li></ul></li><li><p><code>hasattr(object, name)</code></p><ul><li>The arguments are an object and a string. The result is True if the string is the name of one of the object’s attributes, False if not. (This is implemented by calling getattr(object, name) and seeing whether it raises an AttributeError or not.)</li><li>作用就是测试一个对象里是否有指定的属性， 如果字符串是对象属性之一的命名，则返回True，否则False。</li><li>第一个参数(object)是对象，第二个参数(name)是属性名（属性的字符串名字）</li></ul><blockquote><p>&gt;&gt;&gt; help(hasattr)</p><p>Help on built-in function hasattr in module builtins:</p><p><strong>hasattr</strong>(obj, name, &#x2F;)</p><p> Return whether the object has an attribute with the given name.</p><p> This is done by calling getattr(obj, name) and catching AttributeError.</p></blockquote><ul><li><p>Attractive &#x3D; attribute: 属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x=<span class="hljs-number">0</span></span>):<br><span class="hljs-meta">... </span>            self.x = x<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c1 = C()<br>   <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hasattr</span>(c1, <span class="hljs-string">&#x27;x&#x27;</span>)   <span class="hljs-comment"># 注意此处x变量名需要加上引号变成字符串，不然会报错</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hasattr</span>(c1, x) <br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>NameError: name <span class="hljs-string">&#x27;x&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></li></ul></li><li><p><code>getattr(object, name[, default])</code></p><ul><li>返回对象指定的属性值，如果指定的属性不存在，则返回default（可选参数)的值；若没有设置default参数，则抛出ArttributeError异常。</li></ul><blockquote><p>&gt;&gt;&gt; help(getattr)</p><p>Help on built-in function getattr in module builtins:</p><p><strong>getattr</strong>(…)</p><p>  getattr(object, name[, default]) -&gt; value</p><p>  Get a named attribute from an object; getattr(x, ‘y’) is equivalent to x.y.</p><p>  When a default argument is given, it is returned when the attribute doesn’t</p><p>  exist; without it, an exception is raised in that case.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>)<br><br>Traceback (most recent call last):<br><br> File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br><br>AttributeError: <span class="hljs-string">&#x27;C&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;y&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;你所访问的属性不存在&#x27;</span>)<br><br><span class="hljs-string">&#x27;你所访问的属性不存在&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><code>setattr(obj, name, value)</code></p><ul><li>设置对象中指定属性的值，如果指定的属性不存在，则会新建属性并赋值</li></ul><blockquote><p>&gt;&gt;&gt; help(setattr)</p><p>Help on built-in function setattr in module builtins:</p><p><strong>setattr</strong>(obj, name, value, &#x2F;)</p><p>  Sets the named attribute on the given object to the specified value.</p><p>  setattr(x, ‘y’, v) is equivalent to &#96;&#96;x.y &#x3D; v’’</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">setattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;Turtle&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;你所访问的属性不存在&#x27;</span>)<br><span class="hljs-string">&#x27;Turtle&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><code>delattr(obj, name)</code> </p><ul><li>用于删除对象中指定的属性，如果属性不存在，则会抛出AttributeError异常</li></ul><blockquote><p>&gt;&gt;&gt; help(delattr)</p><p>Help on built-in function delattr in module builtins:</p><p><strong>delattr</strong>(obj, name, &#x2F;)</p><p>  Deletes the named attribute from the given object.</p><p>  delattr(x, ‘y’) is equivalent to &#96;&#96;del x.y’’</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">delattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;你所访问的属性不存在&#x27;</span>)<br><span class="hljs-string">&#x27;你所访问的属性不存在&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">delattr</span>(c1, <span class="hljs-string">&#x27;y&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: y<br></code></pre></td></tr></table></figure></li><li><p><code>property(fget=None, fset=None, fdel=None, doc=None)</code></p><ul><li>作用是通过属性来设置属性</li><li>第一个参数是获得属性的方法名，第二个参数是设置属性的方法名，第三个参数是删除属性的方法名</li></ul><p>property 的用处。当有需要对程序进行重构的时候，不需要告知用户每个方法的接口的修改，因为所有的属性都包括在x 里面提供给用户，用户看到的只是property x</p><blockquote><p>&gt;&gt;&gt; help(property)<br>Help on class property in module builtins:</p><p>class property(object)<br> |  property(fget&#x3D;None, fset&#x3D;None, fdel&#x3D;None, doc&#x3D;None)<br> |<br> |  Property attribute.<br> |<br> |    fget<br> |      function to be used for getting an attribute value<br> |    fset<br> |      function to be used for setting an attribute value<br> |    fdel<br> |      function to be used for del’ing an attribute<br> |    doc<br> |      docstring<br> |<br> |  Typical use is to define a managed attribute x:<br> |<br> |  class C(object):<br> |      def getx(self): return self._x<br> |      def setx(self, value): self._x &#x3D; value<br> |      def delx(self): del self._x<br> |      x &#x3D; property(getx, setx, delx, “I’m the ‘x’ property.”)<br> |<br> |  Decorators make defining new properties or modifying existing ones easy:<br> |<br> |  class C(object):<br> |      @property<br> |      def x(self):<br> |          “I am the ‘x’ property.”<br> |          return self._x<br> |      @x.setter<br> |      def x(self, value):<br> |          self._x &#x3D; value<br> |      @x.deleter<br> |      def x(self):<br> |          del self._x<br> |<br> |  Methods defined here:<br> |<br> |  <strong>delete</strong>(self, instance, &#x2F;)<br> |      Delete an attribute of instance.<br> |<br> |  <strong>get</strong>(self, instance, owner, &#x2F;)<br> |      Return an attribute of instance, which is of type owner.<br> |<br> |  <strong>getattribute</strong>(self, name, &#x2F;)<br> |      Return getattr(self, name).<br> |<br> |  <strong>init</strong>(self, &#x2F;, *args, **kwargs)<br> |      Initialize self.  See help(type(self)) for accurate signature.<br> |<br> |  <strong>set</strong>(self, instance, value, &#x2F;)<br> |      Set an attribute of instance to value.<br> |<br> |  deleter(…)<br> |      Descriptor to obtain a copy of the property with a different deleter.<br> |<br> |  getter(…)<br> |      Descriptor to obtain a copy of the property with a different getter.<br> |<br> |  setter(…)<br> |      Descriptor to obtain a copy of the property with a different setter.<br> |<br> |  ———————————————————————-<br> |  Static methods defined here:<br> |<br> |  <strong>new</strong>(*args, **kwargs) from builtins.type<br> |      Create and return a new object.  See help(type) for accurate signature.<br> |<br> |  ———————————————————————-<br> |  Data descriptors defined here:<br> |<br> |  <strong>isabstractmethod</strong><br> |<br> |  fdel<br> |<br> |  fget<br> |<br> |  fset</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size=<span class="hljs-number">10</span></span>):<br>        self.size = size<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getSize</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.size<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setSize</span>(<span class="hljs-params">self, value</span>):<br>        self.size = value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delSize</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">del</span> self.size<br><br>    x = <span class="hljs-built_in">property</span>(getSize(), setSize(), delSize())<br></code></pre></td></tr></table></figure><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c = C()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.getSize()</span><br>10<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.x </span><br>10<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.x = <span class="hljs-number">18</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.x</span><br>18<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.getSize()</span><br>18<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">del</span> c.x</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">c.x</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>  File &quot;C:\Users\felix_yang\PycharmProjects\learningpython\40\example_property.py&quot;, line 6, in getSize<br>    return self.size<br>AttributeError: &#x27;C&#x27; object has no attribute &#x27;size&#x27;<br></code></pre></td></tr></table></figure></li></ul><h2 id="扩展知识：Python-函数修饰符（装饰器）的使用"><a href="#扩展知识：Python-函数修饰符（装饰器）的使用" class="headerlink" title="扩展知识：Python 函数修饰符（装饰器）的使用"></a>扩展知识：<a href="https://fishc.com.cn/thread-51109-1-1.html">Python 函数修饰符（装饰器）的使用</a></h2><p><strong>1. 修饰符的来源</strong></p><p>借用一个博客上的一段叙述：修饰符是一个很著名的设计模式，经常被用于有切面需求的场景，较为经典的有插入日志、性能测试、事务处理等。</p><p>修饰符是解决这类问题的绝佳设计，有了修饰符，我们就可以抽离出大量函数中与函数功能本身无关的雷同代码并继续重用。</p><p>概括的讲，修饰符的作用就是为已经存在的对象添加额外的功能。</p><p>如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">timeslong</span>(<span class="hljs-params">func</span>):<br>    start = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time starting ! &quot;</span>)<br>    func()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time ending ! &quot;</span>)<br>    end = time.time()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;It&#x27;s used : %s.&quot;</span> % (end - start)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunc</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC.&quot;</span>)<br><br>t = timeslong(myfunc)<br><span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure><p>实现结果：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> starting ! <br>Hello FishC.<br>It<span class="hljs-symbol">&#x27;s</span> <span class="hljs-built_in">time</span> ending ! <br>It<span class="hljs-symbol">&#x27;s</span> used : <span class="hljs-number">0.02497720718383789</span>.<br></code></pre></td></tr></table></figure><p>上面的程序中，定义了一个函数（timeslong()），对一个对象（代码中是 myfunc()）的运行时间进行计算。</p><p>通常情况下，如果我们需要计算另外一个函数的运算时间，那么我们就需要修改 timeslong() 函数在调用时候的实参。</p><p>比如我需要统计 myfunc2 这个函数的运行时间，就需要调用 timeslong(myfunc2) 酱紫。</p><p>那么为了优化这种操作，Python 便提出了修饰符这个概念。</p><p>我们看下它是怎么实现的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">timeslong</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">call</span>():<br>        start = time.time()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time starting ! &quot;</span>)<br>        func()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time ending ! &quot;</span>)<br>        end = time.time()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;It&#x27;s used : %s.&quot;</span> % (end - start)<br>    <span class="hljs-keyword">return</span> call<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunc</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC.&quot;</span>)<br><br><span class="hljs-built_in">print</span>(myfunc())<br></code></pre></td></tr></table></figure><p>实现的结果是一样的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">It<span class="hljs-string">&#x27;s time starting ! </span><br><span class="hljs-string">Hello FishC.</span><br><span class="hljs-string">It&#x27;</span>s time ending ! <br>It<span class="hljs-string">&#x27;s used : 0.022337913513183594.</span><br></code></pre></td></tr></table></figure><p>但是大家有没有发现，这一次我们不需要再去调用 timeslong() 函数了。</p><p>如果我有多个函数需要统计，那么使用起修饰符来就更优雅了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">timeslong</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">call</span>():<br>        start = time.time()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time starting ! &quot;</span>)<br>        func()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time ending ! &quot;</span>)<br>        end = time.time()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;It&#x27;s used : %s.&quot;</span> % (end - start)<br>    <span class="hljs-keyword">return</span> call<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfuna</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World.&quot;</span>)<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunb</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello Python.&quot;</span>)<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunc</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC.&quot;</span>)<br><br><span class="hljs-built_in">print</span>(myfuna())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;========================================&quot;</span>)<br><span class="hljs-built_in">print</span>(myfunb())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;========================================&quot;</span>)<br><span class="hljs-built_in">print</span>(myfunc())<br></code></pre></td></tr></table></figure><p>实现结果：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">It&#x27;s time starting ! <br>Hello World.<br>It&#x27;s time ending ! <br><span class="hljs-section">It&#x27;s used : 0.023639202117919922.</span><br><span class="hljs-section">========================================</span><br>It&#x27;s time starting ! <br>Hello Python.<br>It&#x27;s time ending ! <br><span class="hljs-section">It&#x27;s used : 0.01770305633544922.</span><br><span class="hljs-section">========================================</span><br>It&#x27;s time starting ! <br>Hello FishC.<br>It&#x27;s time ending ! <br>It&#x27;s used : 0.014674186706542969.<br></code></pre></td></tr></table></figure><p>通过修饰符主要达到的目标是使得整个代码看起来更加美观，仅此而已。</p><p>另外，我们还可以进一步“优雅”，</p><p>那就是把它封装成类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">timeslong</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):<br>        self.func = func<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self</span>):<br>        start = time.time()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time starting ! &quot;</span>)<br>        self.func()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;It&#x27;s time ending ! &quot;</span>)<br>        end = time.time()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;It&#x27;s used : %s.&quot;</span> % (end - start)<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfuna</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World.&quot;</span>)<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunb</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello Python.&quot;</span>)<br><br><span class="hljs-meta">@timeslong</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunc</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC.&quot;</span>)<br><br><span class="hljs-built_in">print</span>(myfuna())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;========================================&quot;</span>)<br><span class="hljs-built_in">print</span>(myfunb())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;========================================&quot;</span>)<br><span class="hljs-built_in">print</span>(myfunc())<br></code></pre></td></tr></table></figure><p>实现的结果是一样的：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">It&#x27;s time starting ! <br>Hello World.<br>It&#x27;s time ending ! <br><span class="hljs-section">It&#x27;s used : 0.03470897674560547.</span><br><span class="hljs-section">========================================</span><br>It&#x27;s time starting ! <br>Hello Python.<br>It&#x27;s time ending ! <br><span class="hljs-section">It&#x27;s used : 0.01266622543334961.</span><br><span class="hljs-section">========================================</span><br>It&#x27;s time starting ! <br>Hello FishC.<br>It&#x27;s time ending ! <br>It&#x27;s used : 0.014008522033691406.<br></code></pre></td></tr></table></figure><p>其实呀，Python 也有内置的修饰符，它们分别是 staticmethod、classmethod 和 property，作用分别是把类中定义的实例方法变成静态方法、类方法和类属性。</p><p>简单地举个例子，如果我们将类这么写：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span>(<span class="hljs-title class_ inherited__">object</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_hello</span>(<span class="hljs-params">cls</span>):<br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC&quot;</span>)<br></code></pre></td></tr></table></figure><p>那么直接使用 类名.函数() 的方式调用就会报错：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>Hello.print_hello()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#2&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    Hello.print_hello()<br>TypeError: print_hello() missing <span class="hljs-number">1</span> required positional argument: <span class="hljs-string">&#x27;cls&#x27;</span><br></code></pre></td></tr></table></figure><p>但是，只需要在类里面的函数名上方加上一个 @classmethod 修饰符：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span>(<span class="hljs-title class_ inherited__">object</span>):<br><span class="hljs-meta">... </span>    @<span class="hljs-built_in">classmethod</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_hello</span>(<span class="hljs-params">cls</span>):<br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello FishC&quot;</span>)<br></code></pre></td></tr></table></figure><p>那么问题就迎刃而解了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>Hello.print_hello()<br>Hello FishC<br></code></pre></td></tr></table></figure><p>因为给 @classmethod 修饰过后，print_hello() 就变成了类方法，可以直接通过 Hello.print_hello() 调用，而无需绑定实例对象了。</p><h4 id="staticmethod和classmethod的区别"><a href="#staticmethod和classmethod的区别" class="headerlink" title="staticmethod和classmethod的区别"></a>staticmethod和classmethod的区别</h4><ul><li><p>@staticmethod不需要表示自身对象的self和自身类的cls参数，就跟使用函数一样。</p></li><li><p>@classmethod也不需要self参数，但第一个参数需要是表示自身类的cls参数。</p><p>如果在@staticmethod中要调用到这个类的一些属性方法，只能直接类名.属性名或类名.方法名。<br>而@classmethod因为持有cls参数，可以来调用类的属性，类的方法，实例化对象等，避免硬编码。<br>下面上代码。</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):  <br>    bar = <span class="hljs-number">1</span>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;foo&#x27;</span>  <br><br><span class="hljs-meta">    @staticmethod  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">static_foo</span>():  <br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;static_foo&#x27;</span>  <br>        <span class="hljs-built_in">print</span> A.bar  <br><br><span class="hljs-meta">    @classmethod  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">class_foo</span>(<span class="hljs-params">cls</span>):  <br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;class_foo&#x27;</span>  <br>        <span class="hljs-built_in">print</span> cls.bar  <br>        cls().foo()  <br><span class="hljs-comment">###执行  </span><br>A.static_foo()  <br>A.class_foo()  <br>   <span class="hljs-number">123456789101112131415161718123456789101112131415161718</span><br></code></pre></td></tr></table></figure><p>输出</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">static<span class="hljs-emphasis">_foo</span><br><span class="hljs-emphasis">1</span><br><span class="hljs-emphasis">class_</span>foo<br>1<br>foo<br></code></pre></td></tr></table></figure><h2 id="扩展知识：property-的详细使用方法"><a href="#扩展知识：property-的详细使用方法" class="headerlink" title="扩展知识：property 的详细使用方法"></a>扩展知识：<strong>property 的详细使用方法</strong></h2><p><strong>property(fget&#x3D;None, fset&#x3D;None, fdel&#x3D;None, doc&#x3D;None)</strong></p><p>俗话说条条大路通罗马，同样是完成一件事，Python 其实提供了好几个方式供你选择。</p><p>property() 是一个比较奇葩的BIF，它的作用把方法当作属性来访问，从而提供更加友好访问方式。</p><p><em>官方帮助文档代码：</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self._x = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getx</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self._x<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setx</span>(<span class="hljs-params">self, value</span>):<br>        self._x = value<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delx</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">del</span> self._x<br>    x = <span class="hljs-built_in">property</span>(getx, setx, delx, <span class="hljs-string">&quot;I&#x27;m the &#x27;x&#x27; property.&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>property() 返回一个可以设置属性的属性，当然如何设置属性还是需要我们人为来写代码。第一个参数是获得属性的方法名（例子中是 getx），第二个参数是设置属性的方法名（例子中是 setx），第三个参数是删除属性的方法名（例子中是 delx）。</p><p>property() 有什么作用呢？举个例子，在上边的例题中，我们为用户提供 setx 方法名来设置 _x 属性，提供 getx 方法名来获取属性。但是有一天你心血来潮，突然想对程序进行大改，可能你需要把 setx 和 getx 修改为 set_x 和 get_x，那你不得不修改用户调用的接口，这样子的体验就非常不好。</p><p>有了 property() 所有问题就迎刃而解了，因为像上边一样，我们为用户访问 _x 属性只提供了 x 属性。无论我们内部怎么改动，只需要相应的修改 property() 的参数，用户仍然只需要去操作 x 属性即可，对他们来说没有任何影响。</p><p><strong>使用属性修饰符创建描述符</strong></p><p>使用属性修饰符创建描述符，也可以实现同样的功能（【扩展阅读】<a href="http://bbs.fishc.com/thread-51109-1-2.html">Python 函数修饰符（装饰器）的使用</a>）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self._x = <span class="hljs-literal">None</span><br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;I&#x27;m the &#x27;x&#x27; property.&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self._x<br><br><span class="hljs-meta">    @x.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self, value</span>):<br>        self._x = value<br><br><span class="hljs-meta">    @x.deleter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">del</span> self._x<br><br></code></pre></td></tr></table></figure><p>注意：三个处理 _x 属性的方法名要相同（参数不同）</p><h2 id="课后作业-33"><a href="#课后作业-33" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-33"><a href="#Quiz-33" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>如何判断一个类是否为另一个类的子类？</p><p>issubclass(cls, class)</p></li><li><p>如何判断对象 a 是否为 类 A 的实例对象？</p><p>isinstance(a, A)</p></li><li><p>如何优雅地避免访问对象不存在的属性（不产生异常）？</p><p>使用<code>hasattr(object, name)</code> 查看是否有这个属性</p><p>使用 <code>getattr(object, name[, default])</code>， 设置defaul message</p></li><li><p>Python 的一些 BIF 很奇怪，但却十分有用。请问 property() 函数的作用是什么？</p><p>property() 函数允许编程人员轻松、有效地管理属性访问。</p></li><li><p>请补充以下代码，使程序可以正常运行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size=<span class="hljs-number">10</span></span>):<br>self.size = size<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getXSize</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> self.size<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">setXSize</span>(<span class="hljs-params">self, value</span>):<br>self.size = value<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delXSize</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">del</span> self.size<br><br><span class="hljs-comment"># 此处应该补充一句代码，程序才能正常运行</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">12</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br><span class="hljs-number">12</span><br></code></pre></td></tr></table></figure><p>答案：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">x = <span class="hljs-keyword">property</span><span class="hljs-title"></span>(getXSize, setXSize, delXSize)<br></code></pre></td></tr></table></figure></li><li><p>通过自学【扩展阅读】<a href="http://bbs.fishc.com/thread-51109-1-1.html">Python 函数修饰符（装饰器）的使用</a>，使用修饰符修改以下代码。<br>代码A：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">CodeA:</span><br><span class="hljs-symbol">    <span class="hljs-symbol">def</span></span> <span class="hljs-symbol">foo</span>():<br>        <span class="hljs-symbol">print</span>(&quot;调用静态方法 <span class="hljs-symbol">foo</span>()&quot;)<br><br>        # 将 <span class="hljs-symbol">foo</span>() 方法设置为静态方法<br>        <span class="hljs-symbol">foo</span> = <span class="hljs-symbol">staticmethod</span>(<span class="hljs-symbol">foo</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">CodeA:</span><br><span class="hljs-symbol"></span>@<span class="hljs-symbol">staticmethod</span><br>    <span class="hljs-symbol">def</span> <span class="hljs-symbol">foo</span>():<br>        <span class="hljs-symbol">print</span>(&quot;调用静态方法 <span class="hljs-symbol">foo</span>()&quot;)<br>        <br>        <br>        # 将 <span class="hljs-symbol">foo</span>() 方法设置为静态方法<br>        # <span class="hljs-symbol">foo</span> = <span class="hljs-symbol">staticmethod</span>(<span class="hljs-symbol">foo</span>)<br></code></pre></td></tr></table></figure><p>代码B：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">CodeB:</span><br><span class="hljs-symbol">    <span class="hljs-symbol">def</span></span> <span class="hljs-symbol">foo</span>(<span class="hljs-symbol">cls</span>):<br>        <span class="hljs-symbol">print</span>(&quot;调用类方法 <span class="hljs-symbol">foo</span>()&quot;)<br><br>        # 将 <span class="hljs-symbol">foo</span>() 方法设置为类方法<br>        <span class="hljs-symbol">foo</span> = <span class="hljs-symbol">classmethod</span>(<span class="hljs-symbol">foo</span>)<br></code></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">CodeB:</span><br><span class="hljs-symbol"></span>@<span class="hljs-symbol">classmethod</span><br>    <span class="hljs-symbol">def</span> <span class="hljs-symbol">foo</span>(<span class="hljs-symbol">cls</span>):<br>        <span class="hljs-symbol">print</span>(&quot;调用类方法 <span class="hljs-symbol">foo</span>()&quot;)<br><br>        # 将 <span class="hljs-symbol">foo</span>() 方法设置为类方法<br>        # <span class="hljs-symbol">foo</span> = <span class="hljs-symbol">classmethod</span>(<span class="hljs-symbol">foo</span>)<br></code></pre></td></tr></table></figure></li><li><p>你真的理解了修饰符的用法吗？那请你写出以下代码没有用上修饰符的等同形式：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><br><span class="hljs-variable">@something</span><br>def <span class="hljs-built_in">f</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I love FishC.com!&quot;</span>)<br>    <br>f = <span class="hljs-built_in">something</span>(f)<br><br></code></pre></td></tr></table></figure><p>返回的是函数的闭包</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br><br>def <span class="hljs-built_in">something1</span>(func):<br>    def <span class="hljs-built_in">call</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;---start----&#x27;</span>)<br>        start = time.<span class="hljs-built_in">perf_counter</span>()<br>        <span class="hljs-built_in">func</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-------end------&#x27;</span>)<br>        end = time.<span class="hljs-built_in">perf_counter</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;used: %s &#x27;</span> % (end - start))<br>    return call<br>@something1<br>def <span class="hljs-built_in">f</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I love FishC.com!&quot;</span>)<br>    <br><span class="hljs-built_in">f</span>()<br> <br><br></code></pre></td></tr></table></figure></li><li><p>通过自学【扩展阅读】<a href="http://bbs.fishc.com/thread-51106-1-1.html">property 的详细使用方法</a>，将第 4 题的代码修改为“使用属性修饰符创建描述符”的方式实现。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size=<span class="hljs-number">10</span></span>):<br>        self.size = size<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;I&#x27;m the &#x27;x&#x27; property.&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> self.size<br><br><span class="hljs-meta">    @x.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self, value</span>):<br>        self.size = value<br><br><span class="hljs-meta">    @x.deleter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">del</span> self.size<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-29"><a href="#Practice-29" class="headerlink" title="Practice"></a>Practice</h3><h1 id="041-魔法方法：构造和析构"><a href="#041-魔法方法：构造和析构" class="headerlink" title="041. 魔法方法：构造和析构"></a>041. 魔法方法：构造和析构</h1><h2 id="知识点-36"><a href="#知识点-36" class="headerlink" title="知识点"></a>知识点</h2><h3 id="魔法方法"><a href="#魔法方法" class="headerlink" title="魔法方法"></a>魔法方法</h3><ul><li><p>魔法方法总是被双下划线所包围，例如：<code>__init__</code></p></li><li><p>魔法方法是面向对象的python的一切，如果你不知道魔法方法，说明你还没能意识到面向对象的python的强大</p></li><li><p>魔法方法的“魔力”体现在他们总是能够在适当的时候被调用</p></li><li><p><code>__init__(self[, ...])</code> 必须返回none，不要试图用init 返回任何值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>self.x = x<br>self.y = y<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getPeri</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> (self.x + self.y) * <span class="hljs-number">2</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getArea</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> self.x * self.y<br><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>rect = Rectangle(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>rect.getPeri()<br><span class="hljs-number">14</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>rect.getArea()<br><span class="hljs-number">12</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;A fo init&quot;</span><br><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#31&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    a = A()<br>TypeError: __init__() should <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-keyword">not</span> <span class="hljs-string">&#x27;str&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><code>__new__(cls[, ...])</code> 才是实例化对象第一个被调用的魔法方法，<code>__init__(self[, ...])</code> 并不是第一个被调用的</p><ul><li><p>构造器，第一个参数是这个类</p></li><li><p>后面的参数都会原封不动的传递给init 方法</p></li><li><p>new 方法需要返回一个实例对象，通常是返回第一个参数 这个类的实例对象，当然也可以重写返回其他类的实例对象</p></li><li><p>一般极少重写new 方法。有一种情况需要重写new 方法，就是当继承一种不可变类型有需要修改的时候</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">CapStr</span>(<span class="hljs-title class_ inherited__">str</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, string</span>):<br>string = string.upper()<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>.__new__(cls, string)<br><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = CapStr(<span class="hljs-string">&#x27;I love FishC.com!&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a<br><span class="hljs-string">&#x27;I LOVE FISHC.COM!&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><code>__del__(self)</code></p><ul><li><p>析构器，当对象将要被销毁的时候，这个魔法方法就会被自动调用</p></li><li><p>注意： <code>del x</code> 不等于 <code>x.__del__()</code>， 当对象没有任何引用时，会触发垃圾回收机制，这个时候才会调用del 魔法方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我是__init__方法，我被调用了。。。&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我是__del__方法，我被调用了。。。&#x27;</span>)<br><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c1 = C()<br>我是__init__方法，我被调用了。。。<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c2 = c1  <span class="hljs-comment"># c2标签也指向实例</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c3 = c2  <span class="hljs-comment"># c3标签也指向实例</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c3<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c2<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c1   <span class="hljs-comment"># 没有任何标签也指向实例，启动垃圾回收机制，这时候自动调用`__del__(self)`</span><br>我是__del__方法，我被调用了。。。<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-34"><a href="#课后作业-34" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-34"><a href="#Quiz-34" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>是哪个特征让我们一眼就能认出这货是魔法方法？</p><p>双下划线</p></li><li><p>什么时候我们需要在类中明确写出 __ init __ 方法？</p><p>当我们的实例对象需要有明确的初始化步骤的时候，你可以在 <strong>init</strong> 方法中部署初始化的代码。</p></li><li><p>请问下边代码存在什么问题？</p></li></ol>   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>                <span class="hljs-keyword">return</span> x + y<br></code></pre></td></tr></table></figure><p>   init 方法只能返回none，不能是其他</p><ol start="4"><li><p>请问 __ new __ 方法是负责什么任务？</p><p><strong>new</strong> 方法主要任务是返回一个实例对象，通常是参数 cls 这个类的实例化对象，当然你也可以返回其他对象。</p></li><li><p>__ del __ 魔法方法什么时候会被自动调用？</p><p>如果说 __ init __ 和 __ new __ 方法是对象的构造器的话，那么 Python 也提供了一个析构器，叫做 __ del __ 方法。当对象将要被销毁的时候，这个方法就会被调用。<br>但一定要注意的是，并非 del x 就相当于自动调用 x.__ del <strong>()，</strong> del __ 方法是当垃圾回收机制回收这个对象的时候调用的。</p></li></ol><h3 id="Practice-30"><a href="#Practice-30" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>小李做事常常丢三落四的，写代码也一样，常常打开了文件又忘记关闭。你能不能写一个 FileObject 类，给文件对象进行包装，从而确认在删除对象时文件能自动关闭？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 小李做事常常丢三落四的，写代码也一样，常常打开了文件又忘记关闭。</span><br><span class="hljs-comment"># 你能不能写一个 FileObject 类，给文件对象进行包装，从而确认在删除对象时文件能自动关闭？</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileObject</span>:<br>    <span class="hljs-string">&#x27;&#x27;&#x27;给文件对象进行包装从而确认在删除时文件流关闭&#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, filename=<span class="hljs-string">&#x27;p_01.txt&#x27;</span></span>):<br>        <span class="hljs-comment">#读写模式打开一个文件</span><br>        self.new_file = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r+&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        self.new_file.close()<br>        <span class="hljs-keyword">del</span> self.new_file<br></code></pre></td></tr></table></figure></li><li><p>按照以下要求，定义一个类实现摄氏度到华氏度的转换（转换公式：华氏度 &#x3D; 摄氏度*1.8+32）</p><p>要求：我们希望这个类尽量简练地实现功能，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(C2F(<span class="hljs-number">32</span>))<br><span class="hljs-number">89.6</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 代码：</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C2F</span>(<span class="hljs-title class_ inherited__">float</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, c_number</span>):<br>        c_number = c_number * <span class="hljs-number">1.8</span> + <span class="hljs-number">32</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>.__new__(cls, c_number)<br><br><br><span class="hljs-built_in">print</span>(C2F(<span class="hljs-number">32</span>))<br></code></pre></td></tr></table></figure></li><li><p>定义一个类继承于 int 类型，并实现一个特殊功能：当传入的参数是字符串的时候，返回该字符串中所有字符的 ASCII 码的和（使用 ord() 获得一个字符的 ASCII 码值）。</p><p>实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(Nint(<span class="hljs-number">123</span>))<br><span class="hljs-number">123</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(Nint(<span class="hljs-number">1.5</span>))<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(Nint(<span class="hljs-string">&#x27;A&#x27;</span>))<br><span class="hljs-number">65</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(Nint(<span class="hljs-string">&#x27;FishC&#x27;</span>))<br><span class="hljs-number">461</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 代码：</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Nint</span>(<span class="hljs-title class_ inherited__">int</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, arg</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(arg, <span class="hljs-built_in">str</span>):<br>            sum_number = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> arg:<br>                sum_number += <span class="hljs-built_in">ord</span>(each)<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__new__(cls, sum_number)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__new__(cls, arg)<br><br><br><span class="hljs-built_in">print</span>(Nint(<span class="hljs-number">123</span>))<br><span class="hljs-built_in">print</span>(Nint(<span class="hljs-number">1.5</span>))<br><span class="hljs-built_in">print</span>(Nint(<span class="hljs-string">&#x27;A&#x27;</span>))<br><span class="hljs-built_in">print</span>(Nint(<span class="hljs-string">&#x27;FishC&#x27;</span>))<br></code></pre></td></tr></table></figure></li></ol><h1 id="042-魔法方法：算术运算"><a href="#042-魔法方法：算术运算" class="headerlink" title="042. 魔法方法：算术运算"></a>042. 魔法方法：算术运算</h1><h2 id="知识点-37"><a href="#知识点-37" class="headerlink" title="知识点"></a>知识点</h2><h3 id="工厂函数"><a href="#工厂函数" class="headerlink" title="工厂函数"></a>工厂函数</h3><ul><li><p>python2.2 之后，将类和类型进行了统一，做法就是将如下的类型 <em>内置函数</em> 转换成 <em>工厂函数</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">int</span>(),<span class="hljs-built_in">float</span>(), <span class="hljs-built_in">bool</span>(), <span class="hljs-built_in">str</span>(), <span class="hljs-built_in">list</span>(),<span class="hljs-built_in">tuple</span>(), <span class="hljs-built_in">type</span>(), <span class="hljs-built_in">dict</span>(), <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">frozenset</span>()<br></code></pre></td></tr></table></figure></li><li><p>工厂函数，就是能够产生类实例的<strong>内置函数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 普通的内置函数</span><br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">len</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;<br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">open</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;<br><br><span class="hljs-comment"># 工厂函数，就是能够产生类实例的**内置函数**</span><br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">int</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>工厂函数看上去有点像函数，实质上他们是类，当你调用它们时，实际上是生成了该类型的一个实例，就像工厂生产货物一样.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">int</span>)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(C)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>一个类定义完成就变成了类对象，所以工厂函数其实就是类对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 实例化int 对象，传入相应的参数</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;123&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;456&#x27;</span>)<br><br><span class="hljs-comment"># 实例对象还可以计算</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br><span class="hljs-number">579</span><br></code></pre></td></tr></table></figure></li><li><p>python的魔法方法还可以自定义对象的数值处理，通过对魔法方法的重写，可以自定义任何对象间的算术运算</p><table><thead><tr><th>add(self, other)</th><th>定义加法的行为：+</th></tr></thead><tbody><tr><td>sub(self, other)</td><td>定义减法的行为：-</td></tr><tr><td>mul(self, other)</td><td>定义乘法的行为：*</td></tr><tr><td>truediv(self, other)</td><td>定义真除法的行为：&#x2F;</td></tr><tr><td>floordiv(self, other)</td><td>定义整数除法的行为：&#x2F;&#x2F;</td></tr><tr><td>mod(self, other)</td><td>定义取模算法的行为：%</td></tr><tr><td>divmod(self, other)</td><td>定义当被 divmod() 调用时的行为，divmod(a, b)返回一个元组：（a&#x2F;&#x2F;b, a%b)</td></tr><tr><td>pow(self, other[, modulo])</td><td>定义当被 power() 调用或 ** 运算时的行为</td></tr><tr><td>lshift(self, other)</td><td>定义按位左移位的行为：&lt;&lt;</td></tr><tr><td>rshift(self, other)</td><td>定义按位右移位的行为：&gt;&gt;</td></tr><tr><td>and(self, other)</td><td>定义按位与操作的行为：&amp;</td></tr><tr><td>xor(self, other)</td><td>定义按位异或操作的行为：^</td></tr><tr><td>or(self, other)</td><td>定义按位或操作的行为：｜</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">New_int</span>(<span class="hljs-title class_ inherited__">int</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__sub__(self, other)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__sub__</span>(<span class="hljs-params">self, other</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__add__(self, other)<br> <br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = New_int(<span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = New_int(<span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br>-<span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a - b<br><span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-35"><a href="#课后作业-35" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-35"><a href="#Quiz-35" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>自 Python2.2 以后，对类和类型进行了统一，做法就是将 int()、float()、str()、list()、tuple() 这些 BIF 转换为工厂函数。请问所谓的工厂函数，其实是什么原理？</p><p>工厂函数，其实就是一个类对象。当你调用他们的时候，事实上就是创建一个相应的实例对象。</p></li><li><p>当实例对象进行加法操作时，会自动调用什么魔法方法？</p><p>对象 a 和 b 相加时（a + b），Python 会自动根据对象 a 的 <strong>add</strong> 魔法方法进行加法操作， add(self, other)</p></li><li><p>下边代码有问题吗？（运行起来似乎没出错的说_）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">self</span>):<br>                self.foo = <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br>                <span class="hljs-keyword">return</span> self.foo<br><br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>foo = Foo()<br><span class="hljs-meta">&gt;&gt;&gt; </span>foo.foo()<br><span class="hljs-string">&#x27;I love FishC.com!&#x27;</span><br><br></code></pre></td></tr></table></figure><p>这绝对是一个温柔的陷阱，这种BUG比较难以排查，所以一定要注意：类的属性名和方法名绝对不能相同！如果代码这么写，就会有一个难以排查的BUG出现了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                self.foo = <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">self</span>):<br>                <span class="hljs-keyword">return</span> self.foo<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>foo = Foo()<br><span class="hljs-meta">&gt;&gt;&gt; </span>foo.foo()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#21&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    foo.foo()<br>TypeError: <span class="hljs-string">&#x27;str&#x27;</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">callable</span><br><br></code></pre></td></tr></table></figure></li><li><p>写出下列算术运算符对应的魔法方法：</p><table><thead><tr><th>运算符</th><th>对应的魔法方法</th></tr></thead><tbody><tr><td>+</td><td>add(self, other)</td></tr><tr><td>-</td><td>sub(self, other)</td></tr><tr><td>*</td><td><strong><strong>mul</strong></strong>(self, value)</td></tr><tr><td>&#x2F;</td><td>truediv(self, other)</td></tr><tr><td>&#x2F;&#x2F;</td><td>floordiv(self, other)</td></tr><tr><td>%</td><td>mod(self, other)</td></tr><tr><td>divmod(a, b)</td><td>divmod(self, other)</td></tr><tr><td>**</td><td>pow(self, other[, modulo])</td></tr><tr><td>&lt;&lt;</td><td>lshift(self, other)</td></tr><tr><td>&gt;&gt;</td><td>rshift(self, other)</td></tr><tr><td>&amp;</td><td>and(self, other)</td></tr><tr><td>^</td><td>xor(self, other)</td></tr><tr><td>|</td><td>or(self, other)</td></tr></tbody></table></li><li><p>以下代码说明 Python 支持什么风格？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a, b, c</span>):<br>        <span class="hljs-keyword">return</span> (a + b) * c<br><br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>a = calc(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = calc([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], <span class="hljs-number">2</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>c = calc(<span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;FishC&#x27;</span>, <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(a)<br><span class="hljs-number">9</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(b)<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(c)<br>loveFishCloveFishCloveFishC<br><br></code></pre></td></tr></table></figure><p>说明 Python 支持鸭子类型（duck typing）风格。<br><a href="https://blog.csdn.net/qq_41556318/article/details/84640823">鸭子风格</a></p></li></ol><h3 id="Practice-31"><a href="#Practice-31" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>我们都知道在 Python 中，两个字符串相加会自动拼接字符串，但遗憾的是两个字符串相减却抛出异常。因此，现在我们要求定义一个 Nstr 类，支持字符串的相减操作：A – B，从 A 中去除所有 B 的子字符串。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 我们都知道在 Python 中，两个字符串相加会自动拼接字符串，</span><br><span class="hljs-comment"># 但遗憾的是两个字符串相减却抛出异常。</span><br><span class="hljs-comment"># 因此，现在我们要求定义一个 Nstr 类，支持字符串的相减操作：A – B，从 A 中去除所有 B 的子字符串。</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Nstr</span>(<span class="hljs-title class_ inherited__">str</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__sub__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.replace(other, <span class="hljs-string">&#x27;&#x27;</span>)<br><br><br>s1 = Nstr(<span class="hljs-string">&#x27;felixyangfelixyang&#x27;</span>)<br>s2 = Nstr(<span class="hljs-string">&#x27;felix&#x27;</span>)<br><span class="hljs-built_in">print</span>(s1 - s2)<br></code></pre></td></tr></table></figure></li><li><p>移位操作符是应用于二进制操作数的，现在需要你定义一个新的类 Nstr，也支持移位操作符的运算：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = Nstr(<span class="hljs-string">&#x27;I love FishC.com!&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a &lt;&lt; <span class="hljs-number">3</span><br><span class="hljs-string">&#x27;ove FishC.com!I l&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a &gt;&gt; <span class="hljs-number">3</span><br><span class="hljs-string">&#x27;om!I love FishC.c&#x27;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Nstr</span>(<span class="hljs-title class_ inherited__">str</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__lshift__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self[other:] + self[:other]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__rshift__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self[-other:] + self[: -other]<br><br><br>a = Nstr(<span class="hljs-string">&#x27;I love FishC.com!&#x27;</span>)<br><span class="hljs-built_in">print</span>(a &lt;&lt; <span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(a &gt;&gt; <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure></li><li><p>定义一个类 Nstr，当该类的实例对象间发生的加、减、乘、除运算时，将该对象的所有字符串的 ASCII 码之和进行计算：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = Nstr(<span class="hljs-string">&#x27;FishC&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = Nstr(<span class="hljs-string">&#x27;love&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br><span class="hljs-number">899</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a - b<br><span class="hljs-number">23</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a * b<br><span class="hljs-number">201918</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a / b<br><span class="hljs-number">1.052511415525114</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a // b<br><span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Nstr</span>(<span class="hljs-title class_ inherited__">int</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, arg</span>):<br>        sum_number = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> arg:<br>            sum_number += <span class="hljs-built_in">ord</span>(each)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__new__(cls, sum_number)<br><br>a = Nstr(<span class="hljs-string">&#x27;FishC&#x27;</span>)<br>b = Nstr(<span class="hljs-string">&#x27;love&#x27;</span>)<br><span class="hljs-built_in">print</span>(a + b)<br><span class="hljs-built_in">print</span>(a - b)<br><span class="hljs-built_in">print</span>(a * b)<br><span class="hljs-built_in">print</span>(a / b, a // b)<br></code></pre></td></tr></table></figure></li></ol><h1 id="043-魔法方法：算术运算2"><a href="#043-魔法方法：算术运算2" class="headerlink" title="043. 魔法方法：算术运算2"></a>043. 魔法方法：算术运算2</h1><h2 id="知识点-38"><a href="#知识点-38" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>重写魔法方法，python 会根据你的意图进行计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">int</span>(<span class="hljs-title class_ inherited__">int</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__sub__(self, other)<br><br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;5&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;3&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br><span class="hljs-number">2</span><br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure></li><li><p><a href="https://blog.csdn.net/nanhuaibeian/article/details/86687806">反运算魔方方法</a>，与算术运算符保持一一对应，不同之处就是反运算的魔法方法多了一个“r”</p><ul><li><p>比如a+b， 这里加数是a，被加数是b，因此是a主动，反运算就是如果a对象的__add__()方法没有实现或者不支持相应的操作，那么Python就会调用b的__radd__()方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Nint</span>(<span class="hljs-title class_ inherited__">int</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__radd__</span>(<span class="hljs-params">self, other</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__sub__(self, other)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = Nint(<span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = Nint(<span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br><span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span> + b<br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>增量运算符</p><ul><li>a &#x3D; a + b就是 a +&#x3D; b</li></ul></li><li><p>一元操作符</p><ul><li>-a，取相反数的意思</li><li>~a，按位取反</li></ul></li></ul><h2 id="课后作业-36"><a href="#课后作业-36" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-36"><a href="#Quiz-36" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>对象相加（a + b），如果 a 对象有 <strong>add</strong> 方法，请问 b 对象的 <strong>radd</strong> 会被调用吗？</p><p>不会</p></li><li><p>Python 什么时候会调用到反运算的魔法方法？</p><p>例如 a + b, 如果a对象的__add__()方法没有实现或者不支持相应的操作，那么Python就会调用b的__radd__()方法。</p></li><li><p>请问如何在继承的类中调用基类的方法？</p><p>basecls.method()</p><p>或者使用super() 函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>(<span class="hljs-title class_ inherited__">Base</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">meth</span> (self):<br>        <span class="hljs-built_in">super</span>(Derived, self).meth()<br></code></pre></td></tr></table></figure></li><li><p>如果我要继承的基类是动态的（有时候是 A，有时候是 B），我应该如何部署我的代码，以便基类可以随意改变。</p><p>你可以先为基类定义一个别名，在类定义的时候，使用别名代替你要继承的基类。如此，当你想要改变基类的时候，只需要修改给别名赋值的那个语句即可。顺便说一下，当你的资源是视情况而定的时候，这个小技巧很管用。</p><p>例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">BaseAlias = BaseClass  <span class="hljs-comment"># 为基类取别名</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>(<span class="hljs-title class_ inherited__">BaseAlias</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">meth</span>(<span class="hljs-params">self</span>):<br>        BaseAlias.meth(self)  <span class="hljs-comment"># 通过别名访问基类</span><br>        ...<br></code></pre></td></tr></table></figure></li><li><p>尝试自己举一个例子说明如何使用类的静态属性。（一定要自己先动手再看答案哦_）</p><p>在类中直接定义的属性叫做静态属性（没有self.），需要调用的时候直接用 <code>类名.属性名</code>进行调用</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">class</span> C:<br>    <span class="hljs-keyword">number</span> = <span class="hljs-number">0</span><br><br>    def show(self):<br>        <span class="hljs-keyword">return</span> C.<span class="hljs-keyword">number</span><br><br><br>c = C()<br><span class="hljs-built_in">print</span>(c.show())<br><span class="hljs-built_in">print</span>(C.<span class="hljs-keyword">number</span>)<br></code></pre></td></tr></table></figure><p>答案：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        A.count += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getcount</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> A.count<br><br><br>a = A()<br>a1 = A()<br>b = A()<br><br><span class="hljs-built_in">print</span>(a.getcount())<br></code></pre></td></tr></table></figure></li><li><p>尝试自己举例说明如何使用类的静态方法，并指出使用类的静态方法有何要点和需要注意的地方？（一定要自己先动手再看答案哦_）</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">class C:<br>    @staticmethod<br>    def <span class="hljs-built_in">show</span>(name=<span class="hljs-string">&#x27;felix&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(name)<br><br><br>C.<span class="hljs-built_in">show</span>(<span class="hljs-string">&#x27;yang&#x27;</span>)<br>C.<span class="hljs-built_in">show</span>()<br>c = <span class="hljs-built_in">C</span>()<br>c.<span class="hljs-built_in">show</span>()<br></code></pre></td></tr></table></figure><p>答案：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">    @staticmethod   </span><span class="hljs-comment">#该修饰符表示static()是静态方法</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">static</span> (arg1 , arg2 , arg3 ) :<br>        <span class="hljs-built_in">print</span> (arg1 , arg2 , arg3 , arg1 + arg2 + arg3)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">nostatic</span> (self) :<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;I&#x27;m the fucking normal method&quot;</span>)<br><br><br>c1 = C()<br>c2 = C()<br><br><br><span class="hljs-comment"># 静态方法只在内存中生成一个，节省开销</span><br><span class="hljs-built_in">print</span>(c1.static <span class="hljs-keyword">is</span> C.static)<br><span class="hljs-built_in">print</span>(c1.nostatic <span class="hljs-keyword">is</span> C.nostatic)<br><span class="hljs-built_in">print</span>(c1.static)<br><span class="hljs-built_in">print</span>(c2.static)<br><span class="hljs-built_in">print</span>(C.static)<br><br><br><span class="hljs-comment"># 普通方法每个实例对象都有独立的一个，开销较大</span><br><span class="hljs-built_in">print</span>(c1.nostatic)<br><span class="hljs-built_in">print</span>(c2.nostatic)<br><span class="hljs-built_in">print</span>(C.nostatic)<br><br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-32"><a href="#Practice-32" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>定义一个类，当实例化该类的时候，自动判断传入了多少个参数，并显示出来：</p><p><img src="https://img-blog.csdnimg.cn/201903032129217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTcwNzgz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 定义一个类，当实例化该类的时候，自动判断传入了多少个参数，并显示出来：</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span> (self, *args):  <span class="hljs-comment"># *arg表示不确定个数的参数</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> args:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;并没有传入参数&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;传入了%d个参数，分别是：&quot;</span> % <span class="hljs-built_in">len</span>(args), end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> args:<br>                <span class="hljs-built_in">print</span>(each, end=<span class="hljs-string">&#x27; &#x27;</span>)<br><br><br>c = C()<br>c = C(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure></li><li><p>定义一个单词（Word）类继承自字符串，重写比较操作符，当两个 Word 类对象进行比较时，根据单词的长度来进行比较大小。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Word</span>(<span class="hljs-title class_ inherited__">str</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__lt__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &lt; <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__gt__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &gt; <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) == <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__ne__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) != <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__le__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &lt;= <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__ge__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &gt;= <span class="hljs-built_in">len</span>(other)<br><br><br>w1 = Word(<span class="hljs-string">&#x27;123&#x27;</span>)<br>w2 = Word(<span class="hljs-string">&#x27;3456&#x27;</span>)<br><span class="hljs-built_in">print</span>(w1 &gt; w2)<br><span class="hljs-built_in">print</span>(w1 &lt; w2)<br><span class="hljs-built_in">print</span>(w1 != w2)<br><span class="hljs-built_in">print</span>(w1 == w2)<br><span class="hljs-built_in">print</span>(w1 &gt;= w2)<br><span class="hljs-built_in">print</span>(w1 &lt;= w2)<br></code></pre></td></tr></table></figure><p><strong>加分项：实例化时如果传入的是带空格的字符串，则去第一个空格前的单词作为参数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 加分项：实例化时如果传入的是带空格的字符串，则去第一个空格前的单词作为参数</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Word</span>(<span class="hljs-title class_ inherited__">str</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, word</span>):<br>        <span class="hljs-comment"># 注意必须要使用__new__方法，因为str 是不可变类型</span><br>        <span class="hljs-comment"># 必须在创建的时候将他初始化</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-keyword">in</span> word:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Value contains the spaces, truncating to first space.&#x27;</span>)<br>            word = word[: word.index(<span class="hljs-string">&#x27; &#x27;</span>)]<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>.__new__(cls, word)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__lt__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &lt; <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__gt__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &gt; <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) == <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__ne__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) != <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__le__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &lt;= <span class="hljs-built_in">len</span>(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__ge__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) &gt;= <span class="hljs-built_in">len</span>(other)<br><br><br>w1 = Word(<span class="hljs-string">&#x27;I love you&#x27;</span>)<br>w2 = Word(<span class="hljs-string">&#x27;felix&#x27;</span>)<br><span class="hljs-built_in">print</span>(w1 &gt; w2)<br><span class="hljs-built_in">print</span>(w1 &lt; w2)<br><span class="hljs-built_in">print</span>(w1 != w2)<br><span class="hljs-built_in">print</span>(w1 == w2)<br><span class="hljs-built_in">print</span>(w1 &gt;= w2)<br><span class="hljs-built_in">print</span>(w1 &lt;= w2)<br></code></pre></td></tr></table></figure></li></ol><h1 id="044-魔法方法：简单定制"><a href="#044-魔法方法：简单定制" class="headerlink" title="044. 魔法方法：简单定制"></a>044. 魔法方法：简单定制</h1><h2 id="知识点-39"><a href="#知识点-39" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>前情提要</p><ul><li><p>使用time模块的localtime方法获取时间</p><ul><li><a href="https://blog.csdn.net/qq_41556318/article/details/84670804">扩展阅读：time模块详解（时间获取和转换）</a></li></ul></li><li><p>time.localtime返回structure_time的时间格式</p><p>gmtime()，localtime() 和 strptime() 以时间元组（struct_time）的形式返回。</p><p>索引值（Index）属性（Attribute）值（Values）<br>0tm_year（年）（例如：2015）<br>1tm_mon（月）1 ~ 12<br>2tm_mday（日）1 ~ 31<br>3tm_hour（时）0 ~ 23<br>4tm_min（分）0 ~ 59<br>5tm_sec（秒）0 ~ 61（见下方注1）<br>6tm_wday（星期几）0 ~ 6（0 表示星期一）<br>7tm_yday（一年中的第几天）1 ~ 366<br>8tm_isdst（是否为夏令时）0， 1， -1（-1 代表夏令时）<br>注1：范围真的是 0 ~ 61（你没有看错哦^_^）；60 代表闰秒，61 是基于历史原因保留。</p></li><li><p>表现你的类：<code>__str__</code>和<code>__repr__</code></p><ul><li>__repr__改变的是所有的输出，而__str__改变的是print输出</li><li>同时包含了repr和str,  print还是默认调用str，实例是调用repr</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;felix is my name&quot;</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c1 = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c1<br>&lt;__main__.C <span class="hljs-built_in">object</span> at <span class="hljs-number">0x100de3fa0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(c1)<br>felix <span class="hljs-keyword">is</span> my name<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;this is for __repr__&quot;</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c2 = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c2<br>this <span class="hljs-keyword">is</span> <span class="hljs-keyword">for</span> __repr__<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(c2)<br>this <span class="hljs-keyword">is</span> <span class="hljs-keyword">for</span> __repr__<br></code></pre></td></tr></table></figure></li></ul></li><li><p>案例要求</p><ul><li>定制一个计时器的类</li><li>start和stop 方法代表启动计时器和停止计时器</li><li>假设计时器对象t1，print(t1) 和直接调用t1均显示结果</li><li>当计时器未启动或已经停止计时，调用stop方法会给予温馨的提示</li><li>两个计时器对象可以进行相加：t1+t2</li><li>只能使用提供的有限资源完成</li></ul></li><li><p>我的程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 案例</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># - 定制一个计时器的类</span><br><span class="hljs-comment"># - start和stop 方法代表启动计时器和停止计时器</span><br><span class="hljs-comment"># - 假设计时器对象t1，print(t1) 和直接调用t1均显示结果</span><br><span class="hljs-comment"># - 当计时器未启动或已经停止计时，调用stop方法会给予温馨的提示</span><br><span class="hljs-comment"># - 两个计时器对象可以进行相加：t1+t2</span><br><span class="hljs-comment"># - 只能使用提供的有限资源完成</span><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTimer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, status=<span class="hljs-number">0</span></span>):<br>        self.start_time = <span class="hljs-literal">None</span><br>        self.stop_time = <span class="hljs-literal">None</span><br>        self.status = status<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>):<br>        self.start_time = t.localtime()<br>        self.status = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.status == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;计时器未启动&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            self.stop_time = t.localtime()<br>            self.status = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br>        self.interval_sec = self.stop_time.tm_sec - self.start_time.tm_sec<br>        self.interval_min = self.stop_time.tm_min - self.start_time.tm_min<br>        self.interval_hour = self.stop_time.tm_hour - self.start_time.tm_hour<br>        self.interval = (self.interval_hour * <span class="hljs-number">60</span> + self.interval_min) * <span class="hljs-number">60</span> + self.interval_sec<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(self.interval)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        self.interval_sec = self.stop_time.tm_sec - self.start_time.tm_sec<br>        self.interval_min = self.stop_time.tm_min - self.start_time.tm_min<br>        self.interval_hour = self.stop_time.tm_hour - self.start_time.tm_hour<br>        self.interval = (self.interval_hour * <span class="hljs-number">60</span> + self.interval_min) * <span class="hljs-number">60</span> + self.interval_sec<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(self.interval)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(self.__repr__()) + <span class="hljs-built_in">float</span>(other.__repr__())<br></code></pre></td></tr></table></figure></li><li><p>答案程序</p><ul><li><p>初始程序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mytimer</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment">#定义一个列表存放时间的单位，以便程序运行后输出的结果直接是带单位的结果：如：总共运行了：3秒</span><br>        self.unit = [<span class="hljs-string">&#x27;年&#x27;</span>,<span class="hljs-string">&#x27;月&#x27;</span>,<span class="hljs-string">&#x27;天&#x27;</span>,<span class="hljs-string">&#x27;小时&#x27;</span>,<span class="hljs-string">&#x27;分钟&#x27;</span>,<span class="hljs-string">&#x27;秒&#x27;</span>]<br>        self.prompt = <span class="hljs-string">&#x27;未开始计时！&#x27;</span><br>        self.lasted = []<br>        <span class="hljs-comment">#self.start = 0</span><br>        self.begin = <span class="hljs-number">0</span><br>        <span class="hljs-comment">#self.stop = 0</span><br>        self.end = <span class="hljs-number">0</span><br>        <span class="hljs-comment">#这里特别需要注意，方法名和属性名不能定义成同一个名字，否则属性会覆盖方法</span><br>    <br>    <span class="hljs-comment">#实现直接调用对象来输出内容</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.prompt<br><br>    <span class="hljs-comment">#__str__ 赋值给 __repr__</span><br>    __repr__ = __str__<br><br>    <span class="hljs-comment">#两个对象相加</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self,other</span>):<br>        prompt = <span class="hljs-string">&quot;总共运行了&quot;</span><br>        result = []<br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>            result.append(self.lasted[index]+other.lasted[index])<br>            <span class="hljs-keyword">if</span> result[index]:<span class="hljs-comment">#如果result是空的话执行</span><br>                prompt += (<span class="hljs-built_in">str</span>(result[index])+self.unit[index])<br>        <span class="hljs-keyword">return</span> prompt<br>   <br>    <span class="hljs-comment">#开始计时</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>):<span class="hljs-comment">#self表示对象的引用</span><br>        self.begin = t.localtime()<br>        self.prompt = <span class="hljs-string">&#x27;提示：请先调用stop()停止计时&#x27;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;计时开始...&#x27;</span>)<br><br>    <span class="hljs-comment">#停止计时</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.begin:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;提示：请先调用start()进行计时！&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            self.end = t.localtime()<br>            <span class="hljs-comment">#结束计时时并进行计算，即对象.内部方法</span><br>            self._clac()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;计时结束！&#x27;</span>)<br>    <br>    <span class="hljs-comment">#内部方法(_方法名)，计算运行时间</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_clac</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment">#计算的结果放在一个列表里面</span><br>        self.lasted = []<br>        <span class="hljs-comment">#定义一个提示的变量</span><br>        self.prompt = <span class="hljs-string">&#x27;总共运行了&#x27;</span><br>        <span class="hljs-comment">#依次遍历localtime的索引</span><br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>            <span class="hljs-comment">#用结束时间减去开始时间得到运行的时间，并把结果放到lasted[]列表内</span><br>            self.lasted.append(self.end[index]-self.begin[index])<br>            <span class="hljs-comment">#把每一次计算的结果进行一次追加</span><br>            <span class="hljs-keyword">if</span> self.lasted[index]: <span class="hljs-comment">#当lasted为0时就不会执行if内的语句，而是执行下一轮的循环</span><br>                self.prompt += <span class="hljs-built_in">str</span>(self.lasted[index])+self.unit[index] <span class="hljs-comment">#运行时间+单位</span><br><br>        <span class="hljs-comment">#为下一轮计时初始化变量</span><br>                self.begin = <span class="hljs-number">0</span><br>                self.end = <span class="hljs-number">0</span><br>                <br>        <br>  执行结果：<br><span class="hljs-meta">&gt;&gt;&gt; </span>t1 = Mytimer()<br><span class="hljs-meta">&gt;&gt;&gt; </span>t1.start()<br>计时开始...<br><span class="hljs-meta">&gt;&gt;&gt; </span>t1.stop()<br>计时结束！<br><span class="hljs-meta">&gt;&gt;&gt; </span>t1<br>总共运行了<span class="hljs-number">9</span>秒<br><span class="hljs-meta">&gt;&gt;&gt; </span>t2 = Mytimer()<br><span class="hljs-meta">&gt;&gt;&gt; </span>t2.start()<br>计时开始...<br><span class="hljs-meta">&gt;&gt;&gt; </span>t2.stop()<br>计时结束！<br><span class="hljs-meta">&gt;&gt;&gt; </span>t2<br>总共运行了<span class="hljs-number">5</span>秒<br><span class="hljs-meta">&gt;&gt;&gt; </span>t1+t2<br><span class="hljs-string">&#x27;总共运行了14秒&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span> <br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-37"><a href="#课后作业-37" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-37"><a href="#Quiz-37" class="headerlink" title="Quiz"></a>Quiz</h3><h3 id="Practice-33"><a href="#Practice-33" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>按照课堂中的程序，如果开始计时的时间为（2022年2月22日16:30:30），停止时间是（2025年1月23日15:30:30），那按照我们用停止时间减去开始时间的计算方式就会出现负数，你应该对此做一些转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTimer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.unit = [<span class="hljs-string">&#x27;年&#x27;</span>, <span class="hljs-string">&#x27;月&#x27;</span>, <span class="hljs-string">&#x27;天&#x27;</span>, <span class="hljs-string">&#x27;小时&#x27;</span>, <span class="hljs-string">&#x27;分钟&#x27;</span>, <span class="hljs-string">&#x27;秒&#x27;</span>]<br>        self.borrow = [<span class="hljs-number">1</span>, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>, <span class="hljs-number">24</span>, <span class="hljs-number">60</span>, <span class="hljs-number">60</span>]<br>        self.prompt = <span class="hljs-string">&quot;未开始计时！&quot;</span><br>        self.lasted = []<br>        self.begin = <span class="hljs-number">0</span><br>        self.end = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 开始计时</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>):<br>        self.begin = t.localtime()<br>        self.prompt = <span class="hljs-string">&quot;提示：请先调用stop()结束计时！&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计时开始……&quot;</span>)<br><br>    <span class="hljs-comment"># 停止计时</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.begin:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;提示：请先调用start()开始计时！&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            self.end = t.localtime()<br>            self._calc()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计时结束！&quot;</span>)<br><br>    <span class="hljs-comment"># 内部方法，计算运行时间</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calc</span>(<span class="hljs-params">self</span>):<br>        self.lasted = []<br>        self.prompt = <span class="hljs-string">&quot;总共运行了&quot;</span><br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>            temp = self.end[index] - self.begin[index]<br>            <span class="hljs-comment"># 低位不够减，需要向高位借位</span><br>            <span class="hljs-keyword">if</span> temp &lt; <span class="hljs-number">0</span>:<br>                <span class="hljs-comment"># 测试高位是否有得借，没得借的话再向高位借……</span><br>                i = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> self.lasted[index-i] &lt; <span class="hljs-number">1</span>:<br>                    self.lasted[index-i] += self.borrow[index-i] - <span class="hljs-number">1</span><br>                    self.lasted[index-i-<span class="hljs-number">1</span>] -= <span class="hljs-number">1</span><br>                    i += <span class="hljs-number">1</span><br>                self.lasted.append(self.borrow[index] + temp)<br>                self.lasted[index-<span class="hljs-number">1</span>] -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                self.lasted.append(temp)<br><br>        <span class="hljs-comment"># 由于高位随时会被借位，所以打印要放在最后</span><br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>            <span class="hljs-keyword">if</span> self.lasted[index]:<br>                self.prompt += <span class="hljs-built_in">str</span>(self.lasted[index]) + self.unit[index]<br><br>        <span class="hljs-comment"># 为下一轮计算初始化变量</span><br>        self.begin = <span class="hljs-number">0</span><br>        self.end = <span class="hljs-number">0</span><br>        <span class="hljs-built_in">print</span>(self.prompt)<br><br>    <span class="hljs-comment"># 调用实例直接显示结果</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.prompt<br>    __repr__ = __str__<br><br>    <span class="hljs-comment"># 计算两次计时器对象之和</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        prompt = <span class="hljs-string">&quot;总共运行了&quot;</span><br>        result = []<br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>            result.append(self.lasted[index] + other.lasted[index])<br>            <span class="hljs-keyword">if</span> result[index]:<br>                prompt += (<span class="hljs-built_in">str</span>(result[index]) + self.unit[index])<br>        <span class="hljs-keyword">return</span> prompt<br><br><br>t1 = MyTimer()<br>t2 = MyTimer()<br>t1.start()<br>t.sleep(<span class="hljs-number">65</span>)<br>t1.stop()<br>t2.start()<br>t.sleep(<span class="hljs-number">15</span>)<br>t2.stop()<br><span class="hljs-built_in">print</span>(t1 + t2)<br></code></pre></td></tr></table></figure></li><li><p>相信大家已经意识到不对劲了：为毛一个月一定要31天？不知道又可能也是30天或者29天吗?（上一题我们的答案是假设一个月31天）</p><p>没错，如果要正确得到月份的天数，我们还需要考虑是否闰年，还有每月的最大天数，所以太麻烦了……如果我们不及时纠正，我们会在错误的道理上越走越远…….</p><p>所以，这一次，小甲鱼提出来了更加优秀的解决方案：用time模块的perf_counter()和process_time()来计算，其中perf_counter()返回计时器的精准时间（系统的运行时间）;process_time()返回当前进程执行CPU的时间总和</p><p>题目：改进我们课堂中的例子，这次试用perf_counter（）和process_time()作为计时器。另外增加一个set_timer()方法，用于设置默认计时器（默认是perf_counter()，可以通过此方法修改为process_time()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-comment"># 用time模块的perf_counter()和process_time()计算，其中perf_counter()返回计时器的精准时间（系统的运行时间）；</span><br><span class="hljs-comment"># process_time()返回当前进程执行CPU的时间总和。</span><br><br><span class="hljs-comment"># 题目：改进我们课堂中的例子，这次使用perf_counter()和process_time()作为计时器，</span><br><span class="hljs-comment"># 另外新增一个set_time()方法，用于设置默认计时器（默认是perf_counter()，可以通过此方法修改为process_time() ）</span><br><br><br><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTimer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.prompt = <span class="hljs-string">&quot;未开始计时&quot;</span><br>        self.lasted = <span class="hljs-number">0.0</span><br>        self.begin = <span class="hljs-number">0</span><br>        self.end = <span class="hljs-number">0</span><br>        self.default_timer = t.perf_counter<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.prompt<br><br>    __repr__ = __str__<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        result = self.lasted + other.lasted<br>        prompt = <span class="hljs-string">&quot;总共运行了%0.2f秒&quot;</span> % result<br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>):<br>        self.begin = self.default_timer()<br>        self.prompt = <span class="hljs-string">&quot;提示：请先调用stop()停止计时！&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计时开始！&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.begin:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;提示：请先调用start()运行计时！&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            self.end = self.default_timer()<br>            self._calc()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计时结束&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calc</span>(<span class="hljs-params">self</span>):<br>        self.lasted = self.end - self.begin<br>        self.prompt = <span class="hljs-string">&quot;总共运行了%0.2f秒&quot;</span> % self.lasted<br>        <span class="hljs-built_in">print</span>(self.prompt)<br>        self.begin = <span class="hljs-number">0</span><br>        self.end = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_timer</span>(<span class="hljs-params">self, timer</span>):<br>        <span class="hljs-keyword">if</span> timer == <span class="hljs-string">&#x27;process_time&#x27;</span>:<br>            self.default_timer = t.process_time<br>        <span class="hljs-keyword">elif</span> timer == <span class="hljs-string">&#x27;perf_counter&#x27;</span>:<br>            self.default_timer = t.perf_counter<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;输入无效&quot;</span>)<br><br><br>t1 = MyTimer()<br>t1.set_timer(<span class="hljs-string">&#x27;perf_counter&#x27;</span>)<br>t1.start()<br>t.sleep(<span class="hljs-number">5.2</span>)<br>t1.stop()<br>t2 = MyTimer()<br>t2.set_timer(<span class="hljs-string">&#x27;perf_counter&#x27;</span>)<br>t2.start()<br>t.sleep(<span class="hljs-number">5.2</span>)<br>t2.stop()<br><span class="hljs-built_in">print</span>(t1 + t2)<br><br></code></pre></td></tr></table></figure></li><li><p>既然咱都做到这一步，那不如深入一下，再次改进我们的代码，让它能够统计一个函数运行若干次的时间</p><p>要求一：函数调用的次数可以设置（默认是1000000次）</p><p>要求二：新增一个 timeing()方法，用于启动计时器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-comment"># 既然咱都做到这一步，那不如深入一下，再次改进我们的代码，让它能够统计一个函数运行若干次的时间</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 要求一：函数调用的次数可以设置（默认是1000000次）</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 要求二：新增一个 timeing()方法，用于启动计时器</span><br><br><span class="hljs-comment"># !/usr/bin/python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTimer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func, number=<span class="hljs-number">1000000</span></span>):<br>        self.prompt = <span class="hljs-string">&quot;未开始计时&quot;</span><br>        self.lasted = <span class="hljs-number">0.0</span><br>        self.begin = <span class="hljs-number">0</span><br>        self.end = <span class="hljs-number">0</span><br>        self.default_timer = t.perf_counter<br>        self.number = number<br>        self.func = func<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.prompt<br><br>    __repr__ = __str__<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        result = self.lasted + other.lasted<br>        prompt = <span class="hljs-string">&quot;总共运行了%0.2f秒&quot;</span> % result<br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-comment"># 内置方法，计算运行时间</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">timing</span>(<span class="hljs-params">self</span>):<br>        self.begin = self.default_timer()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.number):<br>            self.func()<br>        self.end = self.default_timer()<br>        self.lasted = self.end - self.begin<br>        self.prompt = <span class="hljs-string">&quot;总共运行了 %0.2f 秒&quot;</span> % self.lasted<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_timer</span>(<span class="hljs-params">self, timer</span>):<br>        <span class="hljs-keyword">if</span> timer == <span class="hljs-string">&#x27;process_time&#x27;</span>:<br>            self.default_timer = t.process_time<br>        <span class="hljs-keyword">elif</span> timer == <span class="hljs-string">&#x27;perf_counter&#x27;</span>:<br>            self.default_timer = t.perf_counter<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;输入无效&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    text = <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br>    char = <span class="hljs-string">&#x27;o&#x27;</span><br>    <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> text:<br>        <span class="hljs-keyword">pass</span><br><br><br>t1 = MyTimer(test)<br>t1.timing()<br><span class="hljs-built_in">print</span>(t1)<br>t2 = MyTimer(test, <span class="hljs-number">10000000</span>)<br>t2.timing()<br><span class="hljs-built_in">print</span>(t2)<br>t3 = MyTimer(test, <span class="hljs-number">100000000</span>)<br>t3.timing()<br><span class="hljs-built_in">print</span>(t3)<br></code></pre></td></tr></table></figure></li><li><p>回忆复习</p><p>通常在一段程序的前后都用上time.time(),然后进行相减就可以得到一段程序的运行时间，不过python提供了更强大的计时库：timeit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#导入timeit.timeit</span><br><span class="hljs-keyword">from</span> timeit <span class="hljs-keyword">import</span> timeit  <br><br><span class="hljs-comment">#看执行1000000次x=1的时间：</span><br>timeit(<span class="hljs-string">&#x27;x=1&#x27;</span>)<br><br><span class="hljs-comment">#看x=1的执行时间，执行1次(number可以省略，默认值为1000000)：</span><br>timeit(<span class="hljs-string">&#x27;x=1&#x27;</span>, number=<span class="hljs-number">1</span>)<br><br><span class="hljs-comment">#看一个列表生成器的执行时间,执行1次：</span><br>timeit(<span class="hljs-string">&#x27;[i for i in range(10000)]&#x27;</span>, number=<span class="hljs-number">1</span>)<br><br><span class="hljs-comment">#看一个列表生成器的执行时间,执行10000次：</span><br>timeit(<span class="hljs-string">&#x27;[i for i in range(100) if i%2==0]&#x27;</span>, number=<span class="hljs-number">10000</span>)<br></code></pre></td></tr></table></figure><p>测试一个函数的执行时间：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs swift">from timeit <span class="hljs-keyword">import</span> timeit<br><br>def <span class="hljs-keyword">func</span>():<br>    s <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000</span>):<br>        s <span class="hljs-operator">+=</span> i<br>    <span class="hljs-built_in">print</span>(s)<br><br># timeit(函数名<span class="hljs-keyword">_</span>字符串，运行环境<span class="hljs-keyword">_</span>字符串，number<span class="hljs-operator">=</span>运行次数)<br>t <span class="hljs-operator">=</span> timeit(&#x27;<span class="hljs-keyword">func</span>()&#x27;, &#x27;from __main__ <span class="hljs-keyword">import</span> <span class="hljs-keyword">func</span>&#x27;, number<span class="hljs-operator">=</span><span class="hljs-number">1000</span>)<br><span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure><p>此程序测试函数运行1000次的执行时间。</p></li></ol><h1 id="045-魔法方法：属性访问"><a href="#045-魔法方法：属性访问" class="headerlink" title="045. 魔法方法：属性访问"></a>045. 魔法方法：属性访问</h1><h2 id="知识点-40"><a href="#知识点-40" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>前情提要</p><ul><li><p>访问属性的方法有2种</p><ul><li><p>通过<code>.</code>的方式，实例<code>.</code>属性访问</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            self.name = <span class="hljs-string">&#x27;x-man&#x27;</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.name<br><span class="hljs-string">&#x27;x-man&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>通过BIF，geattr() 优雅的访问</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;木有这个属性&#x27;</span>)<br><span class="hljs-string">&#x27;x-man&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(c, <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;木有这个属性&#x27;</span>)<br><span class="hljs-string">&#x27;木有这个属性&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>可以通过设置property 属性，绑定操作其他属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size</span>):<br><span class="hljs-meta">... </span>            self.size = size<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getSize</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">return</span> self.size<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setSize</span>(<span class="hljs-params">self,value</span>):<br><span class="hljs-meta">... </span>            self.size = value<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delSize</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-keyword">del</span> self.size<br><span class="hljs-meta">... </span>    x = <span class="hljs-built_in">property</span>(getSize, setSize, delSize)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C(<span class="hljs-number">10</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.size<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">1</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.size<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c.x<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.size<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;C&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;size&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">5</span>, <span class="hljs-keyword">in</span> getSize<br>AttributeError: <span class="hljs-string">&#x27;C&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;size&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.size<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>魔法方法 - 操作属性</p><p>通过重写这几个魔法方法可以控制对属性的访问</p><table><thead><tr><th><code>__getattr__(self, name)</code></th><th>定义当用户试图获取一个不存在的属性时的行为</th></tr></thead><tbody><tr><td><code>__getattribute__(self, name)</code></td><td>定义当该类的属性被访问时的行为</td></tr><tr><td><code>__setattr__(self, name)</code></td><td>定义当一个属性被设置时的行为</td></tr><tr><td><code>__delattr__(self, name)</code></td><td>定义当一个属性被删除时的行为</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 4个魔法方法操作属性</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-comment"># 定义当该类的属性被访问时的行为</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;getattribute&#x27;</span>)<br>        <span class="hljs-comment"># 仅仅测试用途，通过super函数继承默认基类的同样魔法方法，不改变魔法方法本身</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__getattribute__(name)<br><br>    <span class="hljs-comment"># 当用户试图获取一个不存在的属性的行为，如果属性存在就不会调用了; 默认行为是会报错</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;getattr&#x27;</span>)<br><br>    <span class="hljs-comment"># 定义当一个属性被设置时的行为</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;setattr&#x27;</span>)<br>        <span class="hljs-comment"># 仅仅测试用途，通过super函数继承默认基类的同样魔法方法，不改变魔法方法本身</span><br>        <span class="hljs-built_in">super</span>().__setattr__(name, value)<br><br>    <span class="hljs-comment"># 定义当一个属性被删除时的行为</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;delattr&#x27;</span>)<br>        <span class="hljs-comment"># 仅仅测试用途，通过super函数继承默认基类的同样魔法方法，不改变魔法方法本身</span><br>        <span class="hljs-built_in">super</span>().__delattr__(name)<br><br><br>c = C()<br>c.size<br>c.size = <span class="hljs-number">1</span><br>c.size<br><span class="hljs-keyword">del</span> c.size<br></code></pre></td></tr></table></figure><p>output</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">getattribute          <span class="hljs-comment"># c.size 访问属性时，调用getattribute</span><br><span class="hljs-built_in">getattr</span>               <span class="hljs-comment"># c.size 不存在，触发调用getattr</span><br><span class="hljs-built_in">setattr</span>               <span class="hljs-comment"># c.size = 1， 触发调用setattr</span><br>getattribute          <span class="hljs-comment"># c.size 访问属性时，调用getattribute；由于c.size 存在，不会触发调用getattr</span><br><span class="hljs-built_in">delattr</span>               <span class="hljs-comment"># del c.size 删除属性时，调用delattr</span><br></code></pre></td></tr></table></figure></li><li><p>课堂练习</p><ul><li><p>写一个矩形类，默认有宽和高两个属性</p></li><li><p>如果为一个叫square的属性赋值，那么说明是一个正方形，值就是正方形的边长，此时宽和高都应该等于边长</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 课堂练习</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># - 写一个矩形类，默认有宽和高两个属性</span><br><span class="hljs-comment"># - 如果为一个叫square的属性赋值，那么说明是一个正方形，值就是正方形的边长，此时宽和高都应该等于边长</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.width = <span class="hljs-number">5</span><br>        self.height = <span class="hljs-number">8</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;square&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;it is a square!!&#x27;</span>)<br>            self.width = value<br>            self.height = value<br>        <span class="hljs-comment"># 继承默认基类的方法，给属性赋值；如果不写，会出现死循环</span><br>        <span class="hljs-built_in">super</span>().__setattr__(name, value)<br>        <br>        <span class="hljs-comment"># 还可以通过默认属性字典的方式，直接给属性赋值</span><br>        <span class="hljs-comment"># self.__dict__[name] = value</span><br><br><br>rec = Rectangle()<br><span class="hljs-built_in">print</span>(rec.width, rec.height)<br><br>rec.square = <span class="hljs-number">10</span><br><span class="hljs-built_in">print</span>(rec.square, rec.width, rec.height)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-38"><a href="#课后作业-38" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-38"><a href="#Quiz-38" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请问以下代码的作用是什么？这样写正确吗？（如果不正确，请改正）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        self.name = value + <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><p>代码的作用是自动为属性的赋值加1，代码不正确，因为会有死循环，<code>self.name = value + 1</code> 本身也是赋值语句，需要不断调用<code>__setattr__</code></p><p>有2种方法改正：</p><ul><li><p>使用super()函数继承默认object 基类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>     <span class="hljs-built_in">super</span>().__setattr__(name, value+<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></li><li><p>采用对默认属性字典直接赋值的方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        <span class="hljs-comment"># self.name = value + 1</span><br>    self.__dict__[name] = value + <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>自定义该类的属性被访问的行为，你应该重写哪个魔法方法？</p><p><code>__getattribute__()</code></p></li><li><p>在不上机验证的情况下，你能推断以下代码分别会显示什么吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">4</span>)<br> <br>                <br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">1</span><br><span class="hljs-comment"># 位置一，请问这里会显示什么？</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(c.x)<br><span class="hljs-comment"># 位置二，请问这里会显示什么？</span><br><br></code></pre></td></tr></table></figure><p>位置一：</p><p>3</p><p>位置二：</p><p>2</p><p>None</p><p>因为 x 是属于实例对象 c 的属性，所以 c.x 是访问一个存在的属性，因此会访问 <strong>getattribute</strong>() 魔法方法，但我们重写了这个方法，使得它不能按照正常的逻辑返回属性值，而是打印一个 2 代替，由于我们没有写返回值，所以紧接着返回 None 并被 print() 打印出来。</p></li><li><p>在不上机验证的情况下，你能推断以下代码分别会显示什么吗？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__getattr__(name)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__getattribute__(name)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">3</span>)<br>                <span class="hljs-built_in">super</span>().__setattr__(name, value)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-number">4</span>)<br>                <span class="hljs-built_in">super</span>().__delattr__(name)<br> <br>                <br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x<br><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; c = C()<br>&gt;&gt;&gt; c.x<br><span class="hljs-number">2</span><br><span class="hljs-number">1</span><br>Traceback (most recent <span class="hljs-keyword">call</span> last):<br>  File &quot;&lt;pyshell#31&gt;&quot;, <span class="hljs-type">line</span> <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    c.x<br>  File &quot;&lt;pyshell#29&gt;&quot;, <span class="hljs-type">line</span> <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> __getattr__<br>    <span class="hljs-keyword">return</span> super().__getattr__(<span class="hljs-type">name</span>)<br>AttributeError: <span class="hljs-string">&#x27;super&#x27;</span> <span class="hljs-keyword">object</span> has <span class="hljs-keyword">no</span> <span class="hljs-keyword">attribute</span> <span class="hljs-string">&#x27;__getattr__&#x27;</span><br><br></code></pre></td></tr></table></figure><p>为什么会如此显示呢？我们来分析下：首先 c.x 会先调用 <strong>getattribute</strong>() 魔法方法，打印 2；然后调用 super().<strong>getattribute</strong>()，找不到属性名 x，因此会紧接着调用 <strong>getattr</strong>() ，于是打印 1；但是你猜到了开头没猜到结局……当你希望最后以 super().<strong>getattr</strong>() 终了的时候，Python 竟然告诉你 AttributeError，super 对象木有 <strong>getattr</strong> ！！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">dir</span>(<span class="hljs-built_in">super</span>)<br>[<span class="hljs-string">&#x27;__class__&#x27;</span>, <span class="hljs-string">&#x27;__delattr__&#x27;</span>, <span class="hljs-string">&#x27;__dir__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__eq__&#x27;</span>, <span class="hljs-string">&#x27;__format__&#x27;</span>, <span class="hljs-string">&#x27;__ge__&#x27;</span>, <span class="hljs-string">&#x27;__get__&#x27;</span>, <span class="hljs-string">&#x27;__getattribute__&#x27;</span>, <span class="hljs-string">&#x27;__gt__&#x27;</span>, <span class="hljs-string">&#x27;__hash__&#x27;</span>, <span class="hljs-string">&#x27;__init__&#x27;</span>, <span class="hljs-string">&#x27;__le__&#x27;</span>, <span class="hljs-string">&#x27;__lt__&#x27;</span>, <span class="hljs-string">&#x27;__ne__&#x27;</span>, <span class="hljs-string">&#x27;__new__&#x27;</span>, <span class="hljs-string">&#x27;__reduce__&#x27;</span>, <span class="hljs-string">&#x27;__reduce_ex__&#x27;</span>, <span class="hljs-string">&#x27;__repr__&#x27;</span>, <span class="hljs-string">&#x27;__self__&#x27;</span>, <span class="hljs-string">&#x27;__self_class__&#x27;</span>, <span class="hljs-string">&#x27;__setattr__&#x27;</span>, <span class="hljs-string">&#x27;__sizeof__&#x27;</span>, <span class="hljs-string">&#x27;__str__&#x27;</span>, <span class="hljs-string">&#x27;__subclasshook__&#x27;</span>, <span class="hljs-string">&#x27;__thisclass__&#x27;</span>]<br><br></code></pre></td></tr></table></figure></li><li><p>请指出以下代码的问题所在：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                self.counter = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>                self.counter += <span class="hljs-number">1</span><br>                <span class="hljs-built_in">super</span>().__setattr__(name, value)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>                self.counter -= <span class="hljs-number">1</span><br>                <span class="hljs-built_in">super</span>().__delattr__(name)<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">以下注释：<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                self.counter = <span class="hljs-number">0</span> <span class="hljs-comment"># 这里会触发 __setattr__ 调用</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>                self.counter += <span class="hljs-number">1</span><br>“””既然需要 __setattr__ 调用后才能真正设置 self.counter 的值，所以这时候 self.counter 还没有定义，所以没法 += <span class="hljs-number">1</span>，错误的根源。”””<br>                <span class="hljs-built_in">super</span>().__setattr__(name, value)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>                self.counter -= <span class="hljs-number">1</span><br>                <span class="hljs-built_in">super</span>().__delattr__(name)<br><br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-34"><a href="#Practice-34" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>按要求重写魔法方法：当访问一个不存在的属性时，不报错且提示“该属性不存在！”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;该属性不存在！&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>编写 Demo 类，使得下边代码可以正常执行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>demo = Demo()<br><span class="hljs-meta">&gt;&gt;&gt; </span>demo.x<br><span class="hljs-string">&#x27;FishC&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>demo.x = <span class="hljs-string">&quot;X-man&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>demo.x<br><span class="hljs-string">&#x27;X-man&#x27;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = <span class="hljs-string">&#x27;FishC&#x27;</span><br>        <span class="hljs-keyword">return</span> self.name<br><br><br>demo = Demo()<br>demo.x<br>demo.x = <span class="hljs-string">&quot;X-man&quot;</span><br>demo.x<br></code></pre></td></tr></table></figure></li><li><p>修改上边【测试题】第 4 题，使之可以正常运行：编写一个 Counter 类，用于实时检测对象有多少个属性。、</p><p>程序实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>c = Counter()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.counter<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.y = <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.z = <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c.counter<br><span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c.x<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.counter<br><span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure><p><strong>方法一：此方法有一个bug，其实不是检测的某个对象的属性数量，而是检测整个类的所有对象的属性数量。。。</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span>:<br>    counter = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        Counter.counter += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">super</span>().__setattr__(name, value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>        Counter.counter -= <span class="hljs-number">1</span><br>        <span class="hljs-built_in">super</span>().__delattr__(name)<br><br>c = Counter()<br>c.x = <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(c.counter)<br>c.y = <span class="hljs-number">1</span><br>c.z = <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(c.counter)<br><span class="hljs-keyword">del</span> c.x<br><span class="hljs-built_in">print</span>(c.counter)<br></code></pre></td></tr></table></figure><p>方法二：方法二满足题目要求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                <span class="hljs-built_in">super</span>().__setattr__(<span class="hljs-string">&#x27;counter&#x27;</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>                <span class="hljs-built_in">super</span>().__setattr__(<span class="hljs-string">&#x27;counter&#x27;</span>, self.counter + <span class="hljs-number">1</span>)<br>                <span class="hljs-built_in">super</span>().__setattr__(name, value)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):<br>                <span class="hljs-built_in">super</span>().__setattr__(<span class="hljs-string">&#x27;counter&#x27;</span>, self.counter - <span class="hljs-number">1</span>)<br>                <span class="hljs-built_in">super</span>().__delattr__(name)<br><br></code></pre></td></tr></table></figure></li></ol><h1 id="046-魔法方法：描述符（Property的原理）"><a href="#046-魔法方法：描述符（Property的原理）" class="headerlink" title="046. 魔法方法：描述符（Property的原理）"></a>046. 魔法方法：描述符（Property的原理）</h1><h2 id="知识点-41"><a href="#知识点-41" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>描述符就是将某种特殊类型的类的实例指派给另一个类的属性。大家对于这个定义可能还不是很理解，等会会举例说明。首先，什么是特殊类型呢？特殊类型的要求是至少要实现以下三个方法其中一个或全部实现。</p><ul><li><code>__get(self, instance, owner)__</code>       用于访问属性，它返回属性的值</li><li><code>__set(self, instance, value)__</code>   将在属性分配操作中调用，不返回任何内容</li><li><code>__delete(self, instance)__</code>   控制删除操作，不返回任何内容</li></ul></li><li><p>一个例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDescriptor</span>:<br>  <span class="hljs-comment">#The first parameter, instance, refers to the object from which the descriptor is being called. In our first example, this would mean the client object.</span><br><br><span class="hljs-comment">#The owner parameter is a reference to the class of that object, which following our example (from the previous class diagram in The machinery behind descriptors section) would be ClientClass.</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;getting...&#x27;</span>, self, instance, owner)<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;setting...&#x27;</span>, self, instance, value)<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, instance</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;deleting...&#x27;</span>, self, instance)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br><span class="hljs-meta">... </span>    x = MyDescriptor()<br><span class="hljs-meta">... </span><br><br><br><span class="hljs-comment"># 先来写一个描述符 MyDescriptor，并且把所有方法的参数给打印出来。</span><br><br><span class="hljs-comment"># 再来一个真正的Test类来测试一下，就给一个属性 x ，把 MyDescriptor() 的实例指派给Test类的属性 x。我们就说</span><br><span class="hljs-comment"># MyDescriptor 类就是 x 的描述符。（是不是一下子感觉到了 property 的影子）。</span><br><br><span class="hljs-comment"># 我们下面实例化 Test 类，对 x 属性进行各种操作，看看描述符类 MyDescriptor 会有怎样的响应。</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x<br>getting... &lt;__main__.MyDescriptor <span class="hljs-built_in">object</span> at <span class="hljs-number">0x104b398e0</span>&gt; &lt;__main__.Test <span class="hljs-built_in">object</span> at <span class="hljs-number">0x1044d79a0</span>&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;__main__.Test&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test<br>&lt;__main__.Test <span class="hljs-built_in">object</span> at <span class="hljs-number">0x1044d79a0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>Test<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;__main__.Test&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x = <span class="hljs-string">&#x27;x-man&#x27;</span><br>setting... &lt;__main__.MyDescriptor <span class="hljs-built_in">object</span> at <span class="hljs-number">0x104b398e0</span>&gt; &lt;__main__.Test <span class="hljs-built_in">object</span> at <span class="hljs-number">0x1044d79a0</span>&gt; x-man<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> test.x<br>deleting... &lt;__main__.MyDescriptor <span class="hljs-built_in">object</span> at <span class="hljs-number">0x104b398e0</span>&gt; &lt;__main__.Test <span class="hljs-built_in">object</span> at <span class="hljs-number">0x1044d79a0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br></code></pre></td></tr></table></figure></li><li><blockquote><p>我们尝试直接打印 test.x ，我们看到会调用描述符的 get，并且参数的意义也很明确， self 是描述符类本身的实例，instance 参数是 它的拥有者 Test 的实例 test，我们直接打印 test，就和 instance 的内容一样，然后 owner 就是它的拥有者 Test 类本身，我们直接打印 Test，就和 owner 的内容一样。<br>然后赋值（test.x &#x3D; “x-man”）的时候，就会调用描述符的 set，删除（del test.x）的时候也是一样，调用__delete__。</p></blockquote></li><li><p>property 就是一个描述符类</p><ul><li><p>自定义一个 property（MyProperty），来实现property的所有功能</p></li><li><p>我们这里定义的MyProperty只是把 property的功能进行照搬，大家可以加入自己的创意</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperty</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, fget = <span class="hljs-literal">None</span>, fset = <span class="hljs-literal">None</span>, fdel = <span class="hljs-literal">None</span></span>):<br>self.fget = fget<br>self.fset = fset<br>self.fdel = fdel<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br><span class="hljs-keyword">return</span> self.fget(instance)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>self.fset(instance, value)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, instance</span>):<br>self.fdel(instance)<br> <br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>self._x = <span class="hljs-literal">None</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getx</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> self._x<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">setx</span>(<span class="hljs-params">self, value</span>):<br>self._x = value<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delx</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">del</span> self._x<br>x = MyProperty(getx, setx, delx)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>c = C()<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.x = <span class="hljs-string">&quot;x-man&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c._x<br><span class="hljs-string">&#x27;x-man&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> c.x<br><span class="hljs-meta">&gt;&gt;&gt; </span>c._x<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#62&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    c._x<br>AttributeError: <span class="hljs-string">&#x27;C&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;_x&#x27;</span><br><br></code></pre></td></tr></table></figure></li></ul></li><li><p>第二个例子：课堂练习</p><ul><li><p>先定义一个温度类，然后定义两个描述符类用于描述摄氏度和华氏度两个属性。</p></li><li><p>要求两个属性会自动进行转换，也就是说你可以给摄氏度这个属性赋值，然后打印的华氏度属性是自动转换后的结果。 公式：摄氏度 * 1.8 + 32 &#x3D; 华氏度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Celsius</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value = <span class="hljs-number">26.0</span></span>):<br>                self.value = <span class="hljs-built_in">float</span>(value)<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>                <span class="hljs-keyword">return</span> self.value<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>                self.value = <span class="hljs-built_in">float</span>(value)<br>                <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fahrenheit</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>                <span class="hljs-keyword">return</span> instance.cel * <span class="hljs-number">1.8</span> +<span class="hljs-number">32</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>                instance.cel = (<span class="hljs-built_in">float</span>(value) - <span class="hljs-number">32</span>) / <span class="hljs-number">1.8</span><br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Temperature</span>:<br>        cel = Celsius()<br>        fah = Fahrenheit()<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-39"><a href="#课后作业-39" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-39"><a href="#Quiz-39" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请尽量用自己的语言来解释什么是描述符（不要搜索来的答案，用自己的话解释）？</p><p>描述符其实就是个特殊的类，实例化之后赋值给目标类的属性， 描述符类有3个特殊的魔法函数，自动实现 (a). get 目标类实例的属性值，(b). set 目标类实例的属性值和 (c). 删除目标类实例的属性；</p><blockquote><p>答：有时候，某个应用程序可能会有一个相当微妙的需求，需要你设计一些更为复杂的操作来响应（例如每当属性被访问时，你也许想创建一个日志记录）。最好的解决方案就是编写一个用于执行这些“更复杂的操作”的特殊函数，然后指定它在属性被访问时运行。那么一个具有这种函数的对象被称之为描述符。<br>往再简单了说，描述符就是一个类，一个至少实现 get()、set() 或 delete() 三个特殊方法中的任意一个的类。</p></blockquote></li><li><p>描述符类中，分别通过哪些魔法方法来实现对属性的 get、set 和 delete 操作的？</p><ul><li><code>__get(self, instance, owner)__</code>       用于访问属性，它返回属性的值</li><li><code>__set(self, instance, value)__</code>   将在属性分配操作中调用，不返回任何内容</li><li><code>__delete(self, instance)__</code>   控制删除操作，不返回任何内容</li></ul></li><li><p>请问以下代码，分别调用 test.a 和 test.x，哪个会打印“getting…”?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;getting...&quot;</span>)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        a = MyDes()<br>        x = a<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><br></code></pre></td></tr></table></figure><p>test.a</p><p>test.x</p><p>test.a 会调用MyDes的 __get__方法<br>由于x&#x3D;a x相当于a的复制品，当然也能调用MyDes的__get__方法</p></li><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value = <span class="hljs-literal">None</span></span>):<br>        self.val = value<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>        <span class="hljs-keyword">return</span> self.val - <span class="hljs-number">20</span><br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>        self.val = value + <span class="hljs-number">10</span><br>        <span class="hljs-built_in">print</span>(self.val)<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br>    x = MyDes()<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:  <span class="hljs-comment"># 该模块被执行的话，执行下边语句。</span><br>    c = C()<br>    c.x = <span class="hljs-number">10</span><br>    <span class="hljs-built_in">print</span>(c.x)<br><br><br></code></pre></td></tr></table></figure><p>20</p><p>0</p><blockquote><p>c.x&#x3D;10触发了__set__方法 所以c.x修改为10+10&#x3D;20<br>print(c.x)打印出20 并触发了__get__方法，c.x的值修改为20-20&#x3D;0<br>然后在get里面打印出来0</p></blockquote></li><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value = <span class="hljs-literal">None</span></span>):<br>                self.val = value<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>                <span class="hljs-keyword">return</span> self.val ** <span class="hljs-number">2</span><br> <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>                self.x = MyDes(<span class="hljs-number">3</span>)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x<br><br><br></code></pre></td></tr></table></figure><p>访问实例层次上的描述符 x，只会返回描述符本身。为了让描述符能够正常工作，<em><strong>它们必须定义在类的层次上</strong></em>。如果你不这么做，那么 Python无法自动为你调用 <strong>get</strong> 和 <strong>set</strong> 方法。</p></li></ol><h3 id="Practice-35"><a href="#Practice-35" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>按要求编写描述符 MyDes：当类的属性被访问、修改或设置的时候，分别做出提醒。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        x = MyDes(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><span class="hljs-meta">&gt;&gt;&gt; </span>y = test.x<br>正在获取变量： x<br><span class="hljs-meta">&gt;&gt;&gt; </span>y<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x = <span class="hljs-number">8</span><br>正在修改变量： x<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> test.x <br>正在删除变量： x<br>噢~这个变量没法删除~<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x<br>正在获取变量： x<br><span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, initval=<span class="hljs-number">0</span>, attr=<span class="hljs-literal">None</span></span>):<br>        self.Value = initval<br>        self.attr = attr<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在获取变量： &#x27;</span> + self.attr)<br>        <span class="hljs-keyword">return</span> self.Value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在修改变量： &#x27;</span> + self.attr)<br>        self.Value = value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, instance</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在删除变量：&#x27;</span> + self.attr)<br>        <span class="hljs-keyword">del</span> self<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>    x = MyDes(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>按要求编写描述符 Record：记录指定变量的读取和写入操作，并将记录以及触发时间保存到文件：record.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        x = Record(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br>        y = Record(<span class="hljs-number">8.8</span>, <span class="hljs-string">&#x27;y&#x27;</span>)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x<br><span class="hljs-number">10</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.y<br><span class="hljs-number">8.8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x = <span class="hljs-number">123</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x = <span class="hljs-number">1.23</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.y = <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br>&gt;&gt;&gt;<br><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200731180156540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhdHJ0ZWVz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 按要求编写描述符 Record：记录指定变量的读取和写入操作，并将记录以及触发时间保存到文件：record.txt</span><br><span class="hljs-keyword">import</span> time <span class="hljs-keyword">as</span> t<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Record</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, initval, name</span>):<br>        self.log_file = <span class="hljs-string">&#x27;/Users/felix_yang/PycharmProjects/learningpython/46/record.txt&#x27;</span><br>        self.Value = initval<br>        self.name = name<br>        self.action = <span class="hljs-literal">None</span><br>        self.atime = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>        self.action = <span class="hljs-string">&#x27;读取&#x27;</span><br>        self.atime = t.strftime(<span class="hljs-string">&quot;%a %b %d %H:%M:%S %Y %z&quot;</span>, t.gmtime())<br>        self.event = <span class="hljs-string">&#x27;&#123;&#125; 变量于北京时间 &#123;&#125; 被 &#123;&#125;, &#123;&#125;=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.name,<br>                                                        self.atime,<br>                                                        self.action,<br>                                                        self.name,<br>                                                        self.Value<br>                                                        )<br>        self._logging(self.event)<br>        <span class="hljs-keyword">return</span> self.Value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>        self.Value = value<br>        self.action = <span class="hljs-string">&#x27;修改&#x27;</span><br>        self.atime = t.strftime(<span class="hljs-string">&quot;%a %b %d %H:%M:%S %Y %z&quot;</span>, t.gmtime())<br>        self.event = <span class="hljs-string">&#x27;&#123;&#125; 变量于北京时间 &#123;&#125; 被 &#123;&#125;, &#123;&#125;=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.name,<br>                                                        self.atime,<br>                                                        self.action,<br>                                                        self.name,<br>                                                        self.Value<br>                                                        )<br>        self._logging(self.event)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_logging</span>(<span class="hljs-params">self, event</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.log_file, <span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(event)<br>            f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><br><br></code></pre></td></tr></table></figure><p>课后答案：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Record</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, initval=<span class="hljs-literal">None</span>, name=<span class="hljs-literal">None</span></span>):<br>        self.name=name<br>        self.Value=initval<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self,instance,owner</span>):<br>        f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;record.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>        f.write(<span class="hljs-string">&quot;%s 变量于北京时间%s被访问，%s = %s\n&quot;</span> % (self.name, time.ctime(), self.name,<span class="hljs-built_in">str</span>(self.Value)))<br>        f.close()<br>        <span class="hljs-keyword">return</span> self.Value<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self,instance,Value</span>):<br>        f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;record.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>        f.write(<span class="hljs-string">&quot;%s 变量于北京时间%s被修改，%s = %s\n&quot;</span> % (self.name, time.ctime(), self.name,<span class="hljs-built_in">str</span>(self.Value)))<br>        f.close()<br>        self.Value=Value<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self,instance</span>):<br>        <span class="hljs-keyword">del</span> self<br><br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        x = Record(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br>        y = Record(<span class="hljs-number">8.8</span>, <span class="hljs-string">&#x27;y&#x27;</span>)<br><br><br></code></pre></td></tr></table></figure></li><li><p>再来一个有趣的案例：编写描述符 MyDes，使用文件来存储属性，属性的值会直接存储到对应的pickle（腌菜，还记得吗？）的文件中。如果属性被删除了，文件也会同时被删除，属性的名字也会被注销。</p><p>举个栗子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        x = MyDes(<span class="hljs-string">&#x27;x&#x27;</span>)<br>        y = MyDes(<span class="hljs-string">&#x27;y&#x27;</span>)<br>        <br><span class="hljs-meta">&gt;&gt;&gt; </span>test = Test()<br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x = <span class="hljs-number">123</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.y = <span class="hljs-string">&quot;I love FishC.com!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.x<br><span class="hljs-number">123</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>test.y<br><span class="hljs-string">&#x27;I love FishC.com!&#x27;</span><br><br></code></pre></td></tr></table></figure><p>产生对应的文件存储变量的值：</p><p><img src="https://img-blog.csdnimg.cn/20200731181640821.png" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> test.x<br>&gt;&gt;&gt;<br><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200731181650271.png" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 再来一个有趣的案例：编写描述符 MyDes，使用文件来存储属性，属性的值会直接存储到对应的pickle</span><br><span class="hljs-comment"># （腌菜，还记得吗？）的文件中。如果属性被删除了，文件也会同时被删除，属性的名字也会被注销。</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.attr_file = <span class="hljs-literal">None</span><br>        self.name = name<br>        self.Value = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, owner</span>):<br>        <span class="hljs-keyword">return</span> self.Value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, instance, value</span>):<br>        self.attr_file = <span class="hljs-string">&#x27;/Users/felix_yang/PycharmProjects/learningpython/46/ %s.pkl&#x27;</span> % self.name<br>        self.Value = value<br>        self._storeattr(self.Value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, instance</span>):<br>        self.attr_file = <span class="hljs-string">&#x27;/Users/felix_yang/PycharmProjects/learningpython/46/ %s.pkl&#x27;</span> % self.name<br>        os.remove(self.attr_file)<br>        <span class="hljs-keyword">del</span> self<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_storeattr</span>(<span class="hljs-params">self, attr</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.attr_file, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> pickle_file:<br>            pickle.dump(attr, pickle_file)<br><br></code></pre></td></tr></table></figure><p>课后答案：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDes</span>:<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name=<span class="hljs-literal">None</span></span>):<br>        self.name=name<br>        self.filePath=self.name+<span class="hljs-string">&#x27;.txt&#x27;</span><br>        self.saved=[]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self,instance,owner</span>):<br>        <span class="hljs-keyword">if</span> self.name <span class="hljs-keyword">in</span> self.saved:<br>            <span class="hljs-keyword">return</span> self.Value<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;属性尚未赋值&quot;</span>)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self,instance,Value</span>):<br>        self.Value=Value<br>        f=<span class="hljs-built_in">open</span>(self.filePath,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>        pickle.dump( <span class="hljs-built_in">str</span>(<span class="hljs-string">&quot;%s修改值为%s&quot;</span> %(self.name,self.Value)),f)<br>        f.close()<br>        self.saved.append(self.name)<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self,instance</span>):<br>        os.remove(self.filePath)<br>        <span class="hljs-keyword">del</span> self<br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>        x = MyDes(<span class="hljs-string">&#x27;x&#x27;</span>)<br>        y = MyDes(<span class="hljs-string">&#x27;y&#x27;</span>)<br><br><br>test=Test()<br>test.x<br>test.x=<span class="hljs-number">10</span><br><br><br></code></pre></td></tr></table></figure></li></ol><h1 id="047-魔法方法：定制序列"><a href="#047-魔法方法：定制序列" class="headerlink" title="047. 魔法方法：定制序列"></a>047. 魔法方法：定制序列</h1><h2 id="知识点-42"><a href="#知识点-42" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>协议（Protocols）与其他编程语言中的接口很相似，它规定你哪些方法必须要定义。然而，在Python中的协议就显得不那么正式。事实上，在Python中，协议更像是一种指南。</p></li><li><p>定制容器的协议</p><ul><li>如果你希望定制的容器是不可变的话，你只需要定义<code>__len__()和__getitem__()</code>方法　　   　                （str、tuple）</li><li>如果你希望定制的容器是可变的话，你需要定义<code>__len__()、__getitem__()、__setitem__()和__delitem__()</code>方法     （list）</li></ul></li><li><p>下表列举了定制容器类型相关的魔法方法及定义</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">__len__(self)    　　　　　　            定义当被 <span class="hljs-built_in">len</span>() 调用时的行为（返回容器中元素的个数）<br>__getitem__(self, key)                 定义获取容器中指定元素的行为，相当于 self[key]<br>__setitem__(self, key, value)          定义设置容器中指定元素的行为，相当于 self[key] = value<br>__delitem__(self, key)                 定义删除容器中指定元素的行为，相当于 <span class="hljs-keyword">del</span> self[key]<br>__iter__(self)                         定义当迭代容器中的元素的行为<br>__reversed__(self)                     定义当被 <span class="hljs-built_in">reversed</span>() 调用时的行为<br>__contains__(self, item)               定义当使用成员测试运算符（<span class="hljs-keyword">in</span> 或 <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span>）时的行为<br></code></pre></td></tr></table></figure></li><li><p>一个例子</p><ul><li><p>定义一个不可改变的列表，且可以记录每个元素的访问次数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">22</span>]: <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyList</span>:<br>    ...:     <span class="hljs-comment"># python中很有趣的两个小东西，先介绍：</span><br>    ...:     <span class="hljs-comment"># 1、*args保存多余变量，保存方式为元组。</span><br>    ...:     <span class="hljs-comment"># 2、**args保存带有变量名的多余变量，保存方式为字典。</span><br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args</span>):<br>    ...:         self.values = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> args]<br>    ...:         self.count = &#123;&#125;.fromkeys(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.values)), <span class="hljs-number">0</span>)<br>      <span class="hljs-comment">#这里使用列表的下标作为字典的键，注意不能用元素作为字典的键</span><br>        <span class="hljs-comment">#因为列表的不同下标可能有值一样的元素，但字典不能有两个相同的键</span><br>    ...: <br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>    ...:         <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.count)<br>    ...: <br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, item</span>):<br>    ...:         self.count[item] += <span class="hljs-number">1</span><br>    ...:         <span class="hljs-keyword">return</span> self.values[item]<br>    ...: <br><br>In [<span class="hljs-number">23</span>]: <br><br>In [<span class="hljs-number">23</span>]: list1 = MyList(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br><br>In [<span class="hljs-number">24</span>]: list1[<span class="hljs-number">0</span>]<br>Out[<span class="hljs-number">24</span>]: <span class="hljs-number">1</span><br><br>In [<span class="hljs-number">25</span>]: list1[<span class="hljs-number">1</span>]<br>Out[<span class="hljs-number">25</span>]: <span class="hljs-number">3</span><br><br>In [<span class="hljs-number">26</span>]: list1.count<br>Out[<span class="hljs-number">26</span>]: &#123;<span class="hljs-number">0</span>: <span class="hljs-number">1</span>, <span class="hljs-number">1</span>: <span class="hljs-number">1</span>, <span class="hljs-number">2</span>: <span class="hljs-number">0</span>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-40"><a href="#课后作业-40" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-40"><a href="#Quiz-40" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>你知道 Python 基于序列的三大容器类指的是什么吗？</p><p>List, Turple, String</p></li><li><p>Python 允许我们自己定制容器，如果你想要定制一个不可变的容器（像 String），你就不能定义什么方法？</p><p>如果你想要定制一个不可变的容器（像 String），你就不能定义像 __ setitem __() 和 __ delitem __() 这些会修改容器中的数据的方法。</p></li><li><p>如果希望定制的容器支持 reversed() 内置函数，那么你应该定义什么方法？</p><p><code>__reversed__(self)  </code></p></li><li><p>既然是容器，必然要提供能够查询“容量”的方法，那么请问需要定义什么方法呢？</p><p>在 Python 中，我们通过 len() 内置函数来查询容器的“容量”，所以容器应该定义 __ len __() 方法。</p></li><li><p>通过定义哪些方法使得容器支持读、写和删除的操作？</p><p><code>读 —— __ getitem __()，写 —— __ setitem __()，删除 —— __ delitem __(),</code></p></li><li><p>为什么小甲鱼说“在 Python 中的协议就显得不那么正式”？</p><p>在 Python 中，协议更像是一种指南。这有点像我们之前在课后作业中提到的“鸭子类型”（忘了的朋友请戳：<a href="http://bbs.fishc.com/thread-51471-1-1.html%EF%BC%89">http://bbs.fishc.com/thread-51471-1-1.html）</a> —— 当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。Python就是这样，并不会严格地要求你一定要怎样去做，而是让你靠着自觉和经验把事情做好！</p></li></ol><h3 id="Practice-36"><a href="#Practice-36" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>根据上面的例子，定制一个列表，同样要求记录列表中每个元素被访问的次数。并且支持append()、pop()、extand()原生列表所拥有的方法。</p><p>要求：</p><ul><li><p>实现获取、设置和删除一个元素的行为(删除一个元素的时候对应的计数器也会被删除)</p></li><li><p>增加counter(index)方法，返回index参数所指定的元素记录的访问次数</p></li><li><p>实现append()、pop()、remove()、insert()、clear()和reverse()方法(重写这些方法时要注意考虑计数器的对应改变)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CountList</span>(<span class="hljs-title class_ inherited__">list</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args</span>):<br>        <span class="hljs-built_in">super</span>().__init__(args)<br>        self.count = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> args:<br>            self.count.append(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.count)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, key</span>):<br>        self.count[key] += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__getitem__(key)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, key, value</span>):<br>        self.count[key] += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">super</span>().__setitem__(key, value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delitem__</span>(<span class="hljs-params">self, key</span>):<br>        <span class="hljs-keyword">del</span> self.count[key]<br>        <span class="hljs-built_in">super</span>().__delitem__(key)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">counter</span>(<span class="hljs-params">self, key</span>):<br>        <span class="hljs-keyword">return</span> self.count[key]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">append</span>(<span class="hljs-params">self, value</span>):<br>        self.count.append(<span class="hljs-number">0</span>)<br>        <span class="hljs-built_in">super</span>().append(value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self, key=-<span class="hljs-number">1</span></span>):<br>        <span class="hljs-keyword">del</span> self.count[key]<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().pop(key)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">self, value</span>):<br>        key = <span class="hljs-built_in">super</span>().index(value)<br>        <span class="hljs-keyword">del</span> self.count[key]<br>        <span class="hljs-built_in">super</span>().remove(value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self, key, value</span>):<br>        self.count.insert(key, <span class="hljs-number">0</span>)<br>        <span class="hljs-built_in">super</span>().insert(key, value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params">self</span>):<br>        self.count.clear()<br>        <span class="hljs-built_in">super</span>().clear()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">self</span>):<br>        self.count.reverse()<br>        <span class="hljs-built_in">super</span>().reverse()<br><br><br></code></pre></td></tr></table></figure></li></ul></li></ol><h1 id="048-魔法方法：迭代器"><a href="#048-魔法方法：迭代器" class="headerlink" title="048. 魔法方法：迭代器"></a>048. 魔法方法：迭代器</h1><h2 id="知识点-43"><a href="#知识点-43" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>迭代： 类似于循环，每一个重复的过程被称为一次迭代，而每一次迭代的结果将被用来作为下一次迭代的初始值；</p><ul><li><p>提供迭代方法的容器，被称为迭代器</p></li><li><p>序列：元组，列表，字符串都是迭代器，字典和文件也是迭代器; 注意字典迭代的是键</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">33</span>]: links = &#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&#x27;felix_yang&#x27;</span>,\<br>    ...:         <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-number">12</span><br>    ...:         &#125;<br><br>In [<span class="hljs-number">35</span>]: <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> links:<br>    ...:     <span class="hljs-built_in">print</span>((<span class="hljs-string">&#x27;&#123;&#125;-&gt;&#123;&#125;&#x27;</span>).<span class="hljs-built_in">format</span>(each, links[each]))<br>    ...: <br>name-&gt;felix_yang<br>age-&gt;<span class="hljs-number">12</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>Python 提供了2个BIF 函数处理迭代器</p><ul><li><p>iter()</p><ul><li>对于一个容器对象，iter() 返回一个迭代器</li></ul></li><li><p>next()</p><ul><li>返回迭代器的下一个元素; 如果迭代器没有值可以返回了，python会抛出一个异常：<em><strong>StopIteration</strong></em></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">36</span>]: string = <span class="hljs-string">&#x27;FishC&#x27;</span><br><br>In [<span class="hljs-number">37</span>]: it = <span class="hljs-built_in">iter</span>(string)<br><br>In [<span class="hljs-number">38</span>]: <span class="hljs-built_in">next</span>(it)<br>Out[<span class="hljs-number">38</span>]: <span class="hljs-string">&#x27;F&#x27;</span><br><br>In [<span class="hljs-number">40</span>]: <span class="hljs-built_in">next</span>(it)<br>Out[<span class="hljs-number">40</span>]: <span class="hljs-string">&#x27;i&#x27;</span><br><br>In [<span class="hljs-number">41</span>]: <span class="hljs-built_in">next</span>(it)<br>Out[<span class="hljs-number">41</span>]: <span class="hljs-string">&#x27;s&#x27;</span><br><br>In [<span class="hljs-number">42</span>]: <span class="hljs-built_in">next</span>(it)<br>Out[<span class="hljs-number">42</span>]: <span class="hljs-string">&#x27;h&#x27;</span><br><br>In [<span class="hljs-number">43</span>]: <span class="hljs-built_in">next</span>(it)<br>Out[<span class="hljs-number">43</span>]: <span class="hljs-string">&#x27;C&#x27;</span><br><br>In [<span class="hljs-number">44</span>]: <span class="hljs-built_in">next</span>(it)<br>---------------------------------------------------------------------------<br>StopIteration                             Traceback (most recent call last)<br>Input In [<span class="hljs-number">44</span>], <span class="hljs-keyword">in</span> &lt;cell line: <span class="hljs-number">1</span>&gt;()<br>----&gt; <span class="hljs-number">1</span> <span class="hljs-built_in">next</span>(it)<br><br>StopIteration:<br></code></pre></td></tr></table></figure></li><li><p>for 语句是怎么工作的呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">45</span>]: string = <span class="hljs-string">&#x27;FishC&#x27;</span><br><br>In [<span class="hljs-number">46</span>]: it = <span class="hljs-built_in">iter</span>(string)<br><br><br>In [<span class="hljs-number">49</span>]: <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    ...:     <span class="hljs-keyword">try</span>:<br>    ...:         each = <span class="hljs-built_in">next</span>(it)<br>    ...:     <span class="hljs-keyword">except</span> StopIteration:<br>    ...:         <span class="hljs-keyword">break</span><br>    ...:     <span class="hljs-built_in">print</span>(each)<br>    ...: <br>F<br>i<br>s<br>h<br>C<br></code></pre></td></tr></table></figure></li></ul></li><li><p>迭代器的魔法方法</p><ul><li><p><code>__iter()__</code>  返回迭代器本身</p></li><li><p><code>__next()__</code>  决定了迭代的规则</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">54</span>]: <span class="hljs-keyword">class</span> <span class="hljs-title class_">fibonacci</span>:<br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n=<span class="hljs-number">10</span></span>):<br>    ...:         self.a = <span class="hljs-number">0</span><br>    ...:         self.b = <span class="hljs-number">1</span><br>    ...:         self.n = n<br>    ...: <br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>    ...:         <span class="hljs-keyword">return</span> self<br>    ...: <br>    ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>    ...:         <span class="hljs-keyword">if</span> self.b &lt; self.n:<br>    ...:             self.a, self.b = self.b, self.a + self.b<br>    ...:         <span class="hljs-keyword">else</span>:<br>    ...:             <span class="hljs-keyword">raise</span> StopIteration<br>    ...:         <span class="hljs-keyword">return</span> self.a<br>    ...: <br><br>In [<span class="hljs-number">55</span>]: <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> fib:<br>    ...:     <span class="hljs-built_in">print</span>(each)<br>    ...: <br><br>In [<span class="hljs-number">56</span>]: fib  = fibonacci(<span class="hljs-number">20</span>)<br><br>In [<span class="hljs-number">57</span>]: <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> fib:<br>    ...:     <span class="hljs-built_in">print</span>(each)<br>    ...: <br><span class="hljs-number">1</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">5</span><br><span class="hljs-number">8</span><br><span class="hljs-number">13</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="课后作业-41"><a href="#课后作业-41" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-41"><a href="#Quiz-41" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>请用你的话解释一下“迭代”的概念？</p><p>类似于循环，每一个重复的过程被称为一次迭代，而每一次迭代的结果将被用来作为下一次迭代的初始值</p></li><li><p>迭代器是一个容器吗？</p><p>不是。因为我们耳熟能详的容器像列表，字典，元组都是可以存放数据的，而迭代器就是实现了__next__()方法的对象（用于<a href="https://so.csdn.net/so/search?q=%E9%81%8D%E5%8E%86&spm=1001.2101.3001.7020">遍历</a>容器中的数据）</p></li><li><p>迭代器可以回退（获取上一个值）吗？</p><p>迭代器性质决定没有办法回退，只能往前进行迭代。但这并不是什么很大的缺点，因为我们几乎不需要在迭代途中进行回退操作。</p></li><li><p>如何快速判断一个容器是否具有迭代功能？</p><p>判断该容器是否拥有<code> __ iter__() 和 __ next__()</code> 魔法方法。</p></li><li><p>for 语句如何判断迭代器里边已经取空了？</p><p>迭代器通过 __ next__() 方法每次返回一个元素，并指向下一个元素。如果当前位置已无元素，通过抛出 StopIteration 异常表示。</p></li><li><p>在 Python 原生支持的数据结构中，你知道哪一个是只能用迭代器访问的吗？</p><p>set。对于原生支持随机访问的数据结构（如tuple、list），可以使用迭代器或者下标索引的形式访问，但对于无法随机访问的数据结构 set 而言，迭代器是唯一的访问元素的方式。</p><p>注意，集合的元素是无序的，无法通过索引操作元素； </p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">set1 = <span class="hljs-built_in">set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>])</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">set1</span><br>&#123;1, 2, 3, 4, 5&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-37"><a href="#Practice-37" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>用 while 语句实现与以下 for 语句相同的功能：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    <span class="hljs-built_in">print</span>(each)<br><br></code></pre></td></tr></table></figure><p>程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">it = <span class="hljs-built_in">iter</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>))<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        each = <span class="hljs-built_in">next</span>(it)<br>    <span class="hljs-keyword">except</span> StopIteration:<br>      <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(each)<br></code></pre></td></tr></table></figure></li><li><p>写一个迭代器，要求输出至今为止的所有闰年。如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>leapYears = LeapYear()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> leapYears:<br>        <span class="hljs-keyword">if</span> i &gt;=<span class="hljs-number">2000</span>:<br>                <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">break</span><br><br><span class="hljs-number">2012</span><br><span class="hljs-number">2008</span><br><span class="hljs-number">2004</span><br><span class="hljs-number">2000</span><br><br></code></pre></td></tr></table></figure><p>程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime <span class="hljs-keyword">as</span> dt<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LeapYear</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.now = dt.date.today().year<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isLeapYear</span>(<span class="hljs-params">self, year</span>):<br>        <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> year % <span class="hljs-number">100</span> != <span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> (year % <span class="hljs-number">400</span> == <span class="hljs-number">0</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.isLeapYear(self.now):<br>            self.now -= <span class="hljs-number">1</span><br><br>        temp = self.now<br>        self.now -= <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> temp<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">114</span>]: <span class="hljs-keyword">import</span> datetime <span class="hljs-keyword">as</span> dt<br>     ...: <br>     ...: <br>     ...: <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeapYear</span>:<br>     ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>     ...:         self.now = dt.date.today().year<br>     ...: <br>     ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">isLeapYear</span>(<span class="hljs-params">self, year</span>):<br>     ...:         <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> year % <span class="hljs-number">100</span> != <span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> (year % <span class="hljs-number">400</span> == <span class="hljs-number">0</span>):<br>     ...:             <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>     ...:         <span class="hljs-keyword">else</span>:<br>     ...:             <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>     ...: <br>     ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>     ...:         <span class="hljs-keyword">return</span> self<br>     ...: <br>     ...:     <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>     ...:         <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.isLeapYear(self.now):<br>     ...:             self.now -= <span class="hljs-number">1</span><br>     ...: <br>     ...:         temp = self.now<br>     ...:         self.now -= <span class="hljs-number">1</span><br>     ...: <br>     ...:         <span class="hljs-keyword">return</span> temp<br>     ...: <br><br>In [<span class="hljs-number">115</span>]: leapYears = LeapYear()<br>     ...: <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> leapYears:<br>     ...:     <span class="hljs-keyword">if</span> i &gt;= <span class="hljs-number">2000</span>:<br>     ...:         <span class="hljs-built_in">print</span>(i)<br>     ...:     <span class="hljs-keyword">else</span>:<br>     ...:         <span class="hljs-keyword">break</span><br>     ...: <br><span class="hljs-number">2020</span><br><span class="hljs-number">2016</span><br><span class="hljs-number">2012</span><br><span class="hljs-number">2008</span><br><span class="hljs-number">2004</span><br><span class="hljs-number">2000</span><br></code></pre></td></tr></table></figure></li><li><p>要求自己写一个 MyRev 类，功能与 reversed() 相同（内置函数 reversed(seq) 是返回一个迭代器，是序列 seq 的逆序显示）。例如：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; myRev = MyRev(<span class="hljs-string">&quot;FishC&quot;</span>)<br>&gt;&gt;&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> myRev:<br>    <span class="hljs-built_in">print</span>(i, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>ChsiF<br></code></pre></td></tr></table></figure><p>程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRev</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, item</span>):<br>        self.item = item<br>        self.index = -<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:<br>            temp = self.item[self.index]<br>            self.index -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">except</span> IndexError:<br>            <span class="hljs-keyword">raise</span> StopIteration<br>        <span class="hljs-keyword">return</span> temp<br><br>In [<span class="hljs-number">130</span>]: myRev = MyRev(<span class="hljs-string">&quot;FishC&quot;</span>)<br><br>In [<span class="hljs-number">131</span>]: <br><br>In [<span class="hljs-number">131</span>]: <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> myRev:<br>     ...:     <span class="hljs-built_in">print</span>(i, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>     ...: <br>ChsiF<br></code></pre></td></tr></table></figure></li></ol><h1 id="049-乱入：生成器"><a href="#049-乱入：生成器" class="headerlink" title="049. 乱入：生成器"></a>049. 乱入：生成器</h1><h2 id="知识点-44"><a href="#知识点-44" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>协同程序就是可以运行的独立函数调用，函数可以暂停或者挂起，并在需要的时候在程序离开的地方继续或者重新开始</p></li><li><p>生成器是迭代器的一种，是一种特殊的函数，调用可以中断，可以暂停; </p></li><li><p>生成器实现方式一： 在普通函数中加入yield 语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">1</span>]: <span class="hljs-keyword">def</span> <span class="hljs-title function_">myGen</span>():<br>   ...:     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;生成器被执行！&#x27;</span>)<br>   ...:     <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span><br>   ...:     <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span><br>   ...: <br><br>In [<span class="hljs-number">3</span>]: myG = myGen()<br><br>In [<span class="hljs-number">4</span>]: <span class="hljs-built_in">next</span>(myG)<br>生成器被执行！<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">1</span><br><br>In [<span class="hljs-number">5</span>]: <span class="hljs-built_in">next</span>(myG)<br>Out[<span class="hljs-number">5</span>]: <span class="hljs-number">2</span><br><br>In [<span class="hljs-number">6</span>]: <span class="hljs-built_in">next</span>(myG)<br>---------------------------------------------------------------------------<br>StopIteration                             Traceback (most recent call last)<br>Input In [<span class="hljs-number">6</span>], <span class="hljs-keyword">in</span> &lt;cell line: <span class="hljs-number">1</span>&gt;()<br>----&gt; <span class="hljs-number">1</span> <span class="hljs-built_in">next</span>(myG)<br><br>StopIteration:<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">8</span>]: <span class="hljs-keyword">def</span> <span class="hljs-title function_">myGen</span>():<br>   ...:     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;生成器被执行！&#x27;</span>)<br>   ...:     <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span><br>   ...:     <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span><br><br>In [<span class="hljs-number">10</span>]: myG = myGen()<br><br>In [<span class="hljs-number">11</span>]: <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> myG:<br>    ...:     <span class="hljs-built_in">print</span>(i)<br>    ...: <br>生成器被执行！<br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><ul><li>fibonacci 数列通过生成器来实现</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fiboGen</span>(<span class="hljs-params">m</span>):<br>    a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> b &lt; m:<br>        <span class="hljs-keyword">yield</span> b<br>        a, b = b, a + b<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;done&#x27;</span><br><br><br>f = fiboGen(<span class="hljs-number">10</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f:<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">12</span>]: <span class="hljs-keyword">def</span> <span class="hljs-title function_">fiboGen</span>(<span class="hljs-params">m</span>):<br>    ...:     a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>    ...:     <span class="hljs-keyword">while</span> b &lt; m:<br>    ...:         <span class="hljs-keyword">yield</span> b<br>    ...:         a, b = b, a + b<br>    ...:     <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;done&#x27;</span><br>    ...: <br><br>In [<span class="hljs-number">13</span>]: f = fiboGen(<span class="hljs-number">10</span>)<br><br>In [<span class="hljs-number">14</span>]: <span class="hljs-built_in">next</span>(f)<br>Out[<span class="hljs-number">14</span>]: <span class="hljs-number">1</span><br><br>In [<span class="hljs-number">15</span>]: <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f:<br>    ...:     <span class="hljs-built_in">print</span>(i)<br>    ...: <br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">5</span><br><span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure></li><li><p>生成器实现方式二：</p><ul><li>推导式:  列表推导式，字典推导式，集合推导式</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">16</span>]: a = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (i % <span class="hljs-number">2</span>) <span class="hljs-keyword">and</span> i % <span class="hljs-number">3</span>]<br><br>In [<span class="hljs-number">17</span>]: a<br>Out[<span class="hljs-number">17</span>]: <br>[<span class="hljs-number">2</span>,<br> <span class="hljs-number">4</span>,<br> <span class="hljs-number">8</span>,<br> <span class="hljs-number">10</span>,<br> <span class="hljs-number">14</span>,<br> <span class="hljs-number">16</span>,<br> <span class="hljs-number">20</span>,<br> <span class="hljs-number">22</span>,<br> <span class="hljs-number">26</span>,<br> <span class="hljs-number">28</span>,<br> <span class="hljs-number">32</span>,<br> <span class="hljs-number">34</span>,<br> <span class="hljs-number">38</span>,<br> <span class="hljs-number">40</span>,<br> <span class="hljs-number">44</span>,<br> <span class="hljs-number">46</span>,<br> <span class="hljs-number">50</span>,<br> <span class="hljs-number">52</span>,<br> <span class="hljs-number">56</span>,<br> <span class="hljs-number">58</span>,<br> <span class="hljs-number">62</span>,<br> <span class="hljs-number">64</span>,<br> <span class="hljs-number">68</span>,<br> <span class="hljs-number">70</span>,<br> <span class="hljs-number">74</span>,<br> <span class="hljs-number">76</span>,<br> <span class="hljs-number">80</span>,<br> <span class="hljs-number">82</span>,<br> <span class="hljs-number">86</span>,<br> <span class="hljs-number">88</span>,<br> <span class="hljs-number">92</span>,<br> <span class="hljs-number">94</span>,<br> <span class="hljs-number">98</span>]<br><br>In [<span class="hljs-number">18</span>]: b = &#123;i:i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)&#125;<br><br>In [<span class="hljs-number">19</span>]: b<br>Out[<span class="hljs-number">19</span>]: <br>&#123;<span class="hljs-number">0</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-number">1</span>: <span class="hljs-literal">False</span>,<br> <span class="hljs-number">2</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-number">3</span>: <span class="hljs-literal">False</span>,<br> <span class="hljs-number">4</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-number">5</span>: <span class="hljs-literal">False</span>,<br> <span class="hljs-number">6</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-number">7</span>: <span class="hljs-literal">False</span>,<br> <span class="hljs-number">8</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-number">9</span>: <span class="hljs-literal">False</span>&#125;<br><br>In [<span class="hljs-number">20</span>]: c = &#123;i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]&#125;<br><br>In [<span class="hljs-number">21</span>]: c<br>Out[<span class="hljs-number">21</span>]: &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>那有没有元组推导式呢？</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">22</span>]: e = (i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>))<br><br>In [<span class="hljs-number">23</span>]: e<br>Out[<span class="hljs-number">23</span>]: &lt;generator <span class="hljs-built_in">object</span> &lt;genexpr&gt; at <span class="hljs-number">0x106a87120</span>&gt;<br></code></pre></td></tr></table></figure><p>其实用（）括起来的推导式，其实就是生成器 “<generator object>”</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">In</span> [<span class="hljs-number">24</span>]: <span class="hljs-built_in">sum</span>((i for i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span>))<br><span class="hljs-keyword">Out</span>[<span class="hljs-number">24</span>]: <span class="hljs-number">2500</span><br><br><span class="hljs-keyword">In</span> [<span class="hljs-number">25</span>]: <span class="hljs-built_in">sum</span>(i for i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span>)<br><span class="hljs-keyword">Out</span>[<span class="hljs-number">25</span>]: <span class="hljs-number">2500</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="课后作业-42"><a href="#课后作业-42" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-42"><a href="#Quiz-42" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>通常，一般的函数从第一行代码开始执行，并在什么情况下结束？</p><p>对于调用一个普通的 Python 函数，一般是从函数的第一行代码开始执行，结束于 return 语句、异常或者函数所有语句执行完毕。一旦函数将控制权交还给调用者，就意味着全部结束。函数中做的所有工作以及保存在局部变量中的数据都将丢失。如果再次调用这个函数时，一切都将重新开始。</p></li><li><p>什么是协同程序？</p><p>所谓的协同程序就是可以运行的独立函数调用，函数可以暂停或者<a href="https://so.csdn.net/so/search?q=%E6%8C%82%E8%B5%B7&spm=1001.2101.3001.7020">挂起</a>，并在需要的时候从程序离开的地方继续或者重新开始。<br>Python 是通过生成器来实现类似于协同程序的概念：生成器可以暂时挂起函数，并保留函数的局部变量等数据，然后在再次调用它的时候，从上次暂停的位置继续执行下去。</p></li><li><p>生成器所能实现的任何操作都可以由迭代器来代替吗，为什么？</p><p>是的，都可以。因为生成器事实上就是基于迭代器来实现的，生成器只需要一个 yield 语句即可，但它内部会自动创建 __ iter__() 和 __ next__() 方法。</p></li><li><p>将一个函数改造为生成器，说白了就是把什么语句改为 yield 语句？</p><p>Return 语句</p></li><li><p>说到底，生成器的最大作用是什么？</p><p>使得函数可以“保留现场”，当下一次执行该函数是从上一次结束的地方开始，而不是重头再来。</p></li><li><p>如下，get_prime() 是一个获得素数的生成器，请问第 2 行代码 while True 有何作用？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_primes</span>(<span class="hljs-params">number</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> is_prime(number):<br>            <span class="hljs-keyword">yield</span> number<br>        number += <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><p><em><strong>这个 while True 循环是用来确保生成器函数永远也不会执行到函数末尾的</strong></em>。只要调用 next() 这个生成器就会生成一个值。这是一个处理无穷序列的常见方法（这类生成器也是很常见的）。</p></li></ol><h3 id="Practice-38"><a href="#Practice-38" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>要求实现一个功能与 reversed() 相同（内置函数 reversed(seq) 是返回一个迭代器，是序列 seq 的逆序显示）的生成器。例如：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> myRev(<span class="hljs-string">&quot;FishC&quot;</span>):<br>    <span class="hljs-built_in">print</span>(i, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>ChsiF<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">myRev</span>(<span class="hljs-params">seq</span>):<br>    seq_len = <span class="hljs-built_in">len</span>(seq)<br>    index = -<span class="hljs-number">1</span><br>    <br>    <span class="hljs-comment"># seq[0] == seq[-seq_len]</span><br>    <span class="hljs-keyword">while</span> index &gt;= -seq_len:<br>        temp = seq[index]<br>        <span class="hljs-keyword">yield</span> temp<br>        index -= <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> myRev(<span class="hljs-string">&quot;FishC&quot;</span>):<br>    <span class="hljs-built_in">print</span>(i, end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>10 以内的素数之和是：2 + 3 + 5 + 7 &#x3D; 17，那么请编写程序，计算 2000000 以内的素数之和？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_prime</span>(<span class="hljs-params">number</span>):<br>    <span class="hljs-keyword">if</span> number &gt; <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> number == <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">for</span> current <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, <span class="hljs-built_in">int</span>(math.sqrt(number) + <span class="hljs-number">1</span>), <span class="hljs-number">2</span>):<br>            <span class="hljs-keyword">if</span> number % current == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_primes</span>(<span class="hljs-params">number</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> is_prime(number):<br>            <span class="hljs-keyword">yield</span> number<br>        number += <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    total = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> next_prime <span class="hljs-keyword">in</span> get_primes(<span class="hljs-number">3</span>):<br>        <span class="hljs-keyword">if</span> next_prime &lt; <span class="hljs-number">2000000</span>:<br>            total += next_prime<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(total)<br>            <span class="hljs-keyword">return</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solve()<br><br></code></pre></td></tr></table></figure></li></ol><h1 id="050-模块就是程序"><a href="#050-模块就是程序" class="headerlink" title="050. 模块就是程序"></a>050. 模块就是程序</h1><h2 id="知识点-45"><a href="#知识点-45" class="headerlink" title="知识点"></a>知识点</h2><ul><li>什么是模块，简单来说，模块就是程序，保存为.py 的文件<ul><li>容器： 数据的分装</li><li>函数： 语句的封装</li><li>类： 方法和属性的封装</li></ul></li><li>命名空间</li><li>导入模块： <ul><li>import moduleName</li><li>From moduleName import functionName</li><li>import moduleName as newName</li></ul></li></ul><h2 id="课后作业-43"><a href="#课后作业-43" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-43"><a href="#Quiz-43" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p>说到底，Python 的模块是什么？</p><p>模块就是程序。没错，所谓模块就是平时我们写的任何代码，然后保存的每一个“.py”结尾的文件，都是一个独立的模块。</p></li><li><p>请问我如何在另外一个源文件 test.py 里边使用 hello.py 的 hi() 函数呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hi</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hi everyone, I love FishC.com!&quot;</span>)<br><span class="hljs-number">12</span><br></code></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> hello <span class="hljs-keyword">as</span> h<br><span class="hljs-title">h</span>.hi()<br></code></pre></td></tr></table></figure></li><li><p>你知道的总共有几种导入模块的方法</p><p>第一种：import 模块名<br>第二种：from 模块名 import 函数名<br>第三种：import 模块名 as 新名字</p></li><li><p>曾经我们讲过有办法阻止 from…import * 导入你的“私隐”属性，你还记得是怎么做的吗？</p><p>如果你不想模块中的某个属性被 from…import * 导入，那么你可以给你不想导入的属性名称的前边加上一个下划线（_）。不过需要注意的是，如果使用 import … 导入整个模块，或者显式地使用 import xx._oo 导入某个属性，那么这个隐藏的方法就不起作用了。</p></li><li><p>倘若有 a.py 和 b.py 两个文件，内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># a.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sayHi</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;嗨，我是 A 模块~&quot;</span>)<br><br><span class="hljs-comment"># b.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sayHi</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;嗨，我是 B 模块~&quot;</span>)<br></code></pre></td></tr></table></figure><p>那么我在 test.py 文件中执行以下操作，会打印什么结果？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># test.py</span><br><span class="hljs-keyword">from</span> a <span class="hljs-keyword">import</span> sayHi<br><span class="hljs-keyword">from</span> b <span class="hljs-keyword">import</span> sayHi<br><br>sayHi()<br><br></code></pre></td></tr></table></figure><p>会打印“嗨，我是 B 模块~”，因为第二次导入的 b 模块把 a 模块的同名函数 sayHi() 给覆盖了，这就是所谓命名空间的冲突。所以，在项目中，特别是大型项目中我们应该避免使用 from…import…，除非你非常明确不会造成命名冲突。</p></li><li><p>执行下边 a.py 或 b.py 任何一个文件，都会报错，请尝试解释一下此现象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># a.py</span><br><span class="hljs-keyword">from</span> b <span class="hljs-keyword">import</span> y<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x&#x27;</span>)<br><br><span class="hljs-comment"># b.py</span><br><span class="hljs-keyword">from</span> a <span class="hljs-keyword">import</span> x<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">y</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y&#x27;</span>)<br><br>&gt;&gt;&gt;<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;/Users/FishC/Desktop/a.py&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> b <span class="hljs-keyword">import</span> x<br>  File <span class="hljs-string">&quot;/Users/FishC/Desktop/b.py&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">import</span> a<br>  File <span class="hljs-string">&quot;/Users/FishC/Desktop/a.py&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> b <span class="hljs-keyword">import</span> x<br>ImportError: cannot <span class="hljs-keyword">import</span> name <span class="hljs-string">&#x27;x&#x27;</span><br><br></code></pre></td></tr></table></figure><p>这个是循环嵌套导入问题。无论运行 a.py 或 b.py 哪一个文件都会抛出 ImportError 异常。这是因为在执行其中某一个文件（a.py）的加载过程中，会创建模块对象并执行对应的字节码。但当执行第一个语句的时候需要导入另一个文件（from b import y），因此 CPU 会转而去加载另一个文件（b.py）。同理，执行另一个文件的第一个语句（from a import x）恰好也是需要导入之前的文件（a.py）。此时，之前的文件处于仅导入第一条语句的阶段，因此其对应的字典中并不存在 x，故抛出“ImportError: cannot import name ‘x’”异常。</p><p>解决方案是直接使用 import 语句导入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># a.py</span><br><span class="hljs-keyword">import</span> b<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">x</span>():<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x&#x27;</span>)<br><br><span class="hljs-comment"># b.py</span><br><span class="hljs-keyword">import</span> a<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">y</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y&#x27;</span>)<br><br>a.x()<br><br></code></pre></td></tr></table></figure></li></ol><h3 id="Practice-39"><a href="#Practice-39" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>问大家一个问题：Python 支持常量吗？相信很多鱼油的答案都是否定的，但实际上 Python 内建的命名空间是支持一小部分常量的，比如我们熟悉的 True，False，None 等，只是 Python 没有提供定义常量的直接方式而已。那么这一题的要求是创建一个 const 模块，功能是让 Python 支持常量。</p><p>说到这里大家可能还是一头雾水，没关系，我们举个栗子。</p><p>test.py 是我们的测试代码，内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># const 模块就是这道题要求我们自己写的</span><br><span class="hljs-comment"># const 模块用于让 Python 支持常量操作</span><br><span class="hljs-keyword">import</span> const<br><br>const.NAME = <span class="hljs-string">&quot;FishC&quot;</span><br><span class="hljs-built_in">print</span>(const.NAME)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 尝试修改常量</span><br>    const.NAME = <span class="hljs-string">&quot;FishC.com&quot;</span><br><span class="hljs-keyword">except</span> TypeError <span class="hljs-keyword">as</span> Err:<br>    <span class="hljs-built_in">print</span>(Err)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 变量名需要大写</span><br>    const.name = <span class="hljs-string">&quot;FishC&quot;</span><br><span class="hljs-keyword">except</span> TypeError <span class="hljs-keyword">as</span> Err:<br>    <span class="hljs-built_in">print</span>(Err)<br></code></pre></td></tr></table></figure><p>执行后的结果是：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;<br>FishC<br>常量无法改变！<br>常量名必须由大写字母组成！<br></code></pre></td></tr></table></figure><p>在 const 模块中我们到底做了什么，使得这个模块这么有“魔力”呢？大家跟着小甲鱼的提示，一步步来做你就懂了：</p><p>提示一：我们需要一个 Const 类<br>提示二：重写 Const 类的某一个魔法方法，指定当实例对象的属性被修改时的行为<br>提示三：检查该属性是否已存在<br>提示四：检查该属性的名字是否为大写<br>提示五：细心的鱼油可能发现了，怎么我们这个 const 模块导入之后就把它当对象来使用（const.NAME &#x3D; “FishC”）了呢？难道模块也可以是一个对象？没错啦，在 Python 中无处不对象，到处都是你的对象。使用以下方法可以将你的模块与类 A 的对象挂钩。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">sys.modules 是一个字典，它包含了从 Python 开始运行起，被导入的所有模块。键就是模块名，值就是模块对象。</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> sys<br>sys.modules[__name__] = A()<br></code></pre></td></tr></table></figure><p>呃……好像说得有点太多了，大家一定要自己动手先尝试完成哦</p><p>程序如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Const</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(self, name):<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;常量无法改变！&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name.isupper():<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;常量名必须由大写字母组成！&#x27;</span>)<br>        <span class="hljs-built_in">super</span>().__setattr__(name, value)<br><br><br><span class="hljs-keyword">import</span> sys<br>sys.modules[__name__] = Const()<br></code></pre></td></tr></table></figure></li></ol><h1 id="051-模块：-name-39-main-39-、搜索路径和包"><a href="#051-模块：-name-39-main-39-、搜索路径和包" class="headerlink" title="051. 模块： __name__ = &#39;__main__&#39;、搜索路径和包"></a>051. 模块： <code>__name__ = &#39;__main__&#39;</code>、搜索路径和包</h1><h2 id="知识点-46"><a href="#知识点-46" class="headerlink" title="知识点"></a>知识点</h2><ul><li><p>代码模块化的优势</p><ul><li><p>代码阅读性和测试，分开更有利</p></li><li><p>代码的重用</p></li></ul></li><li><p><code>if __name__ == &#39;__main__&#39;</code></p><ul><li><p>举一个例子，模块中有测试代码</p><p>模块代码：test.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">c2f</span>(<span class="hljs-params">cel</span>):<br>    fah = cel * <span class="hljs-number">1.8</span> + <span class="hljs-number">32</span><br>    <span class="hljs-keyword">return</span> fah<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f2c</span>(<span class="hljs-params">fah</span>):<br>    cel = (fah - <span class="hljs-number">32</span>) / <span class="hljs-number">1.8</span><br>    <span class="hljs-keyword">return</span> cel<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;测试，0摄氏度 = %.2f华氏度&quot;</span> % c2f(<span class="hljs-number">0</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;测试，0华氏度 = %.2f摄氏度&quot;</span> % f2c(<span class="hljs-number">0</span>))<br><br><br>test()<br></code></pre></td></tr></table></figure><p>直接运行模块，进行测试：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">测试，<span class="hljs-number">0</span>摄氏度 <span class="hljs-operator">=</span> <span class="hljs-number">32.00</span>华氏度<br>测试，<span class="hljs-number">0</span>华氏度 <span class="hljs-operator">=</span> -<span class="hljs-number">17.78</span>摄氏度<br></code></pre></td></tr></table></figure><p>程序代码（导入模块：test）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> test <span class="hljs-keyword">as</span> tc<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;32 摄氏度 = %.2f 华氏度&#x27;</span> % tc.c2f(<span class="hljs-number">32</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;32 华氏度 = %.2f 摄氏度&#x27;</span> % tc.f2c(<span class="hljs-number">32</span>))<br></code></pre></td></tr></table></figure><p>运行结果：（出问题了：打印了测试代码的输出）</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 打印了测试代码的输出</span><br>测试，<span class="hljs-number">0</span>摄氏度 = <span class="hljs-number">32.00</span>华氏度<br>测试，<span class="hljs-number">0</span>华氏度 = -<span class="hljs-number">17.78</span>摄氏度<br><span class="hljs-number">32</span> 摄氏度 = <span class="hljs-number">89.60</span> 华氏度<br><span class="hljs-number">32</span> 华氏度 = <span class="hljs-number">0.00</span> 摄氏度<br></code></pre></td></tr></table></figure></li><li><p>原因分析：</p><ul><li>导入模块的时候，运行了模块中的测试代码：test()</li></ul></li><li><p>解决方法：</p><p>使用<code>__name__</code>属性在判断是否需要运行测试代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    test()<br></code></pre></td></tr></table></figure><p>所有模块都有一个 <strong>name</strong> 属性，<strong>name</strong> 的值取决于如何应用模块，在作为独立程序运行的时候，<strong>name</strong> 属性的值是 ‘<strong>main</strong>’，而作为模块导入的时候，这个值就是该模块的名字了。</p><ul><li>导入模块，运行主程序，在模块中调用<code>__name__</code>属性，值是模块名</li><li>直接运行模块程序，<code>__name__</code>属性，值是<code>&#39;__main__&#39;</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">7</span>]: __name__<br>Out[<span class="hljs-number">7</span>]: <span class="hljs-string">&#x27;__main__&#x27;</span><br><br>In [<span class="hljs-number">8</span>]: tc.__name__<br>Out[<span class="hljs-number">8</span>]: <span class="hljs-string">&#x27;test&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>搜索路径</p><ul><li><p>推荐放置模块的位置：’&#x2F;opt&#x2F;homebrew&#x2F;lib&#x2F;python3.9&#x2F;site-packages’； （不同的OS位置不一样）</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">In</span> [<span class="hljs-number">8</span>]: import sys<br><br><span class="hljs-symbol">In</span> [<span class="hljs-number">9</span>]: sys.path<br><span class="hljs-symbol">Out</span>[<span class="hljs-number">9</span>]: <br>[<span class="hljs-string">&#x27;/opt/homebrew/bin&#x27;</span>,<br> <span class="hljs-string">&#x27;/opt/homebrew/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python39.zip&#x27;</span>,<br> <span class="hljs-string">&#x27;/opt/homebrew/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9&#x27;</span>,<br> <span class="hljs-string">&#x27;/opt/homebrew/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/lib-dynload&#x27;</span>,<br> <span class="hljs-string">&#x27;&#x27;</span>,<br> <span class="hljs-string">&#x27;/opt/homebrew/lib/python3.9/site-packages&#x27;</span>,<br> <span class="hljs-string">&#x27;/opt/homebrew/opt/python-tk@3.9/libexec&#x27;</span>]<br></code></pre></td></tr></table></figure></li><li><p>可以添加模块路径<code>sys.path.append(&#39;module_path&#39;)</code>，以把相关的模块导入进来</p></li></ul></li><li><p>包（package）</p><ol><li><p>创建一个文件夹，用于存放相关的模块。文件夹的名字即包的名字；</p></li><li><p>在文件夹中创建一个<code>__init__.py</code>的模块文件，内容可以为空；</p></li><li><p>将相关的模块放入文件夹中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 上面这个例子，可以把test 模块放入到M 包中，修改主程序cal.py 的代码，导入包.模块：M.test</span><br><span class="hljs-keyword">import</span> M.test <span class="hljs-keyword">as</span> tc<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;32 摄氏度 = %.2f 华氏度&#x27;</span> % tc.c2f(<span class="hljs-number">32</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;32 华氏度 = %.2f 摄氏度&#x27;</span> % tc.f2c(<span class="hljs-number">32</span>))<br></code></pre></td></tr></table></figure></li></ol></li></ul><h2 id="课后作业-44"><a href="#课后作业-44" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-44"><a href="#Quiz-44" class="headerlink" title="Quiz"></a>Quiz</h3><ol><li><p><code>__name__</code>属性的含义是什么？</p><p>所有模块都有一个 <strong>name</strong> 属性，<strong>name</strong> 的值取决于如何应用模块，在作为独立程序运行的时候，<strong>name</strong> 属性的值是 ‘<strong>main</strong>’，而作为模块导入的时候，这个值就是该模块的名字了。</p><ul><li>导入模块，运行主程序，在模块中调用<code>__name__</code>属性，值是模块名</li><li>直接运行模块程序，<code>__name__</code>属性，值是<code>&#39;__main__&#39;</code></li></ul></li><li><p>什么时候<code>__name__</code>属性，值是<code>&#39;__main__&#39;</code>？</p><p>模块在作为独立程序运行的时候，<code>__name__ </code>属性的值是<code>&#39;__main__&#39;</code></p></li><li><p>如果获得当前python的搜索路径？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br>sys.path<br></code></pre></td></tr></table></figure></li><li><p>如果你不想讲相关的模块文件放到当前文件夹中，那最好的选择是？</p><p>可以创建一个包(package),放在 site-packages 文件夹，因为它就是用来存放你的模块文件的。</p></li><li><p>如果你遇到import urllib.request，那么这个urllib是什么？</p><p>是一个包，Python 把同类的模块放在一个文件夹中统一管理，这个文件夹称之为一个包。</p><p>urllib 是 Python 负责管理 URL 的包，用于访问网址（后边我们会讲到）</p></li><li><p>Python 如何区分一个文件夹是一个包还是一个普通文件夹？</p><p>看文件夹中是否有 <strong>init</strong>.py 文件。</p><p>必须在包文件夹中创建一个 <strong>init</strong>.py 的模块文件，内容可以为空。可以是一个空文件，也可以写一些初始化代码。这个是 Python 的规定，用来告诉 Python 将该目录当成一个包来处理。</p></li></ol><h3 id="Practice-40"><a href="#Practice-40" class="headerlink" title="Practice"></a>Practice</h3><ol><li><p>执行下面的a.py 或者 b.py任何一个文件，都会报错，请改正程序</p><p><img src="https://img-blog.csdnimg.cn/201903111045135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTcwNzgz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>下边是一个python项目的基本结构，请你合理组织它们，便于维护和使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">鱼C大项目 % tree ./  <br>./<br>├── LICENSE.txt<br>├── README<br>├── docs<br>├── <span class="hljs-built_in">help</span>.html<br>├── images<br>├── moduleA.py<br>├── moduleB.py<br>├── moduleC.py<br>├── package<br>│   ├── moduleA.py<br>│   ├── moduleB.py<br>│   ├── moduleC.py<br>│   └── static<br>│       ├── images<br>│       └── sounds<br>├── quickstart.html<br>├── readme.txt<br>├── requirements.txt<br>├── setup.py<br>├── sounds<br>├── static<br>├── test<br>├── test_advanced.py<br>└── test_basic.py<br><br><span class="hljs-number">10</span> directories, <span class="hljs-number">14</span> files<br><br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">答：通过将相关的模块组织成包，使项目结构更为完善和合理。从而增强代码的可维护性和实用性。<br><br>以下提供一个可供参考的Python项目结构（仅供参考，没有硬性规定）：<br><br>|<span class="hljs-string">----README/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----readme.txt</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----LICENSE.txt</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----requirents.txt</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----setup.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">----docs/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----help.html</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----quickstart.html</span><br><span class="hljs-string"></span>|<span class="hljs-string">----test/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----__init__.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----test_basic.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----test_advanced.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">----package/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----__init__.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----moduleA.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----moduleB.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----moduleC.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">----static/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">    </span>|<span class="hljs-string">----images/</span><br><span class="hljs-string"></span>|<span class="hljs-string">    </span>|<span class="hljs-string">    </span>|<span class="hljs-string">----sounds/</span><br><span class="hljs-string"></span>|<span class="hljs-string">----setup.py</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure></li></ol><h1 id="052-模块：像个极客一样去思考"><a href="#052-模块：像个极客一样去思考" class="headerlink" title="052. 模块：像个极客一样去思考"></a>052. 模块：像个极客一样去思考</h1><h2 id="知识点-47"><a href="#知识点-47" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Python的电池和充电器"><a href="#Python的电池和充电器" class="headerlink" title="Python的电池和充电器"></a>Python的电池和充电器</h3><p>大家可能还不知道，在Python的社区里有句俗话：“Python自己带着电池（Batteries included）”，什么意思呢？要从Python的设计哲学说起，Python的设计哲学是：优雅、明确和简单。因此，Python开发者演变出来的哲学就是，用一种方法，最好是只有一种方法来做一件事。虽然小甲鱼常常鼓励大家多思考，条条大路通罗马，那是为了训练大家的发散性思维，但是在正式编程中，如果有完善、并且经过严密测试过的模块可以直接实现，那么最好就是使用现成的模块来工作。</p><ul><li><p>所以Python附带安装的有Python标准库，一般我们说的电池就是Python标准库中的模块，这些模块都极其有用，Python标准库中包含一般任务所需要的模块，不过呢，Python标准库包含的模块有数100个之多，一个个单独来讲那着实是不科学的，所以这一讲，我们将学习如何独立的来探索模块。</p></li><li><p>对于Python来说，学习资料其实一直都在身边，因为Python不仅带着电池，还带着充电器！，我们这里给大家分析，遇到问题，我们应该如何去找答案，其实90%的答案你都可以通过我们以下的方式来找到解决的方法。</p></li><li><p>首先要做的就是打开Python的文档，打开IDLE-&gt;Help-&gt;Python Docs(F1)，如下:</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20200129132951392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="文档的基本组成部分"><a href="#文档的基本组成部分" class="headerlink" title="文档的基本组成部分"></a>文档的基本组成部分</h3><pre><code class="hljs"> ※1、What’s new in Python3.8? 介绍了3.8有什么新的特征，新的特性，列举自Python2.0以后所以的新特性。 ※2、Tutorial 是一个简易的教程，简单地介绍了python的语法 ※3、Liberary Reference Python的枕边书，这里边详细的列举了python所有内置函数和标准库各个模块的用法，非常详细，但是，你从头到尾是看不完的，当做字典来查就可以了。 ※4、Inatalling Python Modules 是一个教你如何安装python第三方模块的教程 ※5、Distuributing Python Modules 教你如何发布Python的第三方模块，你需要知道，Python除了标准库的几百个官方模块之外，还有一个叫做 pypi 的社区,----https://pypi.python.org/pypi, 搜集了全球Python爱好者贡献出来的模块，你自己也可以写一个模块发布到pypi社区，分享给全世界。 ※6、language reference 讨论Python的语法和设计哲学 ※7、Python setup and usage 谈论Python如何在不同平台上使用 ※8、Python HOWTOs 针对一些特定的主题进行深入并且详细的探讨 ※9、Extending and Embedding 介绍如何用 C和 C++ 来开发Python的扩展模块，还有开发对应所需要的API函数 ※10、FAQs 这个是常见问题解答</code></pre><h3 id="PEP"><a href="#PEP" class="headerlink" title="PEP"></a>PEP</h3><ul><li><p>PEP是Python Enhancement Proposals 的缩写，翻译过来就是Python增强建议书的意思。它是用来规范与定义Python的各种加强和延伸功能的技术规格，好让Python开发社区能有共同遵循的依据。</p></li><li><p>每一个PEP都有一个唯一的编号，这个编号一旦给定就不会再改变。例如，PEP 3000 就是用来定义 Python 3.0 的相关技术规格；而PEP 333 则是 Python 的 Web 应用程序界面 WSGI (Web Server Gateway Interface 1.0）的规范。关于PEP 本身的相关规范定义在 PEP 1，而PEP 8 则定义了 Python 代码的风格指南。</p></li><li><p>有关 PEP 的列表大家可以参考 PEP 0 ：<a href="https://www.python.org/dev/peps/">https://www.python.org/dev/peps/</a></p></li></ul><h3 id="如何利用文档和其他资源"><a href="#如何利用文档和其他资源" class="headerlink" title="如何利用文档和其他资源"></a>如何利用文档和其他资源</h3><ul><li><p>比如说现在需要用到timeit模块，但自己不清楚，可以通过索引和搜索去查找查看学习timeit的文档，，如下：里边有简单的使用方法、介绍，以及这个模块里边包含了哪些类，哪些函数，还有哪些变量，他们的功能以及用法，最后有个例子，大部分文档都遵循这个顺序讲解</p><p><img src="https://img-blog.csdnimg.cn/20200129141329859.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>想要快速掌握一个模块的用法，最好是使用IDLE 交互界面，首先 import 该模块，然后可以调用 __doc__属性，这样就可以查看到这个模块的简介</p><p><img src="https://img-blog.csdnimg.cn/20200129142044179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>事实上你对于这个方法应该很熟悉了，这跟我们之间讲过的函数文档是一样的，就是写在模块最开头的那个字符串，这个字符串是带格式的，我们可以使用 print() 把这个格式打印出来。会有缩进，换行，会显得更好看一点：</p><p><img src="https://img-blog.csdnimg.cn/20200129142247353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>然后你可能需要知道这个模块里面定义了哪些变量，哪些函数，哪些类，你可以用 dir() 内置方法把它显示出来：</p><p><img src="https://img-blog.csdnimg.cn/20200129142447586.png" alt="在这里插入图片描述"></p></li><li><p>显示出来的这些并不是所有的名字对我们都有用，所以我们需要过滤一些我们不需要的东西，那你可能留意到 __all__这个属性了，这个属性事实上他就是帮助我们完成过滤的过程，我们调用 __all__属性：</p><p><img src="https://img-blog.csdnimg.cn/20200129142620529.png" alt="在这里插入图片描述"></p></li><li><p>它回给我们的是一个列表，这个列表只有4个成员，如果你有看前面的关于 timeit 的文档的话，你会发现，Timer是一个类，timeit、repeat、default_timer 是3个接口函数。所以，我们这个 <strong>all</strong> 属性显示出来的就是这个模块可以供外界调用的所有东西</p><p>这里有两点需要注意的，</p><ul><li><p>第一个不是所有的模块都有 <strong>all</strong> 属性，有 <strong>all</strong> 的话，这个属性里面包含的内容就是作者希望外部调用的名字，这些函数这些类，其它的就是不希望外部调用的了。</p></li><li><p>第二点就是，如果一个模块设置了 <strong>all</strong> 属性，那么使用 from ‘模块名’ import * 语句导入到命名空间的操作，只有 <strong>all</strong> 属性这里面的名字才能被导入。例如：<br><img src="https://img-blog.csdnimg.cn/20200129143307985.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>设置了__all__ 属性，只有 <strong>all</strong> 属性这里面的名字才能被导入，如第一个Timer。但是如果你没有设置这个 all 属性的话，from ‘模块名’ import * 就会把所有不以下划线开头的名字都导入到当前命名空间，所以，我们建议，<em>在编写模块的时候，<strong>对外提供接口函数和类都设置到 all 属性的列表中去，这样子是比较规范的做法。</strong></em></p></li></ul></li><li><p>还有一个属性叫做 <strong>file</strong> 属性，这个属性是指明了该模块的源代码所在的位置</p></li></ul><p>  <img src="https://img-blog.csdnimg.cn/20200129143751352.png" alt="在这里插入图片描述"></p><ul><li><p>我们说过，快速提高编程能力有三大法宝</p><ul><li><p>一个就是不断地编写代码</p></li><li><p>第二个就是阅读高手的代码</p></li><li><p>最后我们还可以使用 help() 函数，比doc属性详细一点，比官方文档简单一点，介于中间的一个帮助文档，可以快速知道各个函数的用法</p><p><img src="https://img-blog.csdnimg.cn/20200129144002981.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3cxNTk3Nzg1ODQwOA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ul></li></ul><h2 id="课后作业-45"><a href="#课后作业-45" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="Quiz-45"><a href="#Quiz-45" class="headerlink" title="Quiz"></a>Quiz</h3><p>总共 16 道题，不上机的情况下答中 14 道以下请自觉忏悔！</p><p>​      注：题目虽然简单，但有陷阱，反正这一讲也没什么要测试的，就考考大家常识^_^</p><ol><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():</span><br>    pass<br> <br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(func()))</span><br><br></code></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-type">A</span>. &lt;<span class="hljs-keyword">type</span> ‘function’&gt;<br><span class="hljs-type">B</span>. &lt;<span class="hljs-keyword">type</span> ‘tuple’&gt;<br><span class="hljs-type">C</span>. &lt;<span class="hljs-keyword">type</span> ‘<span class="hljs-type">NoneType</span>’&gt;<br><span class="hljs-type">D</span>. &lt;<span class="hljs-keyword">type</span> ‘<span class="hljs-keyword">type</span>’&gt;<br></code></pre></td></tr></table></figure><p>C</p></li><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-number">1J</span>))</span><br><br></code></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-type">A</span>. &lt;<span class="hljs-keyword">type</span> ‘unicode’&gt;<br><span class="hljs-type">B</span>. &lt;<span class="hljs-keyword">type</span> ‘int’&gt;<br><span class="hljs-type">C</span>. &lt;<span class="hljs-keyword">type</span> ‘str’&gt;<br><span class="hljs-type">D</span>. &lt;<span class="hljs-keyword">type</span> ‘complex’&gt;<br></code></pre></td></tr></table></figure><p>D</p></li><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-keyword">lambda</span>:<span class="hljs-literal">None</span>))</span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. &lt;type ‘NoneType’&gt;  B. &lt;type ‘function’&gt;  C. &lt;type ‘int’&gt;  D. &lt;type ‘tuple’&gt;</code></pre></li></ol><p>​B</p><ol start="4"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">&quot;FishC&quot;</span>, (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>), [], <span class="hljs-literal">None</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(a))</span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 13  B. 7  C. 6  D. 5</code></pre></li></ol><p>​B</p><ol start="5"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        x = x + <span class="hljs-number">1</span><br>        self.v1 = x<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        x = x + <span class="hljs-number">1</span><br>        self.v2 = x<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>b = B(<span class="hljs-number">8</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;%d %d&quot;</span> % b.v1, b.v2)<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 9 10  B. 9 9  C. 10 10  D. 抛出异常</code></pre></li></ol><p>​D</p><ol start="6"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.x = x<br>        x = <span class="hljs-number">666</span><br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A(<span class="hljs-number">888</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 666  B. 888  C. None  D. 抛出异常</code></pre></li></ol><p>​B</p><ol start="7"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">values</span> <span class="hljs-operator">=</span> [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<br>nums <span class="hljs-operator">=</span> <span class="hljs-keyword">set</span>(<span class="hljs-keyword">values</span>)<br> <br>def checkit(num):<br>    if num <span class="hljs-keyword">in</span> nums:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">filter</span>(checkit, <span class="hljs-keyword">values</span>):<br>print(i, <span class="hljs-keyword">end</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 1 2 3 5  B. 1 1 2 3 5  C. 1 2 3 4 3 2 1  D. 抛出异常</code></pre></li></ol><p>​B</p><ol start="8"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">values</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<br>def <span class="hljs-built_in">transform</span>(<span class="hljs-built_in">num</span>):<br>    <span class="hljs-built_in">return</span> <span class="hljs-built_in">num</span> ** <span class="hljs-number">2</span><br> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">map</span>(<span class="hljs-built_in">transform</span>, <span class="hljs-built_in">values</span>):<br>    <span class="hljs-built_in">print</span>(i, end=&#x27; &#x27;)<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 1 1 4 9 25  B. 1 1 2 3 5  C. 0.5 0.5 1 1.5 2.5  D. 2 2 4 6 10</code></pre></li></ol><p>​A</p><ol start="9"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.x = x<br> <br>a = A(<span class="hljs-number">100</span>)<br>a.__dict__[<span class="hljs-string">&#x27;y&#x27;</span>] = <span class="hljs-number">50</span><br><span class="hljs-built_in">print</span>(a.y + <span class="hljs-built_in">len</span>(a.__dict__))<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 2  B. 50  C. 51  D. 52</code></pre></li></ol><p>​D</p><ol start="10"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(__name__)<br> <br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.get()<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. A  B. a  C. __main__  D. _A__a</code></pre></li></ol><p>​C</p><ol start="11"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">country_counter = &#123;&#125;<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">addone</span>(<span class="hljs-params">country</span>):<br>    <span class="hljs-keyword">if</span> country <span class="hljs-keyword">in</span> country_counter:<br>        country_counter[country] += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        country_counter[country] = <span class="hljs-number">1</span><br> <br>addone(<span class="hljs-string">&#x27;China&#x27;</span>)<br>addone(<span class="hljs-string">&#x27;Japan&#x27;</span>)<br>addone(<span class="hljs-string">&#x27;China&#x27;</span>)<br>addone(<span class="hljs-string">&quot;American&quot;</span>)<br> <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(country_counter))<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 0  B. 1  C. 2  D. 3</code></pre></li></ol><p>​D</p><ol start="12"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dict1 = &#123;&#125;<br>dict1<span class="hljs-selector-attr">[1]</span> = <span class="hljs-number">1</span><br>dict1<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span> = <span class="hljs-number">2</span><br>dict1<span class="hljs-selector-attr">[1.0]</span> = <span class="hljs-number">3</span><br> <br>result = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> dict1:<br><span class="hljs-built_in">print</span>(dict1<span class="hljs-selector-attr">[each]</span>)<br>    result += dict1<span class="hljs-selector-attr">[each]</span><br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(result)</span></span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 2  B. 3  C. 5  D. 6</code></pre></li></ol><p>​C； 注意 dict1[1] 和dict1[1.0]  的键值是一样的</p><ol start="13"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">dostuff</span>(<span class="hljs-params">param1, *param2</span>):<br>    <span class="hljs-built_in">print</span> <span class="hljs-built_in">type</span>(param2)<br> <br>dostuff(<span class="hljs-string">&#x27;apples&#x27;</span>, <span class="hljs-string">&#x27;bananas&#x27;</span>, <span class="hljs-string">&#x27;cherry&#x27;</span>, <span class="hljs-string">&#x27;dates&#x27;</span>)<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. &lt;type ‘int’&gt;  B. &lt;type ‘str’&gt;  C. &lt;type ‘tuple’&gt;  D. &lt;type ‘dict’&gt;</code></pre></li></ol><p>​C</p><ol start="14"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, a, b, c</span>):<br>        self.x = a + b + c<br> <br>a = A(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br>b = <span class="hljs-built_in">getattr</span>(a, <span class="hljs-string">&#x27;x&#x27;</span>)<br><span class="hljs-built_in">setattr</span>(a, <span class="hljs-string">&#x27;x&#x27;</span>, b+<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(a.x)<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 1  B. 2  C. 6  D. 7</code></pre></li></ol><p>​D</p><ol start="15"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus">list1 = <span class="hljs-selector-attr">[1, 2]</span><br>list2 = <span class="hljs-selector-attr">[3, 4]</span><br> <br>dict1 = &#123;<span class="hljs-string">&#x27;1&#x27;</span>:list1, <span class="hljs-string">&#x27;2&#x27;</span>:list2&#125;<br>dict2 = dict1<span class="hljs-selector-class">.copy</span>()<br> <br>dict1<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span> = <span class="hljs-number">5</span><br> <br>result = dict1<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span> + dict2<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(result)</span></span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 5  B. 6  C. 8  D. 10</code></pre></li></ol><p>​D</p><ol start="16"><li><p>请问以下代码会打印什么内容？</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import copy<br> <br>list1 = <span class="hljs-selector-attr">[1, 2]</span><br>list2 = <span class="hljs-selector-attr">[3, 4]</span><br> <br>dict1 = &#123;<span class="hljs-string">&#x27;1&#x27;</span>:list1, <span class="hljs-string">&#x27;2&#x27;</span>:list2&#125;<br>dict2 = copy<span class="hljs-selector-class">.deepcopy</span>(dict1)<br> <br>dict1<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span> = <span class="hljs-number">5</span><br> <br>result = dict1<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span> + dict2<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(result)</span></span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">  A. 5  B. 6  C. 8  D. 10</code></pre></li></ol><p>​B</p><h3 id="Practice-41"><a href="#Practice-41" class="headerlink" title="Practice"></a>Practice</h3>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>AWS Technical Essentials - Lab</title>
    <link href="/1984/01/24/aws-saa/"/>
    <url>/1984/01/24/aws-saa/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><img src="https://felixyanghui.synology.me:8441/images/2022/12/02/image-20221129160103938.png" style="zoom:50%;" /><h1 id="1-AWS-Technical-Essentials-Lab"><a href="#1-AWS-Technical-Essentials-Lab" class="headerlink" title="1. AWS Technical Essentials - Lab"></a>1. AWS Technical Essentials - Lab</h1><h2 id="1-1-Lab-1-Topology"><a href="#1-1-Lab-1-Topology" class="headerlink" title="1.1 Lab-1 Topology"></a>1.1 Lab-1 Topology</h2><p><img src="https://felixyanghui.synology.me:8441/images/2022/12/02/image-20221202103555079.png" alt="image-20221202103555079"></p><h3 id="1-1-1-Create-VPC-and-web-server-AWS-Console"><a href="#1-1-1-Create-VPC-and-web-server-AWS-Console" class="headerlink" title="1.1.1 Create VPC and web server (AWS Console)"></a>1.1.1 Create VPC and web server (AWS Console)</h3><ul><li>Create VPC (VPC can be accross AZ, but shall be within one region)</li><li>Create Internet Gateway and attach it to the VPC</li><li>Create Subnet (associate with VPC, AZ)</li><li>Create NAT gateway (associate with the subnet)  - depends on IGW created firstly</li><li>Create Route Table<ul><li>By default, a “Main” type route table already created for the VPC.  Edit the route table to associate it with two priviate subnets and add a default route destinated to NAT GW created before, finally rename the route table name as “private route table”</li><li>Create one more route table: “public route table”, associate with two public subnets. and add a default route destinated to Internet GW created before</li></ul></li><li>Create VPC security group</li><li>Create EC2 - web instance</li></ul><h3 id="1-1-2-Create-VPC-and-web-server-Terraform-Module"><a href="#1-1-2-Create-VPC-and-web-server-Terraform-Module" class="headerlink" title="1.1.2 Create VPC and web server (Terraform -  Module)"></a>1.1.2 Create VPC and web server (Terraform -  Module)</h3><ul><li><p>main.tf</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs tcl">provider <span class="hljs-string">&quot;aws&quot;</span> &#123;<br>    region = <span class="hljs-string">&quot;us-east-2&quot;</span><br><br>    default_tags &#123;<br>      tags = &#123;<br>        Environment = <span class="hljs-string">&quot;lab-test&quot;</span><br>        Owner = <span class="hljs-string">&quot;Felix&quot;</span><br>        Project = <span class="hljs-string">&quot;AWS-boto3-SDK&quot;</span><br><br>      &#125;<br>    &#125;<br>  <br>&#125;<br><br>module <span class="hljs-string">&quot;vpc&quot;</span> &#123;<br>    <span class="hljs-keyword">source</span> = <span class="hljs-string">&quot;terraform-aws-modules/vpc/aws&quot;</span><br><br>    name = var.vpc_name<br>    cidr = var.vpc_cidr<br><br>    azs = var.vpc_azs<br>    public_subnets = var.vpc_public_subnets<br>    private_subnets = var.vpc_private_subnets<br><br>    enable_nat_gateway = var.vpc_enable_nat_gateway<br>    single_nat_gateway = var.vpc_single_nat_gateway<br>    one_nat_gateway_per_az = var.vpc_one_nat_gateway_per_az<br><br>    enable_dns_hostnames = var.vpc_enable_dns_hostnames<br><br><br><br>    tags = var.vpc_tags<br>&#125;<br><br>module <span class="hljs-string">&quot;web_server_sg&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span> = <span class="hljs-string">&quot;terraform-aws-modules/security-group/aws//modules/http-80&quot;</span><br><br>  name        = <span class="hljs-string">&quot;web-server&quot;</span><br>  description = <span class="hljs-string">&quot;Security group for web-server with HTTP ports open within VPC&quot;</span><br>  vpc_id      = module.vpc.vpc_id<br><br>  ingress_cidr_blocks = var.web_server_sg_ingress_cidr_blocks<br><br>&#125;<br><br>module <span class="hljs-string">&quot;ssh_sg&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span> = <span class="hljs-string">&quot;terraform-aws-modules/security-group/aws//modules/ssh&quot;</span><br>  name = <span class="hljs-string">&quot;ssh&quot;</span><br>  vpc_id      = module.vpc.vpc_id<br>  ingress_cidr_blocks = var.ssh_sg_ingress_cidr_blocks<br>  <br>&#125;<br><br>module <span class="hljs-string">&quot;ec2_instance&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span>  = <span class="hljs-string">&quot;terraform-aws-modules/ec2-instance/aws&quot;</span><br><br>  name = var.ec2_instance_name<br><br>  ami                    = var.ec2_instance_ami<br>  instance_type          = var.ec2_instance_instance_type<br>  key_name               = var.ec2_instance_key_name<br>  vpc_security_group_ids = [module.web_server_sg.security_group_id, module.ssh_sg.security_group_id]<br>  subnet_id              = module.vpc.public_subnets[<span class="hljs-number">1</span>]<br><br>  user_data = <span class="hljs-string">&quot;$&#123;file(&quot;</span>install_web_server.sh<span class="hljs-string">&quot;)&#125;&quot;</span><br><br>  tags = var.ec2_instance_tags<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>variables.tf</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-comment">###</span><br><span class="hljs-comment"># define variables for vpc</span><br><span class="hljs-comment">###</span><br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_name&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Name of VPC&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;Lab-VPC&quot;</span><br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_cidr&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;CIDR block for VPC&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;10.0.0.0/16&quot;</span><br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_azs&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Availability zones for VPC&quot;</span><br>    type = <span class="hljs-keyword">list</span>(<span class="hljs-keyword">string</span>)<br>    default = [<span class="hljs-string">&quot;us-east-2a&quot;</span>, <span class="hljs-string">&quot;us-east-2b&quot;</span>]<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_private_subnets&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Private subnets for VPC&quot;</span><br>    type = <span class="hljs-keyword">list</span>(<span class="hljs-keyword">string</span>)<br>    default = [ <span class="hljs-string">&quot;10.0.1.0/24&quot;</span>, <span class="hljs-string">&quot;10.0.3.0/24&quot;</span> ]<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_public_subnets&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Public subnets for VPC&quot;</span><br>    type = <span class="hljs-keyword">list</span>(<span class="hljs-keyword">string</span>)<br>    default = [ <span class="hljs-string">&quot;10.0.0.0/24&quot;</span>, <span class="hljs-string">&quot;10.0.2.0/24&quot;</span> ]<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_enable_nat_gateway&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Enable NAT gateway for VPC&quot;</span><br>    default = true<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_single_nat_gateway&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Enable Single NAT gateway for VPC&quot;</span><br>    default = true<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_one_nat_gateway_per_az&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Enable one NAT gateway per az for VPC&quot;</span><br>    default = false<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_enable_dns_hostnames&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;enable DNS hostnames&quot;</span><br>    default = true<br>  <br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;vpc_tags&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Tags to apply to resources created by VPC module&quot;</span><br>    type = map(<span class="hljs-keyword">string</span>)<br>    default = &#123;<br>      <span class="hljs-string">&quot;Terrform&quot;</span> = <span class="hljs-string">&quot;True&quot;</span><br>    &#125;<br>  <br>&#125;<br><br><br><span class="hljs-comment">###</span><br><span class="hljs-comment"># define variables for ec2 instance</span><br><span class="hljs-comment">###</span><br><br><span class="hljs-comment">#name = var.ec2_instance_name</span><br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ec2_instance_name&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Name of EC2 instance&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;web server for testing&quot;</span><br><br>&#125;<br><br><span class="hljs-comment"># ami = var.ec2_instance_ami</span><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ec2_instance_ami&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;AMI of EC2 instance&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;ami-0beaa649c482330f7&quot;</span><br>    <br>&#125;<br><br><span class="hljs-comment"># instance_type = var.ec2_instance_instance_type</span><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ec2_instance_instance_type&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Instance type of EC2 instance&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;t2.micro&quot;</span><br>    <br>&#125;<br><br><span class="hljs-comment"># key_name = var.ec2_instance_key_name</span><br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ec2_instance_key_name&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Key name of EC2 instance&quot;</span><br>    type = <span class="hljs-keyword">string</span><br>    default = <span class="hljs-string">&quot;felix-key-pair&quot;</span><br>    <br>&#125;<br><br><br><span class="hljs-comment"># tags = var.ec2_instance_tags</span><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ec2_instance_tags&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Tags to apply to EC2 instance&quot;</span><br>    type = map(<span class="hljs-keyword">string</span>)<br>    default = &#123;<br>      <span class="hljs-string">&quot;Terrform&quot;</span> = <span class="hljs-string">&quot;True&quot;</span><br>    &#125;<br>  <br>&#125;<br><br><span class="hljs-comment">###</span><br><span class="hljs-comment"># define variables for security group</span><br><span class="hljs-comment">###</span><br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;web_server_sg_ingress_cidr_blocks&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;List of IPv4 CIDR ranges to use on all ingress rules for web server HTTP&quot;</span><br>    type = <span class="hljs-keyword">list</span>(<span class="hljs-keyword">string</span>)<br>    default =   [<br>    <span class="hljs-string">&quot;36.152.113.203/32&quot;</span>, <span class="hljs-string">&quot;218.2.208.75/32&quot;</span>, <span class="hljs-string">&quot;172.31.0.0/16&quot;</span>, <span class="hljs-string">&quot;18.162.220.99/32&quot;</span>,<br>    <span class="hljs-string">&quot;18.162.103.100/32&quot;</span>, <span class="hljs-string">&quot;18.162.171.88/32&quot;</span>, <span class="hljs-string">&quot;58.212.197.96/32&quot;</span>, <span class="hljs-string">&quot;18.162.198.138/32&quot;</span> <br>    ]<br>&#125;<br><br><span class="hljs-keyword">variable</span> <span class="hljs-string">&quot;ssh_sg_ingress_cidr_blocks&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;List of IPv4 CIDR ranges to use on all ingress rules for ssh&quot;</span><br>    type = <span class="hljs-keyword">list</span>(<span class="hljs-keyword">string</span>)<br>    default =   [<br>    <span class="hljs-string">&quot;36.152.113.203/32&quot;</span>, <span class="hljs-string">&quot;218.2.208.75/32&quot;</span>, <span class="hljs-string">&quot;172.31.0.0/16&quot;</span>, <span class="hljs-string">&quot;18.162.220.99/32&quot;</span>,<br>    <span class="hljs-string">&quot;18.162.103.100/32&quot;</span>, <span class="hljs-string">&quot;18.162.171.88/32&quot;</span>, <span class="hljs-string">&quot;58.212.197.96/32&quot;</span>, <span class="hljs-string">&quot;18.162.198.138/32&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>outputs.tf</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tcl">output <span class="hljs-string">&quot;vpc_public_subnets&quot;</span> &#123;<br>  description = <span class="hljs-string">&quot;IDs of the VPC&#x27;s public subnets&quot;</span><br>  value       = module.vpc.public_subnets<br>&#125;<br><br>output <span class="hljs-string">&quot;ec2_instance_public_dns&quot;</span> &#123;<br>  description = <span class="hljs-string">&quot;The public DNS name assigned to the instance.&quot;</span><br>  value = module.ec2_instance.public_dns<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>install_web_server.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>yum install -y httpd mysql php<br>wget https://us-west-2-tcprod.s3.amazonaws.com/courses/ILT-TF-100-TECESS/v4.7.10/lab-1-build-a-web-server/scripts/lab-app.zip<br>unzip lab-app.zip -d /var/www/html/<br>chkconfig httpd on<br>service httpd start<br></code></pre></td></tr></table></figure></li></ul><h2 id="1-2-Lab-2-Topology"><a href="#1-2-Lab-2-Topology" class="headerlink" title="1.2 Lab-2 Topology"></a>1.2 Lab-2 Topology</h2><img src="https://felixyanghui.synology.me:8441/images/2022/12/12/image-20221212112639946.png" alt="image-20221212112639946" style="zoom:50%;" /><h3 id="1-2-1-Create-database-and-interact-with-web-server-web-console"><a href="#1-2-1-Create-database-and-interact-with-web-server-web-console" class="headerlink" title="1.2.1 Create database and interact with web server (web console)"></a>1.2.1 Create database and interact with web server (web console)</h3><ul><li>Create security group for RDS instance</li><li>Create subnet groups for database</li><li>Create RDS database instance</li><li>Configure web instance on web browser to connect to RDS database instance</li></ul><h3 id="1-2-2-Create-database-and-interact-with-web-server-Terraform-module"><a href="#1-2-2-Create-database-and-interact-with-web-server-Terraform-module" class="headerlink" title="1.2.2 Create database and interact with web server (Terraform - module)"></a>1.2.2 Create database and interact with web server (Terraform - module)</h3><ul><li><p>Add variables for Dymanadb - MYSQL</p><ul><li>Use “locals” to define parameters for DB</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###</span><br><span class="hljs-comment"># define variables for security group</span><br><span class="hljs-comment">###</span><br><br>variable <span class="hljs-string">&quot;web_server_sg_ingress_cidr_blocks&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;List of IPv4 CIDR ranges to use on all ingress rules for web server HTTP&quot;</span><br>    <span class="hljs-built_in">type</span> = <span class="hljs-built_in">list</span>(string)<br>    default =   [<br>    <span class="hljs-string">&quot;36.152.113.203/32&quot;</span>, <span class="hljs-string">&quot;218.2.208.75/32&quot;</span>, <span class="hljs-string">&quot;172.31.0.0/16&quot;</span>, <span class="hljs-string">&quot;18.162.220.99/32&quot;</span>,<br>    <span class="hljs-string">&quot;18.162.103.100/32&quot;</span>, <span class="hljs-string">&quot;18.162.171.88/32&quot;</span>, <span class="hljs-string">&quot;58.212.197.96/32&quot;</span>, <span class="hljs-string">&quot;18.162.198.138/32&quot;</span>,<br>    <span class="hljs-string">&quot;117.89.135.187/32&quot;</span> <br>    ]<br>&#125;<br><br>variable <span class="hljs-string">&quot;ssh_sg_ingress_cidr_blocks&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;List of IPv4 CIDR ranges to use on all ingress rules for ssh&quot;</span><br>    <span class="hljs-built_in">type</span> = <span class="hljs-built_in">list</span>(string)<br>    default =   [<br>    <span class="hljs-string">&quot;36.152.113.203/32&quot;</span>, <span class="hljs-string">&quot;218.2.208.75/32&quot;</span>, <span class="hljs-string">&quot;172.31.0.0/16&quot;</span>, <span class="hljs-string">&quot;18.162.220.99/32&quot;</span>,<br>    <span class="hljs-string">&quot;18.162.103.100/32&quot;</span>, <span class="hljs-string">&quot;18.162.171.88/32&quot;</span>, <span class="hljs-string">&quot;58.212.197.96/32&quot;</span>, <span class="hljs-string">&quot;18.162.198.138/32&quot;</span>,<br>    <span class="hljs-string">&quot;117.89.135.187/32&quot;</span><br>    ]<br>&#125;<br><br><span class="hljs-comment">###</span><br><span class="hljs-comment"># define variables for db</span><br><span class="hljs-comment">###</span><br><br>variable <span class="hljs-string">&quot;db_sg_name&quot;</span> &#123;<br>    <span class="hljs-built_in">type</span> = string<br>    default = <span class="hljs-string">&quot;lab&quot;</span><br>  <br>&#125;<br><br><span class="hljs-built_in">locals</span> &#123;<br>    web_server_sg_name = <span class="hljs-string">&quot;web_server&quot;</span><br>    ssh_sg_name = <span class="hljs-string">&quot;ssh&quot;</span><br>    db_identifier = <span class="hljs-string">&quot;lab-db&quot;</span><br><br>    db_engine            = <span class="hljs-string">&quot;mysql&quot;</span><br>    db_engine_version    = <span class="hljs-string">&quot;8.0.28&quot;</span><br>    db_instance_class    = <span class="hljs-string">&quot;db.t3.micro&quot;</span><br>    db_allocated_storage = <span class="hljs-number">5</span><br><br>    db_db_name  = <span class="hljs-string">&quot;lab&quot;</span><br>    db_username = <span class="hljs-string">&quot;lab_admin&quot;</span><br>    db_password = <span class="hljs-string">&quot;lab-password&quot;</span><br>    db_port     = <span class="hljs-string">&quot;3306&quot;</span><br>    db_sg_ingress_with_source_security_group_id = [ <br>        &#123;<br>            from_port   = <span class="hljs-number">3306</span><br>            to_port     = <span class="hljs-number">3306</span><br>            protocol    = <span class="hljs-string">&quot;tcp&quot;</span><br>            description = <span class="hljs-string">&quot;mysql&quot;</span><br>            source_security_group_id = module.web_server_sg.security_group_id<br>      &#125;,<br>    ]<br>    db_major_engine_version = <span class="hljs-string">&quot;8.0&quot;</span><br>    db_family = <span class="hljs-string">&quot;mysql8.0&quot;</span><br>    db_create_db_subnet_group = true<br>    db_multi_az = true<br>    db_skip_final_snapshot = true<br>&#125;<br><br>variable <span class="hljs-string">&quot;db_identifier&quot;</span> &#123;<br>    <span class="hljs-built_in">type</span> = string<br>    default = <span class="hljs-string">&quot;lab-db&quot;</span><br><br>&#125;<br><br>variable <span class="hljs-string">&quot;db_tags&quot;</span> &#123;<br>    description = <span class="hljs-string">&quot;Tags to apply to db&quot;</span><br>    <span class="hljs-built_in">type</span> = <span class="hljs-built_in">map</span>(string)<br>    default = &#123;<br>      <span class="hljs-string">&quot;Terrform&quot;</span> = <span class="hljs-string">&quot;True&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Add DB in main.tf</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># for db security group</span><br>module <span class="hljs-string">&quot;db_sg&quot;</span> &#123;<br>  source = <span class="hljs-string">&quot;terraform-aws-modules/security-group/aws&quot;</span><br><br>  name        = var.db_sg_name<br>  vpc_id      = module.vpc.vpc_id<br><br>  ingress_with_source_security_group_id = local.db_sg_ingress_with_source_security_group_id<br>&#125;<br><br>module <span class="hljs-string">&quot;db&quot;</span> &#123;<br>  source  = <span class="hljs-string">&quot;terraform-aws-modules/rds/aws&quot;</span><br><br>  identifier = local.db_identifier<br><br>  engine            = local.db_engine<br>  engine_version    = local.db_engine_version<br>  instance_class    = local.db_instance_class<br>  allocated_storage = local.db_allocated_storage<br>  db_name  = local.db_db_name<br>  username = local.db_username<br>  password = local.db_password<br>  port     = local.db_port<br>  major_engine_version = local.db_major_engine_version<br>  family = local.db_family<br>  multi_az = local.db_multi_az<br>  skip_final_snapshot = local.db_skip_final_snapshot<br>  vpc_security_group_ids = [module.db_sg.security_group_id]<br>  tags = var.db_tags<br>  <span class="hljs-comment"># DB subnet group</span><br>  create_db_subnet_group = local.db_create_db_subnet_group<br>  subnet_ids = module.vpc.private_subnets<br>  <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>output.tf</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">output <span class="hljs-string">&quot;db_db_instance_endpoint&quot;</span> &#123;<br>  description = <span class="hljs-string">&quot;The connection endpoint&quot;</span><br>  value = module.db.db_instance_endpoint<br>  <br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="1-3-Lab-3-Topology"><a href="#1-3-Lab-3-Topology" class="headerlink" title="1.3 Lab-3 Topology"></a>1.3 Lab-3 Topology</h2><img src="https://felixyanghui.synology.me:8441/images/2022/12/02/image-20221129160103938.png" style="zoom:50%;" /><h3 id="1-3-1-Autoscalaing-Loadbalancer-and-Cloud-Watch"><a href="#1-3-1-Autoscalaing-Loadbalancer-and-Cloud-Watch" class="headerlink" title="1.3.1 Autoscalaing, Loadbalancer and Cloud Watch"></a>1.3.1 Autoscalaing, Loadbalancer and Cloud Watch</h3><ul><li><p>Create AMI from running EC2 - web server</p></li><li><p>Create loadbalancer:  ALB</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/12/12/image-20221212135325032.png" alt="image-20221212135325032"></p></li><li><p>Create EC2 launch template</p></li><li><p>Create auto-scalling group, enable load balancer and choose the target group which configured in ALB creation step</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/12/12/image-20221212141947725.png" alt="image-20221212141947725"></p></li><li><p>Validate load balancer if run probably, by accessing the load balancer DNS name. Refresh browser will show different EC2 name as load balancer load balance the traffic to different EC2 in target group</p></li><li><p>Create ASG policy “Target tracking scalling policy”, which automatically create CloudWatch alarm to monitor the CPU utilization of ASG</p></li></ul><h3 id="1-3-2-Autoscalaing-Loadbalancer-and-Cloud-Watch-Terraform-Module"><a href="#1-3-2-Autoscalaing-Loadbalancer-and-Cloud-Watch-Terraform-Module" class="headerlink" title="1.3.2 Autoscalaing, Loadbalancer and Cloud Watch (Terraform - Module)"></a>1.3.2 Autoscalaing, Loadbalancer and Cloud Watch (Terraform - Module)</h3><ul><li><p>Add ALB, ASG and related security groups in main.tf</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-comment">## Creat loadbalancer ALB</span><br>module <span class="hljs-string">&quot;alb&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span>  = <span class="hljs-string">&quot;terraform-aws-modules/alb/aws&quot;</span><br>  version = <span class="hljs-string">&quot;~&gt; 8.0&quot;</span><br><br>  name = local.alb_name<br><br>  load_balancer_type = local.alb_load_balancer_type<br><br>  vpc_id             = module.vpc.vpc_id<br>  subnets            = module.vpc.public_subnets<br>  security_groups    = [module.web_server_sg.security_group_id]<br><br><span class="hljs-comment">  # access_logs = &#123;</span><br><span class="hljs-comment">  #   bucket = &quot;my-alb-logs&quot;</span><br><span class="hljs-comment">  # &#125;</span><br><br>  target_groups = local.alb_target_groups<br><br><br>  http_tcp_listeners = local.alb_http_tcp_listeners<br><br>  tags = local.alb_tags<br><br>&#125;<br><br><br><span class="hljs-comment">## create auto scalling</span><br><br><span class="hljs-comment"># for asg security group</span><br>module <span class="hljs-string">&quot;asg_sg&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span> = <span class="hljs-string">&quot;terraform-aws-modules/security-group/aws&quot;</span><br><br>  name        = local.asg_sg_name<br>  vpc_id      = module.vpc.vpc_id<br><br>  ingress_with_source_security_group_id = local.asg_sg_ingress_with_source_security_group_id<br>  egress_with_cidr_blocks = local.asg_sg_egress_with_cidr_blocks<br>&#125;<br><br>module <span class="hljs-string">&quot;asg&quot;</span> &#123;<br>  <span class="hljs-keyword">source</span>  = <span class="hljs-string">&quot;terraform-aws-modules/autoscaling/aws&quot;</span><br><br><span class="hljs-comment">  # Autoscaling group</span><br>  name = local.asg_name<br><br><span class="hljs-comment">  # combine ASG with loadbalancer alb through target_group_arns</span><br>  target_group_arns = module.alb.target_group_arns<br><br>  min_size                  = local.asg_min_size<br>  max_size                  = local.asg_max_size<br>  desired_capacity          = local.asg_desired_capacity<br>  wait_for_capacity_timeout = local.asg_wait_for_capacity_timeout<br>  health_check_type         = local.asg_health_check_type<br>  vpc_zone_identifier       = module.vpc.private_subnets<br><br>  instance_refresh = local.asg_instance_refresh<br><br><span class="hljs-comment">  # Launch configuration</span><br>  launch_template_name = local.asg_lc_name<br><br>  image_id          = local.asg_image_id<br>  instance_type     = local.asg_instance_type<br>  key_name          = var.ec2_instance_key_name<br>  <br><span class="hljs-comment"># use pre-defined sg, only allow the access from loadbalancers or others in sg: web server group</span><br>  security_groups = [module.asg_sg.security_group_id]<br><br><span class="hljs-comment">  # create autoscaling policy based on avgCPUutilization</span><br>  scaling_policies = local.asg_scaling_policies<br><br><br>  tags = local.asg_tags<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Define related variables and locals in variables.tf</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs tcl">locals &#123;<br>    ...<br><br><span class="hljs-comment">    # alb</span><br>    alb_load_balancer_type = <span class="hljs-string">&quot;application&quot;</span><br>    alb_name = <span class="hljs-string">&quot;lab-alb&quot;</span><br>    alb_target_groups = [<br>        &#123;<br>        name_prefix      = <span class="hljs-string">&quot;pref-&quot;</span><br>        backend_protocol = <span class="hljs-string">&quot;HTTP&quot;</span><br>        backend_port     = <span class="hljs-number">80</span><br>        &#125;<br>    ]<br><br>    alb_http_tcp_listeners = [<br>        &#123;<br>            port               = <span class="hljs-number">80</span><br>            protocol           = <span class="hljs-string">&quot;HTTP&quot;</span><br>            target_group_index = <span class="hljs-number">0</span><br>        &#125;<br>    ]<br><br>    alb_tags = &#123;<br><br>        <span class="hljs-string">&quot;Terrform&quot;</span> = <span class="hljs-string">&quot;True&quot;</span><br>    &#125;<br><br><span class="hljs-comment">    #asg</span><br>    asg_sg_ingress_with_source_security_group_id = [ <br>        &#123;<br>            from_port   = <span class="hljs-number">80</span><br>            to_port     = <span class="hljs-number">80</span><br>            protocol    = <span class="hljs-string">&quot;tcp&quot;</span><br>            description = <span class="hljs-string">&quot;web&quot;</span><br>            source_security_group_id = module.web_server_sg.security_group_id<br>      &#125;,<br>        &#123;<br>            from_port   = <span class="hljs-number">22</span><br>            to_port     = <span class="hljs-number">22</span><br>            protocol    = <span class="hljs-string">&quot;tcp&quot;</span><br>            description = <span class="hljs-string">&quot;ssh&quot;</span><br>            source_security_group_id = module.web_server_sg.security_group_id<br>      &#125;,<br>    ]<br><br><span class="hljs-comment"># define egress policy to allow all protocols for EC2 in private subnet to access internet</span><br>    asg_sg_egress_with_cidr_blocks = [<br>        &#123;<br>            from_port = <span class="hljs-number">-1</span><br>            to_port = <span class="hljs-number">-1</span><br><span class="hljs-comment">            # value = &quot;all&quot; to allow all protocols</span><br>            protocol    = <span class="hljs-string">&quot;all&quot;</span><br>            description = <span class="hljs-string">&quot;all ports for egress of EC2&quot;</span><br>            cidr_blocks = <span class="hljs-string">&quot;0.0.0.0/0&quot;</span><br>        &#125;,<br>    ]<br><br>    asg_name = <span class="hljs-string">&quot;lab-asg&quot;</span><br>    asg_min_size                  = <span class="hljs-number">2</span><br>    asg_max_size                  = <span class="hljs-number">4</span><br>    asg_desired_capacity          = <span class="hljs-number">2</span><br>    asg_wait_for_capacity_timeout = <span class="hljs-number">0</span><br>    asg_health_check_type         = <span class="hljs-string">&quot;EC2&quot;</span><br>    asg_instance_refresh = &#123;<br>        strategy = <span class="hljs-string">&quot;Rolling&quot;</span><br>        preferences = &#123;<br>            checkpoint_delay       = <span class="hljs-number">600</span><br>            checkpoint_percentages = [<span class="hljs-number">35</span>, <span class="hljs-number">70</span>, <span class="hljs-number">100</span>]<br>            instance_warmup        = <span class="hljs-number">300</span><br>            min_healthy_percentage = <span class="hljs-number">50</span><br>        &#125;<br>        triggers = [<span class="hljs-string">&quot;tag&quot;</span>]<br>    &#125;<br><br><br>    asg_lc_name           = <span class="hljs-string">&quot;lab-asg-launch-configuration&quot;</span><br>    asg_image_id          = <span class="hljs-string">&quot;ami-0366e7e36827b904b&quot;</span><br>    asg_instance_type     = <span class="hljs-string">&quot;t2.micro&quot;</span><br>    asg_ebs_optimized     = true<br>    asg_enable_monitoring = true<br><br><br>    asg_tags = &#123;<br>        <span class="hljs-string">&quot;Terrform&quot;</span> = <span class="hljs-string">&quot;True&quot;</span><br>    &#125;<br><br>    asg_sg_name = <span class="hljs-string">&quot;lab-asg-sg&quot;</span><br><br>    asg_scaling_policies = &#123;<br>        lab-autoscaling-policy = &#123;<br>            policy_type               = <span class="hljs-string">&quot;TargetTrackingScaling&quot;</span><br>            target_tracking_configuration = &#123;<br>                predefined_metric_specification = &#123;<br>                predefined_metric_type = <span class="hljs-string">&quot;ASGAverageCPUUtilization&quot;</span><br><span class="hljs-comment">                # resource_label         = &quot;Lab-Label&quot;</span><br>                &#125;<br>                target_value = <span class="hljs-number">50.0</span><br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="1-3-3-Learning-and-Summary"><a href="#1-3-3-Learning-and-Summary" class="headerlink" title="1.3.3 Learning and Summary"></a>1.3.3 Learning and Summary</h3><ul><li>Issue not resolved:  Configure launch template with <code>user_data</code>  and EC2 in private network, even though NAT gateway and egress rules (allow all protocols) already set. Only EC2 AMI works</li><li>Create ALB, ASG<ul><li>ALB:  two components : “alb_target_groups” and “alb_http_tcp_listeners”</li><li>ASG: <ul><li>launch_template</li><li>autoscaling group</li><li>target_group_arns:  associate ASG with loadbalancer alb target groups</li><li>scaling_policies:  automatically create CloudWatch alarms for ASG scaling</li></ul></li></ul></li><li></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>AWS</tag>
      
      <tag>lab</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible lab</title>
    <link href="/1984/01/24/ansible-web-haproxy/"/>
    <url>/1984/01/24/ansible-web-haproxy/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Infra-preparation"><a href="#Infra-preparation" class="headerlink" title="Infra preparation"></a>Infra preparation</h1><h2 id="Servers-List"><a href="#Servers-List" class="headerlink" title="Servers List"></a>Servers List</h2><table><thead><tr><th>Server Name</th><th>IP address</th><th>Role</th><th>OS</th></tr></thead><tbody><tr><td>Ansible01</td><td>192.168.22.67</td><td>Web Server - 1</td><td>CentOS8</td></tr><tr><td>Ansible02</td><td>192.168.22.68</td><td>Web Server - 2</td><td>CentOS8</td></tr><tr><td>Ansible03</td><td>192.168.22.69</td><td>HAProxy</td><td>CentOS8</td></tr></tbody></table><h2 id="Topology"><a href="#Topology" class="headerlink" title="Topology"></a>Topology</h2><p>Overall topology is like below:</p><p>![image-20220311092828023](&#x2F;Users&#x2F;felix&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20220311092828023.png)</p><h2 id="Provision-Infra-with-Terraform-and-vSphere"><a href="#Provision-Infra-with-Terraform-and-vSphere" class="headerlink" title="Provision Infra with Terraform and vSphere"></a>Provision Infra with Terraform and vSphere</h2><p>Leverage terraform to provision the servers, create below main.tf file:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Configure the VMware vSphere Provider</span><br><span class="hljs-string">provider</span> <span class="hljs-string">&quot;vsphere&quot;</span> &#123;<br>  <span class="hljs-string">user</span>           <span class="hljs-string">=</span> <span class="hljs-string">&quot;administrator@vsphere.local&quot;</span><br>  <span class="hljs-string">password</span>       <span class="hljs-string">=</span> <span class="hljs-string">&quot;xxx&quot;</span><br>  <span class="hljs-string">vsphere_server</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;192.168.20.251&quot;</span><br><br>  <span class="hljs-comment"># if you have a self-signed cert</span><br>  <span class="hljs-string">allow_unverified_ssl</span> <span class="hljs-string">=</span> <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-comment"># Deploy 3 linux VMs</span><br><span class="hljs-string">module</span> <span class="hljs-string">&quot;centos-server-linuxvm&quot;</span> &#123;<br>  <span class="hljs-string">source</span>    <span class="hljs-string">=</span> <span class="hljs-string">&quot;Terraform-VMWare-Modules/vm/vsphere&quot;</span><br>  <span class="hljs-comment">#source    = &quot;.terraform/modules/centos-server-linuxvm&quot;</span><br>  <span class="hljs-string">version</span>   <span class="hljs-string">=</span> <span class="hljs-string">&quot;3.4.1&quot;</span><br>  <span class="hljs-string">vmtemp</span>    <span class="hljs-string">=</span> <span class="hljs-string">&quot;CentOS8&quot;</span><br>  <span class="hljs-string">instances</span> <span class="hljs-string">=</span> <span class="hljs-number">3</span><br>  <span class="hljs-string">vmname</span>    <span class="hljs-string">=</span> <span class="hljs-string">&quot;Ansible&quot;</span><br>  <span class="hljs-string">vmrp</span>      <span class="hljs-string">=</span> <span class="hljs-string">&quot;Felix-Cluster/Resources/ansiblelab&quot;</span><br>  <span class="hljs-string">network</span> <span class="hljs-string">=</span> &#123;<br>    <span class="hljs-string">&quot;VM Network&quot;</span> <span class="hljs-string">=</span> [<span class="hljs-string">&quot;192.168.22.67&quot;</span>, <span class="hljs-string">&quot;192.168.22.68&quot;</span>, <span class="hljs-string">&quot;192.168.22.69&quot;</span>] <span class="hljs-comment"># To use DHCP create Empty list [&quot;&quot;,&quot;&quot;]; You can also use a CIDR annotation;</span><br>  &#125;<br>  <span class="hljs-string">vmgateway</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;192.168.0.250&quot;</span><br>  <span class="hljs-string">dc</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;Felix-DC&quot;</span><br>  <span class="hljs-string">datastore</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;Data&quot;</span><br>  <span class="hljs-string">ipv4submask</span>  <span class="hljs-string">=</span> [<span class="hljs-string">&quot;16&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>]<br>  <span class="hljs-string">network_type</span> <span class="hljs-string">=</span> [<span class="hljs-string">&quot;vmxnet3&quot;</span>, <span class="hljs-string">&quot;vmxnet3&quot;</span>, <span class="hljs-string">&quot;vmxnet3&quot;</span>]<br>  <span class="hljs-string">dns_server_list</span>  <span class="hljs-string">=</span> [<span class="hljs-string">&quot;192.168.22.1&quot;</span>, <span class="hljs-string">&quot;192.168.22.1&quot;</span>, <span class="hljs-string">&quot;192.168.22.1&quot;</span>]<br>  <span class="hljs-string">is_windows_image</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-string">output</span> <span class="hljs-string">&quot;vmnames&quot;</span> &#123;<br>  <span class="hljs-string">value</span> <span class="hljs-string">=</span> <span class="hljs-string">module.centos-server-linuxvm.VM</span><br>&#125;<br><br><span class="hljs-string">output</span> <span class="hljs-string">&quot;vmnameswip&quot;</span> &#123;<br>  <span class="hljs-string">value</span> <span class="hljs-string">=</span> <span class="hljs-string">module.centos-server-linuxvm.ip</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">terrform init</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">terrform plan</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">terrform apply</span><br></code></pre></td></tr></table></figure><h1 id="Step-by-step-to-set-up-webservers-and-haproxy-with-ansible"><a href="#Step-by-step-to-set-up-webservers-and-haproxy-with-ansible" class="headerlink" title="Step by step to set up webservers and haproxy with ansible"></a><a href="https://github.com/felixyh/ansiblelab">Step by step to set up webservers and haproxy with ansible</a></h1><h2 id="Lab-01"><a href="#Lab-01" class="headerlink" title="Lab-01"></a>Lab-01</h2><h3 id="Initialize-lab-environment"><a href="#Initialize-lab-environment" class="headerlink" title="Initialize lab environment"></a>Initialize lab environment</h3><p>Create hosts file</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[web]<br>ansible01 <span class="hljs-attribute">ansible_host</span>=192.168.22.67<br>ansible02 <span class="hljs-attribute">ansible_host</span>=192.168.22.68<br><br>[haproxy]<br>ansible03 <span class="hljs-attribute">ansible_host</span>=192.168.22.69<br><br>[web:vars]<br><span class="hljs-attribute">ansible_ssh_user</span>=root<br><br>[haproxy:vars]<br><span class="hljs-attribute">ansible_ssh_user</span>=root<br></code></pre></td></tr></table></figure><p>Ignore SSH authenticity checking, to avoid any human intervention in the middle of the script execution for below prompts:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># GATHERING FACTS <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">***</span></span><br><span class="hljs-strong"><span class="hljs-section"># The authenticity of host &#x27;xxx.xxx.xxx.xxx (xxx.xxx.xxx.xxx)&#x27; can&#x27;t be established.</span></span><br><span class="hljs-strong"><span class="hljs-section"># RSA key fingerprint is xx:yy:zz:....</span></span><br><span class="hljs-strong"><span class="hljs-section"># Are you sure you want to continue connecting (yes/no)?</span></span><br></code></pre></td></tr></table></figure><p>Edit the <em>ansible.cfg</em>, set <code>host_key_checking=false</code></p><blockquote><p>ansible configuration file is only created automatically during the installation if you perform the installation with package managers like yum or apt-get. If you installed ansible using pip you should create the configuration file manually.</p><p>See <a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#the-configuration-file">The configuration file</a>. Ansible searches configuration files in this order</p><ol><li>ansible.cfg (in the current directory)</li><li>~&#x2F;.ansible.cfg (in the home directory)</li><li>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</li></ol><p>If there isn’t any configuration file the defaults will apply. See the hardcoded defaults in <a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#ansible-configuration-settings">Ansible Configuration Settings</a>. </p><p> <code>ansible-config dump</code> can help show the default ansible.cfg file.</p><p><code>ansible-config init --disabled &gt; ansible.cfg</code> can help generate ansible.cfg file with all options disabled by default</p></blockquote><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">felix@Felixs-MacBook-Pro <span class="hljs-number">01</span>-Environment % cat <span class="hljs-regexp">/etc/</span>ansible/ansible.cfg | <span class="hljs-keyword">grep</span> host_key<br>host_key_checking=<span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>Upload the key to servers in batch with Ansible module: <code>authorized_key</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ansible -i <span class="hljs-number">01</span>-Environment/hosts <span class="hljs-keyword">all</span>  -m authorized_key -a &quot;user=root key=&#x27;&#123;&#123; lookup(&#x27;file&#x27;,&#x27;~/.ssh/id_rsa.pub&#x27;)&#125;&#125;&#x27; path=&#x27;/root/.ssh/authorized_keys&#x27; manage_dir=no&quot; <span class="hljs-comment">--ask-pass -c paramiko</span><br>#因为密码都一样，所以只需要输入一次密码即可，如果密码不同  需要自定义<br> <br>#说明：<br><span class="hljs-keyword">user</span>=root    #将秘钥推送到远程主机的哪个用户下<br>key=<span class="hljs-string">&#x27;&#123;&#123; lookup(&#x27;</span>fil<span class="hljs-string">e&#x27;,&#x27;</span>/root/.ssh/id_rsa.pub<span class="hljs-string">&#x27;)&#125;&#125;&#x27;</span>    #指定要推送的秘钥文件所在的路径<br><span class="hljs-type">path</span>=<span class="hljs-string">&#x27;/root/.ssh/authorized_keys&#x27;</span>    #将秘钥推送到远程主机的哪个目录下并重命名<br>manage_dir=<span class="hljs-keyword">no</span>       #指定模块是否应该管理authorized_keys文件所在的目录，如果设置为yes,模块会创建目录，以及设置一个已存在目录的拥有者和权限。如果通过 <span class="hljs-type">path</span> 选项，重新指定了一个 authorized key 文件所在目录，那么应该将该选项设置为 <span class="hljs-keyword">no</span><br><span class="hljs-keyword">exclusive</span> [<span class="hljs-keyword">default</span>: <span class="hljs-keyword">no</span>]： #是否移除 authorized_keys 文件中其它非指定 key<br>state (Choices: present, absent) [<span class="hljs-keyword">Default</span>: present]： #present 添加指定 key 到 authorized_keys 文件中；absent 从 authorized_keys 文件中移除指定 key<br><br></code></pre></td></tr></table></figure><p>Lastly, add key footprint into known host in localhost and disable firewall on all servers</p><p>Create the setup.yaml file as below:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wait</span> <span class="hljs-string">for</span> <span class="hljs-string">ssh</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">up</span><br>      <span class="hljs-attr">become:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">wait_for:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">22</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">connect_timeout:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">timeout:</span> <span class="hljs-number">360</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_host &#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">delegate_to:</span> <span class="hljs-string">localhost</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">add</span> <span class="hljs-string">footprints</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">&quot;ssh-keyscan -H <span class="hljs-template-variable">&#123;&#123; ansible_host &#125;&#125;</span> &gt;&gt; ~/.ssh/known_hosts&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">diable</span> <span class="hljs-string">firewall</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">firewalld</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">stopped</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>Run <code>setup.yaml </code> </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># To add key footprint into known host in localhost</span><br><span class="hljs-attribute">ansible</span>-playbook -i <span class="hljs-number">01</span>-Environment/hosts <span class="hljs-number">01</span>-Environment/setup.yaml<br></code></pre></td></tr></table></figure><h2 id="Lab-02"><a href="#Lab-02" class="headerlink" title="Lab-02"></a>Lab-02</h2><h3 id="Install-necesssary-packages-and-set-global-proxy"><a href="#Install-necesssary-packages-and-set-global-proxy" class="headerlink" title="Install necesssary packages and set global proxy"></a>Install necesssary packages and set global proxy</h3><p>Create httpd.yaml file and create tasks for package installation</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">web</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">environment:</span><br>    <span class="hljs-attr">http_proxy:</span> <span class="hljs-number">10.64</span><span class="hljs-number">.1</span><span class="hljs-number">.81</span><span class="hljs-string">:8080</span><br>    <span class="hljs-attr">https_proxy:</span> <span class="hljs-number">10.64</span><span class="hljs-number">.1</span><span class="hljs-number">.81</span><span class="hljs-string">:8080</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installs</span> <span class="hljs-string">necessary</span> <span class="hljs-string">packages</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">httpd</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">php*</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">git</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span><br>        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">true</span>  <br></code></pre></td></tr></table></figure><h3 id="Setup-the-virtual-hosts"><a href="#Setup-the-virtual-hosts" class="headerlink" title="Setup the virtual hosts"></a>Setup the virtual hosts</h3><p>Create the virtual host configuration file: awesome-app</p><blockquote><p><a href="https://www.cnblogs.com/swl0221/p/11752080.html">A good article for virtual hosts</a> setup to understand the concept: </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"># Listen 8067<br># <span class="hljs-tag">&lt;<span class="hljs-name">VirtualHost</span> *<span class="hljs-attr">:8067</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">VirtualHost</span> *<span class="hljs-attr">:80</span>&gt;</span><br>  DocumentRoot /var/www/awesome-app<br>  # ServerName www.awesomeapp.com<br>  ErrorLog /var/log/httpd/error_log<br>  CustomLog /var/log/httpd/access_log combined<br>  <span class="hljs-tag">&lt;<span class="hljs-name">Directory</span> /<span class="hljs-attr">var</span>/<span class="hljs-attr">www</span>/<span class="hljs-attr">awesome-app</span>&gt;</span><br>    Options -Indexes +FollowSymlinks<br>    Require all granted<br>    AllowOverride All<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">Directory</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">VirtualHost</span>&gt;</span><br></code></pre></td></tr></table></figure><p>@httpd.yaml file, create task to copy awesome-app configuration file to webserver: &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Push</span> <span class="hljs-string">default</span> <span class="hljs-string">virtual</span> <span class="hljs-string">host</span> <span class="hljs-string">configuration</span><br>  <span class="hljs-attr">copy:</span><br>    <span class="hljs-attr">src:</span> <span class="hljs-string">files/awesome-app</span><br>    <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/httpd/conf.d/awesome-app.conf</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-number">0640</span><br></code></pre></td></tr></table></figure><h3 id="Deploy-the-web-servers"><a href="#Deploy-the-web-servers" class="headerlink" title="Deploy the web servers"></a>Deploy the web servers</h3><p>@httpd.yaml file, create task to deploy awesome application</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">our</span> <span class="hljs-string">awesome</span> <span class="hljs-string">application</span><br>  <span class="hljs-attr">git:</span><br>    <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/leucos/ansible-tuto-demosite.git</span><br>    <span class="hljs-attr">dest:</span> <span class="hljs-string">/var/www/awesome-app</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">deploy</span><br></code></pre></td></tr></table></figure><h3 id="Check-configuration-and-roll-back-to-default-http-server-as-needed"><a href="#Check-configuration-and-roll-back-to-default-http-server-as-needed" class="headerlink" title="Check configuration and roll back to default http server as needed"></a>Check configuration and roll back to default http server as needed</h3><p>@httpd.yaml file, create tasks to check configuration and rollback as needed</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">that</span> <span class="hljs-string">our</span> <span class="hljs-string">config</span> <span class="hljs-string">is</span> <span class="hljs-string">valid</span><br>   <span class="hljs-attr">command:</span> <span class="hljs-string">apachectl</span> <span class="hljs-string">configtest</span><br>   <span class="hljs-attr">register:</span> <span class="hljs-string">result</span><br>   <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">true</span><br>   <span class="hljs-attr">notify:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">httpd</span><br><br> <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Rolling</span> <span class="hljs-string">back</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Removing</span> <span class="hljs-string">the</span> <span class="hljs-string">virtualhost</span><br>   <span class="hljs-attr">file:</span><br>     <span class="hljs-attr">path:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/httpd/conf.d/awesome-app.conf</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">/var/www/awesome-app</span><br>     <span class="hljs-attr">state:</span> <span class="hljs-string">absent</span><br>   <span class="hljs-attr">when:</span> <span class="hljs-string">result</span> <span class="hljs-string">is</span> <span class="hljs-string">failed</span><br><br> <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Rolling</span> <span class="hljs-string">back</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Ending</span> <span class="hljs-string">playbook</span><br>   <span class="hljs-attr">fail:</span><br>     <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;Configuration file is not valid. Please  check that before re-running the playbook&quot;</span><br>   <span class="hljs-attr">when:</span> <span class="hljs-string">result</span> <span class="hljs-string">is</span> <span class="hljs-string">failed</span><br></code></pre></td></tr></table></figure><h3 id="Run-command-to-deploy"><a href="#Run-command-to-deploy" class="headerlink" title="Run command to deploy"></a>Run command to deploy</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ansible-playbook -<span class="hljs-selector-tag">i</span> hosts httpd<span class="hljs-selector-class">.yaml</span><br></code></pre></td></tr></table></figure><img src="/Users/felix/Library/Application Support/typora-user-images/image-20220311102203398.png" alt="image-20220311102203398" style="zoom:50%;" /><h2 id="Lab-03"><a href="#Lab-03" class="headerlink" title="Lab-03"></a>Lab-03</h2><h3 id="Create-haproxy-template-to-be-rendered"><a href="#Create-haproxy-template-to-be-rendered" class="headerlink" title="Create haproxy template to be rendered"></a>Create haproxy template to be rendered</h3><p>create <code>haproxy.cfg.j2</code> file under teamplate folder</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">global</span><br><span class="language-xml">    daemon</span><br><span class="language-xml">    maxconn 256</span><br><span class="language-xml"></span><br><span class="language-xml">defaults</span><br><span class="language-xml">    mode http</span><br><span class="language-xml">    timeout connect 5000ms</span><br><span class="language-xml">    timeout client 50000ms</span><br><span class="language-xml">    timeout server 50000ms</span><br><span class="language-xml"></span><br><span class="language-xml">listen cluster</span><br><span class="language-xml">    bind </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">ansible_host</span> &#125;&#125;</span><span class="language-xml">:80</span><br><span class="language-xml">    mode http</span><br><span class="language-xml">    stats enable</span><br><span class="language-xml">    balance roundrobin</span><br><span class="language-xml">&#123;% for backend in groups[&#x27;web&#x27;] %&#125;</span><br><span class="language-xml">    server </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">hostvars</span>[backend][&#x27;ansible_hostname&#x27;] &#125;&#125;</span><span class="language-xml"> </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">hostvars</span>[backend].ansible_host &#125;&#125;</span><span class="language-xml"> check port 80</span><br><span class="language-xml">&#123;% endfor %&#125;</span><br><span class="language-xml">    option httpchk HEAD /index.php HTTP/1.0</span><br></code></pre></td></tr></table></figure><h3 id="Install-haproxy-for-two-web-servers"><a href="#Install-haproxy-for-two-web-servers" class="headerlink" title="Install haproxy for two web servers"></a>Install haproxy for two web servers</h3><p>Create <code>haproxy.yaml</code> file and create tasks to install haproxy and enable service on server boot</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">web</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">haproxy</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installs</span> <span class="hljs-string">haproxy</span> <span class="hljs-string">load</span> <span class="hljs-string">balancer</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">haproxy</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br>        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">yes</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">and</span> <span class="hljs-string">Allow</span> <span class="hljs-string">haproxy</span> <span class="hljs-string">to</span> <span class="hljs-string">restart</span> <span class="hljs-string">automatically</span> <span class="hljs-string">at</span> <span class="hljs-string">system</span> <span class="hljs-string">boot-up</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">haproxy</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">notify:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">haproxy</span><br></code></pre></td></tr></table></figure><p>Create tasks to push template to haproxy server</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pushes</span> <span class="hljs-string">configuration</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">src:</span> <span class="hljs-string">templates/haproxy.cfg.j2</span><br>    <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/haproxy/haproxy.cfg</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-number">0640</span><br>    <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">group:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">notify:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">haproxy</span><br></code></pre></td></tr></table></figure><h3 id="Run-command-to-deploy-haproxy"><a href="#Run-command-to-deploy-haproxy" class="headerlink" title="Run command to deploy haproxy"></a>Run command to deploy haproxy</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible-playbook -i hosts httpd.yaml haproxy.yaml<br></code></pre></td></tr></table></figure><img src="/Users/felix/Library/Application Support/typora-user-images/image-20220311102500323.png" alt="image-20220311102500323" style="zoom:50%;" /><p>Access <a href="http://haproxy-ip/haproxy?stats">http://haproxy-IP/haproxy?stats</a></p><img src="/Users/felix/Library/Application Support/typora-user-images/image-20220311102526388.png" alt="image-20220311102526388" style="zoom:50%;" /><h2 id="Lab-04"><a href="#Lab-04" class="headerlink" title="Lab-04"></a>Lab-04</h2><h3 id="set-variables-for-tempalte-associated-with-hosts-x2F-groups"><a href="#set-variables-for-tempalte-associated-with-hosts-x2F-groups" class="headerlink" title="set variables for tempalte associated with hosts&#x2F;groups"></a>set variables for tempalte associated with hosts&#x2F;groups</h3><p>create two folders named as <code>group_vars</code> and <code>host_vars</code></p><h4 id="Group-vars"><a href="#Group-vars" class="headerlink" title="Group vars"></a>Group vars</h4><p>The check interval will be set in a group_vars file for haproxy. This will ensure all haproxies will inherit from it.</p><p>We just need to create the file <code>group_vars/haproxy.yml</code> below the inventory directory. <strong>The file has to be named after the group you want to define the variables for</strong>. <strong>If we wanted to define variables for the web group, the file would be named <code>group_vars/web.yml</code>.</strong></p><p>@haproxy.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">haproxy_check_interval:</span> <span class="hljs-number">3000</span><br></code></pre></td></tr></table></figure><p>Note that the <code>.yml</code> is optionalm: we could name haproxy group vars file <code>group_vars/haproxy</code> and Ansible would be ok with it. The extension just helps editors picking the right syntax highlighter.</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">haproxy_check_interval:</span> <span class="hljs-number">3000</span><br><span class="hljs-symbol">haproxy_stats_socket:</span> <span class="hljs-keyword">/tmp/</span>sock<br></code></pre></td></tr></table></figure><p>The name is arbitrary. Meaningful names are recommended of course, but there is no required syntax. You could even use complex variables (a.k.a. Python dict) like this:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">haproxy:</span><br><span class="hljs-symbol">    check_interval:</span> <span class="hljs-number">3000</span><br><span class="hljs-symbol">    stats_socket:</span> <span class="hljs-keyword">/tmp/</span>sock<br></code></pre></td></tr></table></figure><p>This is just a matter of taste. Complex vars can help group stuff logically. They can also, under some circumstances, merge subsequently defined keys (note however that this is not the default ansible behaviour). For now we’ll just use simple variables.</p><h4 id="Hosts-vars"><a href="#Hosts-vars" class="headerlink" title="Hosts vars"></a>Hosts vars</h4><p>Hosts vars follow exactly the same rules, but live in files under <code>host_vars</code> directory.</p><p>Let’s define weights for our backends in <code>host_vars/host1.example.com</code>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">haproxy_backend_weight</span>: <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>and <code>host_vars/host2.example.com</code>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">haproxy_backend_weight</span>: <span class="hljs-number">150</span><br></code></pre></td></tr></table></figure><p>If we’d define <code>haproxy_backend_weight</code> in <code>group_vars/web</code>, it would be used as a ‘default’: variables defined in <code>host_vars</code> files overrides variables defined in <code>group_vars</code>.</p><p>@ansible01.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">haproxy_backend_weight:</span> <span class="hljs-number">150</span><br></code></pre></td></tr></table></figure><p>@ansible02.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">haproxy_backend_weight:</span> <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>@ansible03.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">haproxy_backend_weight:</span> <span class="hljs-number">150</span><br><span class="hljs-attr">haproxy_stats_socket:</span> <span class="hljs-string">/run/sock</span><br></code></pre></td></tr></table></figure><h3 id="Update-the-template-file-with-defined-variables"><a href="#Update-the-template-file-with-defined-variables" class="headerlink" title="Update the template file with defined variables"></a>Update the template file with defined variables</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">global</span><br>    <span class="hljs-string">daemon</span><br>    <span class="hljs-string">maxconn</span> <span class="hljs-number">256</span><br>&#123;<span class="hljs-string">%</span> <span class="hljs-string">if</span> <span class="hljs-string">haproxy_stats_socket</span> <span class="hljs-string">%</span>&#125;<br>    <span class="hljs-string">stats</span> <span class="hljs-string">socket</span> &#123;&#123; <span class="hljs-string">haproxy_stats_socket</span> &#125;&#125; <span class="hljs-comment"># use variables: haproxy_stats_socket defined in host var</span><br>&#123;<span class="hljs-string">%</span> <span class="hljs-string">endif</span> <span class="hljs-string">%</span>&#125;<br><br><span class="hljs-string">defaults</span><br>    <span class="hljs-string">mode</span> <span class="hljs-string">http</span><br>    <span class="hljs-string">timeout</span> <span class="hljs-string">connect</span> <span class="hljs-string">5000ms</span><br>    <span class="hljs-string">timeout</span> <span class="hljs-string">client</span> <span class="hljs-string">50000ms</span><br>    <span class="hljs-string">timeout</span> <span class="hljs-string">server</span> <span class="hljs-string">50000ms</span><br><br><span class="hljs-string">listen</span> <span class="hljs-string">cluster</span><br>    <span class="hljs-string">bind</span> &#123;&#123; <span class="hljs-string">ansible_host</span> &#125;&#125;<span class="hljs-string">:80</span><br>    <span class="hljs-string">mode</span> <span class="hljs-string">http</span><br>    <span class="hljs-string">stats</span> <span class="hljs-string">enable</span><br>    <span class="hljs-string">balance</span> <span class="hljs-string">roundrobin</span><br>&#123;<span class="hljs-string">%</span> <span class="hljs-string">for</span> <span class="hljs-string">backend</span> <span class="hljs-string">in</span> <span class="hljs-string">groups</span>[<span class="hljs-string">&#x27;web&#x27;</span>] <span class="hljs-string">%</span>&#125;<br>    <span class="hljs-string">server</span> &#123;&#123; <span class="hljs-string">hostvars</span>[<span class="hljs-string">backend</span>][<span class="hljs-string">&#x27;ansible_hostname&#x27;</span>] &#125;&#125; &#123;&#123; <span class="hljs-string">hostvars</span>[<span class="hljs-string">backend</span>]<span class="hljs-string">.ansible_host</span> &#125;&#125; <span class="hljs-string">check</span> <span class="hljs-string">port</span> <span class="hljs-number">80</span><br>&#123;<span class="hljs-string">%</span> <span class="hljs-string">endfor</span> <span class="hljs-string">%</span>&#125;<br>    <span class="hljs-string">option</span> <span class="hljs-string">httpchk</span> <span class="hljs-string">HEAD</span> <span class="hljs-string">/index.php</span> <span class="hljs-string">HTTP/1.0</span><br></code></pre></td></tr></table></figure><h3 id="Run-command-to-update"><a href="#Run-command-to-update" class="headerlink" title="Run command to update"></a>Run command to update</h3><p>ansible-playbook -i hosts haproxy.yaml</p><blockquote><p>we don’t need to run httpd.yaml any more, as there’s no change to web servers. However we added an empty play for web hosts at the top. It does nothing except <code>gather_facts: true</code>. But it’s here because it will trigger facts gathering on hosts in group <code>web</code>. This is required because the haproxy playbook needs to pick facts from hosts in this group. If we don’t do this, ansible will complain saying that <code>ansible_all_ipv4_addresses</code> key doesn’t exist.</p></blockquote><p>@haproxy.yaml </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">web</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">haproxy</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Installs</span> <span class="hljs-string">haproxy</span> <span class="hljs-string">load</span> <span class="hljs-string">balancer</span><br>      <span class="hljs-attr">yum:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">haproxy</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br>        <span class="hljs-attr">update_cache:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Pushes</span> <span class="hljs-string">configuration</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">templates/haproxy.cfg.j2</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/haproxy/haproxy.cfg</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-number">0640</span><br>        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">notify:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">haproxy</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">and</span> <span class="hljs-string">Allow</span> <span class="hljs-string">haproxy</span> <span class="hljs-string">to</span> <span class="hljs-string">restart</span> <span class="hljs-string">automatically</span> <span class="hljs-string">at</span> <span class="hljs-string">system</span> <span class="hljs-string">boot-up</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">haproxy</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">notify:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">haproxy</span><br><br>  <span class="hljs-attr">handlers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">haproxy</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">haproxy</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">restarted</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>lab</tag>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Azure AKS</title>
    <link href="/1984/01/24/azure/"/>
    <url>/1984/01/24/azure/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Azure-AKS"><a href="#Azure-AKS" class="headerlink" title="Azure AKS"></a>Azure AKS</h1><h2 id="Create-Azure-AKS-via-AZ-CLI"><a href="#Create-Azure-AKS-via-AZ-CLI" class="headerlink" title="Create Azure AKS via AZ CLI"></a>Create Azure AKS via AZ CLI</h2><ul><li><p>Login Azure</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">az login</span><br></code></pre></td></tr></table></figure></li><li><p>Create Azure resource group</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">az <span class="hljs-keyword">group</span> <span class="hljs-title">create</span> --name felix_test<br></code></pre></td></tr></table></figure></li><li><p>Create Azure AKS Cluster</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">az aks create --resource-<span class="hljs-keyword">group</span> <span class="hljs-title">felix_test</span> --name K8sCluster --<span class="hljs-keyword">node</span><span class="hljs-title">-count</span> <span class="hljs-number">1</span> --generate-ssh-keys --<span class="hljs-keyword">node</span><span class="hljs-title">-vm-size</span>=Standard_B2s --disable-rbac<br></code></pre></td></tr></table></figure></li><li><p>Access AKS cluster through kubectl</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">az</span> <span class="hljs-string">aks</span> <span class="hljs-built_in">get-credentials</span> <span class="hljs-built_in">--resource-group=felix_test</span> <span class="hljs-built_in">--name=K8sCluster</span><br><span class="hljs-string">Merged</span> <span class="hljs-string">&quot;K8sCluster&quot;</span> <span class="hljs-string">as</span> <span class="hljs-string">current</span> <span class="hljs-string">context</span> <span class="hljs-string">in</span> /<span class="hljs-string">Users</span>/<span class="hljs-string">felix_yang</span>/.<span class="hljs-string">kube</span>/<span class="hljs-string">config</span><br></code></pre></td></tr></table></figure><p><img src="https://felixyanghui.synology.me:8441/images/2022/12/30/image-20221230212633255.png" alt="image-20221230212633255"></p><blockquote><p>all the configuration of Azure AKS cluster written into kubectl config file: <em>&#x2F;Users&#x2F;felix_yang&#x2F;.kube&#x2F;config</em></p></blockquote></li><li><p>Verify the access via Kubectl commands</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">felix_yang</span>@nj-felix-yang-mba ~ % kubectl get nodes<br><span class="hljs-attribute">NAME</span>                                STATUS   ROLES   AGE    VERSION<br><span class="hljs-attribute">aks</span>-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   Ready    agent   <span class="hljs-number">6</span>m2s   v1.<span class="hljs-number">24</span>.<span class="hljs-number">6</span><br><br><span class="hljs-attribute">felix_yang</span>@nj-felix-yang-mba ~ % kubectl get namespaces   <br><span class="hljs-attribute">NAME</span>              STATUS   AGE<br><span class="hljs-attribute">default</span>           Active   <span class="hljs-number">19</span>m<br><span class="hljs-attribute">kube</span>-node-lease   Active   <span class="hljs-number">19</span>m<br><span class="hljs-attribute">kube</span>-public       Active   <span class="hljs-number">19</span>m<br><span class="hljs-attribute">kube</span>-system       Active   <span class="hljs-number">19</span>m<br><br><br><span class="hljs-attribute">felix_yang</span>@nj-felix-yang-mba ~ % kubectl get pods --<span class="hljs-literal">all</span>-namespaces -o wide<br><span class="hljs-attribute">NAMESPACE</span>     NAME                                  READY   STATUS    RESTARTS   AGE     IP            NODE                                NOMINATED NODE   READINESS GATES<br><span class="hljs-attribute">kube</span>-system   azure-ip-masq-agent-<span class="hljs-number">5</span>nb4w             <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m29s   <span class="hljs-number">10.224.0.4</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   cloud-node-manager-bjghg              <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m29s   <span class="hljs-number">10.224.0.4</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   coredns-<span class="hljs-number">59</span>b6bf8b4f-<span class="hljs-number">9</span>bnk9              <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m39s   <span class="hljs-number">10.244.0.8</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   coredns-<span class="hljs-number">59</span>b6bf8b4f-sktkk              <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">19</span>m     <span class="hljs-number">10.244.0.7</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   coredns-autoscaler-<span class="hljs-number">5655</span>d66f64-dv487   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">19</span>m     <span class="hljs-number">10.244.0.5</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   csi-azuredisk-node-hkzb6              <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m29s   <span class="hljs-number">10.224.0.4</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   csi-azurefile-node-vgh7t              <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m29s   <span class="hljs-number">10.224.0.4</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   konnectivity-agent-<span class="hljs-number">676</span>cb95b4d-dj9f5   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m36s   <span class="hljs-number">10.244.0.9</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   konnectivity-agent-<span class="hljs-number">676</span>cb95b4d-pfv8c   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">19</span>m     <span class="hljs-number">10.244.0.2</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   kube-proxy-<span class="hljs-number">9</span>n8wm                      <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m29s   <span class="hljs-number">10.224.0.4</span>    aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   metrics-server-<span class="hljs-number">7</span>dd74d8758-vnkwn       <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m34s   <span class="hljs-number">10.244.0.11</span>   aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">kube</span>-system   metrics-server-<span class="hljs-number">7</span>dd74d8758-xvj5h       <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m34s   <span class="hljs-number">10.244.0.10</span>   aks-nodepool1-<span class="hljs-number">19839722</span>-vmss000000   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure></li><li><p>Delete AKS cluster</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">az aks delete --resource-<span class="hljs-keyword">group</span> <span class="hljs-title">felix_test</span> --name K8sCluster<br></code></pre></td></tr></table></figure></li></ul><h2 id="Useful-Links-of-Kubectl"><a href="#Useful-Links-of-Kubectl" class="headerlink" title="Useful Links of Kubectl"></a>Useful Links of Kubectl</h2><ul><li><a href="https://go.microsoft.com/fwlink/?linkid=2135816">kubectl 概述</a> </li><li><a href="https://go.microsoft.com/fwlink/?linkid=2135746">Kubectl 入门</a> </li><li><a href="https://go.microsoft.com/fwlink/?linkid=2135748">Kubectl 速查表</a> </li><li><a href="https://go.microsoft.com/fwlink/?linkid=2135818">Kubectl 参考</a> </li><li><a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">JSONPath Support</a></li></ul><h2 id="Organizing-Cluster-Access-Using-kubeconfig-Files"><a href="#Organizing-Cluster-Access-Using-kubeconfig-Files" class="headerlink" title="Organizing Cluster Access Using kubeconfig Files"></a><a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Organizing Cluster Access Using kubeconfig Files</a></h2><p>Use kubeconfig files to organize information about clusters, users, namespaces, and authentication mechanisms. The <code>kubectl</code> command-line tool uses kubeconfig files to find the information it needs to choose a cluster and communicate with the API server of a cluster.</p><blockquote><p><strong>Note:</strong> A file that is used to configure access to clusters is called a <em>kubeconfig file</em>. This is a generic way of referring to configuration files. It does not mean that there is a file named <code>kubeconfig</code>.</p></blockquote><blockquote><p><strong>Warning:</strong> Only use kubeconfig files from trusted sources. Using a specially-crafted kubeconfig file could result in malicious code execution or file exposure. If you must use an untrusted kubeconfig file, inspect it carefully first, much as you would a shell script.</p></blockquote><p>By default, <code>kubectl</code> looks for a file named <code>config</code> in the <code>$HOME/.kube</code> directory. You can specify other kubeconfig files by setting the <code>KUBECONFIG</code> environment variable or by setting the <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl/"><code>--kubeconfig</code></a> flag.</p><p>For step-by-step instructions on creating and specifying kubeconfig files, see <a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters">Configure Access to Multiple Clusters</a>.</p><h2 id="Azure-CLI-Commands"><a href="#Azure-CLI-Commands" class="headerlink" title="Azure CLI Commands"></a>Azure CLI Commands</h2><ul><li><p>use query to filter the output</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">felix_yang@nj-felix-yang-mba ~ % az <span class="hljs-keyword">group</span> <span class="hljs-title">list</span> --query <span class="hljs-string">&quot;[*].name&quot;</span>                        <br>[<br>  <span class="hljs-string">&quot;rg-vm-jpwest&quot;</span>,<br>  <span class="hljs-string">&quot;NetworkWatcherRG&quot;</span>,<br>  <span class="hljs-string">&quot;felix_test&quot;</span>,<br>  <span class="hljs-string">&quot;MC_felix_test_K8sCluster_eastus&quot;</span>,<br>  <span class="hljs-string">&quot;rg-vm-eastasia&quot;</span><br>]<br></code></pre></td></tr></table></figure><p><em><a href="https://jmespath.org/tutorial.html">https://jmespath.org/tutorial.html</a></em></p></li><li><p>set default subscription</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros">az account <span class="hljs-built_in">set</span> -s 138250aa-021a-4cb4-81ff-537da09d0e72<br><br>felix_yang@nj-felix-yang-mba ~ % az account show<br>&#123;<br>  <span class="hljs-string">&quot;environmentName&quot;</span>: <span class="hljs-string">&quot;AzureCloud&quot;</span>,<br>  <span class="hljs-string">&quot;homeTenantId&quot;</span>: <span class="hljs-string">&quot;3e04753a-ae5b-42d4-a86d-d6f05460f9e4&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;138250aa-021a-4cb4-81ff-537da09d0e72&quot;</span>,<br>  <span class="hljs-string">&quot;isDefault&quot;</span>: <span class="hljs-literal">true</span>,      -------------------------&gt;&gt;&gt;&gt; <span class="hljs-built_in">set</span> <span class="hljs-keyword">to</span><span class="hljs-built_in"> default</span><br><span class="hljs-built_in"></span>  <span class="hljs-string">&quot;managedByTenants&quot;</span>: [],<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Cloud Service Engineering lab test&quot;</span>,<br>  <span class="hljs-string">&quot;state&quot;</span>: <span class="hljs-string">&quot;Enabled&quot;</span>,<br>  <span class="hljs-string">&quot;tenantId&quot;</span>: <span class="hljs-string">&quot;3e04753a-ae5b-42d4-a86d-d6f05460f9e4&quot;</span>,<br>  <span class="hljs-string">&quot;user&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;felix_yang@trendmicro.com&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;user&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><img src="https://felixyanghui.synology.me:8441/images/2022/12/30/image-20221230214050304.png" alt="image-20221230214050304" style="zoom:33%;" /></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Azure</tag>
      
      <tag>AKS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8s and CICD lab</title>
    <link href="/1984/01/24/cicd-lab/"/>
    <url>/1984/01/24/cicd-lab/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002110216278.png" alt="image-20221002110216278"></p><h1 id="01-Installation"><a href="#01-Installation" class="headerlink" title="01. Installation"></a>01. Installation</h1><h2 id="01-1-A-Setup-K8S-Cluster-lt-V1-24"><a href="#01-1-A-Setup-K8S-Cluster-lt-V1-24" class="headerlink" title="01.1.A Setup K8S Cluster (&lt; V1.24)"></a>01.1.A Setup K8S Cluster (&lt; V1.24)</h2><h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><h4 id="Lab-servers"><a href="#Lab-servers" class="headerlink" title="Lab servers"></a>Lab servers</h4><p>OS image: CentOS 8 stream</p><p>K8S Master: 192.168.22.91<br>K8S Node-1: 192.168.22.92<br>K8S Node-2: 192.168.22.93</p><p>Rancher: 192.168.22.84 admin&#x2F;novirus</p><p>GitLab: 192.168.22.85. root&#x2F;P@ssw0rd</p><p>Harbor: 192.168.22.86 admin&#x2F;novirus</p><p><del>(Jenkins on Kubernetes: 192.168.22.61:32001)</del></p><p>Jenkins on CentOS8: 192.168.22.87:8080 </p><p>Grafana:  192.168.22.61:32000</p><h4 id="Initial-environment-setup-for-master-and-node-servers"><a href="#Initial-environment-setup-for-master-and-node-servers" class="headerlink" title="Initial environment setup for master and node servers"></a>Initial environment setup for master and node servers</h4><p>Environment_ini.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Disable SELinux</span><br>setenforce 0<br>sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment"># Disable firewall permanently</span><br>systemctl <span class="hljs-built_in">disable</span> firewalld --now<br>systemctl mask --now firewalld<br><span class="hljs-comment">#systemctl status firewalld</span><br><br><span class="hljs-comment"># Diable swap temporally</span><br>swapoff -a<br><br><span class="hljs-comment">#永久禁掉swap分区，注释掉swap那一行</span><br>sed -ri <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab<br><br><span class="hljs-comment"># Adjust kernel parameters</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sysctl --system<br><br><span class="hljs-comment"># Load netfilter kernel module</span><br>modprobe br_netfilter<br>lsmod | grep br_netfilter<br><br><span class="hljs-comment"># Network gateway and proxy settings, only GW=192.168.0.250 can reach TW proxy=10.64.1.81:8080</span><br>route -n | grep -i ug<br><br><span class="hljs-comment"># sync time with chronyd</span><br>sudo systemctl start chronyd<br>sudo systemctl <span class="hljs-built_in">enable</span> chronyd<br>chronyd -q <span class="hljs-string">&#x27;server ntp.ntsc.ac.cn iburst&#x27;</span><br>chronyc activity<br>chronyc tracking<br></code></pre></td></tr></table></figure><h4 id="Set-proxy-for-Lab-environment"><a href="#Set-proxy-for-Lab-environment" class="headerlink" title="Set proxy for Lab environment"></a>Set proxy for Lab environment</h4><p>Proxy_set.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Set proxy for os system</span><br><span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">&quot;10.64.1.81:8080&quot;</span><br><span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">&quot;10.64.1.81:8080&quot;</span><br><span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">&quot;10.64.0.0/16,172.168.1.0/24,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16&quot;</span><br></code></pre></td></tr></table></figure><h4 id="Install-Docker-for-master-and-node-servers"><a href="#Install-Docker-for-master-and-node-servers" class="headerlink" title="Install Docker for master and node servers"></a>Install Docker for master and node servers</h4><p>Docker_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the devicemapper storage driver.</span><br>yum install -y yum-utils device-mapper-persistent-data lvm2<br><br><span class="hljs-comment"># Use the following command to set up the stable repository</span><br>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br><br><span class="hljs-comment"># Remove podman buildah to avoid the error: &quot;Error: Problem 1: problem with installed package podman-1:3.4.1-3.module_el8.6.0+954+963caf36.x86_64 - package podman-1:3.4.1-3.module_el8.6.0+954+963caf36.x86_64 requires runc &gt;= 1.0.0-57, but none of the providers can be installed&quot;</span><br>yum erase -y podman buildah<br><br><span class="hljs-comment"># Install docker</span><br>yum install -y docker-ce docker-ce-cli containerd.io<br><br><span class="hljs-comment"># If need to install a specific version, can use below commands</span><br><span class="hljs-comment">## yum list docker-ce --showduplicates | sort -r</span><br><span class="hljs-comment">## sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br><span class="hljs-comment">## for example: 3:19.03.2-3.el7</span><br><span class="hljs-comment">## yum install docker-ce-&lt;3:19.03.2-3.el7&gt; docker-ce-cli-&lt;3:19.03.2-3.el7&gt; containerd.io</span><br><span class="hljs-comment"># Start and Enable Docker</span><br>systemctl start docker &amp;&amp;  systemctl <span class="hljs-built_in">enable</span> docker<br><br><br><span class="hljs-comment"># Set proxy for docker </span><br><span class="hljs-built_in">mkdir</span> /etc/systemd/system/docker.service.d<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Environment=&quot;HTTP_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;HTTPS_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;NO_PROXY=localhost,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,docker-registry.somecorporation.com&quot;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># set proxy for containerd</span><br><span class="hljs-built_in">mkdir</span> /etc/systemd/system/containerd.service.d<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; /etc/systemd/system/containerd.service.d/http-proxy.conf</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Environment=&quot;HTTP_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;HTTPS_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;NO_PROXY=localhost,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,docker-registry.somecorporation.com&quot;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># Reload and restart docker</span><br>systemctl daemon-reload &amp;&amp; systemctl restart docker<br><br><span class="hljs-comment"># Reload and restart containerd</span><br>systemctl daemon-reload &amp;&amp; systemctl restart containerd<br><br><span class="hljs-comment"># Show docker proxy settings</span><br>systemctl show --property Environment docker<br><br><span class="hljs-comment"># Show docker proxy settings</span><br>systemctl show --property Environment containerd<br></code></pre></td></tr></table></figure><h3 id="Install-Kubernetes"><a href="#Install-Kubernetes" class="headerlink" title="Install Kubernetes"></a>Install Kubernetes</h3><h4 id="Installing-kubeadm-kubelet-and-kubectl-on-Master-and-node-servers"><a href="#Installing-kubeadm-kubelet-and-kubectl-on-Master-and-node-servers" class="headerlink" title="Installing kubeadm, kubelet and kubectl on Master and node servers"></a><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl">Installing kubeadm, kubelet and kubectl</a> on Master and node servers</h4><p>K8s_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Install kubeadm, kubelet and kubectl with Aliyun repo</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">repo_gpgcheck=0</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># Set SELinux in permissive mode (effectively disabling it)</span><br>sudo setenforce 0<br>sudo sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config<br><br><br><span class="hljs-comment"># sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="hljs-comment"># install version 1.23.5 which is stable version. Installing lastest version usually have unknown issue when initialization</span><br>sudo yum -y install kubeadm-1.23.5 kubelet-1.23.5 kubectl-1.23.5<br><br><br><span class="hljs-comment"># !!! before enable kubelet, need to ensure docker and kubelet driver are the same, otherwise, there&#x27;s below error message after &quot;kubeadm init&quot; command: &quot;cgroup and systemd are not matched&quot;</span><br><span class="hljs-comment"># [error: failed to run Kubelet: failed to create kubelet: misconfiguration: kubelet cgroup driver: “systemd” is different from docker cgroup driver: “cgroupfs”]</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><span class="hljs-string"># Note: This dropin only works with kubeadm and kubelet v1.11+</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Environment=&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span><br><span class="hljs-string">Environment=&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;</span><br><span class="hljs-string">Environment=&quot;KUBELET_CGROUP_ARGS=--cgroup-driver=cgroupfs&quot;</span><br><span class="hljs-string"># This is a file that &quot;kubeadm init&quot; and &quot;kubeadm join&quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span><br><span class="hljs-string">EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env</span><br><span class="hljs-string"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span><br><span class="hljs-string"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span><br><span class="hljs-string">EnvironmentFile=-/etc/sysconfig/kubelet</span><br><span class="hljs-string">ExecStart=</span><br><span class="hljs-string">ExecStart=/usr/bin/kubelet \$KUBELET_KUBECONFIG_ARGS \$KUBELET_CONFIG_ARGS \$KUBELET_KUBEADM_ARGS \$KUBELET_EXTRA_ARGS \$KUBELET_CGROUP_ARGS</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">###################</span><br><span class="hljs-comment"># !!! before enable kubelet, need to ensure docker and kubelet driver are the same, otherwise, there&#x27;s below error message after &quot;kubeadm init&quot; command: &quot;cgroup and systemd are not matched&quot;</span><br><span class="hljs-comment"># [error: failed to run Kubelet: failed to create kubelet: misconfiguration: kubelet cgroup driver: “systemd” is different from docker cgroup driver: “cgroupfs”]</span><br><br><span class="hljs-comment"># vi  /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><br><br><span class="hljs-comment">#Update below parameter:</span><br><span class="hljs-comment">#Environment=&quot;KUBELET_CGROUP_ARGS=--cgroup-driver=cgroupfs&quot;</span><br><span class="hljs-comment">#ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS $KUBELET_CGROUP_ARGS</span><br><span class="hljs-comment">#######################</span><br><br>systemctl daemon-reload &amp;&amp; systemctl restart kubelet<br>sudo systemctl <span class="hljs-built_in">enable</span> --now kubelet<br><br><span class="hljs-comment"># restart container CRI</span><br><span class="hljs-built_in">rm</span> -rf /etc/containerd/config.toml<br>systemctl restart containerd<br><br><span class="hljs-comment"># install crictl</span><br>crictl config runtime-endpoint unix:///run/containerd/containerd.sock<br>crictl config image-endpoint unix:///run/containerd/containerd.sock<br></code></pre></td></tr></table></figure><h4 id="Init-Kubenetes-with-network-and-configure-kubectl-as-regular-user-on-Master-server"><a href="#Init-Kubenetes-with-network-and-configure-kubectl-as-regular-user-on-Master-server" class="headerlink" title="Init Kubenetes with network and configure kubectl as regular user on Master server"></a>Init Kubenetes with network and configure kubectl as regular user on Master server</h4><p>Network_kubectl_user.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><br>kubeadm init --pod-network-cidr=10.244.0.0/16 --config kubeadm-config.yaml<br><span class="hljs-comment">#参考：如果要指定Kubernetes的版本,可以用一下命令</span><br><span class="hljs-comment">#kubeadm init --kubernetes-version=v1.15.1 --pod-network-cidr=10.244.0.0/16</span><br><br><span class="hljs-comment"># 如果初始化失败，记得执行清空</span><br><span class="hljs-comment"># kubeadm reset</span><br><br><span class="hljs-comment"># 卸载管理组件</span><br><span class="hljs-comment"># yum erase -y kubelet kubectl kubeadm kubernetes-cni</span><br><br><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h4 id="Install-network-plugin-and-weave-tool-on-Master-server"><a href="#Install-network-plugin-and-weave-tool-on-Master-server" class="headerlink" title="Install network plugin and weave tool on Master server"></a>Install network plugin and weave tool on Master server</h4><p>Network_plugin.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Install network plugin weave</span><br>kubectl apply -f <span class="hljs-string">&quot;https://cloud.weave.works/k8s/net?k8s-version=<span class="hljs-subst">$(kubectl version | base64 | tr -d &#x27;\n&#x27;)</span>&quot;</span><br><br>sudo curl --proxy 10.64.1.81:8080 -L git.io/weave -o /usr/local/bin/weave<br>sudo <span class="hljs-built_in">chmod</span> a+x /usr/local/bin/weave<br>weave ps<br>weave status<br>weave status peers<br>weave status connections<br></code></pre></td></tr></table></figure><h3 id="Post-Installation"><a href="#Post-Installation" class="headerlink" title="Post-Installation"></a>Post-Installation</h3><h4 id="Join-node-server-to-master"><a href="#Join-node-server-to-master" class="headerlink" title="Join node server to master"></a>Join node server to master</h4><p>Node_join.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># avoid error: [ERROR FileContent–proc-sys-net-ipv4-ip_forward]: /proc/sys/net/ipv4/ip_forward contents are not set to 1</span><br><span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward<br><br><span class="hljs-comment"># Below command is copied from the output of the &quot;kubeadm init&quot;</span><br>kubeadm <span class="hljs-built_in">join</span> 192.168.22.81:6443 --token d0cbz5.9nugb974yhl54ss6 \<br>--discovery-token-ca-cert-hash sha256:bc7099ce8ff86c2cc7d8d51b0f30c4d57cbd3fbe967e81f8f05c2decf9599b07 <br><br><span class="hljs-comment"># Check K8S cluster nodes and pods status</span><br>kubectl get nodes<br>kubectl get pods --all-namespaces -o wide<br></code></pre></td></tr></table></figure><h4 id="Install-helm3-on-K8SMaster"><a href="#Install-helm3-on-K8SMaster" class="headerlink" title="Install helm3 on K8SMaster"></a>Install helm3 on K8SMaster</h4><p>Helm3_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -e <span class="hljs-string">&quot;https_proxy=10.64.1.81:8080&quot;</span>  https://get.helm.sh/helm-v3.1.2-linux-amd64.tar.gz<br>tar -zxvf helm-v3.1.2-linux-amd64.tar.gz<br><span class="hljs-built_in">cd</span> linux-amd64/<br><span class="hljs-built_in">mv</span> helm /usr/bin/<br>helm version<br><br><br><span class="hljs-comment"># helm init is not used any more since helm3</span><br><span class="hljs-comment"># $ kubectl create serviceaccount --namespace kube-system tiller</span><br><span class="hljs-comment"># $ kubectl create clusterrolebinding tiller-cluster-role --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br><span class="hljs-comment"># $ helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.15.1 --service-account=tiller --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts![title](/api/file/getImage?fileId=620bb3b4935fe2000e000015)</span><br><span class="hljs-comment"># add helm repo</span><br>helm repo add  aliyuncs https://apphub.aliyuncs.com<br>helm repo list<br>helm search repo aliyuncs | <span class="hljs-built_in">head</span> -5<br></code></pre></td></tr></table></figure><h4 id="something-more-about-helm"><a href="#something-more-about-helm" class="headerlink" title="something more about helm"></a>something more about helm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># add helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="hljs-string">&quot;stable&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="hljs-string">&quot;aliyun&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add jetstack https://charts.jetstack.io</span><br><span class="hljs-string">&quot;jetstack&quot;</span> has been added to your repositories<br><br><span class="hljs-comment"># update helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo update</span><br>Hang tight <span class="hljs-keyword">while</span> we grab the latest from your chart repositories...<br>...Successfully got an update from the <span class="hljs-string">&quot;jetstack&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;aliyun&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;stable&quot;</span> chart repository<br>Update Complete. ⎈ Happy Helming!⎈ <br><br><span class="hljs-comment"># list helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo list</span><br>NAME    URL                                                   <br>stable  http://mirror.azure.cn/kubernetes/charts              <br>aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br>jetstackhttps://charts.jetstack.io                            <br><br><span class="hljs-comment"># search chart</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm search repo nginx</span><br>NAME                       CHART VERSIONAPP VERSIONDESCRIPTION                                       <br>aliyun/nginx-ingress       0.9.5        0.10.2     An nginx Ingress controller that uses ConfigMap...<br>aliyun/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>stable/nginx-ingress       1.41.3       v0.34.1    DEPRECATED! An nginx Ingress controller that us...<br>stable/nginx-ldapauth-proxy0.1.6        1.13.5     DEPRECATED - nginx proxy with ldapauth            <br>stable/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>aliyun/gcloud-endpoints    0.1.0                   Develop, deploy, protect and monitor your APIs ...<br>stable/gcloud-endpoints    0.1.2        1          DEPRECATED Develop, deploy, protect and monitor..<br></code></pre></td></tr></table></figure><h3 id="Common-Troubleshooting-Tips"><a href="#Common-Troubleshooting-Tips" class="headerlink" title="Common Troubleshooting Tips"></a>Common Troubleshooting Tips</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get nodes<br>kubectl get ds -n kube-system<br>kubectl get pod<br>kubectl get pods -n kube-system<br>kubectl get pods -n kube-system -o wide<br>kubectl logs weave-net-ldsgl  -n kube-system weave-npc<br>kubectl describe pod auth-54d7667c5d-sgrt8<br>systemctl status kubelet<br>journalctl -f -u kubelet<br><span class="hljs-comment"># If the init container failed, subsequent container initilization just pending there, no logs from below commands</span><br>kubectl logs auth-54d7667c5d-dnslv<br>kubectl logs scan-687c4bfddd-w5fbk  --previous<br><span class="hljs-comment"># check why init container failed, lead to subsequent container can not be initialized</span><br>kubectl logs scan-687c4bfddd-w5fbk  -c db-init <br></code></pre></td></tr></table></figure><h2 id="01-1-B-Setup-K8S-Cluster-gt-x3D-V1-24"><a href="#01-1-B-Setup-K8S-Cluster-gt-x3D-V1-24" class="headerlink" title="01.1.B Setup K8S Cluster (&gt;&#x3D; V1.24)"></a>01.1.B Setup K8S Cluster (&gt;&#x3D; V1.24)</h2><p>since the new Kubernetes 1.24, there’s deprecation of dockershim</p><p>Refer to <a href="https://blog.csdn.net/qq_41822345/article/details/126679925?ops_request_misc=&request_id=&biz_id=102&utm_term=%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85k8s&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-126679925.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_control2&spm=1018.2226.3001.4187">Install latest K8S version</a></p><p>Refer to <a href="Containerd%E3%80%90%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E3%80%91">containerd introduction</a></p><p><img src="https://felixyanghui.synology.me:8441/images/2023/01/01/e230010b8e2640a286296e5a777d7726.png" alt="在这里插入图片描述"></p><h3 id="Preparation-1"><a href="#Preparation-1" class="headerlink" title="Preparation"></a>Preparation</h3><h4 id="Lab-servers-1"><a href="#Lab-servers-1" class="headerlink" title="Lab servers"></a>Lab servers</h4><p>OS image: CentOS 8 stream</p><p>K8S Master: 192.168.22.91<br>K8S Node-1: 192.168.22.92<br>K8S Node-2: 192.168.22.93</p><p>Rancher: 192.168.22.84 admin&#x2F;novirus</p><p>GitLab: 192.168.22.85. root&#x2F;P@ssw0rd</p><p>Harbor: 192.168.22.86 admin&#x2F;novirus</p><p><del>(Jenkins on Kubernetes: 192.168.22.61:32001)</del></p><p>Jenkins on CentOS8: 192.168.22.87:8080 </p><p>Grafana:  192.168.22.61:32000</p><h4 id="Initial-environment-setup-for-master-and-node-servers-1"><a href="#Initial-environment-setup-for-master-and-node-servers-1" class="headerlink" title="Initial environment setup for master and node servers"></a>Initial environment setup for master and node servers</h4><p>Environment_ini.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Disable SELinux</span><br>setenforce 0<br>sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment"># Disable firewall permanently</span><br>systemctl <span class="hljs-built_in">disable</span> firewalld --now<br>systemctl mask --now firewalld<br><span class="hljs-comment">#systemctl status firewalld</span><br><br><span class="hljs-comment"># Diable swap temporally</span><br>swapoff -a<br><br><span class="hljs-comment">#永久禁掉swap分区，注释掉swap那一行</span><br>sed -ri <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab<br><br><span class="hljs-comment"># Adjust kernel parameters</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sysctl --system<br><br><span class="hljs-comment"># Load netfilter kernel module</span><br>modprobe br_netfilter<br>lsmod | grep br_netfilter<br><br><span class="hljs-comment"># Network gateway and proxy settings, only GW=192.168.0.250 can reach TW proxy=10.64.1.81:8080</span><br>route -n | grep -i ug<br><br><span class="hljs-comment"># sync time with chronyd</span><br>sudo systemctl start chronyd<br>sudo systemctl <span class="hljs-built_in">enable</span> chronyd<br>chronyd -q <span class="hljs-string">&#x27;server ntp.ntsc.ac.cn iburst&#x27;</span><br>chronyc activity<br>chronyc tracking<br></code></pre></td></tr></table></figure><h4 id="Set-proxy-for-Lab-environment-1"><a href="#Set-proxy-for-Lab-environment-1" class="headerlink" title="Set proxy for Lab environment"></a>Set proxy for Lab environment</h4><p>Proxy_set.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Set proxy for os system</span><br><span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">&quot;10.64.1.81:8080&quot;</span><br><span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">&quot;10.64.1.81:8080&quot;</span><br><span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">&quot;10.64.0.0/16,172.168.1.0/24,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16&quot;</span><br></code></pre></td></tr></table></figure><h4 id="Install-Docker-for-master-and-node-servers-1"><a href="#Install-Docker-for-master-and-node-servers-1" class="headerlink" title="Install Docker for master and node servers"></a>Install Docker for master and node servers</h4><p>Docker_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the devicemapper storage driver.</span><br>yum install -y yum-utils device-mapper-persistent-data lvm2<br><br><span class="hljs-comment"># Use the following command to set up the stable repository</span><br>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br><br><span class="hljs-comment"># Remove podman buildah to avoid the error: &quot;Error: Problem 1: problem with installed package podman-1:3.4.1-3.module_el8.6.0+954+963caf36.x86_64 - package podman-1:3.4.1-3.module_el8.6.0+954+963caf36.x86_64 requires runc &gt;= 1.0.0-57, but none of the providers can be installed&quot;</span><br>yum erase -y podman buildah<br><br><span class="hljs-comment"># Install docker</span><br>yum install -y docker-ce docker-ce-cli containerd.io<br><br><span class="hljs-comment"># If need to install a specific version, can use below commands</span><br><span class="hljs-comment">## yum list docker-ce --showduplicates | sort -r</span><br><span class="hljs-comment">## sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br><span class="hljs-comment">## for example: 3:19.03.2-3.el7</span><br><span class="hljs-comment">## yum install docker-ce-&lt;3:19.03.2-3.el7&gt; docker-ce-cli-&lt;3:19.03.2-3.el7&gt; containerd.io</span><br><span class="hljs-comment"># Start and Enable Docker</span><br>systemctl start docker &amp;&amp;  systemctl <span class="hljs-built_in">enable</span> docker<br><br><br><span class="hljs-comment"># Install containerd #-----------------Start----------------#</span><br><span class="hljs-comment"># https://github.com/containerd/containerd/blob/main/docs/getting-started.md</span><br><br><span class="hljs-comment"># Step-1: Installing containerd</span><br>tar Cxzvf /usr/local containerd-1.6.14-linux-amd64.tar.gz<br><br><br><span class="hljs-comment">## systemd enabled</span><br><span class="hljs-built_in">mkdir</span> -p /usr/local/lib/systemd/system<br>curl https://raw.githubusercontent.com/containerd/containerd/main/containerd.service -o /usr/local/lib/systemd/system/containerd.service<br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now containerd<br><br><span class="hljs-comment"># Step-2: Installing runc</span><br><br>install -m 755 runc.amd64 /usr/local/sbin/runc<br><br><span class="hljs-comment"># Step-3: Installing CNI plugins</span><br><br><span class="hljs-built_in">mkdir</span> -p /opt/cni/bin<br>tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz<br><span class="hljs-comment">#---------------------------------END--------------------#</span><br><br><span class="hljs-comment">#---------- set Cgroup drivers on systemd &lt;start&gt;--------------</span><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; kubeadm-config.yaml</span><br><span class="hljs-string"># kubeadm-config.yaml</span><br><span class="hljs-string">kind: ClusterConfiguration</span><br><span class="hljs-string">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="hljs-string">kubernetesVersion: v1.25.5</span><br><span class="hljs-string">---</span><br><span class="hljs-string">kind: KubeletConfiguration</span><br><span class="hljs-string">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="hljs-string">cgroupDriver: systemd</span><br><span class="hljs-string">EOF</span><br><br>containerd config default &gt; /etc/containerd/config.toml<br><br>sed -i <span class="hljs-string">&#x27;s/SystemdCgroup = false/SystemdCgroup = true/g&#x27;</span> /etc/containerd/config.toml<br><br>systemctl restart containerd<br><br><span class="hljs-comment">#---------- set Cgroup drivers on systemd &lt;end&gt;--------------</span><br><br><span class="hljs-comment"># Set proxy for docker </span><br><span class="hljs-built_in">mkdir</span> /etc/systemd/system/docker.service.d<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Environment=&quot;HTTP_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;HTTPS_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;NO_PROXY=localhost,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,docker-registry.somecorporation.com&quot;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># set proxy for containerd</span><br><span class="hljs-built_in">mkdir</span> /etc/systemd/system/containerd.service.d<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; /etc/systemd/system/containerd.service.d/http-proxy.conf</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Environment=&quot;HTTP_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;HTTPS_PROXY=10.64.1.81:8080&quot;</span><br><span class="hljs-string">Environment=&quot;NO_PROXY=localhost,127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,docker-registry.somecorporation.com&quot;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># Reload and restart docker</span><br>systemctl daemon-reload &amp;&amp; systemctl restart docker<br><br><span class="hljs-comment"># Reload and restart containerd</span><br>systemctl daemon-reload &amp;&amp; systemctl restart containerd<br><br><span class="hljs-comment"># Show docker proxy settings</span><br>systemctl show --property Environment docker<br><br><span class="hljs-comment"># Show docker proxy settings</span><br>systemctl show --property Environment containerd<br></code></pre></td></tr></table></figure><h3 id="Install-Kubernetes-1"><a href="#Install-Kubernetes-1" class="headerlink" title="Install Kubernetes"></a>Install Kubernetes</h3><h4 id="Installing-kubeadm-kubelet-and-kubectl-on-Master-and-node-servers-1"><a href="#Installing-kubeadm-kubelet-and-kubectl-on-Master-and-node-servers-1" class="headerlink" title="Installing kubeadm, kubelet and kubectl on Master and node servers"></a><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl">Installing kubeadm, kubelet and kubectl</a> on Master and node servers</h4><p>K8s_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Install kubeadm, kubelet and kubectl with Aliyun repo</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">repo_gpgcheck=0</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># Set SELinux in permissive mode (effectively disabling it)</span><br>sudo setenforce 0<br>sudo sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment"># install version 1.25.5 which is stable version. Installing lastest version usually have unknown issue when initialization</span><br>sudo yum -y install kubeadm-1.25.5 kubelet-1.25.5 kubectl-1.25.5<br><br>systemctl daemon-reload &amp;&amp; systemctl restart kubelet<br>sudo systemctl <span class="hljs-built_in">enable</span> --now kubelet<br><br><span class="hljs-comment"># install crictl</span><br>crictl config runtime-endpoint unix:///run/containerd/containerd.sock<br>crictl config image-endpoint unix:///run/containerd/containerd.sock<br></code></pre></td></tr></table></figure><h4 id="Init-Kubenetes-with-network-and-configure-kubectl-as-regular-user-on-Master-server-1"><a href="#Init-Kubenetes-with-network-and-configure-kubectl-as-regular-user-on-Master-server-1" class="headerlink" title="Init Kubenetes with network and configure kubectl as regular user on Master server"></a>Init Kubenetes with network and configure kubectl as regular user on Master server</h4><p>Network_kubectl_user.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm init --pod-network-cidr=10.244.0.0/16<br><span class="hljs-comment"># kubeadm init --pod-network-cidr=10.244.0.0/16 --config kubeadm-config.yaml</span><br><span class="hljs-comment">#参考：如果要指定Kubernetes的版本,可以用一下命令</span><br><span class="hljs-comment">#kubeadm init --kubernetes-version=v1.15.1 --pod-network-cidr=10.244.0.0/16</span><br><br><span class="hljs-comment"># 如果初始化失败，记得执行清空</span><br><span class="hljs-comment"># kubeadm reset</span><br><br><span class="hljs-comment"># 卸载管理组件</span><br><span class="hljs-comment"># yum erase -y kubelet kubectl kubeadm kubernetes-cni</span><br><br><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h4 id="Install-network-plugin-and-weave-tool-on-Master-server-1"><a href="#Install-network-plugin-and-weave-tool-on-Master-server-1" class="headerlink" title="Install network plugin and weave tool on Master server"></a>Install network plugin and weave tool on Master server</h4><p>Network_plugin.sh</p><blockquote><p><strong>Note:</strong> Without network plugin installed, master node and kubelet status will not be ready</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://docs.projectcalico.org/manifests/calico.yaml -O<br><span class="hljs-comment"># 把calico.yaml里pod所在网段改成kubeadm init时选项--pod-network-cidr所指定的网段</span><br>sed -i <span class="hljs-string">&#x27;s/192.168.0.0/10.244.0.0/g&#x27;</span> calico.yaml<br>kubectl apply -f calico.yaml<br></code></pre></td></tr></table></figure><p><img src="https://felixyanghui.synology.me:8441/images/2023/01/01/image-20230101211754084.png" alt="image-20230101211754084"></p><p><img src="https://felixyanghui.synology.me:8441/images/2023/01/01/image-20230101211819945.png" alt="image-20230101211819945"></p><h3 id="Post-Installation-1"><a href="#Post-Installation-1" class="headerlink" title="Post-Installation"></a>Post-Installation</h3><h4 id="Join-node-server-to-master-1"><a href="#Join-node-server-to-master-1" class="headerlink" title="Join node server to master"></a>Join node server to master</h4><p>Node_join.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># avoid error: [ERROR FileContent–proc-sys-net-ipv4-ip_forward]: /proc/sys/net/ipv4/ip_forward contents are not set to 1</span><br><span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward<br><br><span class="hljs-comment"># Below command is copied from the output of the &quot;kubeadm init&quot;</span><br>kubeadm <span class="hljs-built_in">join</span> 192.168.22.81:6443 --token d0cbz5.9nugb974yhl54ss6 \<br>--discovery-token-ca-cert-hash sha256:bc7099ce8ff86c2cc7d8d51b0f30c4d57cbd3fbe967e81f8f05c2decf9599b07 <br><br><span class="hljs-comment"># Check K8S cluster nodes and pods status</span><br>kubectl get nodes<br>kubectl get pods --all-namespaces -o wide<br></code></pre></td></tr></table></figure><h4 id="Install-helm3-on-K8SMaster-1"><a href="#Install-helm3-on-K8SMaster-1" class="headerlink" title="Install helm3 on K8SMaster"></a>Install helm3 on K8SMaster</h4><p>Helm3_install.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -e <span class="hljs-string">&quot;https_proxy=10.64.1.81:8080&quot;</span>  https://get.helm.sh/helm-v3.1.2-linux-amd64.tar.gz<br>tar -zxvf helm-v3.1.2-linux-amd64.tar.gz<br><span class="hljs-built_in">cd</span> linux-amd64/<br><span class="hljs-built_in">mv</span> helm /usr/bin/<br>helm version<br><br><br><span class="hljs-comment"># helm init is not used any more since helm3</span><br><span class="hljs-comment"># $ kubectl create serviceaccount --namespace kube-system tiller</span><br><span class="hljs-comment"># $ kubectl create clusterrolebinding tiller-cluster-role --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br><span class="hljs-comment"># $ helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.15.1 --service-account=tiller --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts![title](/api/file/getImage?fileId=620bb3b4935fe2000e000015)</span><br><span class="hljs-comment"># add helm repo</span><br>helm repo add  aliyuncs https://apphub.aliyuncs.com<br>helm repo list<br>helm search repo aliyuncs | <span class="hljs-built_in">head</span> -5<br></code></pre></td></tr></table></figure><h4 id="something-more-about-helm-1"><a href="#something-more-about-helm-1" class="headerlink" title="something more about helm"></a>something more about helm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># add helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="hljs-string">&quot;stable&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="hljs-string">&quot;aliyun&quot;</span> has been added to your repositories<br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo add jetstack https://charts.jetstack.io</span><br><span class="hljs-string">&quot;jetstack&quot;</span> has been added to your repositories<br><br><span class="hljs-comment"># update helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo update</span><br>Hang tight <span class="hljs-keyword">while</span> we grab the latest from your chart repositories...<br>...Successfully got an update from the <span class="hljs-string">&quot;jetstack&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;aliyun&quot;</span> chart repository<br>...Successfully got an update from the <span class="hljs-string">&quot;stable&quot;</span> chart repository<br>Update Complete. ⎈ Happy Helming!⎈ <br><br><span class="hljs-comment"># list helm repo</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm repo list</span><br>NAME    URL                                                   <br>stable  http://mirror.azure.cn/kubernetes/charts              <br>aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br>jetstackhttps://charts.jetstack.io                            <br><br><span class="hljs-comment"># search chart</span><br>[root@CentOS001 ~]<span class="hljs-comment"># helm search repo nginx</span><br>NAME                       CHART VERSIONAPP VERSIONDESCRIPTION                                       <br>aliyun/nginx-ingress       0.9.5        0.10.2     An nginx Ingress controller that uses ConfigMap...<br>aliyun/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>stable/nginx-ingress       1.41.3       v0.34.1    DEPRECATED! An nginx Ingress controller that us...<br>stable/nginx-ldapauth-proxy0.1.6        1.13.5     DEPRECATED - nginx proxy with ldapauth            <br>stable/nginx-lego          0.3.1                   Chart <span class="hljs-keyword">for</span> nginx-ingress-controller and kube-lego  <br>aliyun/gcloud-endpoints    0.1.0                   Develop, deploy, protect and monitor your APIs ...<br>stable/gcloud-endpoints    0.1.2        1          DEPRECATED Develop, deploy, protect and monitor..<br></code></pre></td></tr></table></figure><h3 id="Common-Troubleshooting-Tips-1"><a href="#Common-Troubleshooting-Tips-1" class="headerlink" title="Common Troubleshooting Tips"></a>Common Troubleshooting Tips</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get nodes<br>kubectl get ds -n kube-system<br>kubectl get pod<br>kubectl get pods -n kube-system<br>kubectl get pods -n kube-system -o wide<br>kubectl logs weave-net-ldsgl  -n kube-system weave-npc<br>kubectl describe pod auth-54d7667c5d-sgrt8<br>systemctl status kubelet<br>journalctl -f -u kubelet<br><span class="hljs-comment"># If the init container failed, subsequent container initilization just pending there, no logs from below commands</span><br>kubectl logs auth-54d7667c5d-dnslv<br>kubectl logs scan-687c4bfddd-w5fbk  --previous<br><span class="hljs-comment"># check why init container failed, lead to subsequent container can not be initialized</span><br>kubectl logs scan-687c4bfddd-w5fbk  -c db-init <br><br>crictl --runtime-endpoint /run/containerd/containerd.sock ps<br><br></code></pre></td></tr></table></figure><h4 id="Check-Cgroup-drivers-for-kubelet-containerd"><a href="#Check-Cgroup-drivers-for-kubelet-containerd" class="headerlink" title="Check Cgroup drivers for kubelet, containerd"></a>Check Cgroup drivers for kubelet, containerd</h4><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fortran">systemctl <span class="hljs-keyword">status</span> containerd.service<br>systemctl <span class="hljs-keyword">status</span> kubelet<br></code></pre></td></tr></table></figure><h3 id="cgroup-setting-highlights"><a href="#cgroup-setting-highlights" class="headerlink" title="cgroup setting highlights"></a>cgroup setting highlights</h3><p><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers">https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers</a></p><blockquote><h3 id="cgroupfs-driver"><a href="#cgroupfs-driver" class="headerlink" title="cgroupfs driver"></a>cgroupfs driver</h3><p>The <code>cgroupfs</code> driver is the default cgroup driver in the kubelet. When the <code>cgroupfs</code> driver is used, the kubelet and the container runtime directly interface with the cgroup filesystem to configure cgroups.</p><p>The <code>cgroupfs</code> driver is <strong>not</strong> recommended when <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> is the init system because systemd expects a single cgroup manager on the system. Additionally, if you use <a href="https://kubernetes.io/docs/concepts/architecture/cgroups">cgroup v2</a> , use the <code>systemd</code> cgroup driver instead of <code>cgroupfs</code>.</p><h3 id="systemd-cgroup-driver"><a href="#systemd-cgroup-driver" class="headerlink" title="systemd cgroup driver"></a>systemd cgroup driver</h3><p>When <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> is chosen as the init system for a Linux distribution, the init process generates and consumes a root control group (<code>cgroup</code>) and acts as a cgroup manager.</p><p>systemd has a tight integration with cgroups and allocates a cgroup per systemd unit. As a result, if you use <code>systemd</code> as the init system with the <code>cgroupfs</code> driver, the system gets two different cgroup managers.</p><p>Two cgroup managers result in two views of the available and in-use resources in the system. In some cases, nodes that are configured to use <code>cgroupfs</code> for the kubelet and container runtime, but use <code>systemd</code> for the rest of the processes become unstable under resource pressure.</p><p>The approach to mitigate this instability is to use <code>systemd</code> as the cgroup driver for the kubelet and the container runtime when systemd is the selected init system.</p><p>To set <code>systemd</code> as the cgroup driver, edit the <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/"><code>KubeletConfiguration</code></a> option of <code>cgroupDriver</code> and set it to <code>systemd</code>. For example:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubelet.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeletConfiguration</span><br><span class="hljs-string">...</span><br><span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">systemd</span><br></code></pre></td></tr></table></figure><p>If you configure <code>systemd</code> as the cgroup driver for the kubelet, you must also configure <code>systemd</code> as the cgroup driver for the container runtime. Refer to the documentation for your container runtime for instructions. For example:</p><ul><li><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd">containerd</a></li></ul><h4 id="Configuring-the-systemd-cgroup-driver"><a href="#Configuring-the-systemd-cgroup-driver" class="headerlink" title="Configuring the systemd cgroup driver"></a>Configuring the <code>systemd</code> cgroup driver</h4><p>To use the <code>systemd</code> cgroup driver in <code>/etc/containerd/config.toml</code> with <code>runc</code>, set</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[plugins.<span class="hljs-string">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="hljs-string">.containerd.runtimes.runc</span>]<br>  <span class="hljs-string">...</span><br>  [plugins.<span class="hljs-string">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="hljs-string">.containerd.runtimes.runc.options</span>]<br>    SystemdCgroup = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>The <code>systemd</code> cgroup driver is recommended if you use <a href="https://kubernetes.io/docs/concepts/architecture/cgroups">cgroup v2</a>.</p><p><strong>Note:</strong></p><p>If you installed containerd from a package (for example, RPM or <code>.deb</code>), you may find that the CRI integration plugin is disabled by default.</p><p>You need CRI support enabled to use containerd with Kubernetes. Make sure that <code>cri</code> is not included in the<code>disabled_plugins</code> list within <code>/etc/containerd/config.toml</code>; if you made changes to that file, also restart <code>containerd</code>.</p><p>If you experience container crash loops after the initial cluster installation or after installing a CNI, the containerd configuration provided with the package might contain incompatible configuration parameters. Consider resetting the containerd configuration with <code>containerd config default &gt; /etc/containerd/config.toml</code> as specified in <a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md#advanced-topics">getting-started.md</a> and then set the configuration parameters specified above accordingly.</p></blockquote><h3 id="Accessing-Cluster-via-kubeconfig"><a href="#Accessing-Cluster-via-kubeconfig" class="headerlink" title="Accessing Cluster via kubeconfig"></a>Accessing Cluster via kubeconfig</h3><p><a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/</a></p><p><a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/</a></p><h2 id="01-2-Setup-Rancher"><a href="#01-2-Setup-Rancher" class="headerlink" title="01.2. Setup Rancher"></a>01.2. Setup Rancher</h2><h3 id="prerequisites"><a href="#prerequisites" class="headerlink" title="prerequisites"></a>prerequisites</h3><p>refer to <a href="https://www.suse.com/assets/v2.5.16-Support-Matrix.pdf">rancher support matrix</a></p><table><thead><tr><th>Rancher Server</th><th>OS</th><th>Docker</th><th>K8S</th></tr></thead><tbody><tr><td>v2.4.9</td><td>CentOS8.2</td><td>20.10.18</td><td>v1.18.20</td></tr></tbody></table><h3 id="Install-rancher-on-docker"><a href="#Install-rancher-on-docker" class="headerlink" title="Install rancher on docker"></a>Install rancher on docker</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> docker run -d --restart=unless-stopped --privileged  -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -p <span class="hljs-number">443</span>:<span class="hljs-number">443</span> rancher/rancher:v2.<span class="hljs-number">4</span>.<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><h3 id="Import-existing-K8S-cluster-on-rancher-console"><a href="#Import-existing-K8S-cluster-on-rancher-console" class="headerlink" title="Import existing K8S cluster on rancher console"></a>Import existing K8S cluster on rancher console</h3><p><img src="https://felixyanghui.synology.me:8441/images/2023/12/11/image-20231211172023355.png" alt="image-20231211172023355"></p><p><img src="https://felixyanghui.synology.me:8441/images/2023/12/11/image-20231211172110563.png" alt="image-20231211172110563"></p><p><img src="https://felixyanghui.synology.me:8441/images/2023/12/11/image-20231211172128804.png" alt="image-20231211172128804"></p><h4 id="Run-commands-on-K8S-master"><a href="#Run-commands-on-K8S-master" class="headerlink" title="Run commands on K8S master"></a>Run commands on K8S master</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl create serviceaccount felix<br>kubectl create clusterrolebinding cluster-admin-binding --clusterrole cluster-admin --user=felix<br><br>curl --insecure -sfL https://192.168.22.84/v3/import/5glwxx7gnhkc4zldnb8ts5xnrxv244cwmz5qrgw4k6jfkvf577t7b9.yaml | kubectl apply -f -<br>kubectl get pods --all-namespaces -o wide<br></code></pre></td></tr></table></figure><h2 id="01-3-Setup-Gitlab"><a href="#01-3-Setup-Gitlab" class="headerlink" title="01.3. Setup Gitlab"></a>01.3. Setup Gitlab</h2><h3 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p><a href="https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/8/gitlab-ce-14.2.3-ce.0.el8.x86_64.rpm">https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/8/gitlab-ce-14.2.3-ce.0.el8.x86_64.rpm</a></p><h3 id="Install-gitlab"><a href="#Install-gitlab" class="headerlink" title="Install gitlab"></a>Install gitlab</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bath">sudo yum install -y curl policycoreutils-python policycoreutils-python-utils policycoreutils openssh-server openssh-clients perl<br>sudo systemctl enable sshd<br>sudo systemctl start sshd<br><br>dnf install postfix<br>systemctl enable postfix<br>systemctl start postfix<br><br>curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash<br>sudo EXTERNAL_URL=&quot;http://192.168.22.85&quot;  yum install gitlab-ce-14.2.3-ce.0.el8.x86_64<br></code></pre></td></tr></table></figure><p><em><strong>Output:</strong></em> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">Default admin account has been configured with following details:<br>Username: root<br>Password: You didn<span class="hljs-string">&#x27;t opt-in to print initial root password to STDOUT.</span><br><span class="hljs-string">Password stored to /etc/gitlab/initial_root_password. This file will be cleaned up in first reconfigure run after 24 hours.</span><br><span class="hljs-string"></span><br><span class="hljs-string">NOTE: Because these credentials might be present in your log files in plain text, it is highly recommended to reset the password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.</span><br><span class="hljs-string"></span><br><span class="hljs-string">gitlab Reconfigured!</span><br><span class="hljs-string"></span><br><span class="hljs-string">       *.                  *.</span><br><span class="hljs-string">      ***                 ***</span><br><span class="hljs-string">     *****               *****</span><br><span class="hljs-string">    .******             *******</span><br><span class="hljs-string">    ********            ********</span><br><span class="hljs-string">   ,,,,,,,,,***********,,,,,,,,,</span><br><span class="hljs-string">  ,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="hljs-string">  .,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="hljs-string">      ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="hljs-string">         ,,,,,,,****,,,,,,</span><br><span class="hljs-string">            .,,,***,,,,</span><br><span class="hljs-string">                ,*,.</span><br><span class="hljs-string">  </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">     _______ __  __          __</span><br><span class="hljs-string">    / ____(_) /_/ /   ____ _/ /_</span><br><span class="hljs-string">   / / __/ / __/ /   / __ `/ __ \</span><br><span class="hljs-string">  / /_/ / / /_/ /___/ /_/ / /_/ /</span><br><span class="hljs-string">  \____/_/\__/_____/\__,_/_.___/</span><br><span class="hljs-string">  </span><br><span class="hljs-string"></span><br><span class="hljs-string">Thank you for installing GitLab!</span><br><span class="hljs-string">GitLab should be available at http://192.168.22.85</span><br><span class="hljs-string"></span><br><span class="hljs-string">For a comprehensive list of configuration options please see the Omnibus GitLab readme</span><br><span class="hljs-string">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md</span><br><span class="hljs-string"></span><br><span class="hljs-string">Help us improve the installation experience, let us know how we did with a 1 minute survey:</span><br><span class="hljs-string">https://gitlab.fra1.qualtrics.com/jfe/form/SV_6kVqZANThUQ1bZb?installation=omnibus&amp;release=14-2</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">  Verifying        : gitlab-ce-14.2.3-ce.0.el8.x86_64                                                                                                                                                           1/1 </span><br><span class="hljs-string"></span><br><span class="hljs-string">Installed:</span><br><span class="hljs-string">  gitlab-ce-14.2.3-ce.0.el8.x86_64                                                                                                                                                                                  </span><br><span class="hljs-string"></span><br><span class="hljs-string">Complete!</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span><br><span class="hljs-attribute">Password</span>: x35fWPKFju3JP7QLQ+VXgFYwKvQtwh77sCl8Jjw+<span class="hljs-number">8</span>xQ=<br></code></pre></td></tr></table></figure><h3 id="Useful-commands"><a href="#Useful-commands" class="headerlink" title="Useful commands"></a>Useful commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim  /etc/gitlab/gitlab.rb<br>external_url <span class="hljs-string">&#x27;http://192.168.22.85&#x27;</span><br><br>重置并启动GitLab:<br>gitlab-ctl reconfigure<br>gitlab-ctl restart  <br><br>查看服务状态：<br>gitlab-ctl status<br><br>开启服务： <br>gitlab-ctl start<br><br>关闭服务：<br>gitlab-ctl stop <br><br>关闭gitlab的自动启动<br>systemctl <span class="hljs-built_in">disable</span> gitlab-runsvdir.service<br><br>开启gitlab的自动启动：<br>systemctl <span class="hljs-built_in">enable</span> gitlab-runsvdir.service<br>systemctl start gitlab-runsvdir.service<br>gitlab-cmd start<br><br></code></pre></td></tr></table></figure><h2 id="01-4-Setup-Jenkins"><a href="#01-4-Setup-Jenkins" class="headerlink" title="01.4. Setup Jenkins"></a>01.4. Setup Jenkins</h2><h3 id="Option-1-Set-up-a-Jenkins-server-on-Kubernetes"><a href="#Option-1-Set-up-a-Jenkins-server-on-Kubernetes" class="headerlink" title="Option-1: Set up a Jenkins server on Kubernetes"></a>Option-1: Set up a Jenkins server on Kubernetes</h3><p><a href="https://devopscube.com/setup-jenkins-on-kubernetes-cluster/">How To Setup Jenkins On Kubernetes Cluster – Beginners Guide</a></p><p>Access Jenkins:</p><p><a href="http://192.168.22.61:32001/login?from=/">http://192.168.22.61:32001/login?from=%2F</a></p><p>Get the initial password of Jenkins</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@k8smaster ~]<span class="hljs-comment"># kubectl get pods -n devops-tools</span><br>NAME                      READY   STATUS    RESTARTS   AGE<br>jenkins-b96f7764f-g5fhh   1/1     Running   0          11m<br><br>[root@k8smaster ~]<span class="hljs-comment"># kubectl exec jenkins-b96f7764f-g5fhh -n devops-tools -it bash</span><br>kubectl <span class="hljs-built_in">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class="hljs-keyword">in</span> a future version. Use kubectl <span class="hljs-built_in">exec</span> [POD] -- [COMMAND] instead.<br><br>jenkins@jenkins-b96f7764f-g5fhh:/$ <span class="hljs-built_in">cat</span> /var/jenkins_home/secrets/initialAdminPassword<br>04a4a6c9e79c4428930a92f433427dce<br></code></pre></td></tr></table></figure><h4 id="Errors-and-resolution"><a href="#Errors-and-resolution" class="headerlink" title="Errors and resolution"></a>Errors and resolution</h4><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk"><span class="hljs-comment">&quot;An error occurred during installation: No such plugin: cloudbees-folder&quot;</span><br></code></pre></td></tr></table></figure><p>Resolution is to restart Jenkins: <a href="http://localhost:8080/restart">http://localhost:8080/restart</a></p><h3 id="Option-2-Set-up-a-Jenkins-server-on-CentOS8"><a href="#Option-2-Set-up-a-Jenkins-server-on-CentOS8" class="headerlink" title="Option-2: Set up a Jenkins server on CentOS8"></a>Option-2: Set up a Jenkins server on CentOS8</h3><p>Reference:</p><p><a href="https://sysadminxpert.com/install-openjdk-11-on-centos-7/">https://sysadminxpert.com/install-openjdk-11-on-centos-7/</a></p><p><a href="https://www.jianshu.com/p/85ab4db26857">https://www.jianshu.com/p/85ab4db26857</a></p><!--Need to install Java 11--><ul><li><p>Install OpenJDK 11</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"> yum -y install java-11-openjdk java-11-openjdk-devel<br> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export JAVA_HOME=<span class="hljs-subst">$(dirname $(dirname $(readlink $(readlink $(which javac)</span>))))&quot;</span> &gt;&gt; ~/.bash_profile<br> <span class="hljs-built_in">cat</span> ~/.bash_profile<br><br>java –version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span><br></code></pre></td></tr></table></figure></li><li><p>Set or configure default Java version if there’s another&#x2F;old version already installed</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">alternatives --config javac<br><br><span class="hljs-comment"># Set JAVA_HOME Environment Variable</span><br>vim ~/.bash_profile<br><br>JAVA_HOME=<span class="hljs-string">&quot;/usr/lib/jvm/java-11-openjdk-11.0.7.10-4.el7_8.x86_64/bin/java&quot;</span><br><br><span class="hljs-built_in">source</span> ~/.bash_profile<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span><br></code></pre></td></tr></table></figure></li><li><p>Test Java installation</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; hello_world.java &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">public class helloworld &#123;</span><br><span class="hljs-string">  public static void main(String[] args) &#123;</span><br><span class="hljs-string">    System.out.println(&quot;Hello Java World!&quot;);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br>java hello_world.java<br></code></pre></td></tr></table></figure></li><li><p>Add the Jenkins Repository and Verify security key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo<br>sudo rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key<br><br></code></pre></td></tr></table></figure></li><li><p>Update packages</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum update<br></code></pre></td></tr></table></figure></li><li><p>Install Jenkins</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install jenkins -y<br></code></pre></td></tr></table></figure></li><li><p>Configure and start Jenkins service </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl start jenkins<br></code></pre></td></tr></table></figure></li><li><p>Get initial password</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /var/lib/jenkins/secrets/initialAdminPassword<br></code></pre></td></tr></table></figure></li></ul><h2 id="01-5-Setup-Harbor"><a href="#01-5-Setup-Harbor" class="headerlink" title="01.5. Setup Harbor"></a>01.5. Setup Harbor</h2><h3 id="Prerequisites-1"><a href="#Prerequisites-1" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><h4 id="Install-docker"><a href="#Install-docker" class="headerlink" title="Install docker"></a>Install docker</h4><h4 id="Install-docker-compose"><a href="#Install-docker-compose" class="headerlink" title="Install docker compose"></a>Install docker compose</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install docker-compose-plugin<br>sudo <span class="hljs-built_in">chmod</span> +x /usr/libexec/docker/cli-plugins/docker-compose<br><span class="hljs-built_in">ln</span> -s /usr/libexec/docker/cli-plugins/docker-compose /usr/sbin/docker-compose<br>docker-compose version<br></code></pre></td></tr></table></figure><h4 id="Download-harbor-offline-package"><a href="#Download-harbor-offline-package" class="headerlink" title="Download harbor offline package:"></a>Download harbor offline package:</h4><p><a href="https://github.com/goharbor/harbor/releases/tag/v2.6.0">https://github.com/goharbor/harbor/releases/tag/v2.6.0</a></p><h4 id="Install-harbor"><a href="#Install-harbor" class="headerlink" title="Install harbor"></a>Install harbor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -zxvf harbor-online-installer-v2.6.0.tgz -C /usr/local/<br><span class="hljs-built_in">cd</span> /usr/local/harbor/<br><span class="hljs-built_in">cp</span> harbor.yml.tmpl harbor.yml<br></code></pre></td></tr></table></figure><p>Modify harbor.yml to disable https and add IP address in hostname</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>++++++++++++++<br>hostname: 192.168.22.86<br><br><span class="hljs-comment"># http related config</span><br>http:<br>  <span class="hljs-comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span><br>  port: 80<br><br><span class="hljs-comment"># https related config</span><br><span class="hljs-comment">#https:</span><br>  <span class="hljs-comment"># https port for harbor, default is 443</span><br>  <span class="hljs-comment">#port: 443</span><br>  <span class="hljs-comment"># The path of cert and key files for nginx</span><br>  <span class="hljs-comment">#certificate: /your/certificate/path</span><br>  <span class="hljs-comment">#private_key: /your/private/key/path</span><br>+++++++++++++++<br></code></pre></td></tr></table></figure><p>Install harbor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./prepare<br>./install.sh <br></code></pre></td></tr></table></figure><h3 id="Optional-HTTPS-access-enablement"><a href="#Optional-HTTPS-access-enablement" class="headerlink" title="Optional - HTTPS access enablement"></a>Optional - HTTPS access enablement</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl genrsa -out root.pem 2048<br>openssl req -new -sha256 -out root.csr -key root.pem \<br>-subj <span class="hljs-string">&quot;/C=CN/ST=jiangsu/L=nj/O=test/OU=Personal/CN=192.168.22.86&quot;</span> <br>openssl req -x509 -new -nodes -sha256 -days 365 \<br> -subj <span class="hljs-string">&quot;/C=CN/ST=jiangsu/L=nj/O=test/OU=Personal/CN=192.168.22.86&quot;</span> \<br> -key root.pem \<br> -out root.crt<br> <br> <br><span class="hljs-built_in">cat</span> &gt; v3.ext &lt;&lt;-<span class="hljs-string">EOF</span><br><span class="hljs-string">authorityKeyIdentifier=keyid,issuer</span><br><span class="hljs-string">basicConstraints=CA:FALSE</span><br><span class="hljs-string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="hljs-string">extendedKeyUsage = serverAuth</span><br><span class="hljs-string">subjectAltName = IP:192.168.56.108</span><br><span class="hljs-string">EOF</span><br><br><br><br>openssl genrsa -out ca_harbor.pem 2048<br>openssl req -new -sha256 -out ca_harbor.csr -key ca_harbor.pem<br>openssl x509 -req -sha512 -days 365 \<br>    -extfile v3.ext \<br>    -CA root.crt -CAkey root.pem -CAcreateserial \<br>    -<span class="hljs-keyword">in</span> ca_harbor.csr \<br>    -out ca_harbor.crt<br><br><br>openssl x509 -inform PEM -<span class="hljs-keyword">in</span> ca_harbor.crt -out ca_harbor.cert<br><br><span class="hljs-built_in">mkdir</span> -p /etc/docker/certs.d/192.168.22.86/<br><span class="hljs-built_in">cp</span> ca_harbor.cert /data/cert/ca_harbor.cert<br><span class="hljs-built_in">cp</span> ca_harbor.pem /data/cert/ca_harbor.pem<br><span class="hljs-built_in">cp</span> ca_harbor.crt /data/cert/ca_harbor.crt<br><span class="hljs-built_in">cp</span> /data/cert/ca_harbor.cert /etc/docker/certs.d/192.168.22.86/<br><span class="hljs-built_in">cp</span> /data/cert/ca_harbor.pem /etc/docker/certs.d/192.168.22.86/<br><span class="hljs-built_in">cp</span> /data/cert/ca_harbor.crt /etc/docker/certs.d/192.168.22.86/<br><br><br>/usr/local/harbor/<br>vi harbor.yml<br>++++++++++++++<br>hostname: 192.168.22.86<br><br><span class="hljs-comment"># http related config</span><br>http:<br>  <span class="hljs-comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span><br>  port: 80<br><br><span class="hljs-comment"># https related config</span><br>https:<br>  <span class="hljs-comment"># https port for harbor, default is 443</span><br>  port: 443<br>  <span class="hljs-comment"># The path of cert and key files for nginx</span><br>  certificate: /data/cert/ca_harbor.cert<br>  private_key: /data/cert/ca_harbor.pem<br>+++++++++++++++<br><br>docker-compose down -v<br>systemctl restart docker<br><br>./install.sh<br><br>netstat -nplt<br></code></pre></td></tr></table></figure><h3 id="Access-the-harbor-console"><a href="#Access-the-harbor-console" class="headerlink" title="Access the harbor console"></a>Access the harbor console</h3><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002100923461.png" alt="image-20221002100923461"></p><h2 id="01-6-Setup-InfluxDB-on-Kubernetes"><a href="#01-6-Setup-InfluxDB-on-Kubernetes" class="headerlink" title="01.6. Setup InfluxDB on Kubernetes"></a>01.6. Setup InfluxDB on Kubernetes</h2><h3 id="Step-by-step"><a href="#Step-by-step" class="headerlink" title="Step by step"></a>Step by step</h3><p>Reference articles:</p><p><a href="https://www.cnblogs.com/zhangsi-lzq/p/14457707.html">https://www.cnblogs.com/zhangsi-lzq/p/14457707.html</a></p><p><a href="https://opensource.com/article/19/2/deploy-influxdb-grafana-kubernetes">https://opensource.com/article/19/2/deploy-influxdb-grafana-kubernetes</a></p><ul><li><p>Create namespace: influxdb</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">kubectl create <span class="hljs-keyword">namespace</span> <span class="hljs-symbol">influxdb</span><br></code></pre></td></tr></table></figure></li><li><p>create a secret using the <strong>kubectl create secret</strong> command and some basic credentials</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl create<span class="hljs-built_in"> secret </span>generic influxdb-creds -n influxdb \<br>  <span class="hljs-attribute">--from-literal</span>=INFLUXDB_DATABASE=twittergraph \<br>  <span class="hljs-attribute">--from-literal</span>=INFLUXDB_USERNAME=root \<br>  <span class="hljs-attribute">--from-literal</span>=INFLUXDB_PASSWORD=root \<br>  <span class="hljs-attribute">--from-literal</span>=INFLUXDB_HOST=influxdb<br>  <br>kubectl <span class="hljs-built_in">get</span><span class="hljs-built_in"> secret </span>influxdb-creds -n influxdb<br>kubectl describe<span class="hljs-built_in"> secret </span>influxdb-creds -n influxdb<br></code></pre></td></tr></table></figure></li><li><p>create and configure persistent storage for InfluxDB</p><ul><li><p>Setup the nfs server: 192.168.22.60</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-comment"># 在nfs上安装nfs服务</span><br>[root<span class="hljs-variable">@nfs</span> ~]<span class="hljs-comment"># yum install nfs-utils -y</span><br><br><span class="hljs-comment"># 准备一个共享目录</span><br>[root<span class="hljs-variable">@nfs</span> ~]<span class="hljs-comment"># mkdir /root/data/influxdbpv -pv</span><br><br><span class="hljs-comment"># 将共享目录以读写权限暴露给192.168.5.0/24网段中的所有主机</span><br>[root<span class="hljs-variable">@nfs</span> ~]<span class="hljs-comment"># vim /etc/exports</span><br>[root<span class="hljs-variable">@nfs</span> ~]<span class="hljs-comment"># more /etc/exports</span><br><span class="hljs-regexp">/root/data</span><span class="hljs-regexp">/influxdbpv     192.168.22.0/</span><span class="hljs-number">24</span>(rw,no_root_squash)<br><br><span class="hljs-comment"># 启动nfs服务</span><br>[root<span class="hljs-variable">@nfs</span> ~]<span class="hljs-comment"># systemctl restart nfs-server</span><br><br><span class="hljs-comment"># 在每个node上安装nfs服务，注意不需要启动</span><br>[~]<span class="hljs-comment"># yum install nfs-utils -y</span><br></code></pre></td></tr></table></figure></li><li><p>create pv and pvc</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolume</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span>  <span class="hljs-string">influxdbpv</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">capacity:</span> <br>    <span class="hljs-attr">storage:</span> <span class="hljs-string">10Gi</span><br>  <span class="hljs-attr">accessModes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteMany</span><br>  <span class="hljs-attr">persistentVolumeReclaimPolicy:</span> <span class="hljs-string">Retain</span><br>  <span class="hljs-attr">nfs:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/root/data/influxdbpv</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.60</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolumeClaim</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">accessModes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteMany</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">requests:</span><br>      <span class="hljs-attr">storage:</span> <span class="hljs-string">8Gi</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>create configmap from default conf file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull influxdb:1.6.4<br><br><span class="hljs-comment"># --rm means to remove the container after the command run</span><br>docker run --<span class="hljs-built_in">rm</span> influxdb:1.6.4 influxd config &gt; influxdb.conf<br><br><br>kubectl create configmap influxdb-config --from-file influxdb.conf -n influxdb<br>kubectl get cm influxdb-config -n influxdb<br></code></pre></td></tr></table></figure></li><li><p>create deployment yaml</p><p><code>kubectl get deploy influxdb -n influxdb -o yaml &gt; influxdb_deploy.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-attr">deployment.kubernetes.io/revision:</span> <span class="hljs-string">&quot;4&quot;</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">envFrom:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">secretRef:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-creds</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/influxdb:1.6.4</span><br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><br>        <span class="hljs-attr">terminationMessagePath:</span> <span class="hljs-string">/dev/termination-log</span><br>        <span class="hljs-attr">terminationMessagePolicy:</span> <span class="hljs-string">File</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/influxdb</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">var-lib-influxdb</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/influxdb</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span><br>      <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span><br>      <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">default-scheduler</span><br>      <span class="hljs-attr">securityContext:</span> &#123;&#125;<br>      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">var-lib-influxdb</span><br>        <span class="hljs-attr">persistentVolumeClaim:</span><br>          <span class="hljs-attr">claimName:</span> <span class="hljs-string">influxdb</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">420</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span><br></code></pre></td></tr></table></figure></li><li><p>expose service for external access</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-svc</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8086</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8086</span><br>      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">32002</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span><br></code></pre></td></tr></table></figure></li><li><p>check status</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@k8smaster influxdb]# kubectl <span class="hljs-keyword">get</span> pods,deployment,rs,svc,ep -n influxdb -o wide<br><span class="hljs-type">NAME</span>                            READY   STATUS    RESTARTS   AGE     IP          NODE       NOMINATED NODE   READINESS GATES<br>pod/influxdb<span class="hljs-number">-5</span>c576d94b4-r8ln8   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>h26m   <span class="hljs-number">10.42</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>   k8s-n301   &lt;<span class="hljs-keyword">none</span>&gt;           &lt;<span class="hljs-keyword">none</span>&gt;<br><br><span class="hljs-type">NAME</span>                       READY   UP-<span class="hljs-keyword">TO</span>-<span class="hljs-type">DATE</span>   AVAILABLE   AGE     CONTAINERS   IMAGES                     SELECTOR<br>deployment.apps/influxdb   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">5</span>h55m   influxdb     docker.io/influxdb:<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>   app=influxdb<br><br><span class="hljs-type">NAME</span>                                  DESIRED   <span class="hljs-keyword">CURRENT</span>   READY   AGE     CONTAINERS   IMAGES                     SELECTOR<br>replicaset.apps/influxdb<span class="hljs-number">-5</span>c576d94b4   <span class="hljs-number">1</span>         <span class="hljs-number">1</span>         <span class="hljs-number">1</span>       <span class="hljs-number">4</span>h2m    influxdb     docker.io/influxdb:<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>   app=influxdb,pod-<span class="hljs-keyword">template</span>-hash=<span class="hljs-number">5</span>c576d94b4<br>replicaset.apps/influxdb<span class="hljs-number">-6564</span>f56995   <span class="hljs-number">0</span>         <span class="hljs-number">0</span>         <span class="hljs-number">0</span>       <span class="hljs-number">4</span>h40m   influxdb     docker.io/influxdb:<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>   app=influxdb,pod-<span class="hljs-keyword">template</span>-hash=<span class="hljs-number">6564</span>f56995<br>replicaset.apps/influxdb<span class="hljs-number">-88</span>c898c6f    <span class="hljs-number">0</span>         <span class="hljs-number">0</span>         <span class="hljs-number">0</span>       <span class="hljs-number">4</span>h30m   influxdb     docker.io/influxdb:<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>   app=influxdb,pod-<span class="hljs-keyword">template</span>-hash=<span class="hljs-number">88</span>c898c6f<br>replicaset.apps/influxdb-c4df979df    <span class="hljs-number">0</span>         <span class="hljs-number">0</span>         <span class="hljs-number">0</span>       <span class="hljs-number">4</span>h37m   influxdb     docker.io/influxdb:<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>   app=influxdb,pod-<span class="hljs-keyword">template</span>-hash=c4df979df<br><br><span class="hljs-type">NAME</span>                   <span class="hljs-keyword">TYPE</span>       <span class="hljs-keyword">CLUSTER</span>-IP      <span class="hljs-keyword">EXTERNAL</span>-IP   PORT(S)          AGE     SELECTOR<br>service/influxdb-svc   NodePort   <span class="hljs-number">10.106</span><span class="hljs-number">.242</span><span class="hljs-number">.32</span>   &lt;<span class="hljs-keyword">none</span>&gt;        <span class="hljs-number">8086</span>:<span class="hljs-number">32002</span>/TCP   <span class="hljs-number">3</span>h32m   app=influxdb<br><br><span class="hljs-type">NAME</span>                     ENDPOINTS        AGE<br>endpoints/influxdb-svc   <span class="hljs-number">10.42</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>:<span class="hljs-number">8086</span>   <span class="hljs-number">3</span>h32m<br></code></pre></td></tr></table></figure></li></ul><h3 id="Enable-authentication-for-InfluxDB"><a href="#Enable-authentication-for-InfluxDB" class="headerlink" title="Enable authentication for InfluxDB"></a>Enable authentication for InfluxDB</h3><ul><li><p>Create db user</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">kubectl -n influxdb exec influxdb-dp<span class="hljs-number">-6</span>c8756cfcd-pc8gf -it <span class="hljs-comment">-- /bin/bash</span><br>bash<span class="hljs-number">-5.0</span># influx<br>Connected <span class="hljs-keyword">to</span> http://localhost:<span class="hljs-number">8086</span> <span class="hljs-keyword">version</span> <span class="hljs-number">1.6</span><span class="hljs-number">.4</span><br>InfluxDB shell <span class="hljs-keyword">version</span>: <span class="hljs-number">1.6</span><span class="hljs-number">.4</span><br>&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> root <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">PASSWORD</span> <span class="hljs-string">&#x27;123456&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span><br>&gt; <span class="hljs-keyword">show</span> users<br><span class="hljs-keyword">user</span> <span class="hljs-keyword">admin</span><br><span class="hljs-comment">---- -----</span><br>root <span class="hljs-keyword">true</span><br>&gt; <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure></li><li><p>modify configmap, to enable authentication</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">edit</span> cm influxdb-config  -n influxdb<br><span class="hljs-comment">#....skip....</span><br>    [http]<br>      enabled = <span class="hljs-literal">true</span><br>      bind-address = <span class="hljs-string">&quot;:8086&quot;</span><br>      auth-enabled = <span class="hljs-literal">true</span>        #change <span class="hljs-keyword">from</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">to</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#....skip....</span><br></code></pre></td></tr></table></figure></li><li><p>Restart pod to reload configmap file</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kubectl</span> -n influxdb delete pod influxdb-dp-<span class="hljs-number">6</span>c8756cfcd-pc8gf<br><span class="hljs-attribute">kubectl</span> -n influxdb get pod<br><span class="hljs-attribute">NAME</span>                           READY   STATUS    RESTARTS   AGE<br><span class="hljs-attribute">influxdb</span>-dp-<span class="hljs-number">6</span>c8756cfcd-fhvws   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">30</span>s<br></code></pre></td></tr></table></figure></li><li><p>Test authentication</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk">kubectl -n influxdb exec influxdb-dp-<span class="hljs-number">6</span>c8756cfcd-fhvws -it -- <span class="hljs-regexp">/bin/</span>bash<br>bash-<span class="hljs-number">5.0</span><span class="hljs-comment"># influx</span><br>Connected to http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8086</span> version <span class="hljs-number">1.6</span>.<span class="hljs-number">4</span><br>InfluxDB shell version: <span class="hljs-number">1.6</span>.<span class="hljs-number">4</span><br>&gt; show database;<br>ERR: unable to parse authentication credentials<br>Warning: It is possible this error is due to not setting a database.        <br>Please set a database with the command <span class="hljs-string">&quot;use &lt;database&gt;&quot;</span>.<br>&gt; auth                                                                      <br>username: root<br>password: <br>&gt; show databases                                                            <br>name: databases<br>name<br>----<br>_internal<br>&gt; <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="Useful-commands-1"><a href="#Useful-commands-1" class="headerlink" title="Useful commands"></a>Useful commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Run a influxdb instand directly with deployment</span><br>kubectl create deployment influxdb --image=docker.io/influxdb:1.6.4 -n influxdb<br><br><span class="hljs-comment"># edit the resource on-line</span><br>kubectl edit deployment influxdb -n influxdb<br><br><span class="hljs-comment"># Test influxdb connection, data writing and reading</span><br>----<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span><br><span class="hljs-keyword">do</span><br>processes=$(<span class="hljs-built_in">cat</span> /proc/stat | awk <span class="hljs-string">&#x27;/processes/&#123;print $2&#125;&#x27;</span>)<br>curl -i -XPOST <span class="hljs-string">&#x27;http://192.168.22.61:32002/write?db=test&#x27;</span> --data-binary <span class="hljs-string">&quot;performance,type=processes value=<span class="hljs-variable">$processes</span>&quot;</span><br><span class="hljs-built_in">sleep</span> 60<br><span class="hljs-keyword">done</span><br>----<br><br>[root@nfs ~]<span class="hljs-comment"># ./test.sh </span><br>HTTP/1.1 204 No Content<br>Content-Type: application/json<br>Request-Id: 493a3dd6-3fdd-11ed-8007-000000000000<br>X-Influxdb-Build: OSS<br>X-Influxdb-Version: 1.6.4<br>X-Request-Id: 493a3dd6-3fdd-11ed-8007-000000000000<br>Date: Thu, 29 Sep 2022 09:58:36 GMT<br><br>HTTP/1.1 204 No Content<br>Content-Type: application/json<br>Request-Id: 6d125a7f-3fdd-11ed-8008-000000000000<br>X-Influxdb-Build: OSS<br>X-Influxdb-Version: 1.6.4<br>X-Request-Id: 6d125a7f-3fdd-11ed-8008-000000000000<br>Date: Thu, 29 Sep 2022 09:59:36 GMT<br><br><br>[root@nfs ~]<span class="hljs-comment"># curl -G &#x27;http://192.168.22.61:32002/query?pretty=true&#x27; --data-urlencode &quot;db=test&quot; --data-urlencode &quot;q=select * from performance order by time desc&quot;</span><br>&#123;<br>    <span class="hljs-string">&quot;results&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;statement_id&quot;</span>: 0,<br>            <span class="hljs-string">&quot;series&quot;</span>: [<br>                &#123;<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;performance&quot;</span>,<br>                    <span class="hljs-string">&quot;columns&quot;</span>: [<br>                        <span class="hljs-string">&quot;time&quot;</span>,<br>                        <span class="hljs-string">&quot;type&quot;</span>,<br>                        <span class="hljs-string">&quot;value&quot;</span><br>                    ],<br>                    <span class="hljs-string">&quot;values&quot;</span>: [<br>                        [<br>                            <span class="hljs-string">&quot;2022-09-29T09:59:36.859605683Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            7109601<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-09-29T09:58:36.723087558Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            7109596<br>                        ]<br>                    ]<br>                &#125;<br>            ]<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="02-CICD-configuration"><a href="#02-CICD-configuration" class="headerlink" title="02. CICD configuration"></a>02. CICD configuration</h1><h2 id="02-1-Configure-Gitlab"><a href="#02-1-Configure-Gitlab" class="headerlink" title="02.1. Configure Gitlab"></a>02.1. Configure Gitlab</h2><ul><li><p>Add new group : <em>MyApp</em></p></li><li><p>Add user: <em>felix</em></p></li><li><p>Assign user to the group</p></li><li><p>Add a project : <em>test</em></p></li><li><p>Add ssh key for gitlab connection</p><ul><li><p>At rancher server, create the ssh key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@CentOS004 ~]<span class="hljs-comment"># ssh-keygen -t rsa -b 2048 -C &quot;felix@demo.com&quot;</span><br>Generating public/private rsa key pair.<br>Enter file <span class="hljs-keyword">in</span> <span class="hljs-built_in">which</span> to save the key (/root/.ssh/id_rsa): <br>Created directory <span class="hljs-string">&#x27;/root/.ssh&#x27;</span>.<br>Enter passphrase (empty <span class="hljs-keyword">for</span> no passphrase): <br>Enter same passphrase again: <br>Your identification has been saved <span class="hljs-keyword">in</span> /root/.ssh/id_rsa.<br>Your public key has been saved <span class="hljs-keyword">in</span> /root/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>SHA256:QFuC63n5VJBGTlKbG7oCzjXfnoR+azYAZKi490C918Q felix@demo.com<br>The key<span class="hljs-string">&#x27;s randomart image is:</span><br><span class="hljs-string">+---[RSA 2048]----+</span><br><span class="hljs-string">|   . .+o=.       |</span><br><span class="hljs-string">|  . +. B+o       |</span><br><span class="hljs-string">|.. + .oo=.       |</span><br><span class="hljs-string">|o . +  oEo.      |</span><br><span class="hljs-string">| o..o+.+S.       |</span><br><span class="hljs-string">|.ooo+o=+o        |</span><br><span class="hljs-string">| .oo.o++o        |</span><br><span class="hljs-string">|    .o o*.       |</span><br><span class="hljs-string">|      .++o       |</span><br><span class="hljs-string">+----[SHA256]-----+</span><br><span class="hljs-string">[root@CentOS004 ~]# cd ~/.ssh/</span><br><span class="hljs-string">[root@CentOS004 .ssh]# ll</span><br><span class="hljs-string">total 8</span><br><span class="hljs-string">-rw-------. 1 root root 1823 Sep 29 09:41 id_rsa</span><br><span class="hljs-string">-rw-r--r--. 1 root root  396 Sep 29 09:41 id_rsa.pub</span><br><span class="hljs-string">[root@CentOS004 .ssh]# cat id_rsa.pub </span><br><span class="hljs-string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnB34PpjflNQhmHq3ZxJqRb6veoMRJe49ZQWNEqWFAnndDYlHPUw/q+6z14Ef2YWMLZqvNzLRPCYALTmsJNe05Ln/q/iQ2AM0wDrAUz8FegTPwTrTn9w7L+JezRDQh0Q46tPP8snJdUE+NjEqFNwUT+0ug42+LG9BaLho9HViPBeAQDI2UKNb33lg/y09JxsHqXqqviM+Bjo3G79DsP4p+przNGztReln8+fu6rax3czGfnIs6FvIH6GN8pRny3pVfM89sPxtyF3JqkhJGVgrbwN4v8zRUUI/bXJgKYBWpROt3K2GXf9aY2YSS1xsvvs1rl00xdmYL44YnrAMuv8Xd felix@demo.com</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure></li><li><p>Copy id_rsa.pub text into <strong>public SSH key</strong> field</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002101228652.png" alt="image-20221002101228652"></p></li><li><p>Test connection and git pull from rancher server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@CentOS004 .ssh]<span class="hljs-comment"># ssh -T -p 22 git@192.168.22.85</span><br>The authenticity of host <span class="hljs-string">&#x27;192.168.22.85 (192.168.22.85)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:/QoEvOYhu/IIbXkiLmBAeTtIyEceztIMRGr8//HfcH0.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.22.85<span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">Welcome to GitLab, @root!</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@CentOS004 ~]# git clone http://192.168.22.85/myapp/test.git</span><br><span class="hljs-string">Cloning into &#x27;</span><span class="hljs-built_in">test</span><span class="hljs-string">&#x27;...</span><br><span class="hljs-string">remote: Enumerating objects: 3, done.</span><br><span class="hljs-string">remote: Counting objects: 100% (3/3), done.</span><br><span class="hljs-string">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="hljs-string">Receiving objects: 100% (3/3), done.</span><br><span class="hljs-string">[root@CentOS004 ~]# cd test</span><br><span class="hljs-string">[root@CentOS004 test]# ll</span><br><span class="hljs-string">total 4</span><br><span class="hljs-string">-rw-r--r--. 1 root root 8 Sep 29 09:56 README.md</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="02-2-Configure-Harbor"><a href="#02-2-Configure-Harbor" class="headerlink" title="02.2. Configure Harbor"></a>02.2. Configure Harbor</h2><ul><li>Create project<ul><li>project name: <em>demo</em></li><li>Access level: <em>public</em></li></ul></li><li>Create user<ul><li>Name: <em>felix</em></li></ul></li><li>Assign user into the project<ul><li>Role: <em>project admin</em></li></ul></li></ul><h2 id="02-3-Configure-Jenkins"><a href="#02-3-Configure-Jenkins" class="headerlink" title="02.3. Configure Jenkins"></a>02.3. Configure Jenkins</h2><ul><li><p>Create account</p><ul><li>Name: <em>felix</em></li></ul></li><li><p>Create jenkins credential with kind: <em>SSH Username with private key</em></p><ul><li><p>ID: demo</p></li><li><p>Username: git</p></li><li><p>Private Key:  &lt;pasted from rancher server: ~&#x2F;.ssh&#x2F;id_rsa&gt;</p></li><li><p>Create a new Jenkins task: *myapp *with freestyle project</p><ul><li><p>configure source code management with git</p></li><li><p>Repository URL: ssh:&#x2F;&#x2F;<a href="mailto:&#103;&#x69;&#116;&#64;&#49;&#x39;&#50;&#46;&#x31;&#x36;&#56;&#x2e;&#x32;&#x32;&#46;&#56;&#53;">&#103;&#x69;&#116;&#64;&#49;&#x39;&#50;&#46;&#x31;&#x36;&#56;&#x2e;&#x32;&#x32;&#46;&#56;&#53;</a>&#x2F;myapp&#x2F;test.git</p></li><li><p>If there’s error “<a href="https://stackoverflow.com/questions/15174194/jenkins-host-key-verification-failed">Jenkins Host key verification failed</a>“ , <a href="https://stackoverflow.com/questions/15174194/jenkins-host-key-verification-failed">refer to this solution</a>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo su -s /bin/bash jenkins<br>git ls-remote -h -- ssh://git@192.168.22.85/myapp/test.git HEAD<br><br><span class="hljs-built_in">cat</span> ~/.ssh/known_hosts<br></code></pre></td></tr></table></figure></li></ul></li><li><p>Branches to build:  *&#x2F;main</p></li></ul></li><li><p>Install cloudbase plug-in</p><ul><li><a href="https://plugins.jenkins.io/docker-build-publish">CloudBees Docker Build and Publish pluginVersion1.4.0</a></li></ul></li><li><p>Add user: <em>Jenkins</em> into group: <em>docker</em>, to ensure read priviledge of docker&#x2F;unix socket</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">usermod -a -G docker jenkins<br>systemctl restart jenkins<br>newgrp docker<br></code></pre></td></tr></table></figure></li><li><p>Add docker authentication, ensure jenkins access harbor through http</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/docker/daemon.json<br>&#123;<br>  <span class="hljs-string">&quot;insecure-registries&quot;</span>: [<span class="hljs-string">&quot;http://192.168.22.86&quot;</span>]<br>&#125;<br><br>systemctl daemon-reload &amp;&amp; systemctl restart docker<br></code></pre></td></tr></table></figure><p>on Jenkins console , add a new global credentials (kind: username with password)</p><ul><li>username: felix</li><li>password: <harbor password></li></ul></li><li><p>Update existing Jenkins task: <em>myapp</em>, add “docker build and publish”</p><ul><li><p>Repository Name: &lt;harbor repository: “demo&#x2F;test”&gt;</p></li><li><p>Docker Host URL: unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock</p></li><li><p>Docker registry URL: <a href="http://192.168.22.86/">http://192.168.22.86</a></p></li><li><p>Registry credentials: felix&#x2F;**** <harbor account></p></li></ul></li></ul><h1 id="03-CICD-Testing"><a href="#03-CICD-Testing" class="headerlink" title="03. CICD Testing"></a>03. CICD Testing</h1><h2 id="CI-Testing-with-Jenkins-Gitlab-Harbor"><a href="#CI-Testing-with-Jenkins-Gitlab-Harbor" class="headerlink" title="CI Testing with Jenkins, Gitlab, Harbor"></a>CI Testing with Jenkins, Gitlab, Harbor</h2><ul><li><p>push docker file, source code: start.sh to gitlab</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> http://192.168.22.85/myapp/test.git<br><span class="hljs-built_in">cd</span> <span class="hljs-built_in">test</span>/<br><br><span class="hljs-built_in">chmod</span> +x start.sh<br><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># more Dockerfile </span><br>From centos<br><br>USER root<br>ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>ADD ./ /root/<br>CMD [<span class="hljs-string">&quot;/root/start.sh&quot;</span>]<br><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># more start.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span><br><span class="hljs-keyword">do</span><br>processes=$(<span class="hljs-built_in">cat</span> /proc/stat | awk <span class="hljs-string">&#x27;/processes/&#123;print $2&#125;&#x27;</span>)<br>curl -i -XPOST <span class="hljs-string">&#x27;http://192.168.22.61:32002/write?db=test&#x27;</span> --data-binary <span class="hljs-string">&quot;performance,type=processes value=<span class="hljs-variable">$processes</span>&quot;</span><span class="hljs-built_in">sleep</span> 60<br><span class="hljs-keyword">done</span><br><br><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># git config --global user.name &quot;felix&quot;</span><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># git config --global user.email &quot;felix@demo.com&quot;</span><br><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># git add .</span><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># git commit -m &quot;add docker file&quot;</span><br>[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># git push origin main</span><br></code></pre></td></tr></table></figure><ul><li><p>what’s docker file, refer to here: </p><ul><li><a href="https://www.jianshu.com/p/1aed40d82c62">https://www.jianshu.com/p/1aed40d82c62</a></li><li><a href="https://www.runoob.com/docker/docker-dockerfile.html">https://www.runoob.com/docker/docker-dockerfile.html</a></li></ul><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/25/webp.webp" alt="img"></p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/25/webp-20221025115318212.webp" alt="img"></p><blockquote></blockquote></li></ul></li><li><p>Go to Jenkins &gt; myapp, build now</p><!--the dockerfile name must be "Dockerfile" in source code,otherwise Jenkins can not fine the dockerfile when building image--><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Started <span class="hljs-keyword">by</span> <span class="hljs-keyword">user</span> felix<br>Running <span class="hljs-keyword">as</span> <span class="hljs-keyword">SYSTEM</span><br>Building <span class="hljs-keyword">in</span> workspace /var/lib/jenkins/workspace/myapp<br>The recommended git tool <span class="hljs-keyword">is</span>: <span class="hljs-keyword">NONE</span><br><span class="hljs-keyword">using</span> credential a9ec308d-cc1a<span class="hljs-number">-4</span>d6e-bfd5<span class="hljs-number">-003325</span>dd5944<br> &gt; git rev-parse <span class="hljs-comment">--resolve-git-dir /var/lib/jenkins/workspace/myapp/.git # timeout=10</span><br>Fetching changes <span class="hljs-keyword">from</span> the remote Git repository<br> &gt; git config remote.origin.url ssh://git@<span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.85</span>/myapp/test.git # timeout=<span class="hljs-number">10</span><br>Fetching upstream changes <span class="hljs-keyword">from</span> ssh://git@<span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.85</span>/myapp/test.git<br> &gt; git <span class="hljs-comment">--version # timeout=10</span><br> &gt; git <span class="hljs-comment">--version # &#x27;git version 2.31.1&#x27;</span><br><span class="hljs-keyword">using</span> GIT_SSH <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> credentials cicdtest<br>Verifying host key <span class="hljs-keyword">using</span> known hosts file<br> &gt; git <span class="hljs-keyword">fetch</span> <span class="hljs-comment">--tags --force --progress -- ssh://git@192.168.22.85/myapp/test.git +refs/heads/*:refs/remotes/origin/* # timeout=10</span><br> &gt; git rev-parse refs/remotes/origin/main^&#123;<span class="hljs-keyword">commit</span>&#125; # timeout=<span class="hljs-number">10</span><br>Checking <span class="hljs-keyword">out</span> Revision <span class="hljs-number">6119</span>d6d79088ba5cfa8fb6eba368f51dcf5e12f1 (refs/remotes/origin/main)<br> &gt; git config core.sparsecheckout # timeout=<span class="hljs-number">10</span><br> &gt; git checkout -f <span class="hljs-number">6119</span>d6d79088ba5cfa8fb6eba368f51dcf5e12f1 # timeout=<span class="hljs-number">10</span><br><span class="hljs-keyword">Commit</span> message: &quot;add start.sh&quot;<br> &gt; git rev-list <span class="hljs-comment">--no-walk e73b7cbe817d832caef117e9adcd400906517626 # timeout=10</span><br>[myapp] $ docker build -t <span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.86</span>/demo/test <span class="hljs-comment">--pull=true /var/lib/jenkins/workspace/myapp</span><br><span class="hljs-built_in">WARNING</span>: Support <span class="hljs-keyword">for</span> the legacy ~/.dockercfg <span class="hljs-keyword">configuration</span> file <span class="hljs-keyword">and</span> file-<span class="hljs-keyword">format</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> an upcoming <span class="hljs-keyword">release</span><br>Sending build context <span class="hljs-keyword">to</span> Docker daemon  <span class="hljs-number">69.63</span>kB<br><br>Step <span class="hljs-number">1</span>/<span class="hljs-number">5</span> : <span class="hljs-keyword">From</span> centos<br>latest: Pulling <span class="hljs-keyword">from</span> library/centos<br>Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177<br>Status: Image <span class="hljs-keyword">is</span> up <span class="hljs-keyword">to</span> <span class="hljs-type">date</span> <span class="hljs-keyword">for</span> centos:latest<br> <span class="hljs-comment">---&gt; 5d0da3dc9764</span><br>Step <span class="hljs-number">2</span>/<span class="hljs-number">5</span> : <span class="hljs-keyword">USER</span> root<br> <span class="hljs-comment">---&gt; Using cache</span><br> <span class="hljs-comment">---&gt; 566a6bb50798</span><br>Step <span class="hljs-number">3</span>/<span class="hljs-number">5</span> : ENV <span class="hljs-type">PATH</span> /usr/<span class="hljs-keyword">local</span>/sbin:/usr/<span class="hljs-keyword">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin<br> <span class="hljs-comment">---&gt; Using cache</span><br> <span class="hljs-comment">---&gt; 976874dd9ea6</span><br>Step <span class="hljs-number">4</span>/<span class="hljs-number">5</span> : <span class="hljs-keyword">ADD</span> ./ /root/<br> <span class="hljs-comment">---&gt; 89f3bef76911</span><br>Step <span class="hljs-number">5</span>/<span class="hljs-number">5</span> : CMD [&quot;bash /root/start.sh&quot;]<br> <span class="hljs-comment">---&gt; Running in 27a4eec3ac71</span><br>Removing intermediate container <span class="hljs-number">27</span>a4eec3ac71<br> <span class="hljs-comment">---&gt; d3821c155ee9</span><br>Successfully built d3821c155ee9<br>Successfully tagged <span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.86</span>/demo/test:latest<br>[myapp] $ docker inspect d3821c155ee9<br><span class="hljs-built_in">WARNING</span>: Support <span class="hljs-keyword">for</span> the legacy ~/.dockercfg <span class="hljs-keyword">configuration</span> file <span class="hljs-keyword">and</span> file-<span class="hljs-keyword">format</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> an upcoming <span class="hljs-keyword">release</span><br>[myapp] $ docker push <span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.86</span>/demo/test<br><span class="hljs-built_in">WARNING</span>: Support <span class="hljs-keyword">for</span> the legacy ~/.dockercfg <span class="hljs-keyword">configuration</span> file <span class="hljs-keyword">and</span> file-<span class="hljs-keyword">format</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> an upcoming <span class="hljs-keyword">release</span><br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> tag: latest<br>The push refers <span class="hljs-keyword">to</span> repository [<span class="hljs-number">192.168</span><span class="hljs-number">.22</span><span class="hljs-number">.86</span>/demo/test]<br><span class="hljs-number">064</span>ab7092af0: Preparing<br><span class="hljs-number">74</span>ddd0ec08fa: Preparing<br><span class="hljs-number">74</span>ddd0ec08fa: Layer already <span class="hljs-keyword">exists</span><br><span class="hljs-number">064</span>ab7092af0: Pushed<br>latest: digest: sha256:<span class="hljs-number">486091</span>b0f6dab11302a808a99988b26ed52ed093beaa830c9a104c988b808805 size: <span class="hljs-number">738</span><br>Finished: SUCCESS<br></code></pre></td></tr></table></figure></li><li><p>Check harbor repository, confirm the image is created</p></li></ul><h2 id="CD-Testing-with-Rancher"><a href="#CD-Testing-with-Rancher" class="headerlink" title="CD Testing with Rancher"></a>CD Testing with Rancher</h2><ul><li><p>add below insecure access for all nodes of K8s cluster, ensure each node can access insure harbor server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;insecure-registries&quot;: [&quot;http://192.168.22.86&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload &amp;&amp; systemctl restart docker<br></code></pre></td></tr></table></figure></li><li><p>create deploy to deploy workload via Rancher</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@cicdlab001 ~]<span class="hljs-comment"># kubectl get pods -n cicdtest -o wide</span><br>NAME                    READY   STATUS    RESTARTS   AGE   IP          NODE GATES<br>test-58b7787d9d-9r2kn   1/1     Running   0          44s   10.44.0.1   cicd<br>test-58b7787d9d-sb6x5   1/1     Running   0          44s   10.36.0.2   cicd<br><br></code></pre></td></tr></table></figure></li><li><p>verify influx db - confirm the latest data already written in databa</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@rancher <span class="hljs-built_in">test</span>]<span class="hljs-comment"># curl -G &#x27;http://192.168.22.61:32002/query?pretty=true&#x27; --data-urlencode &quot;db=test&quot; --data-urlencode &quot;q=select * from performance order by time desc&quot;</span><br>&#123;<br>    <span class="hljs-string">&quot;results&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;statement_id&quot;</span>: 0,<br>            <span class="hljs-string">&quot;series&quot;</span>: [<br>                &#123;<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;performance&quot;</span>,<br>                    <span class="hljs-string">&quot;columns&quot;</span>: [<br>                        <span class="hljs-string">&quot;time&quot;</span>,<br>                        <span class="hljs-string">&quot;type&quot;</span>,<br>                        <span class="hljs-string">&quot;value&quot;</span><br>                    ],<br>                    <span class="hljs-string">&quot;values&quot;</span>: [<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:37:15.037646251Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1530626<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:37:15.000946467Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1529608<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:36:15.012783232Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1530322<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:36:14.979504738Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1529306<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:35:14.980991216Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1530004<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-10-01T16:35:14.944116291Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            1528989<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-09-29T09:59:36.859605683Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            7109601<br>                        ],<br>                        [<br>                            <span class="hljs-string">&quot;2022-09-29T09:58:36.723087558Z&quot;</span>,<br>                            <span class="hljs-string">&quot;processes&quot;</span>,<br>                            7109596<br>                        ]<br>                    ]<br>                &#125;<br>            ]<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="Configure-Grafana-to-display-the-data"><a href="#Configure-Grafana-to-display-the-data" class="headerlink" title="Configure Grafana to display the data"></a>Configure Grafana to display the data</h2><ul><li><p>Configure grafana data source with influxdb</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002101502662.png" alt="image-20221002101502662"></p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002101537582.png" alt="image-20221002101537582"></p></li><li><p>Create dashboard</p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/04/image-20221002101644194.png" alt="image-20221002101644194"></p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>cicd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内置函数，工厂函数和魔法函数</title>
    <link href="/1984/01/24/nei-zhi-han-shu-gong-han-han-shu-mo-fa-han-shu/"/>
    <url>/1984/01/24/nei-zhi-han-shu-gong-han-han-shu-mo-fa-han-shu/</url>
    
    <content type="html"><![CDATA[<h1 id="内置函数，工厂函数-和-魔法函数"><a href="#内置函数，工厂函数-和-魔法函数" class="headerlink" title="内置函数，工厂函数 和 魔法函数"></a>内置函数，工厂函数 和 魔法函数</h1><h2 id="内置函数-Built-in-Functions"><a href="#内置函数-Built-in-Functions" class="headerlink" title="内置函数 (Built-in Functions)"></a>内置函数 (Built-in Functions)</h2><p><a href="https://www.cnblogs.com/wang-yc/p/5635765.html">python3 内置函数详解</a></p><p><a href="https://docs.python.org/3/library/functions.html">Built-in Functions</a></p><p><img src="https://felixyanghui.synology.me:8441/images/2022/10/10/image-20221010105230386.png" alt="image-20221010105230386"></p><p>Python中声明每一个类系统都会加上一些默认内置方法，提供给系统调用该类的对象时使用。比如需要实例化一个对象时，需要调用该类的<strong>init</strong>方法；使用print去打印一个类时，其实调用的是<strong>str</strong>方法等等。</p><ul><li><strong>init</strong>(self, …)：<strong>初始化对象class</strong>，在创建新对象时调用。在方法里，可以初始化该对象的属性，否则调用其他时可能出“现has no attribute”错误；</li><li><strong>del</strong>(self)：释放对象，在对象被虚拟机删除之前调用；</li><li><strong>new</strong>(cls,*args,<strong>kwd)：实例的生成操作，相比</strong>init<strong>在对象实例化调用做初始化，</strong>new**方法运行在实例化阶段，修改某些实例化过程；</li><li><strong>str</strong>(self)：在使用print语句时被调用，将对象的属性值拼接成字符串返回；</li><li><strong>getitem</strong>(self, key)：获取序列的索引key对应的值，需要使用[]操作符的类需要覆盖的，等价于seq[key]；</li><li><strong>setitem</strong>(self, key, value)：类似<strong>geitem</strong>，需要seq[key]&#x3D;value操作的类需要实现该方法；</li><li><strong>len</strong>(self)：在调用内联函数len()时被调用；</li><li><strong>getattr</strong>(s, name)： 获取属性的值；</li><li><strong>setattr</strong>(s, name, value)：设置属性的值；</li><li><strong>delattr</strong>(s, name)： 删除name属性；</li><li><strong>getattribute</strong>()：<strong>getattribute</strong>()功能与<strong>getattr</strong>()类似，无条件被调用，通过实例访问属性。如果class中定义了<strong>getattr</strong>()，则<strong>getattr</strong>()不会被调用（除非显示调用或引发AttributeError异常）；</li><li><strong>gt</strong>(self, other)：判断self对象是否大于other对象；</li><li><strong>lt</strong>(self, other)：判断self对象是否小于other对象；</li><li><strong>ge</strong>(slef, other)：判断self对象是否大于或者等于other对象；</li><li><strong>le</strong>(self, other)： 判断self对象是否小于或者等于other对象；</li><li><strong>eq</strong>(self, other)：判断self对象是否等于other对象；</li><li><strong>call</strong>(self, *args)： 把实例对象作为函数调用，在一个对象后面加上()，虚拟机就会调用该<strong>call</strong>方法。</li></ul><p>内置变量：</p><ul><li><p><strong>name</strong>：标识模块的名字的一个系统变量。假如当前模块是主模块（也就是调用其他模块的模块），那么此模块名字就是”<strong>main</strong>“，通过if判断这样就可以执行“<strong>main</strong>”后面的主函数内容；假如此模块是被import的，则此模块名字为文件名字（不加后面的.py），通过if判断这样就会跳过“<strong>main</strong>”后面的内容；</p></li><li><p><strong>file</strong>：用来获得模块所在的路径的，这可能得到的是一个相对路径；</p></li><li><p><strong>package</strong>：当前文件为None，导入其他文件，指定文件所在包用 . 分割；</p></li><li><p><strong>doc</strong>：文件注释</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>.__name__<br><span class="hljs-string">&#x27;print&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>.__doc__<br><span class="hljs-string">&quot;print(value, ..., sep=&#x27; &#x27;, end=&#x27;\\n&#x27;, file=sys.stdout, flush=False)\n\nPrints the values to a stream, or to sys.stdout by default.\nOptional keyword arguments:\nfile:  a file-like object (stream); defaults to the current sys.stdout.\nsep:   string inserted between values, default a space.\nend:   string appended after the last value, default a newline.\nflush: whether to forcibly flush the stream.&quot;</span><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">dir</span>(__builtins__)<br>[<span class="hljs-string">&#x27;ArithmeticError&#x27;</span>, <span class="hljs-string">&#x27;AssertionError&#x27;</span>, <span class="hljs-string">&#x27;AttributeError&#x27;</span>, <span class="hljs-string">&#x27;BaseException&#x27;</span>, <span class="hljs-string">&#x27;BlockingIOError&#x27;</span>, <span class="hljs-string">&#x27;BrokenPipeError&#x27;</span>, <span class="hljs-string">&#x27;BufferError&#x27;</span>, <span class="hljs-string">&#x27;BytesWarning&#x27;</span>, <span class="hljs-string">&#x27;ChildProcessError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionAbortedError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionRefusedError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionResetError&#x27;</span>, <span class="hljs-string">&#x27;DeprecationWarning&#x27;</span>, <span class="hljs-string">&#x27;EOFError&#x27;</span>, <span class="hljs-string">&#x27;Ellipsis&#x27;</span>, <span class="hljs-string">&#x27;EnvironmentError&#x27;</span>, <span class="hljs-string">&#x27;Exception&#x27;</span>, <span class="hljs-string">&#x27;False&#x27;</span>, <span class="hljs-string">&#x27;FileExistsError&#x27;</span>, <span class="hljs-string">&#x27;FileNotFoundError&#x27;</span>, <span class="hljs-string">&#x27;FloatingPointError&#x27;</span>, <span class="hljs-string">&#x27;FutureWarning&#x27;</span>, <span class="hljs-string">&#x27;GeneratorExit&#x27;</span>, <span class="hljs-string">&#x27;IOError&#x27;</span>, <span class="hljs-string">&#x27;ImportError&#x27;</span>, <span class="hljs-string">&#x27;ImportWarning&#x27;</span>, <span class="hljs-string">&#x27;IndentationError&#x27;</span>, <span class="hljs-string">&#x27;IndexError&#x27;</span>, <span class="hljs-string">&#x27;InterruptedError&#x27;</span>, <span class="hljs-string">&#x27;IsADirectoryError&#x27;</span>, <span class="hljs-string">&#x27;KeyError&#x27;</span>, <span class="hljs-string">&#x27;KeyboardInterrupt&#x27;</span>, <span class="hljs-string">&#x27;LookupError&#x27;</span>, <span class="hljs-string">&#x27;MemoryError&#x27;</span>, <span class="hljs-string">&#x27;ModuleNotFoundError&#x27;</span>, <span class="hljs-string">&#x27;NameError&#x27;</span>, <span class="hljs-string">&#x27;None&#x27;</span>, <span class="hljs-string">&#x27;NotADirectoryError&#x27;</span>, <span class="hljs-string">&#x27;NotImplemented&#x27;</span>, <span class="hljs-string">&#x27;NotImplementedError&#x27;</span>, <span class="hljs-string">&#x27;OSError&#x27;</span>, <span class="hljs-string">&#x27;OverflowError&#x27;</span>, <span class="hljs-string">&#x27;PendingDeprecationWarning&#x27;</span>, <span class="hljs-string">&#x27;PermissionError&#x27;</span>, <span class="hljs-string">&#x27;ProcessLookupError&#x27;</span>, <span class="hljs-string">&#x27;RecursionError&#x27;</span>, <span class="hljs-string">&#x27;ReferenceError&#x27;</span>, <span class="hljs-string">&#x27;ResourceWarning&#x27;</span>, <span class="hljs-string">&#x27;RuntimeError&#x27;</span>, <span class="hljs-string">&#x27;RuntimeWarning&#x27;</span>, <span class="hljs-string">&#x27;StopAsyncIteration&#x27;</span>, <span class="hljs-string">&#x27;StopIteration&#x27;</span>, <span class="hljs-string">&#x27;SyntaxError&#x27;</span>, <span class="hljs-string">&#x27;SyntaxWarning&#x27;</span>, <span class="hljs-string">&#x27;SystemError&#x27;</span>, <span class="hljs-string">&#x27;SystemExit&#x27;</span>, <span class="hljs-string">&#x27;TabError&#x27;</span>, <span class="hljs-string">&#x27;TimeoutError&#x27;</span>, <span class="hljs-string">&#x27;True&#x27;</span>, <span class="hljs-string">&#x27;TypeError&#x27;</span>, <span class="hljs-string">&#x27;UnboundLocalError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeDecodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeEncodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeTranslateError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeWarning&#x27;</span>, <span class="hljs-string">&#x27;UserWarning&#x27;</span>, <span class="hljs-string">&#x27;ValueError&#x27;</span>, <span class="hljs-string">&#x27;Warning&#x27;</span>, <span class="hljs-string">&#x27;ZeroDivisionError&#x27;</span>, <span class="hljs-string">&#x27;__build_class__&#x27;</span>, <span class="hljs-string">&#x27;__debug__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__import__&#x27;</span>, <span class="hljs-string">&#x27;__loader__&#x27;</span>, <span class="hljs-string">&#x27;__name__&#x27;</span>, <span class="hljs-string">&#x27;__package__&#x27;</span>, <span class="hljs-string">&#x27;__spec__&#x27;</span>, <span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;any&#x27;</span>, <span class="hljs-string">&#x27;ascii&#x27;</span>, <span class="hljs-string">&#x27;bin&#x27;</span>, <span class="hljs-string">&#x27;bool&#x27;</span>, <span class="hljs-string">&#x27;breakpoint&#x27;</span>, <span class="hljs-string">&#x27;bytearray&#x27;</span>, <span class="hljs-string">&#x27;bytes&#x27;</span>, <span class="hljs-string">&#x27;callable&#x27;</span>, <span class="hljs-string">&#x27;chr&#x27;</span>, <span class="hljs-string">&#x27;classmethod&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;complex&#x27;</span>, <span class="hljs-string">&#x27;copyright&#x27;</span>, <span class="hljs-string">&#x27;credits&#x27;</span>, <span class="hljs-string">&#x27;delattr&#x27;</span>, <span class="hljs-string">&#x27;dict&#x27;</span>, <span class="hljs-string">&#x27;dir&#x27;</span>, <span class="hljs-string">&#x27;divmod&#x27;</span>, <span class="hljs-string">&#x27;enumerate&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;filter&#x27;</span>, <span class="hljs-string">&#x27;float&#x27;</span>, <span class="hljs-string">&#x27;format&#x27;</span>, <span class="hljs-string">&#x27;frozenset&#x27;</span>, <span class="hljs-string">&#x27;getattr&#x27;</span>, <span class="hljs-string">&#x27;globals&#x27;</span>, <span class="hljs-string">&#x27;hasattr&#x27;</span>, <span class="hljs-string">&#x27;hash&#x27;</span>, <span class="hljs-string">&#x27;help&#x27;</span>, <span class="hljs-string">&#x27;hex&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;isinstance&#x27;</span>, <span class="hljs-string">&#x27;issubclass&#x27;</span>, <span class="hljs-string">&#x27;iter&#x27;</span>, <span class="hljs-string">&#x27;len&#x27;</span>, <span class="hljs-string">&#x27;license&#x27;</span>, <span class="hljs-string">&#x27;list&#x27;</span>, <span class="hljs-string">&#x27;locals&#x27;</span>, <span class="hljs-string">&#x27;map&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;memoryview&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;next&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;oct&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;ord&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;print&#x27;</span>, <span class="hljs-string">&#x27;property&#x27;</span>, <span class="hljs-string">&#x27;quit&#x27;</span>, <span class="hljs-string">&#x27;range&#x27;</span>, <span class="hljs-string">&#x27;repr&#x27;</span>, <span class="hljs-string">&#x27;reversed&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;set&#x27;</span>, <span class="hljs-string">&#x27;setattr&#x27;</span>, <span class="hljs-string">&#x27;slice&#x27;</span>, <span class="hljs-string">&#x27;sorted&#x27;</span>, <span class="hljs-string">&#x27;staticmethod&#x27;</span>, <span class="hljs-string">&#x27;str&#x27;</span>, <span class="hljs-string">&#x27;sum&#x27;</span>, <span class="hljs-string">&#x27;super&#x27;</span>, <span class="hljs-string">&#x27;tuple&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>, <span class="hljs-string">&#x27;vars&#x27;</span>, <span class="hljs-string">&#x27;zip&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><br></code></pre></td></tr></table></figure><h2 id="工厂函数"><a href="#工厂函数" class="headerlink" title="工厂函数"></a>工厂函数</h2><ul><li><p>python2.2 之后，将类和类型进行了统一，做法就是将如下的类型 <em>内置函数</em> 转换成 <em>工厂函数</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">int</span>(),<span class="hljs-built_in">float</span>(), <span class="hljs-built_in">bool</span>(), <span class="hljs-built_in">str</span>(), <span class="hljs-built_in">list</span>(),<span class="hljs-built_in">tuple</span>(), <span class="hljs-built_in">type</span>(), <span class="hljs-built_in">dict</span>(), <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">frozenset</span>()<br></code></pre></td></tr></table></figure></li><li><p>工厂函数，就是能够产生类实例的<strong>内置函数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 普通的内置函数</span><br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">len</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;<br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">open</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;<br><br><span class="hljs-comment"># 工厂函数，就是能够产生类实例的**内置函数**</span><br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">int</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br>&gt;&gt; <span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>)<br>&gt;&gt; &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>工厂函数看上去有点像函数，实质上他们是类，当你调用它们时，实际上是生成了该类型的一个实例，就像工厂生产货物一样.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">int</span>)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">pass</span><br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(C)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>一个类定义完成就变成了类对象，所以工厂函数其实就是类对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 实例化int 对象，传入相应的参数</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;123&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;456&#x27;</span>)<br><br><span class="hljs-comment"># 实例对象还可以计算</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br><span class="hljs-number">579</span><br></code></pre></td></tr></table></figure></li><li><p>python的魔法方法还可以自定义对象的数值处理，通过对魔法方法的重写，可以自定义任何对象间的算术运算</p><table><thead><tr><th>add(self, other)</th><th>定义加法的行为：+</th></tr></thead><tbody><tr><td>sub(self, other)</td><td>定义减法的行为：-</td></tr><tr><td>mul(self, other)</td><td>定义乘法的行为：*</td></tr><tr><td>truediv(self, other)</td><td>定义真除法的行为：&#x2F;</td></tr><tr><td>floordiv(self, other)</td><td>定义整数除法的行为：&#x2F;&#x2F;</td></tr><tr><td>mod(self, other)</td><td>定义取模算法的行为：%</td></tr><tr><td>divmod(self, other)</td><td>定义当被 divmod() 调用时的行为，divmod(a, b)返回一个元组：（a&#x2F;&#x2F;b, a%b)</td></tr><tr><td>pow(self, other[, modulo])</td><td>定义当被 power() 调用或 ** 运算时的行为</td></tr><tr><td>lshift(self, other)</td><td>定义按位左移位的行为：&lt;&lt;</td></tr><tr><td>rshift(self, other)</td><td>定义按位右移位的行为：&gt;&gt;</td></tr><tr><td>and(self, other)</td><td>定义按位与操作的行为：&amp;</td></tr><tr><td>xor(self, other)</td><td>定义按位异或操作的行为：^</td></tr><tr><td>or(self, other)</td><td>定义按位或操作的行为：｜</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">New_int</span>(<span class="hljs-title class_ inherited__">int</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__sub__(self, other)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__sub__</span>(<span class="hljs-params">self, other</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.__add__(self, other)<br> <br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = New_int(<span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = New_int(<span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a + b<br>-<span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a - b<br><span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure></li></ul><h1 id="魔法方法"><a href="#魔法方法" class="headerlink" title="魔法方法"></a>魔法方法</h1><ul><li><p>魔法方法都是被双下划线包围 <code>__init__(self, param1, param2...)</code> </p><p>对象创建完后，在初始化实例对象时，该魔法方法会自动调用。可以根据需要自行改写该方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ball</span>:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br><span class="hljs-meta">... </span>            self.name = name<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">kick</span>(<span class="hljs-params">self</span>):<br><span class="hljs-meta">... </span>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;my name is %s, fuck, who kick me#@#&#x27;</span> % self.name)<br><span class="hljs-meta">... </span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = Ball(<span class="hljs-string">&#x27;土豆&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>c.kick()<br>my name <span class="hljs-keyword">is</span> 土豆, fuck, who kick me<span class="hljs-comment">#@#</span><br></code></pre></td></tr></table></figure></li><li><p>魔法方法是面向对象的python的一切，如果你不知道魔法方法，说明你还没能意识到面向对象的python的强大</p></li><li><p>魔法方法的“魔力”体现在他们总是能够在适当的时候被调用</p></li></ul><p>Python中每个魔法函数都对应了一个Python内置函数或操作，比如__str__对应str函数，__lt__对应小于号&lt;等。Python中的魔法函数可以大概分为以下几类：</p><p>类的构造、删除：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__new__(self, ...)<br><span class="hljs-built_in">object</span>.__init__(self, ...)<br><span class="hljs-built_in">object</span>.__del__(self)<br></code></pre></td></tr></table></figure><p>二元操作符：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">+<span class="hljs-built_in">object</span>.__add__(self, other)<br>-<span class="hljs-built_in">object</span>.__sub__(self, other)<br>*<span class="hljs-built_in">object</span>.__mul__(self, other)<br>//<span class="hljs-built_in">object</span>.__floordiv__(self, other)<br>/<span class="hljs-built_in">object</span>.__div__(self, other)<br>%<span class="hljs-built_in">object</span>.__mod__(self, other)<br>**<span class="hljs-built_in">object</span>.__pow__(self, other[, modulo])<br>&lt;&lt;<span class="hljs-built_in">object</span>.__lshift__(self, other)<br>&gt;&gt;<span class="hljs-built_in">object</span>.__rshift__(self, other)<br>&amp;<span class="hljs-built_in">object</span>.__and__(self, other)<br>^<span class="hljs-built_in">object</span>.__xor__(self, other)<br>|<span class="hljs-built_in">object</span>.__or__(self, other)<br></code></pre></td></tr></table></figure><p>扩展二元操作符：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">+=<span class="hljs-built_in">object</span>.__iadd__(self, other)<br>-=<span class="hljs-built_in">object</span>.__isub__(self, other)<br>*=<span class="hljs-built_in">object</span>.__imul__(self, other)<br>/=<span class="hljs-built_in">object</span>.__idiv__(self, other)<br>//=<span class="hljs-built_in">object</span>.__ifloordiv__(self, other)<br>%=<span class="hljs-built_in">object</span>.__imod__(self, other)<br>**=<span class="hljs-built_in">object</span>.__ipow__(self, other[, modulo])<br>&lt;&lt;=<span class="hljs-built_in">object</span>.__ilshift__(self, other)<br>&gt;&gt;=<span class="hljs-built_in">object</span>.__irshift__(self, other)<br>&amp;=<span class="hljs-built_in">object</span>.__iand__(self, other)<br>^=<span class="hljs-built_in">object</span>.__ixor__(self, other)<br>|=<span class="hljs-built_in">object</span>.__ior__(self, other)<br></code></pre></td></tr></table></figure><p>一元操作符：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">-<span class="hljs-built_in">object</span>.__neg__(self)<br>+<span class="hljs-built_in">object</span>.__pos__(self)<br><span class="hljs-built_in">abs</span>()<span class="hljs-built_in">object</span>.__abs__(self)<br>~<span class="hljs-built_in">object</span>.__invert__(self)<br><span class="hljs-built_in">complex</span>()<span class="hljs-built_in">object</span>.__complex__(self)<br><span class="hljs-built_in">int</span>()<span class="hljs-built_in">object</span>.__int__(self)<br>long()<span class="hljs-built_in">object</span>.__long__(self)<br><span class="hljs-built_in">float</span>()<span class="hljs-built_in">object</span>.__float__(self)<br><span class="hljs-built_in">oct</span>()<span class="hljs-built_in">object</span>.__oct__(self)<br><span class="hljs-built_in">hex</span>()<span class="hljs-built_in">object</span>.__hex__(self)<br><span class="hljs-built_in">round</span>()<span class="hljs-built_in">object</span>.__round__(self, n)<br>floor()object__floor__(self)<br>ceil()<span class="hljs-built_in">object</span>.__ceil__(self)<br>trunc()<span class="hljs-built_in">object</span>.__trunc__(self)<br></code></pre></td></tr></table></figure><p>比较函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;<span class="hljs-built_in">object</span>.__lt__(self, other)<br>&lt;=<span class="hljs-built_in">object</span>.__le__(self, other)<br>==<span class="hljs-built_in">object</span>.__eq__(self, other)<br>!=<span class="hljs-built_in">object</span>.__ne__(self, other)<br>&gt;=<span class="hljs-built_in">object</span>.__ge__(self, other)<br>&gt;<span class="hljs-built_in">object</span>.__gt__(self, other)<br></code></pre></td></tr></table></figure><p>类的表示、输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>()<span class="hljs-built_in">object</span>.__str__(self) <br><span class="hljs-built_in">repr</span>()<span class="hljs-built_in">object</span>.__repr__(self)<br><span class="hljs-built_in">len</span>()<span class="hljs-built_in">object</span>.__len__(self)<br><span class="hljs-built_in">hash</span>()<span class="hljs-built_in">object</span>.__hash__(self) <br><span class="hljs-built_in">bool</span>()<span class="hljs-built_in">object</span>.__nonzero__(self) <br><span class="hljs-built_in">dir</span>()<span class="hljs-built_in">object</span>.__dir__(self)<br>sys.getsizeof()<span class="hljs-built_in">object</span>.__sizeof__(self)<br></code></pre></td></tr></table></figure><p>类容器：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">len</span>()<span class="hljs-built_in">object</span>.__len__(self)<br>self[key]<span class="hljs-built_in">object</span>.__getitem__(self, key)<br>self[key] = value<span class="hljs-built_in">object</span>.__setitem__(self, key, value)<br><span class="hljs-keyword">del</span>[key] <span class="hljs-built_in">object</span>.__delitem__(self, key)<br><span class="hljs-built_in">iter</span>()<span class="hljs-built_in">object</span>.__iter__(self)<br><span class="hljs-built_in">reversed</span>()<span class="hljs-built_in">object</span>.__reversed__(self)<br><span class="hljs-keyword">in</span>操作<span class="hljs-built_in">object</span>.__contains__(self, item)<br>字典key不存在时<span class="hljs-built_in">object</span>.__missing__(self, key)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Github 教程</title>
    <link href="/1984/01/24/github-workflow/"/>
    <url>/1984/01/24/github-workflow/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Step-by-step"><a href="#Step-by-step" class="headerlink" title="Step by step"></a>Step by step</h1><iframe src="//player.bilibili.com/player.html?aid=561005338&bvid=BV19e4y1q7JJ&cid=846391446&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><p>1.git clone &#x2F;&#x2F; 到本地<br>2.git checkout -b xxx 切换至新分支xxx<br>（相当于复制了remote的仓库到本地的xxx分支上<br>3.修改或者添加本地代码（部署在硬盘的源文件上）<br>4.git diff 查看自己对代码做出的改变<br>5.git add 上传更新后的代码至暂存区<br>6.git commit 可以将暂存区里更新后的代码更新到本地git<br>7.git push origin xxx 将本地的xxxgit分支上传至github上的git<br>-———————————————————-<br>（如果在写自己的代码过程中发现远端GitHub上代码出现改变）<br>1.git checkout main 切换回main分支<br>2.git pull origin master(main) 将远端修改过的代码再更新到本地<br>3.git checkout xxx 回到xxx分支<br>4.git rebase main 我在xxx分支上，先把main移过来，然后根据我的commit来修改成新的内容<br>（中途可能会出现，rebase conflict —–》手动选择保留哪段代码）<br>5.git push -f origin xxx 把rebase后并且更新过的代码再push到远端github上<br>（-f —》强行）<br>6.原项目主人采用pull request 中的 squash and merge 合并所有不同的commit<br>-———————————————————————————————<br>远端完成更新后<br>1.git branch -d xxx 删除本地的git分支<br>2.git pull origin master 再把远端的最新代码拉至本地</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
